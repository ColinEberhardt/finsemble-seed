!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=187)}([,,function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)},i=Math.max;var o=function(e,t,r){return t=i(void 0===t?e.length-1:t,0),function(){for(var o=arguments,s=-1,a=i(o.length-t,0),l=Array(a);++s<a;)l[s]=o[t+s];s=-1;for(var u=Array(t+1);++s<t;)u[s]=o[s];return u[t]=r(l),n(e,this,u)}},s=r(12);function a(e,t){return o(e,t,s.a)}},,function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.LoggerConstructor=void 0;const n=r(6),i=r(40),o={Error:!0,Warn:!0,Info:!0,Log:!0,Debug:!0,Verbose:!0,LocalOnly:!1},s={Error:!0,Warn:!0,Info:!0,Log:!0,Debug:!0},a=r(59);t.LoggerConstructor=function(e){const i=this;let l;i.RouterClient=e&&e.RouterClient;let u=!1,c=!1;const d=i;let f,h,p=0,m=0;this.startupTime=0;let g=[];if("undefined"==typeof window)return;let y=n.System.Window.getCurrent().name;window.top!==window&&(y+=".Frame"),this.onLogStateChangeCallback=[];const v="finsemble.logger.client."+y;let b={console:s,dev:o,system:o,perf:o};function w(e,t,r){this.category=e,!l&&n.System.isBrowserView()&&(l=n.System.getViewId()),this.logClientName=l?`${y}: view-${l}`:y,this.logType=t,this.logData=r,this.logTimestamp=window.performance.timing.navigationStart+window.performance.now()+p}function S(e,t){e&&e.dev&&(b=e,i.onLogStateChangeCallback.forEach(t=>{t(e)})),function(e){d.system.debug("Logger updateQueueBasedOnState",e,p,"QUEUE LENGTH",g.length,b);const t=[];for(let r=0,{length:n}=g;r<n;r++)if(b[g[r].category][g[r].logType]&&!b[g[r].category].LocalOnly)e&&(g[r].logTimestamp=g[r].logTimestamp+p),t.push(g[r]);else if(b[g[r].category][g[r].logType]&&b[g[r].category].LocalOnly){const e=g[r];console.log(e.category,e.logType,e.logTimestamp-window.performance.timing.navigationStart,e.logData,"(Previously queued!)")}g=t}(t)}function C(){const{stack:e}=function(){try{throw Error("")}catch(e){return e}}(),t=(r="\n",n=4,e.split(r,n).join(r).length);var r,n;return"Log Stack: \n"+e.substring(t).substr(1)}this.onStateChanged=e=>{-1===this.onLogStateChangeCallback.indexOf(e)&&this.onLogStateChangeCallback.push(e)},this.setClientName=function(e){y=e},this.getClientName=function(){return y},this.clearMessageList=function(){g=[]},this.callStack=function(){return C()},this.setting=function(){return b};const _=console.error,E=console.warn,P=console.info,T=console.log,k=console.debug;function A(e,t){try{e.apply(console,function e(t){return t.reduce((t,r)=>t.concat(Array.isArray(r)?e(r):r),[])}(t))}catch(e){(t=[]).push(C())}}let O=()=>{g.length>0&&(i.RouterClient.transmit("logger.service.logMessages",g),d.clearMessageList())};function L(e,r,n){let i,o=!1,s=!0;"forceObjectsToLogger"===n[0]&&(o=!0,s=!1,n.splice(0,1)),n=n.map(e=>{if(s){if(function(e){const t=[],r=[e];let n=0,i=0;for(;r.length&&i<1e3;){i++;const e=r.pop();if("boolean"==typeof e)n+=4;else if("string"==typeof e)n+=2*e.length;else if("number"==typeof e)n+=8;else if("object"==typeof e&&-1===t.indexOf(e)){t.push(e);for(const t in e)r.push(e[t])}}return n}(e)>5e4)return A(P,["Message too large to send to the logger.",n]),"Log argument greater than 50KB. Check local Console to see output of the object."}return e});try{for(let e=0;e<n.length;e++)n[e]instanceof Error&&(n[e]=n[e].toString());i=new w(e,r,JSON.stringify(n))}catch(t){n.splice(0,n.length),n.push(C()),i=new w(e,r,"*** Logging Error: "+JSON.stringify(n))}if(o||!function(e){return!0===e.logData.includes("Finsemble.heartbeat")}(i))!function(e){if(g.length<2e4)g.push(e);else{console.error("Logging Queue Overflowed! Dumping queue here then continuing.",g.length);let e,r=0;for(;e=g.shift();)console.log("Message "+r++,e);t.Logger.system.error("Logging Queue Overflowed! Dumping queue in client then continuing.")}}(i);else if(++m<=5){A(P,[`"Filtered Logger Message (${m} of first 5 shown)`,i])}c&&O()}function I(){!l&&n.System.isBrowserView()&&(l=n.System.getViewId()),d.system.debug("logger.service.registering",y),i.RouterClient.query("logger.service.register",{clientName:y,clientChannel:v,uuid:n.System.Window.getCurrent().uuid,windowName:n.System.Window.getCurrent().name,viewId:l},(e,t)=>{if(e)setTimeout(I,750);else{for(const e of g)e.viewId=l;c=!0,d.system.debug("logger.service.registered"),f=t.data,"routerService"!==y?(p=h,S(f,!0)):S(f,!1),L("system","Debug",["Logger Registered"]),O()}}),i.RouterClient.addListener(v,(e,t)=>{d.system.debug("logger.client.setLogState",t.data),f=t.data,S(f,!1)})}O=a(O,"routerService"===y?100:250,{leading:!1}),this.error=function(){const e=Array.prototype.slice.call(arguments);e.push(C()),b.dev.Error&&!b.dev.LocalOnly&&L("dev","Error",e),e.unshift(`dev error (${window.performance.now()}):`),A(_,e)},this.warn=function(){if(b.dev.Warn){const e=Array.prototype.slice.call(arguments);e.push(C()),b.dev.Warn&&!b.dev.LocalOnly&&L("dev","Warn",e),b.dev.Warn&&b.dev.LocalOnly&&(e.unshift(`dev warn (${window.performance.now()}):`),A(E,e))}},this.info=function(){if(b.dev.Info){const e=Array.prototype.slice.call(arguments);0,b.dev.Info&&!b.dev.LocalOnly&&L("dev","Info",e),b.dev.Info&&b.dev.LocalOnly&&(e.unshift(`dev info (${window.performance.now()}):`),A(P,e))}},this.log=function(){if(b.dev.Log){const e=Array.prototype.slice.call(arguments);0,b.dev.Log&&!b.dev.LocalOnly&&L("dev","Log",e),b.dev.Log&&b.dev.LocalOnly&&(e.unshift(`dev log (${window.performance.now()}):`),A(T,e))}},this.debug=function(){if(b.dev.Debug){const e=Array.prototype.slice.call(arguments);0,b.dev.Debug&&!b.dev.LocalOnly&&L("dev","Debug",e),b.dev.Debug&&b.dev.LocalOnly&&(e.unshift(`dev debug (${window.performance.now()}):`),A(k,e))}},this.verbose=function(){if(b.dev.Verbose){const e=Array.prototype.slice.call(arguments);0,b.dev.Verbose&&!b.dev.LocalOnly&&L("dev","Verbose",e),b.dev.Verbose&&b.dev.LocalOnly&&(e.unshift(`dev verbose (${window.performance.now()}):`),A(k,e))}},this.system={},this.system.error=function(){const e=Array.prototype.slice.call(arguments);e.push(C()),b.system.Error&&!b.system.LocalOnly&&L("system","Error",e),e.unshift(`system error (${window.performance.now()}):`),A(_,e)},this.system.warn=function(){if(b.system.Warn){const e=Array.prototype.slice.call(arguments);e.push(C()),b.system.Warn&&!b.system.LocalOnly&&L("system","Warn",e),b.system.Warn&&b.system.LocalOnly&&(e.unshift(`system warn (${window.performance.now()}):`),A(E,e))}},this.system.info=function(){if(b.system.Info){const e=Array.prototype.slice.call(arguments);0,b.system.Info&&!b.system.LocalOnly&&L("system","Info",e),b.system.Info&&b.system.LocalOnly&&(e.unshift(`system info (${window.performance.now()}):`),A(P,e))}},this.system.log=function(){if(b.system.Log){const e=Array.prototype.slice.call(arguments);0,b.system.Log&&!b.system.LocalOnly&&L("system","Log",e),b.system.Log&&b.system.LocalOnly&&(e.unshift(`system log (${window.performance.now()}):`),A(T,e))}},this.system.debug=function(){if(b.system.Debug){const e=Array.prototype.slice.call(arguments);0,b.system.Debug&&!b.system.LocalOnly&&L("system","Debug",e),b.system.Debug&&b.system.LocalOnly&&(e.unshift(`system debug (${window.performance.now()}):`),A(k,e))}},this.system.verbose=function(){if(b.system.Verbose){var e=Array.prototype.slice.call(arguments);0,b.system.Verbose&&!b.system.LocalOnly&&L("system","Verbose",e),b.system.Verbose&&b.system.LocalOnly&&((e=Array.prototype.slice.call(arguments)).unshift(`system log (${window.performance.now()}):`),A(k,e))}},this.perf={},this.perf.error=function(){const e=Array.prototype.slice.call(arguments);e.push(C()),b.perf.Error&&!b.perf.LocalOnly&&L("perf","Error",e),e.unshift(`perf error (${window.performance.now()}):`),A(_,e)},this.perf.warn=function(){if(b.perf.Warn){const e=Array.prototype.slice.call(arguments);e.push(C()),b.perf.Warn&&!b.perf.LocalOnly&&L("perf","Warn",e),b.perf.Warn&&b.perf.LocalOnly&&(e.unshift(`perf warn (${window.performance.now()}):`),A(E,e))}},this.perf.info=function(){if(b.perf.Info){const e=Array.prototype.slice.call(arguments);0,b.perf.Info&&!b.perf.LocalOnly&&L("perf","Info",e),b.perf.Info&&b.perf.LocalOnly&&(e.unshift(`perf info (${window.performance.now()}):`),A(P,e))}},this.perf.log=function(){if(b.perf.Log){const e=Array.prototype.slice.call(arguments);0,b.perf.Log&&!b.perf.LocalOnly&&L("perf","Log",e),b.perf.Log&&b.perf.LocalOnly&&(e.unshift(`perf log (${window.performance.now()}):`),A(T,e))}},this.perf.debug=function(){if(b.perf.Debug){const e=Array.prototype.slice.call(arguments);0,b.perf.Debug&&!b.perf.LocalOnly&&L("perf","Debug",e),b.perf.Debug&&b.perf.LocalOnly&&(e.unshift(`perf debug (${window.performance.now()}):`),A(k,e))}},this.perf.verbose=function(){if(b.perf.Verbose){const e=Array.prototype.slice.call(arguments);0,b.perf.Verbose&&!b.perf.LocalOnly&&L("perf","Verbose",e),b.perf.Verbose&&b.perf.LocalOnly&&(e.unshift(`perf verbose (${window.performance.now()}):`),A(k,e))}},this.unregisterClient=function(e=null,t=Function.prototype){d.system.debug("logger.service.unregister",y,e,l),O();const r=e||{clientName:y,viewId:l};i.RouterClient.query("logger.service.unregister",r,t)},this.isLogMessage=function(e){return"logger.service.logMessages"===e},this.status="offline",this.setRouterClient=e=>{this.RouterClient=e},this.start=function(){let e;function t(){i.status="online",d.system.debug("Logger onReady",y),i.RouterClient.calibrateTimeWithRouterService(e=>{h=e,u||(i.startupTime=performance.now()-i.startupTime,I(),u=!0)})}this.startupTime=performance.now(),i.RouterClient||(console.log("No instance of the RouterClient found for this instance of the Logger. Dynamically requiring it."),i.RouterClient=r(10).default);const o=()=>{e=i.RouterClient.subscribe("Finsemble.Service.State.loggerService",(r,n)=>{"ready"===n.data.state&&(t(),i.RouterClient.unsubscribe(e))})};"routerService"===window.name?i.RouterClient.query("logger.service.register",{},e=>{e?setTimeout(o,750):o()}):i.RouterClient.onReady(o),n.System.isBrowserView()&&window.addEventListener("beforeunload",()=>{i.unregisterClient()})}},t.Logger="undefined"!=typeof window?new t.LoggerConstructor:new i.LocalLogger,t.default=t.Logger},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.System=void 0;const r="undefined"!=typeof window?window:e;class n{constructor(e,t,r){return new fin.desktop.Window(e,t)}static get getCurrent(){return fin.desktop.Window.getCurrent}static get wrap(){return fin.desktop.Window.wrap}}class i{constructor(e,t,r){return new fin.desktop.Application(e,t)}static get getCurrent(){return fin.desktop.Application.getCurrent}static get wrap(){return fin.desktop.Application.wrap}}class o{constructor(e){new fin.desktop.Notification(e)}}class s{constructor(){return new fin.desktop.System.Clipboard}static get writeText(){return fin.desktop.System.Clipboard.writeText}static get writeHTML(){return fin.desktop.System.Clipboard.writeHTML}static get writeRTF(){return fin.desktop.System.Clipboard.writeRTF}static get readText(){return fin.desktop.System.Clipboard.readText}static get readHTML(){return fin.desktop.System.Clipboard.readHTML}static get readRTF(){return fin.desktop.System.Clipboard.readRTF}}t.System=class{static get Application(){return i}static get Window(){return n}static get Notification(){return o}static get Clipboard(){return s}static async getMousePosition(e=Function.prototype){return new Promise((t,r)=>{fin.desktop.System.getMousePosition(r=>{(r.left||0===r.left)&&(r.x=r.left),(r.top||0===r.top)&&(r.y=r.top),e(null,r),t(r)},t=>{e(t,null),r(t)})})}static getMonitorInfo(e=Function.prototype){return new Promise(t=>{fin.desktop.System.getMonitorInfo(r=>{t(r),e(r)})})}static get container(){return fin.container?fin.container:"Electron"}static get isBrowserView(){return e2o.isBrowserView}static get getViewId(){return e2o.getViewId}static get hasBrowserView(){return e2o.hasBrowserView}static get fin(){return e2o||fin||{}}static get ready(){return fin.desktop.main}static getHostSpecs(e=Function.prototype){return new Promise(t=>{fin.desktop.System.getHostSpecs(r=>{t(r),e(r)})})}static get InterApplicationBus(){return fin.desktop.InterApplicationBus}static get launchExternalProcess(){return fin.desktop.System.launchExternalProcess}static get terminateExternalProcess(){return fin.desktop.System.terminateExternalProcess}static get getAllApplications(){return fin.desktop.System.getAllApplications}static get exit(){return fin.desktop.System.exit}static get clearCache(){return fin.desktop.System.clearCache}static get showDeveloperTools(){return fin.desktop.System.showDeveloperTools}static get getRuntimeInfo(){return fin.desktop.System.getRuntimeInfo||chrome.desktop.getDetails}static get addEventListener(){return fin.desktop.System.addEventListener}static get addSelectClientCertificateListener(){return fin.desktop.System.addSelectClientCertificateListener}static get addCertificateErrorListener(){return fin.desktop.System.addCertificateErrorListener}static get getVersion(){return fin.desktop.System.getVersion}static get getUpdateAvailable(){return fin.desktop.System.getUpdateAvailable}static get openUrlWithBrowser(){return fin.desktop.System.openUrlWithBrowser}static get getAllWindows(){return fin.desktop.System.getAllWindows}static get getProcessList(){return fin.desktop.System.getProcessList}static get getProtocolString(){return fin.desktop.System.getProtocolString}static get hideSplashScreen(){return fin.desktop.System.hideSplashScreen}static FinsembleReady(e){return r.FSBL&&r.FSBL.addEventListener?r.FSBL.addEventListener("onready",e):window.addEventListener("FSBLready",e)}static startupApplicationHandshake(){fin.desktop.System.startupApplicationHandshake&&fin.desktop.System.startupApplicationHandshake()}static closeApplication(e,t=Function.prototype){return new Promise(r=>{let n,i=!1;const o=()=>{i||(console.log("Attempting to terminate",e.uuid),e.terminate(()=>{t(),r()},()=>{i||(i=!0,clearInterval(n),console.log("force closing ",e.uuid),e.terminate())}))};n=setInterval(o,2e3),console.log("closing ",e.uuid),e.close(!1,()=>{console.log("app.close: successfully closed",e.uuid),i=!0,clearInterval(n),t(),r()},o)})}static isElectron(){return"Electron"===fin.container}}}).call(this,r(27))},function(e,t,r){"use strict";(function(e,n){r.d(t,"d",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return l})),r.d(t,"e",(function(){return u}));var i,o=r(2),s="function"==typeof e&&e,a="object"==typeof n&&"function"==typeof n.nextTick;function l(e){setTimeout(e,0)}function u(e){return Object(o.a)((function(t,r){e((function(){t.apply(null,r)}))}))}i=s?e:a?n.nextTick:l,t.a=u(i)}).call(this,r(39).setImmediate,r(27))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},,function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */Object.defineProperty(t,"__esModule",{value:!0});const n=r(62),i=r(4),o=new(0,n.RouterClientConstructor)({clientName:"RouterClient"});i.Logger.setRouterClient(o),t.default=o},,function(e,t,r){"use strict";t.a=function(e){return e}},,,,,function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.clone=u,t.getContainerVersion=function(e=Function.prototype){return new Promise(t=>{o.System.getVersion(r=>{const n=r.split(".").map(Number),i={major:n[0],chromium:n[1],minor:n[2],patch:n[3]};e(i),t({versionObject:i})})})},t.castToPromise=function(e){return function(){return new Promise((t,r)=>{const n=e.apply(null,Array.from(arguments));try{return n.then(t,r)}catch(e){e instanceof TypeError?t(n):r(e)}})}},t.isPercentage=function(e){if("string"!=typeof e)return!1;return-1!==e.indexOf("%")},t.crossDomain=function(e){const t=document.createElement("a");t.href=e;const r=window.location.hostname===t.hostname,n=window.location.protocol===t.protocol,i=void 0!==window.location.port?window.location.port:80,o=void 0!==t.port?t.port:80,s=i===o,l=!(r&&s&&n);return a.default.system.debug(`Launcher crossDomain=${l} (${r}:${n}:${s})`),l},t.getMonitorFromWindow=f,t.getFinWindow=h,t.getWindowDescriptor=p,t.findMonitor=m,t.getWhichMonitor=g,t.getMonitor=y,t.getMonitorFromCommand=function(e,t,r){return new Promise(n=>{y(t,t=>{l.getAllMonitors(i=>{g({commandMonitor:e,monitors:i,launchingMonitorPosition:t.position},e=>{r&&r(e),n(e)})})})})},t.windowOnMonitor=function(e,t){if(e.left>=t.left&&e.left<t.right||e.right<=t.right&&e.right>t.left)return!0;return!1},t.getMonitorByDescriptor=function(e,t){return new Promise(r=>{f(e,e=>{t&&t(e),r(e)})})},t.getMyWindowIdentifier=function(e){const t=o.System.Window.getCurrent();return new Promise(r=>{t.getOptions(n=>{let i=null;const{customData:o}=n;o&&o.component&&(i=o.component.type);const s={windowName:t.name,uuid:t.uuid,componentType:i};e&&e(s),r(s)})})},t.camelCase=function(){let e="";for(let t=0;t<arguments.length;t++)e=`${e} ${arguments[t]}`;return e.replace(/\s(.)/g,e=>e.toUpperCase()).replace(/\s/g,"").replace(/^(.)/,e=>e.toLowerCase())},t.guuid=function(){return(0,i.default)()},t.injectJS=function(e,t){const r=document.createElement("script");r.onload=t,r.type="text/javascript",r.async=!0,r.src=e;const n=document.getElementsByTagName("head")[0],i=n.getElementsByTagName("script")[0];n.insertBefore(r,i)},t.openSharedData=function(e,t){const r=FSBL.Clients.LauncherClient,n=FSBL.Clients.LinkerClient;e.multipleOpenerHandler||(e.multipleOpenerHandler=function(e){let t,r=0;for(const n of Object.keys(e))e[n].length>r&&(t=n,r=e[n].length);return[t]});const i=[],o={};r.getComponentsThatCanReceiveDataTypes({dataTypes:Object.keys(e.data)},(s,l)=>{for(const e of Object.keys(l))if(l[e].componentTypes.length)for(const t of l[e].componentTypes)o[t]?o[t].push(e):o[t]=[e];else{const t="No Components Available to Handle the type: "+e;i.push(t),a.default.system.error(t)}let u=Object.keys(o);if(u.length){u.length>1&&(u=e.multipleOpenerHandler(o));const s=Object.keys(n.channels);if(s.length){if(n.getLinkedComponents({componentTypes:u,windowIdentifier:n.windowIdentifier()}).length||e.publishOnly)n.publish({dataType:"Finsemble.DragAndDropClient",data:e.data}),t&&t(i.length?i:null,"Data published");else{for(const t of u)r.spawn(t,{data:{sharedData:e.data,linker:{channels:s}},addToWorkspace:!0});t&&t(i.length?i:null,"Linked Window(s) spawned with data")}}else if(!e.publishOnly){for(const t of u)r.spawn(t,{data:{sharedData:e.data},addToWorkspace:!0});t&&t(i.length?i:null,"New Window(s) spawned with data")}}else t&&t(i.length?i:null,null)})},t.getNewBoundsWhenMovedToMonitor=function(e,t,r="availableRect"){const n=e[r]||e.availableRect||e.monitorRect,i=u(t);t.top<n.top?i.top=n.top:t.top>n.bottom-t.height&&(i.top=n.bottom-t.height);t.left<n.left?i.left=n.left:t.left>n.right-t.width&&(i.left=n.right-t.width);i.bottom=i.top+i.height,i.right=i.left+i.width,i.right>n.right&&(i.right=n.right);i.top<n.top&&(i.top=n.top);i.left<n.left&&(i.left=n.left);i.bottom>n.bottom&&(i.bottom=n.bottom);i.height=i.bottom-i.top,i.width=i.right-i.left;const o=Math.sqrt((t.left-i.left)**2+(t.top-i.top)**2);return{newBounds:i,distanceMoved:o,monitor:e}},t.isOnAMonitor=function(e){return this.Monitors.allMonitors.some(t=>{const{monitorRect:r}=t;return e.left>=r.left&&e.left<=r.right&&e.right>=r.left&&e.right<=r.right&&e.top>=r.top&&e.top<=r.bottom&&e.bottom>=r.top&&e.bottom<=r.bottom})},t.adjustBoundsToBeOnMonitor=function(e,t="availableRect"){if(this.isOnAMonitor(e))return a.default.system.info("Launcher.adjustWindowDescriptorBoundsToBeOnMonitor: on monitor."),e;const r=this.Monitors.allMonitors.map(r=>{let n=r.rawMonitor?r.rawMonitor:r;return this.getNewBoundsWhenMovedToMonitor(n,e,t)}).sort((e,t)=>e.distanceMoved-t.distanceMoved)[0];return a.default.system.info("Launcher.adjustWindowDescriptorBoundsToBeOnMonitor: not on monitor.  bounds",e,"monitor name",r.monitor.name,"newBounds",r.newBounds),r.newBounds},t.isWindows=async function(e=Function.prototype){const t=(await o.System.getHostSpecs()).name.toUpperCase().includes("WINDOWS");return e(t),t},t.getWindowType=function(e){if(e.windowType&&!["assimilation","assimilated","native","application","NativeWindow","FinsembleNativeWindow","CompoundWindow","WebWindow","WebApplication","StackedWindow"].includes(e.windowType))return a.default.system.error(`Invalid windowType: ${e.windowType}, defaulting to windowType: WebWindow`),"WebWindow";let t=e.windowType||"WebWindow";switch(e.windowType){case"assimilation":case"assimilated":t="NativeWindow";break;case"native":t="FinsembleNativeWindow";break;case"application":t="WebApplication";break;case"Web":t="WebWindow";break;case"StackedWindow":t="StackedWindow"}e.native&&(t="NativeWindow");e.compound&&(t="CompoundWindow");return t},t.getMonitorFromXY=t.getAllMonitors=t.Monitors=void 0;var i=n(r(41)),o=r(6),s=n(r(64)),a=n(r(4));
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */
const l=new s.default(Function.prototype,Function.prototype,{System:o.System});function u(e,t){if(null===e||"object"!=typeof e)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);t=t||new e.constructor;for(const r in e)t[r]=void 0===t[r]?u(e[r],null):t[r];return t}t.Monitors=l;var{getAllMonitors:c}=l;t.getAllMonitors=c;var d=l.getMonitorFromScaledXY;function f(e,t){const r=Number.isFinite(e.x)?e.x:e.defaultLeft,n=Number.isFinite(e.y)?e.y:e.defaultTop,i=r+e.defaultWidth,o=n+e.defaultHeight;return new Promise((e,s)=>{l.getMonitorFromScaledXY(r,n,c=>{if(!c)return a.default.system.debug("getMonitorFromWindow - top-left is off screen, trying bottom right"),void l.getMonitorFromScaledXY(i,o,i=>{if(!i)return a.default.system.debug("getMonitorFromWindow - bottom-right is off screen, getting primary"),void l.getAllMonitors(r=>{r[0]?(t&&t(r[0]),e(r[0])):(s(new Error("Cannot find monitor for window.")),t&&t(null))});i=u(i);const{monitorRect:o}=i;(o.left<r||o.right<n)&&(i.straddling=!0),t&&t(i),e(i)});c=u(c);const{monitorRect:d}=c;(d.right>i||d.bottom>o)&&(c.straddling=!0),t&&t(c),e(c)})})}function h(e,t){return new Promise((r,n)=>{const i=o.System.Window.getCurrent();i.getOptions(s=>{if(e&&e.windowName){e.uuid||(e.uuid=s.uuid);const i=o.System.Window.wrap(e.uuid,e.windowName);i.getInfo(()=>{t&&t(i),r(i)},()=>{t&&t(null),n(`Window ${e.windowName} not found. UUID: ${e.uuid}`),console.debug(`util.getFinWindow: Window ${e.windowName} not found`)})}else if(e&&e.componentType)if(void 0!==window.LauncherService){const i=window.LauncherService.componentFinder(e);i?(r(i),t&&t(i)):(n(`util.getFinWindow: Component ${e.componentType} not found.`),t&&t(null))}else n("getFinWindow by componentType is currently only operable within LaunchService"),t&&t(null);else t&&t(i),r(i)})})}function p(e,t){return new Promise((r,n)=>{h(e).then(e=>{e.getOptions(e=>{t&&t(e),r(e)})}).catch(e=>{console.warn(e),t&&t(null),n(e)})})}function m(e,t,r){for(let n=0;n<e.length;n++){const i=e[n];if(i[t]===r)return i}return null}function g(e,t){let r;arguments.length>2&&(e={commandMonitor:arguments[0],monitors:arguments[1],launchingMonitorPosition:arguments[2]},t=null);let{commandMonitor:n,monitors:i,launchingMonitorPosition:o}=e;const s=n&&""!==n||0===n;if("primary"===n)r=m(i,"whichMonitor","primary");else if("next"===n){let e=o+1;e>=i.length&&(e=0),r=i[e]}else if("previous"===n){let e=o-1;e<0&&(e=i.length-1),r=i[e]}else if("mine"===n){var a=!0;activeWindows.getWindow(e.windowIdentifier.windowName)._getBounds((e,n)=>{e?(r=i[0],t(r)):l.getMonitorFromScaledXY(n.left,n.top,e=>{t(e)})})}else s?(n>=i.length&&(n=i.length-1),r=i.filter(e=>e.position===n)[0]):o&&(r=i[o]);if(r||(r=i[0]),!a){if(!t)return r;t(r)}}function y(e,t){return new Promise((r,n)=>{p(e,e=>{e?f(e,e=>{t&&t(e),r(e)}):n("util.getMonitor: Can't locate windowDescriptor.")})})}t.getMonitorFromXY=d},function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigUtilInstance=void 0;var i=n(r(17)),o=n(r(4)),s=r(6);
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */
const a=new function(){const e=this;this.resolveConfigVariables=function(e,t){let r=0,n=0,i=!0;function s(e){const t=e.split(/[/\\:?=&\s]/);for(let r=0;r<t.length;r++)if("$"===t[r][0]){const n=t[r].substring(1);let s=a(n);if(void 0!==s){const a=e.replace(t[r],s);o.default.system.verbose("forceObjectsToLogger","ConfigUtil.resolveConfigVariables:resolveString configString",t[r],n,s,"old value=",e,"value=",a),i=!0,e=a}}return e}function a(t){let r=e[t];return void 0===r&&(e.custom?(r=e.custom[t],void 0===r&&o.default.system.warn("ConfigUtil.resolveString",`Missing [${t}] variable from finsemble.custom configuration object`)):o.default.system.error("ConfigUtil.resolveString",'Missing "custom" node from finsemble configuration - unable to get variable resoution for variable: '+t)),r}function l(e,t,r){e=e||{},o.default.system.verbose("forceObjectsToLogger","ConfigUtil.resolveConfigVariables:resolveObject","pass",t,"recursionLevel",r,"configObject:",e),Object.keys(e).forEach(n=>{const i=e[n];"string"==typeof i&&i.indexOf("$")>-1?e[n]=s(i):i instanceof Array?function e(t,r,n){o.default.system.verbose("forceObjectsToLogger","resolveArray","pass",r,"recursionLevel",n,"configArray:",t);for(let i=0;i<t.length;i++){const o=t[i];"string"==typeof o&&o.indexOf("$")>-1?t[i]=s(o):o instanceof Array?e(o,r,n+1):"object"==typeof o&&l(o,r,n+1)}}(i,t,r+1):"object"==typeof i&&l(i,t,r+1)})}for(;i&&n++<100;)i=!1,l(t,++r,1);n>=100&&o.default.system.error("forceObjectsToLogger","resolveConfigVariables exceeded maximum passes so continuing -- probably a recursive macro definitions.  Look in this config for unresolved macro variables",e)},this.getExpandedRawManifest=function(t,r){o.default.system.debug("ConfigUtil.getExpandedRawManifest starting"),s.System.ready(()=>{const n=s.System.Application.getCurrent();!function t(n,i,a){o.default.system.debug("forceObjectsToLogger","ConfigUtil.getExpandedRawManifest:getRawManifest",i,a),i.getManifest(t=>{o.default.system.debug("forceObjectsToLogger","ConfigUtil.getExpandedRawManifest:getExpandedRawManifest: manifest retrieved. Pre-variable resolution",t),e.resolveConfigVariables(t.finsemble,t.finsemble),o.default.system.debug("forceObjectsToLogger","ConfigUtil.getExpandedRawManifest:getExpandedRawManifest:Complete. post-variable resolution",t),n(t)},e=>{e&&(o.default.system.error("ConfigUtil.getExpandedRawManifest:application.getManifest:err",e),r&&r()),i.getParentUuid(e=>{const r=s.System.Application.wrap(e);o.default.system.debug("forceObjectsToLogger","uuid",e,"parentApplication",r),a<10?t(n,r,++a):n("could not find manifest in parent applications")})})}(t,n,1)})},this.readConfigFile=function(e,t){o.default.system.debug("fetching "+e),fetch(e,{credentials:"include",cache:"no-cache"}).then(e=>e.json()).catch(r=>{t(`Failure importing ${e}: ${r}`,null)}).then(e=>{t(null,e)})},this.getInitialManifest=function(t){s.System.ready(()=>{s.System.Application.getCurrent().getManifest(r=>{r.finsemble=r.finsemble||{},e.resolveConfigVariables(r.finsemble,r.finsemble),r.finsemble.applicationRoot||o.default.system.error("FATAL ERROR: applicationRoot was not defined in manifest file.");const n=r.finsemble.moduleRoot+"/configs/core/config.json";e.readConfigFile(n,(i,s)=>{i?o.default.system.error(`ConfigUtil.getInitialManifest:getCoreConfig:failed importing into finsemble config. $moduleRoot=${r.finsemble.moduleRoot}; Full Path=${n}`,i):(Object.keys(s).forEach(e=>{if("importConfig"===e){r.finsemble.importConfig=r.finsemble.importConfig||[];for(let e=0;e<s.importConfig.length;e++)r.finsemble.importConfig.unshift(s.importConfig[e])}else if("importThirdPartyConfig"===e){r.finsemble.importThirdPartyConfig=r.finsemble.importThirdPartyConfig||[];for(let e=0;e<s.importThirdPartyConfig.length;e++)r.finsemble.importThirdPartyConfig.unshift(s.importThirdPartyConfig[e])}else r.finsemble[e]=s[e]}),e.resolveConfigVariables(r.finsemble,r.finsemble),o.default.system.debug("forceObjectsToLogger","ConfigUtil.getInitialManifest:getCoreConfig:Initial Manifest after variables Resolved",r)),t(r)})})})},this.promptAndSaveJSONToLocalFile=function(e,t){o.default.system.debug("saveJSONToLocalFile",e,t);const r=JSON.stringify(t,null,"\t"),n="data:application/json;charset=utf-8,"+encodeURIComponent(r),i=e+".json",s=document.createElement("a");s.setAttribute("href",n),s.setAttribute("download",i),s.click()},this.configFormatForExport=function(e,t){o.default.system.debug("configFormatForExport starting",e,t);let r=i.default.clone(t);if("raw"===e);else if("all"===e)delete r.importConfig,delete r.comment;else if("application"===e)delete r.importConfig,delete r.comment,delete r.system,delete r.services;else if("workspace"===e)r={workspace:r};else if("workspaceTemplate"===e){const e={};e[r.name]=r,r={workspaceTemplates:e}}else"services"===e?r=r.services:"components"===e&&(r=r.components);return r},this.getDefault=function(e,t,r){let n=r;if(e){try{const r=t.split(".");let i=e;for(let e=1;e<r.length;e++)i=i[r[e]];n=i}catch(e){n=r}void 0===n&&(n=r)}return n},this.getFile=async function(e,t=Function.prototype){o.default.system.debug("fetching import "+e);let r=null;return await fetch(e,{credentials:"include",cache:"no-cache"}).then(e=>e.json()).catch(r=>{t(`failure importing ${e}: ${r}`,null)}).then(e=>{t(null,e),r=e}),r}};t.ConfigUtilInstance=a},function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(74));
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var o=new function(){function e(e,t,r){const n=function(){try{throw Error("")}catch(e){return e}}(),i=n.stack.split("\n")[5],o=i.indexOf("at "),s=i.slice(o+2,i.length),a=n.stack.split("\n")[6],l=a.indexOf("at "),u=a.slice(l+2,a.length);console.warn(`parameter validation failed: parameter ${e} is of type '${typeof t}' but should be of type '${r}' in${s} called by${u}`)}this.args=function(){let t=!0;if(i.default.validationEnabled()){const r=arguments.length;if((r+1)%2!=0)for(let n=0;n<r;n+=2){let r=!1;const i=arguments[n];let o=arguments[n+1];if("="===o.slice(-1)&&(o=o.slice(0,-1),r=!0),typeof i!==o&&!(r&&void 0===i||void 0!==i&&"any"===o)){e(n/2+1,i,o),t=!1;break}}else console.warn("validate.args requires even number of parameters: "+JSON.stringify(arguments))}return t},this.args2=function(){let t=!0;if(i.default.validationEnabled()){const r=arguments.length;if((r+1)%3!=0)for(let n=0;n<r;n+=3){let r=!1;const i=arguments[n],o=arguments[n+1];let s=arguments[n+2];if("="===s.slice(-1)&&(s=s.slice(0,-1),r=!0),typeof o!==s&&!(r&&void 0===o||void 0!==o&&"any"===s)){e(i,o,s),t=!1;break}}else console.warn("validate.args requires even number of parameters: "+JSON.stringify(arguments))}return t}};t.default=o,e.exports=t.default},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(10)),o=n(r(4)),s=r(47),a=r(34),l=r(38);const u=new class{publishBootStatus(e,t,r){console.log("publishStartingStatus",e,r),o.default.system.debug("publishBootStatus",e,t,r),i.default.publish(l.statusChannel(e),{name:e,type:t,state:r})}waitForBootStage(e,t,r=Function.prototype){return new Promise((n,l)=>{o.default.system.debug("SystemManagerClient.waitForBootStage entry",e,t);const u=s.ALL_BOOT_STAGES.indexOf(e);"microkernel"===e&&"stageEntered"===t&&o.default.system.error("Cannot wait on `stageEntered` for microkernel because router isn't up yet. So will instead wait for microkernal stage complete.");const c=i.default.subscribe(a.STAGE_CHANNEL,(a,d)=>{if(o.default.system.debug("SystemManagerClient.waitForBootStage new stage",d.data.stage,c),a)o.default.system.error("SystemManagerClient.waitForBootStage subscribe error",a),r(a),l(a);else if(-1===u)a="illegal stage argument",o.default.system.debug("SystemManagerClient.waitForBootStage subscribe error",a,e),r(a),l(a);else{const a=s.ALL_BOOT_STAGES.indexOf(d.data.stage);o.default.system.debug("SystemManagerClient.waitForBootStage new stage",d.data,c),"stageEntered"===t&&a+1>=u?(o.default.system.debug("SystemManagerClient.waitForBootStage stageEntered",e,c,r.name),r(),n(),i.default.unsubscribe(c)):"stageCompleted"===t&&a>=u?(o.default.system.debug("SystemManagerClient.waitForBootStage completed",e,c),r(),n(),i.default.unsubscribe(c)):o.default.system.debug(`SystemManagerClient.waitForBootStage else currentStageIndex=${a} stageIndex=${u} `,a,u,e,c)}})})}waitForStartup(e,t=Function.prototype){return new Promise((r,n)=>{o.default.system.debug("SystemManagerClient.waitForStartup."+e,e);const s=i.default.subscribe(l.statusChannel(e),(a,l)=>{o.default.system.debug("SystemManagerClient.waitForStartup subscribe",e,a,l),a?(o.default.system.error("SystemManagerClient.waitForStartup subscribe error",a),t(a),n()):l.data.name===e&&"completed"===l.data.state&&(o.default.system.debug("SystemManagerClient.waitForStartup completed",e),t(),r(),i.default.unsubscribe(s))})})}publishCheckpointState(e,t,r){console.log("publishCheckpoint",e,t,r,l.checkpointChannel(e,t)),o.default.system.debug("publishCheckpoint",e,t,r,l.checkpointChannel(e,t)),i.default.publish(l.checkpointChannel(e,t),{windowName:e,checkpointName:t,state:r})}showSystemLog(){o.default.system.debug("SystemManagerClient.showSystemLog"),i.default.transmit(a.SHOW_SYSLOG_CHANNEL,!0)}systemLog(e,t){o.default.system.debug("SystemManagerClient.systemLog",e,t),i.default.transmit(a.SYSLOG_CHANNEL,{params:e,logMessage:t})}};t.default=u},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(26),o=n(r(19)),s=r(22),a=n(r(20)),l=n(r(4));class u extends s._BaseClient{constructor(e){super(e),this.listeners=[],this.changeSub=e=>{this.subs||(this.subs={}),this.subs[e]||(this.routerClient.query("configService.addListener",e,t=>{t&&l.default.system.error("Error adding listener to config service",t),this.routerClient.subscribe(e,this.handleChanges)}),this.subs[e]=!0)},this.handleChanges=(e,t)=>{e&&l.default.system.error(e),t.data.field||(t.data.field=null);const r=t.data.storeData?t.data.storeData:t.data.value;this.triggerListeners(t.data.field?t.data.field:"configService",r)},this.triggerListeners=(e,t)=>{if(this.listeners[e])for(let r=0;r<this.listeners[e].length;r++)"function"==typeof this.listeners[e][r]?this.listeners[e][r](null,{field:e,value:t}):l.default.system.warn("ConfigClient:triggerListeners: listener is not a function",e)},this.set=(e,t)=>{l.default.system.debug("ConfigClient.Set",e),"function"==typeof e?(t=e,o.default.args(t,"function"),e={}):o.default.args(e,"object",t,"function"),this.routerClient.query("config.set",e,(e,r)=>{t(e,r?r.data:null)})},this.processAndSet=this.processAndSet.bind(this),this.getValue=this.getValue.bind(this),this.getValues=this.getValues.bind(this),this.setValue=this.setValue.bind(this),this.setValues=this.setValues.bind(this),this.removeValue=this.removeValue.bind(this),this.removeValues=this.removeValues.bind(this),this.addListener=this.addListener.bind(this),this.addListeners=this.addListeners.bind(this),this.removeListener=this.removeListener.bind(this),this.removeListeners=this.removeListeners.bind(this),this.setPreference=this.setPreference.bind(this),this.getPreferences=this.getPreferences.bind(this)}getValue(e,t=Function.prototype){"string"==typeof e&&(e={field:e});return new Promise((r,n)=>{if(!e.field){const e="no field provided";return n(e),t(e)}this.routerClient.query("configService.getValue",{field:e.field},(e,i)=>e?(n(e),t(e)):(r({err:e,data:i.data}),t(e,i.data)))})}getValues(e,t=Function.prototype){if("function"==typeof e&&(t=e,e=null),e&&!Array.isArray(e))return this.getValue(e,t);return new Promise(r=>{this.routerClient.query("configService.getValues",{fields:e},(e,n)=>e?t(e):(r({err:e,data:n.data}),t(e,n.data)))})}setValue(e,t){const r={field:e.field,value:e.value};return this.routerClient.query("configService.setValue",r,e=>t?t(e):null)}setValues(e,t){return e?Array.isArray(e)?this.routerClient.query("configService.setValues",e,e=>t?t(e):null):l.default.system.error("ConfigClient.SetValues. Params must be an array"):l.default.system.error("ConfigClient.SetValues. No params given")}removeValue(e,t=Function.prototype){if(void 0!==e){if(e.field||"string"!=typeof e)return t("no field provided");e={field:e}}return e.value=null,this.setValue(e,t)}removeValues(e,t=Function.prototype){if(!Array.isArray(e))return t("The passed in parameter needs to be an array");i.map(e,this.removeValue,(e,r)=>t(e,r))}addListener(e,t,r){let n=null;"function"==typeof e&&(t=e,e={field:n}),({field:n}=e);const i="configService"+(n?"."+n:"");return this.listeners[i]?this.listeners[i].push(t):this.listeners[i]=[t],this.changeSub(i),r?r():null}addListeners(e,t,r){if(!Array.isArray(e))return this.addListener({field:e.field},t,r);for(let r=0;r<e.length;r++){let i=null;const o=e[r];var n;"string"==typeof o?i=o:o.field&&(({field:i}=o),n=o.listener);const s="configService"+(i?"."+i:"");n||t&&"function"==typeof t&&(n=t),this.listeners[s]?this.listeners[s].push(n):this.listeners[s]=[n],this.changeSub(s)}return r?r():null}removeListener(e,t,r){let n=null;"function"==typeof e&&(r=t,t=e,e={field:n}),({field:n}=e);const i=this.name+(n?"."+n:"");if(this.listeners[i])for(let e=0;e<this.listeners[i].length;e++)if(this.listeners[i][e]===t)return this.listeners[i].pop(e),r?r(null,!0):null;return r?r(null,!1):null}removeListeners(e,t,r){if(!Array.isArray(e))return"function"==typeof e?this.removeListener({},e,r):e.field&&this.removeListener(e,t,r),r("missing fields");let n=0;for(let r=0;r<e.length;r++){let o=null;const s=e[r];var i;"string"==typeof s?o=s:s.field&&(({field:o}=s),i=e[r].listener);const a="configService"+(o?"."+o:"");if(!i){if(!t||"function"!=typeof t)continue;i=t}for(let e=0;e<this.listeners[a].length;e++)this.listeners[a][e]===i&&(this.listeners[a].pop(r),n++)}return n<e.length?r("All listeners could not be found",!1):r?r(null,!0):null}get(e,t){l.default.system.debug("ConfigClient.Get",e),l.default.system.warn("This functionality has been deprecated. It will be removed in Finsemble version 3.0. Use getValue instead.",e),1===arguments.length?(t=e,o.default.args(t,"function"),e={}):o.default.args(e,"object",t,"function"),this.routerClient.query("config.get",e,(e,r)=>{t(e,r?r.data:null)})}processAndSet(e,t){if(l.default.system.debug("ConfigClient.processAndSet",e),o.default.args(e,"object",t,"function=")&&o.default.args2("params.newConfig",e.newConfig,"object","params.overwrite",e.overwrite,"boolean=","params.replace",e.replace,"boolean="),!e.overwrite&&e.replace){const e="cannot use replace option unless overwrite is also true";l.default.system.warn("ConfigClient.processAndSet:",e),t&&t(e,null)}else this.routerClient.query("config.processAndSet",e,(e,r)=>{t&&t(e,r?r.data:null)})}setPreference(e,t){this.routerClient.query("PreferencesService.setPreference",e,(e,r)=>{t&&t(e,r?r.data:null)})}async getPreferences(e,t){l.default.system.debug("ConfigClient.getPreferences",e),"function"==typeof e&&(t=e,e=null),await a.default.waitForStartup("preferencesService"),this.routerClient.query("PreferencesService.getPreferences",e,(e,r)=>{l.default.system.debug("ConfigClient.getPreferences response",r),t&&t(e,r?r.data:null)})}}const c=new u({startupDependencies:{services:["configService"]},onReady(e){e&&e()},name:"configClient"});t.default=c},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t._BaseClient=void 0;
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */
const i=n(r(10)),o=n(r(19)),s=n(r(4)),a=r(6),l=n(r(54)),u=r(55);class c extends l.default{constructor(e){super({name:e.name,sourceType:e.name.replace("Client","")}),this.status="offline",this.startupTime=0,this.initialized=!1,this.startupDependencies={services:[],clients:[]},this.finsembleWindow=null,this.windowName="",this.clientReadyQueue=[],this.processClientReadyQueue=()=>{for(const e of this.clientReadyQueue)e();this.clientReadyQueue=[]},this.onReady=e=>{this.clientReadyQueue.push(e),"online"===this.status&&this.processClientReadyQueue()},this.setClientOnline=()=>{this.status="online";const e=`STARTUP:CLIENT ONLINE:${this.finWindow.name}:${this.name}`;this.startupTime=window.performance.now()-this.startupTime;const t=()=>{this.logger.system.debug(e),this.processClientReadyQueue(),u.FSBLDependencyManagerSingleton.setClientOnline(this.name)};this._onReady?this._onReady(t):t()},this.initialize=(e=Function.prototype)=>{this.initialized||(this.initialized=!0,this.startupTime=performance.now(),this.routerClient.onReady(()=>{this.finWindow=a.System.Window.getCurrent(),this.windowName=this.finWindow.name,this.logger.system.debug("Baseclient Init Router Ready",this.name),u.FSBLDependencyManagerSingleton.startup.waitFor(this.startupDependencies,()=>{e(),this.setClientOnline()})}))},this.onClose=e=>{this.cleanup(),e&&e()},this.name=e.name,this._onReady=e.onReady,this.startupDependencies=e.startupDependencies||{services:[],clients:[]},this.logger=s.default,this.routerClient=i.default}addEventListener(e,t){super.addEventListener(e,t)}}t._BaseClient=c;t.default=function(e){o.default.args(e,"object=");const t=this;let r,n="offline";this.startupTime=0,e&&(e.onReady&&({onReady:r}=e),this.name=e.name),this.initialized=!1,this.startupDependencies=e.startupDependencies||{services:[],clients:[]},this.routerClient=i.default,this.finWindow=null,this.finsembleWindow=null,this.windowName="",this.requiredServices=[],this.requiredClients=[],this.clientReadyQueue=[],this.processClientReadyQueue=function(){for(let e=0;e<this.clientReadyQueue.length;e++){const t=this.clientReadyQueue[e];"function"==typeof t&&t()}this.clientReadyQueue=[]},this.onReady=function(e){this.clientReadyQueue.push(e),"online"===n&&this.processClientReadyQueue()},this.setClientOnline=function(){n="online";const e=`STARTUP:CLIENT ONLINE:${t.finWindow.name}:${t.name}`;t.startupTime=performance.now()-t.startupTime,r?r(()=>{s.default.system.debug(e),t.processClientReadyQueue(),u.FSBLDependencyManagerSingleton.setClientOnline(t.name)}):(s.default.system.debug(e),t.processClientReadyQueue(),u.FSBLDependencyManagerSingleton.setClientOnline(t.name))},this.initialize=function(e=Function.prototype){t.initialized||(t.initialized=!0,t.setClientOnline=t.setClientOnline.bind(t),t.startupTime=performance.now(),t.routerClient.onReady(()=>{t.finWindow=a.System.Window.getCurrent(),t.windowName=t.finWindow.name,s.default.system.debug("Baseclient Init Router Ready",t.name),u.FSBLDependencyManagerSingleton.startup.waitFor({clients:t.startupDependencies.clients||[]},()=>{e(),t.setClientOnline()})}))},this.onClose=function(){}}},,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MOVE_REASON=t.LAUNCHER_SERVICE=t.HEARTBEAT_TIMEOUT_CHANNEL=t.COMPONENT_STATE_STORAGE_TOPIC=t.WINDOW_SERVICE_REQUESTS=t.WORKSPACE=t.WINDOW=t.INTERRUPTIBLE_EVENTS=t.EVENT_INTERRUPT_CHANNEL=t.DOCKING=t.SERVICE_STOP_CHANNEL=t.SERVICE_START_CHANNEL=t.WINDOWSTATE=t.SERVICES_STATE_CHANNEL=t.CLIENT_SERVER_MAPPING=t.SERVICE_QUERY_READY_CHANNEL=t.SERVICE_CLOSED_CHANNEL=t.SERVICE_CLOSING_CHANNEL=t.SERVICE_READY_CHANNEL=t.SERVICE_INITIALIZING_CHANNEL=t.APPLICATION_STATE_CHANNEL=t.WRAPPERS=void 0,t.WRAPPERS={EVENTS:["title-changed","bringToFront","setBounds","alwaysOnTop","setOpacity"]},t.APPLICATION_STATE_CHANNEL="Finsemble.Application.State",t.SERVICE_INITIALIZING_CHANNEL="Finsemble.ServiceManager.serviceInitializing",t.SERVICE_READY_CHANNEL="Finsemble.ServiceManager.serviceReady",t.SERVICE_CLOSING_CHANNEL="Finsemble.ServiceManager.serviceClosing",t.SERVICE_CLOSED_CHANNEL="Finsemble.ServiceManager.serviceClosed",t.SERVICE_QUERY_READY_CHANNEL=e=>"Finsemble.ServiceManager.queryReady."+e,t.CLIENT_SERVER_MAPPING=e=>({authenticationClient:"authenticationService",configClient:"configService",distributedStoreClient:"dataStoreService",hotkeysClient:"hotkeysService",linkerClient:"linkerService",logger:"loggerService",searchClient:"searchService",storageClient:"storageService",windowClient:"windowService",workspaceClient:"workspaceService"}[e]),t.SERVICES_STATE_CHANNEL="Finsemble.State.Services",function(e){e[e.NORMAL=0]="NORMAL",e[e.MINIMIZED_WAS_NORMAL=1]="MINIMIZED_WAS_NORMAL",e[e.MAXIMIZED=2]="MAXIMIZED",e[e.MINIMIZED_WAS_MAXIMIZED=3]="MINIMIZED_WAS_MAXIMIZED",e[e.TRANSITIONING=4]="TRANSITIONING"}(t.WINDOWSTATE||(t.WINDOWSTATE={})),t.SERVICE_START_CHANNEL="Finsemble.Service.Start",t.SERVICE_STOP_CHANNEL="Finsemble.Service.Stop",t.DOCKING={GROUP_UPDATE:"DockingService.groupUpdate",WORKSPACE_GROUP_UPDATE:"Finsemble.WorkspaceService.groupUpdate",REQUEST_PUBLISH:"DockingService.requestGroupDataPublish"},t.EVENT_INTERRUPT_CHANNEL="Finsemble.Event.Interrupt",t.INTERRUPTIBLE_EVENTS=["close-requested","closed","close-complete","_container-close-handlers"],t.WINDOW={DELAYABLE_EVENTS:["close-requested","closed","close-complete","_container-close-handlers"],CANCELABLE_EVENTS:["close-requested"]},t.WORKSPACE={DELAYABLE_EVENTS:["load-requested","close-requested","save-requested"],CANCELABLE_EVENTS:["close-requested"],CLEAN_SHUTDOWN:"Finsemble.Workspace.cleanShutdown",UPDATE_PUBSUB:"Finsemble.WorkspaceService.update",STORAGE_TOPIC:"finsemble.workspace",CACHE_STORAGE_TOPIC:"finsemble.workspace.cache",ALL_WORKSPACES:"finsemble.allWorkspaces",ACTIVE_WORKSPACE:"activeWorkspace",LAST_USED_WORKSPACE_TOPIC:"finsemble",LAST_USED_WORKSPACE_NAME:"finsemble.lastUsedWorkspace.name",LAST_USED_WORKSPACE:"finsemble.lastUsedWorkspace",INITIAL_WORKSPACE_PREFERENCE:"finsemble.initialWorkspace",PUBLISH_REASONS:{INIT:"workspace:initialization",LOAD_DATA_RETRIEVED:"workspace:load:dataRetrieved",LOAD_FINISHED:"workspace:load:finished",WINDOW_REMOVED:"window:remove",WINDOW_ADDED:"window:add",LOAD_STARTED:"workspace:load:start",WORKSPACE_REMOVED:"Workspace:remove",WORKSPACE_RENAMED:"rename",SWITCHTO_TERMINATED:"workspace:switchTo:terminated",NEW_WORKSPACE:"new workspace",SAVE_AS:"APPLICATION LIFECYCLE:WORKSPACE LIFECYCLE:SaveAs:Workspace:Save As"},API_CHANNELS:{NEW_WORKSPACE:"Finsemble.Workspace.NewWorkspace",SAVE:"Finsemble.Workspace.Save",RENAME:"Finsemble.Workspace.Rename",SAVE_AS:"Finsemble.Workspace.SaveAs",SWITCH_TO:"Finsemble.Workspace.SwitchTo",IMPORT:"Finsemble.Workspace.Import",EXPORT:"Finsemble.Workspace.Export",REMOVE:"Finsemble.Workspace.Remove",SAVE_GLOBAL_DATA:"Finsemble.Workspace.SaveGlobalData",SAVE_VIEW_DATA:"Finsemble.Workspace.SaveViewData",GET_GLOBAL_DATA:"Finsemble.Workspace.GetGlobalData",GET_VIEW_DATA:"Finsemble.Workspace.GetViewData",GET_WORKSPACES:"Finsemble.Workspace.GetWorkspaces",GET_WORKSPACE_NAMES:"Finsemble.Workspace.GetWorkspaceNames",SET_WORKSPACE_ORDER:"Finsemble.Workspace.SetWorkspaceOrder",GET_ACTIVE_WORKSPACE:"Finsemble.Workspace.GetActiveWorkspace",GET_ACTIVE_WORKSPACE_DIRTY:"Finsemble.Workspace.GetActiveWorkspaceDirty",GET_TEMPLATES:"Finsemble.Workspace.GetTemplates",IMPORT_TEMPLATE:"Finsemble.Workspace.ImportTemplate",EXPORT_TEMPLATE:"Finsemble.Workspace.ExportTemplate",REMOVE_TEMPLATE:"Finsemble.Workspace.RemoveTemplate",SET_WINDOW_STATE:"Finsemble.Workspace.SetWindowData",GET_WINDOW_STATE:"Finsemble.Workspace.GetWindowData",ADD_WINDOW:"WorkspaceService.addWindow",REMOVE_WINDOW:"WorkspaceService.removeWindow"},DEFAULT_WINDOW_PROPS:["name","componentType","windowType","alwaysOnTop","autoShow","minWidth","minHeight","maxWidth","maxHeight","resizable","maximizable","minimizable","opacity","windowState","left","top","width","height","right","bottom","defaultLeft","defaultTop","defaultWidth","defaultHeight","defaultRight","defaultBottom","monitorInfo","icon","cachedBounds","showTaskbarIcon","isEvergreen","compositeComponentData"],ADDITIONAL_WINDOW_PROPS:{WebWindow:["url","fullscreen","frame","backgroundColor","transparent","waitForPageLoad","affinity","appUUID"],NativeWindow:["path","alias","arguments","argumentsAsQueryString","isWPF"],StackedWindow:["childWindowIdentifiers","visibleWindowIdentifier","bounds"]}},t.WINDOW_SERVICE_REQUESTS={REMOTE_FOCUS:"WindowService.remoteFocus",SET_ALWAYS_ON_TOP:"WindowService-Request-setAlwaysOnTop",IS_ALWAYS_ON_TOP:"WindowService-Request-isAlwaysOnTop"},t.COMPONENT_STATE_STORAGE_TOPIC="finsemble.componentStateStorage",t.HEARTBEAT_TIMEOUT_CHANNEL="Finsemble.WindowService.HeartbeatTimeout",t.LAUNCHER_SERVICE={WINDOW_CLOSED:"LauncherService.WindowClosed"},t.MOVE_REASON={AERO_KEY:"aero_key",SYSTEM_RESTORED:"system_restored"}},function(e,t,r){"use strict";r.r(t),r.d(t,"applyEach",(function(){return se})),r.d(t,"applyEachSeries",(function(){return ce})),r.d(t,"apply",(function(){return de})),r.d(t,"asyncify",(function(){return fe})),r.d(t,"auto",(function(){return we})),r.d(t,"autoInject",(function(){return Xe})),r.d(t,"cargo",(function(){return nt})),r.d(t,"compose",(function(){return at})),r.d(t,"concat",(function(){return ut})),r.d(t,"concatSeries",(function(){return dt})),r.d(t,"constant",(function(){return ft})),r.d(t,"detect",(function(){return gt})),r.d(t,"detectLimit",(function(){return yt})),r.d(t,"detectSeries",(function(){return vt})),r.d(t,"dir",(function(){return wt})),r.d(t,"doDuring",(function(){return St})),r.d(t,"doUntil",(function(){return _t})),r.d(t,"doWhilst",(function(){return Ct})),r.d(t,"during",(function(){return Et})),r.d(t,"each",(function(){return Tt})),r.d(t,"eachLimit",(function(){return kt})),r.d(t,"eachOf",(function(){return re})),r.d(t,"eachOfLimit",(function(){return X})),r.d(t,"eachOfSeries",(function(){return it})),r.d(t,"eachSeries",(function(){return At})),r.d(t,"ensureAsync",(function(){return Ot})),r.d(t,"every",(function(){return It})),r.d(t,"everyLimit",(function(){return Dt})),r.d(t,"everySeries",(function(){return Rt})),r.d(t,"filter",(function(){return Nt})),r.d(t,"filterLimit",(function(){return xt})),r.d(t,"filterSeries",(function(){return $t})),r.d(t,"forever",(function(){return Bt})),r.d(t,"log",(function(){return Ut})),r.d(t,"map",(function(){return oe})),r.d(t,"mapLimit",(function(){return le})),r.d(t,"mapSeries",(function(){return ue})),r.d(t,"mapValues",(function(){return Ht})),r.d(t,"mapValuesLimit",(function(){return Vt})),r.d(t,"mapValuesSeries",(function(){return qt})),r.d(t,"memoize",(function(){return Gt})),r.d(t,"nextTick",(function(){return Qt.a})),r.d(t,"parallel",(function(){return Yt})),r.d(t,"parallelLimit",(function(){return Jt})),r.d(t,"priorityQueue",(function(){return er})),r.d(t,"queue",(function(){return Zt})),r.d(t,"race",(function(){return tr})),r.d(t,"reduce",(function(){return ot})),r.d(t,"reduceRight",(function(){return nr})),r.d(t,"reflect",(function(){return ir})),r.d(t,"reflectAll",(function(){return ar})),r.d(t,"reject",(function(){return sr})),r.d(t,"rejectLimit",(function(){return lr})),r.d(t,"rejectSeries",(function(){return ur})),r.d(t,"retry",(function(){return dr})),r.d(t,"retryable",(function(){return fr})),r.d(t,"seq",(function(){return st})),r.d(t,"series",(function(){return hr})),r.d(t,"setImmediate",(function(){return Xt})),r.d(t,"some",(function(){return pr})),r.d(t,"someLimit",(function(){return mr})),r.d(t,"someSeries",(function(){return gr})),r.d(t,"sortBy",(function(){return yr})),r.d(t,"timeout",(function(){return vr})),r.d(t,"times",(function(){return _r})),r.d(t,"timesLimit",(function(){return Cr})),r.d(t,"timesSeries",(function(){return Er})),r.d(t,"transform",(function(){return Pr})),r.d(t,"unmemoize",(function(){return Tr})),r.d(t,"until",(function(){return Ar})),r.d(t,"waterfall",(function(){return Or})),r.d(t,"whilst",(function(){return kr})),r.d(t,"all",(function(){return It})),r.d(t,"allLimit",(function(){return Dt})),r.d(t,"allSeries",(function(){return Rt})),r.d(t,"any",(function(){return pr})),r.d(t,"anyLimit",(function(){return mr})),r.d(t,"anySeries",(function(){return gr})),r.d(t,"find",(function(){return gt})),r.d(t,"findLimit",(function(){return yt})),r.d(t,"findSeries",(function(){return vt})),r.d(t,"forEach",(function(){return Tt})),r.d(t,"forEachSeries",(function(){return At})),r.d(t,"forEachLimit",(function(){return kt})),r.d(t,"forEachOf",(function(){return re})),r.d(t,"forEachOfSeries",(function(){return it})),r.d(t,"forEachOfLimit",(function(){return X})),r.d(t,"inject",(function(){return ot})),r.d(t,"foldl",(function(){return ot})),r.d(t,"foldr",(function(){return nr})),r.d(t,"select",(function(){return Nt})),r.d(t,"selectLimit",(function(){return xt})),r.d(t,"selectSeries",(function(){return $t})),r.d(t,"wrapSync",(function(){return fe}));var n=r(2),i=function(e){return Object(n.a)((function(t){var r=t.pop();e.call(this,t,r)}))};function o(e){return Object(n.a)((function(t,r){var n=i((function(r,n){var i=this;return e(t,(function(e,t){e.apply(i,r.concat(t))}),n)}));return r.length?n.apply(this,r):n}))}var s=r(29).a.Symbol,a=Object.prototype,l=a.hasOwnProperty,u=a.toString,c=s?s.toStringTag:void 0;var d=function(e){var t=l.call(e,c),r=e[c];try{e[c]=void 0;var n=!0}catch(e){}var i=u.call(e);return n&&(t?e[c]=r:delete e[c]),i},f=Object.prototype.toString;var h=function(e){return f.call(e)},p=s?s.toStringTag:void 0;var m=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":p&&p in Object(e)?d(e):h(e)};var g=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var y=function(e){if(!g(e))return!1;var t=m(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};var v=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var b=function(e){return null!=e&&v(e.length)&&!y(e)},w={};var S=function(){};function C(e){return function(){if(null!==e){var t=e;e=null,t.apply(this,arguments)}}}var _="function"==typeof Symbol&&Symbol.iterator;var E=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var P=function(e){return null!=e&&"object"==typeof e};var T=function(e){return P(e)&&"[object Arguments]"==m(e)},k=Object.prototype,A=k.hasOwnProperty,O=k.propertyIsEnumerable,L=T(function(){return arguments}())?T:function(e){return P(e)&&A.call(e,"callee")&&!O.call(e,"callee")},I=Array.isArray,D=r(50),R=/^(?:0|[1-9]\d*)$/;var F=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&R.test(e))&&e>-1&&e%1==0&&e<t},j={};j["[object Float32Array]"]=j["[object Float64Array]"]=j["[object Int8Array]"]=j["[object Int16Array]"]=j["[object Int32Array]"]=j["[object Uint8Array]"]=j["[object Uint8ClampedArray]"]=j["[object Uint16Array]"]=j["[object Uint32Array]"]=!0,j["[object Arguments]"]=j["[object Array]"]=j["[object ArrayBuffer]"]=j["[object Boolean]"]=j["[object DataView]"]=j["[object Date]"]=j["[object Error]"]=j["[object Function]"]=j["[object Map]"]=j["[object Number]"]=j["[object Object]"]=j["[object RegExp]"]=j["[object Set]"]=j["[object String]"]=j["[object WeakMap]"]=!1;var W=function(e){return P(e)&&v(e.length)&&!!j[m(e)]};var M=function(e){return function(t){return e(t)}},N=r(36),x=N.a&&N.a.isTypedArray,$=x?M(x):W,B=Object.prototype.hasOwnProperty;var U=function(e,t){var r=I(e),n=!r&&L(e),i=!r&&!n&&Object(D.a)(e),o=!r&&!n&&!i&&$(e),s=r||n||i||o,a=s?E(e.length,String):[],l=a.length;for(var u in e)!t&&!B.call(e,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||F(u,l))||a.push(u);return a},V=Object.prototype;var H=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||V)};var q=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),z=Object.prototype.hasOwnProperty;var G=function(e){if(!H(e))return q(e);var t=[];for(var r in Object(e))z.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Q=function(e){return b(e)?U(e):G(e)};function K(e){if(b(e))return function(e){var t=-1,r=e.length;return function(){return++t<r?{value:e[t],key:t}:null}}(e);var t,r,n,i,o=function(e){return _&&e[_]&&e[_]()}(e);return o?function(e){var t=-1;return function(){var r=e.next();return r.done?null:(t++,{value:r.value,key:t})}}(o):(r=Q(t=e),n=-1,i=r.length,function(){var e=r[++n];return n<i?{value:t[e],key:e}:null})}function Y(e){return function(){if(null===e)throw new Error("Callback was already called.");var t=e;e=null,t.apply(this,arguments)}}function J(e){return function(t,r,n){if(n=C(n||S),e<=0||!t)return n(null);var i=K(t),o=!1,s=0;function a(e,t){if(s-=1,e)o=!0,n(e);else{if(t===w||o&&s<=0)return o=!0,n(null);l()}}function l(){for(;s<e&&!o;){var t=i();if(null===t)return o=!0,void(s<=0&&n(null));s+=1,r(t.value,t.key,Y(a))}}l()}}function X(e,t,r,n){J(t)(e,r,n)}function Z(e,t){return function(r,n,i){return e(r,t,n,i)}}function ee(e,t,r){r=C(r||S);var n=0,i=0,o=e.length;function s(e,t){e?r(e):++i!==o&&t!==w||r(null)}for(0===o&&r(null);n<o;n++)t(e[n],n,Y(s))}var te=Z(X,1/0),re=function(e,t,r){(b(e)?ee:te)(e,t,r)};function ne(e){return function(t,r,n){return e(re,t,r,n)}}function ie(e,t,r,n){n=n||S;var i=[],o=0;e(t=t||[],(function(e,t,n){var s=o++;r(e,(function(e,t){i[s]=t,n(e)}))}),(function(e){n(e,i)}))}var oe=ne(ie),se=o(oe);function ae(e){return function(t,r,n,i){return e(J(r),t,n,i)}}var le=ae(ie),ue=Z(le,1),ce=o(ue),de=Object(n.a)((function(e,t){return Object(n.a)((function(r){return e.apply(null,t.concat(r))}))}));function fe(e){return i((function(t,r){var n;try{n=e.apply(this,t)}catch(e){return r(e)}g(n)&&"function"==typeof n.then?n.then((function(e){r(null,e)}),(function(e){r(e.message?e:new Error(e))})):r(null,n)}))}var he=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e};var pe=function(e){return function(t,r,n){for(var i=-1,o=Object(t),s=n(t),a=s.length;a--;){var l=s[e?a:++i];if(!1===r(o[l],l,o))break}return t}}();var me=function(e,t){return e&&pe(e,t,Q)};var ge=function(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return-1};var ye=function(e){return e!=e};var ve=function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1};var be=function(e,t,r){return t==t?ve(e,t,r):ge(e,ye,r)},we=function(e,t,r){"function"==typeof t&&(r=t,t=null),r=C(r||S);var i=Q(e).length;if(!i)return r(null);t||(t=i);var o={},s=0,a=!1,l=Object.create(null),u=[],c=[],d={};function f(e,t){u.push((function(){!function(e,t){if(a)return;var i=Y(Object(n.a)((function(t,n){if(s--,n.length<=1&&(n=n[0]),t){var i={};me(o,(function(e,t){i[t]=e})),i[e]=n,a=!0,l=Object.create(null),r(t,i)}else o[e]=n,u=l[e]||[],he(u,(function(e){e()})),h();var u})));s++;var u=t[t.length-1];t.length>1?u(o,i):u(i)}(e,t)}))}function h(){if(0===u.length&&0===s)return r(null,o);for(;u.length&&s<t;){u.shift()()}}function p(t){var r=[];return me(e,(function(e,n){I(e)&&be(e,t,0)>=0&&r.push(n)})),r}me(e,(function(t,r){if(!I(t))return f(r,[t]),void c.push(r);var n=t.slice(0,t.length-1),i=n.length;if(0===i)return f(r,t),void c.push(r);d[r]=i,he(n,(function(o){if(!e[o])throw new Error("async.auto task `"+r+"` has a non-existent dependency `"+o+"` in "+n.join(", "));!function(e,t){var r=l[e];r||(r=l[e]=[]);r.push(t)}(o,(function(){0===--i&&f(r,t)}))}))})),function(){var e,t=0;for(;c.length;)e=c.pop(),t++,he(p(e),(function(e){0==--d[e]&&c.push(e)}));if(t!==i)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}(),h()};var Se=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i};var Ce=function(e){return"symbol"==typeof e||P(e)&&"[object Symbol]"==m(e)},_e=s?s.prototype:void 0,Ee=_e?_e.toString:void 0;var Pe=function e(t){if("string"==typeof t)return t;if(I(t))return Se(t,e)+"";if(Ce(t))return Ee?Ee.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r};var Te=function(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(i);++n<i;)o[n]=e[n+t];return o};var ke=function(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:Te(e,t,r)};var Ae=function(e,t){for(var r=e.length;r--&&be(t,e[r],0)>-1;);return r};var Oe=function(e,t){for(var r=-1,n=e.length;++r<n&&be(t,e[r],0)>-1;);return r};var Le=function(e){return e.split("")},Ie=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var De=function(e){return Ie.test(e)},Re="[\\ud800-\\udfff]",Fe="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",je="\\ud83c[\\udffb-\\udfff]",We="[^\\ud800-\\udfff]",Me="(?:\\ud83c[\\udde6-\\uddff]){2}",Ne="[\\ud800-\\udbff][\\udc00-\\udfff]",xe="(?:"+Fe+"|"+je+")"+"?",$e="[\\ufe0e\\ufe0f]?"+xe+("(?:\\u200d(?:"+[We,Me,Ne].join("|")+")[\\ufe0e\\ufe0f]?"+xe+")*"),Be="(?:"+[We+Fe+"?",Fe,Me,Ne,Re].join("|")+")",Ue=RegExp(je+"(?="+je+")|"+Be+$e,"g");var Ve=function(e){return e.match(Ue)||[]};var He=function(e){return De(e)?Ve(e):Le(e)};var qe=function(e){return null==e?"":Pe(e)},ze=/^\s+|\s+$/g;var Ge=function(e,t,r){if((e=qe(e))&&(r||void 0===t))return e.replace(ze,"");if(!e||!(t=Pe(t)))return e;var n=He(e),i=He(t),o=Oe(n,i),s=Ae(n,i)+1;return ke(n,o,s).join("")},Qe=/^(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,Ke=/,/,Ye=/(=.+)?(\s*)$/,Je=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;function Xe(e,t){var r={};me(e,(function(e,t){var n,i;if(I(e))n=e.slice(0,-1),e=e[e.length-1],r[t]=n.concat(n.length>0?o:e);else if(1===e.length)r[t]=e;else{if(n=i=(i=(i=(i=(i=e).toString().replace(Je,"")).match(Qe)[2].replace(" ",""))?i.split(Ke):[]).map((function(e){return Ge(e.replace(Ye,""))})),0===e.length&&0===n.length)throw new Error("autoInject task functions require explicit parameters.");n.pop(),r[t]=n.concat(o)}function o(t,r){var i=Se(n,(function(e){return t[e]}));i.push(r),e.apply(null,i)}})),we(r,t)}var Ze=r(7);function et(){this.head=this.tail=null,this.length=0}function tt(e,t){e.length=1,e.head=e.tail=t}function rt(e,t,r){if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");function i(e,t,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(u.started=!0,I(e)||(e=[e]),0===e.length&&u.idle())return Object(Ze.a)((function(){u.drain()}));for(var n=0,i=e.length;n<i;n++){var o={data:e[n],callback:r||S};t?u._tasks.unshift(o):u._tasks.push(o)}Object(Ze.a)(u.process)}function o(e){return Object(n.a)((function(t){s-=1;for(var r=0,n=e.length;r<n;r++){var i=e[r],o=be(a,i,0);o>=0&&a.splice(o),i.callback.apply(i,t),null!=t[0]&&u.error(t[0],i.data)}s<=u.concurrency-u.buffer&&u.unsaturated(),u.idle()&&u.drain(),u.process()}))}var s=0,a=[],l=!1,u={_tasks:new et,concurrency:t,payload:r,saturated:S,unsaturated:S,buffer:t/4,empty:S,drain:S,error:S,started:!1,paused:!1,push:function(e,t){i(e,!1,t)},kill:function(){u.drain=S,u._tasks.empty()},unshift:function(e,t){i(e,!0,t)},process:function(){if(!l){for(l=!0;!u.paused&&s<u.concurrency&&u._tasks.length;){var t=[],r=[],n=u._tasks.length;u.payload&&(n=Math.min(n,u.payload));for(var i=0;i<n;i++){var c=u._tasks.shift();t.push(c),r.push(c.data)}0===u._tasks.length&&u.empty(),s+=1,a.push(t[0]),s===u.concurrency&&u.saturated();var d=Y(o(t));e(r,d)}l=!1}},length:function(){return u._tasks.length},running:function(){return s},workersList:function(){return a},idle:function(){return u._tasks.length+s===0},pause:function(){u.paused=!0},resume:function(){!1!==u.paused&&(u.paused=!1,Object(Ze.a)(u.process))}};return u}function nt(e,t){return rt(e,1,t)}et.prototype.removeLink=function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,e.prev=e.next=null,this.length-=1,e},et.prototype.empty=et,et.prototype.insertAfter=function(e,t){t.prev=e,t.next=e.next,e.next?e.next.prev=t:this.tail=t,e.next=t,this.length+=1},et.prototype.insertBefore=function(e,t){t.prev=e.prev,t.next=e,e.prev?e.prev.next=t:this.head=t,e.prev=t,this.length+=1},et.prototype.unshift=function(e){this.head?this.insertBefore(this.head,e):tt(this,e)},et.prototype.push=function(e){this.tail?this.insertAfter(this.tail,e):tt(this,e)},et.prototype.shift=function(){return this.head&&this.removeLink(this.head)},et.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)};var it=Z(X,1);function ot(e,t,r,n){n=C(n||S),it(e,(function(e,n,i){r(t,e,(function(e,r){t=r,i(e)}))}),(function(e){n(e,t)}))}var st=Object(n.a)((function(e){return Object(n.a)((function(t){var r=this,i=t[t.length-1];"function"==typeof i?t.pop():i=S,ot(e,t,(function(e,t,i){t.apply(r,e.concat(Object(n.a)((function(e,t){i(e,t)}))))}),(function(e,t){i.apply(r,[e].concat(t))}))}))})),at=Object(n.a)((function(e){return st.apply(null,e.reverse())}));function lt(e,t,r,n){var i=[];e(t,(function(e,t,n){r(e,(function(e,t){i=i.concat(t||[]),n(e)}))}),(function(e){n(e,i)}))}var ut=ne(lt);var ct,dt=(ct=lt,function(e,t,r){return ct(it,e,t,r)}),ft=Object(n.a)((function(e){var t=[null].concat(e);return i((function(e,r){return r.apply(this,t)}))})),ht=r(12);function pt(e,t){return function(r,n,i,o){o=o||S;var s,a=!1;r(n,(function(r,n,o){i(r,(function(n,i){n?o(n):e(i)&&!s?(a=!0,s=t(!0,r),o(null,w)):o()}))}),(function(e){e?o(e):o(null,a?s:t(!1))}))}}function mt(e,t){return t}var gt=ne(pt(ht.a,mt)),yt=ae(pt(ht.a,mt)),vt=Z(yt,1);function bt(e){return Object(n.a)((function(t,r){t.apply(null,r.concat(Object(n.a)((function(t,r){"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&he(r,(function(t){console[e](t)})))}))))}))}var wt=bt("dir");function St(e,t,r){r=Y(r||S);var i=Object(n.a)((function(e,n){if(e)return r(e);n.push(o),t.apply(this,n)}));function o(t,n){return t?r(t):n?void e(i):r(null)}o(null,!0)}function Ct(e,t,r){r=Y(r||S);var i=Object(n.a)((function(n,o){return n?r(n):t.apply(this,o)?e(i):void r.apply(null,[null].concat(o))}));e(i)}function _t(e,t,r){Ct(e,(function(){return!t.apply(this,arguments)}),r)}function Et(e,t,r){function n(t){if(t)return r(t);e(i)}function i(e,i){return e?r(e):i?void t(n):r(null)}r=Y(r||S),e(i)}function Pt(e){return function(t,r,n){return e(t,n)}}function Tt(e,t,r){re(e,Pt(t),r)}function kt(e,t,r,n){J(t)(e,Pt(r),n)}var At=Z(kt,1);function Ot(e){return i((function(t,r){var n=!0;t.push((function(){var e=arguments;n?Object(Ze.a)((function(){r.apply(null,e)})):r.apply(null,e)})),e.apply(this,t),n=!1}))}function Lt(e){return!e}var It=ne(pt(Lt,Lt)),Dt=ae(pt(Lt,Lt)),Rt=Z(Dt,1);var Ft=function(e){return function(t){return null==t?void 0:t[e]}};function jt(e,t,r,n){var i=new Array(t.length);e(t,(function(e,t,n){r(e,(function(e,r){i[t]=!!r,n(e)}))}),(function(e){if(e)return n(e);for(var r=[],o=0;o<t.length;o++)i[o]&&r.push(t[o]);n(null,r)}))}function Wt(e,t,r,n){var i=[];e(t,(function(e,t,n){r(e,(function(r,o){r?n(r):(o&&i.push({index:t,value:e}),n())}))}),(function(e){e?n(e):n(null,Se(i.sort((function(e,t){return e.index-t.index})),Ft("value")))}))}function Mt(e,t,r,n){(b(t)?jt:Wt)(e,t,r,n||S)}var Nt=ne(Mt),xt=ae(Mt),$t=Z(xt,1);function Bt(e,t){var r=Y(t||S),n=Ot(e);!function e(t){if(t)return r(t);n(e)}()}var Ut=bt("log");function Vt(e,t,r,n){n=C(n||S);var i={};X(e,t,(function(e,t,n){r(e,t,(function(e,r){if(e)return n(e);i[t]=r,n()}))}),(function(e){n(e,i)}))}var Ht=Z(Vt,1/0),qt=Z(Vt,1);function zt(e,t){return t in e}function Gt(e,t){var r=Object.create(null),o=Object.create(null);t=t||ht.a;var s=i((function(i,s){var a=t.apply(null,i);zt(r,a)?Object(Ze.a)((function(){s.apply(null,r[a])})):zt(o,a)?o[a].push(s):(o[a]=[s],e.apply(null,i.concat(Object(n.a)((function(e){r[a]=e;var t=o[a];delete o[a];for(var n=0,i=t.length;n<i;n++)t[n].apply(null,e)})))))}));return s.memo=r,s.unmemoized=e,s}var Qt=r(35);function Kt(e,t,r){r=r||S;var i=b(t)?[]:{};e(t,(function(e,t,r){e(Object(n.a)((function(e,n){n.length<=1&&(n=n[0]),i[t]=n,r(e)})))}),(function(e){r(e,i)}))}function Yt(e,t){Kt(re,e,t)}function Jt(e,t,r){Kt(J(t),e,r)}var Xt=Ze.a,Zt=function(e,t){return rt((function(t,r){e(t[0],r)}),t,1)},er=function(e,t){var r=Zt(e,t);return r.push=function(e,t,n){if(null==n&&(n=S),"function"!=typeof n)throw new Error("task callback must be a function");if(r.started=!0,I(e)||(e=[e]),0===e.length)return Xt((function(){r.drain()}));t=t||0;for(var i=r._tasks.head;i&&t>=i.priority;)i=i.next;for(var o=0,s=e.length;o<s;o++){var a={data:e[o],priority:t,callback:n};i?r._tasks.insertBefore(i,a):r._tasks.push(a)}Xt(r.process)},delete r.unshift,r};function tr(e,t){if(t=C(t||S),!I(e))return t(new TypeError("First argument to race must be an array of functions"));if(!e.length)return t();for(var r=0,n=e.length;r<n;r++)e[r](t)}var rr=Array.prototype.slice;function nr(e,t,r,n){ot(rr.call(e).reverse(),t,r,n)}function ir(e){return i((function(t,r){return t.push(Object(n.a)((function(e,t){if(e)r(null,{error:e});else{var n=null;1===t.length?n=t[0]:t.length>1&&(n=t),r(null,{value:n})}}))),e.apply(this,t)}))}function or(e,t,r,n){Mt(e,t,(function(e,t){r(e,(function(e,r){t(e,!r)}))}),n)}var sr=ne(or);function ar(e){var t;return I(e)?t=Se(e,ir):(t={},me(e,(function(e,r){t[r]=ir.call(this,e)}))),t}var lr=ae(or),ur=Z(lr,1);var cr=function(e){return function(){return e}};function dr(e,t,r){var n=5,i=0,o={times:n,intervalFunc:cr(i)};function s(e,t){if("object"==typeof t)e.times=+t.times||n,e.intervalFunc="function"==typeof t.interval?t.interval:cr(+t.interval||i),e.errorFilter=t.errorFilter;else{if("number"!=typeof t&&"string"!=typeof t)throw new Error("Invalid arguments for async.retry");e.times=+t||n}}if(arguments.length<3&&"function"==typeof e?(r=t||S,t=e):(s(o,e),r=r||S),"function"!=typeof t)throw new Error("Invalid arguments for async.retry");var a=1;function l(){t((function(e){e&&a++<o.times&&("function"!=typeof o.errorFilter||o.errorFilter(e))?setTimeout(l,o.intervalFunc(a)):r.apply(null,arguments)}))}l()}var fr=function(e,t){return t||(t=e,e=null),i((function(r,n){function i(e){t.apply(null,r.concat(e))}e?dr(e,i,n):dr(i,n)}))};function hr(e,t){Kt(it,e,t)}var pr=ne(pt(Boolean,ht.a)),mr=ae(pt(Boolean,ht.a)),gr=Z(mr,1);function yr(e,t,r){function n(e,t){var r=e.criteria,n=t.criteria;return r<n?-1:r>n?1:0}oe(e,(function(e,r){t(e,(function(t,n){if(t)return r(t);r(null,{value:e,criteria:n})}))}),(function(e,t){if(e)return r(e);r(null,Se(t.sort(n),Ft("value")))}))}function vr(e,t,r){var n,o,s=!1;function a(){s||(n.apply(null,arguments),clearTimeout(o))}function l(){var t=e.name||"anonymous",i=new Error('Callback function "'+t+'" timed out.');i.code="ETIMEDOUT",r&&(i.info=r),s=!0,n(i)}return i((function(r,i){n=i,o=setTimeout(l,t),e.apply(null,r.concat(a))}))}var br=Math.ceil,wr=Math.max;var Sr=function(e,t,r,n){for(var i=-1,o=wr(br((t-e)/(r||1)),0),s=Array(o);o--;)s[n?o:++i]=e,e+=r;return s};function Cr(e,t,r,n){le(Sr(0,e,1),t,r,n)}var _r=Z(Cr,1/0),Er=Z(Cr,1);function Pr(e,t,r,n){3===arguments.length&&(n=r,r=t,t=I(e)?[]:{}),n=C(n||S),re(e,(function(e,n,i){r(t,e,n,i)}),(function(e){n(e,t)}))}function Tr(e){return function(){return(e.unmemoized||e).apply(null,arguments)}}function kr(e,t,r){if(r=Y(r||S),!e())return r(null);var i=Object(n.a)((function(n,o){return n?r(n):e()?t(i):void r.apply(null,[null].concat(o))}));t(i)}function Ar(e,t,r){kr((function(){return!e.apply(this,arguments)}),t,r)}var Or=function(e,t){if(t=C(t||S),!I(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var r=0;!function i(o){if(r===e.length)return t.apply(null,[null].concat(o));var s=Y(Object(n.a)((function(e,r){if(e)return t.apply(null,[e].concat(r));i(r)})));o.push(s),e[r++].apply(null,o)}([])};t.default={applyEach:se,applyEachSeries:ce,apply:de,asyncify:fe,auto:we,autoInject:Xe,cargo:nt,compose:at,concat:ut,concatSeries:dt,constant:ft,detect:gt,detectLimit:yt,detectSeries:vt,dir:wt,doDuring:St,doUntil:_t,doWhilst:Ct,during:Et,each:Tt,eachLimit:kt,eachOf:re,eachOfLimit:X,eachOfSeries:it,eachSeries:At,ensureAsync:Ot,every:It,everyLimit:Dt,everySeries:Rt,filter:Nt,filterLimit:xt,filterSeries:$t,forever:Bt,log:Ut,map:oe,mapLimit:le,mapSeries:ue,mapValues:Ht,mapValuesLimit:Vt,mapValuesSeries:qt,memoize:Gt,nextTick:Qt.a,parallel:Yt,parallelLimit:Jt,priorityQueue:er,queue:Zt,race:tr,reduce:ot,reduceRight:nr,reflect:ir,reflectAll:ar,reject:sr,rejectLimit:lr,rejectSeries:ur,retry:dr,retryable:fr,seq:st,series:hr,setImmediate:Xt,some:pr,someLimit:mr,someSeries:gr,sortBy:yr,timeout:vr,times:_r,timesLimit:Cr,timesSeries:Er,transform:Pr,unmemoize:Tr,until:Ar,waterfall:Or,whilst:kr,all:It,any:pr,forEach:Tt,forEachSeries:At,forEachLimit:kt,forEachOf:re,forEachOfSeries:it,forEachOfLimit:X,inject:ot,foldl:ot,foldr:nr,select:Nt,selectLimit:xt,selectSeries:$t,wrapSync:fe}},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var l,u=[],c=!1,d=-1;function f(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&h())}function h(){if(!c){var e=a(f);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},,function(e,t,r){"use strict";var n=r(30),i="object"==typeof self&&self&&self.Object===Object&&self,o=n.a||i||Function("return this")();t.a=o},function(e,t,r){"use strict";(function(e){var r="object"==typeof e&&e&&e.Object===Object&&e;t.a=r}).call(this,r(8))},function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(r,n){function i(){void 0!==o&&e.removeListener("error",o),r([].slice.call(arguments))}var o;"error"!==t&&(o=function(r){e.removeListener(t,i),n(r)},e.once("error",o)),e.once(t,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var l=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,o,s,a;if(u(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=c(e))>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,a=l,console&&console.warn&&console.warn(a)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=f.bind(n);return i.listener=r,n.wrapFn=i,i}function p(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var u=l.length,c=g(l,u);for(r=0;r<u;++r)o(c[r],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,i,o,s;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkDeprecatedConfigs=t.isEqualIgnoringArrayOrder=t.sleep=t.checkIfBoundsAreEqual=t.removeKeys=t.toRecord=t.isStackedWindow=t.wrapWithTimeout=t.timeoutPromise=t.getRandomWindowName=t.getUniqueName=t.getProp=t.composeRL=t.instrumentPromise=t.promisify=t.identity=t.isNumber=t.chunkArray=t.Timeout=t.mockLogger=t.capitalizeFirst=t.clone=t.isServiceInWindow=t.iAmAServiceWindow=t.guuid=void 0;const i=r(45),o=n(r(46)),s=n(r(72)),a=n(r(44)),l=n(r(73)),u=r(18),c=n(r(4)),d=window;function f(e,t){if(Array.isArray(e))return e.slice();try{return JSON.parse(JSON.stringify(e))}catch(e){return t("clone error",e),e}}t.guuid=function(){return i.v1()},t.iAmAServiceWindow=function(){return!(!d.finsembleServices||!d.finsembleServices.length)},t.isServiceInWindow=function(e){return d.finsembleServices&&d.finsembleServices.find(t=>t.name===e)},t.clone=f,t.capitalizeFirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};t.mockLogger=new class{constructor({debug:e}={debug:!0}){e?(this.system=console,this.system.debug=console.log):this.system={warn:Function.prototype,debug:Function.prototype,log:Function.prototype,info:Function.prototype,error:console.error}}isLogMessage(){return!0}start(){}};function h(e="RouterClient"){return`${e}-${Math.floor(100*Math.random())}-${Math.floor(1e4*Math.random())}`}function p(e,t){return new Promise((r,n)=>{const i=setTimeout(()=>{clearTimeout(i),n(t)},e)})}function m(e,t,r){return`${e}.${t}.${r}`}function g(e,t,r){const n=""+m(e.baseString,e.newPath,e.newValue);c.default.system.warn(`${m(e.baseString,t,r)} has been deprecated in favor of ${n}`)}t.Timeout=class{constructor(e,t){this.fired=!1,this.id=setTimeout(()=>{e(),this.fired=!0},t),this.clear=this.clear.bind(this),this.didFire=this.didFire.bind(this)}clear(){this.fired||clearTimeout(this.id)}didFire(){return this.fired}},t.chunkArray=function(e,t){if(e<=0)throw new Error("Can't chunk array by number less than 0");return t.reduce((r,n,i)=>{if(i%e==0){const n=[];for(let r=i;r<i+e;r++)r<t.length&&n.push(t[r]);r.push(n)}return r},[])},t.isNumber=function(e){return!(!e||Number.isNaN(Number(e)))&&Number(e)},t.identity=function(e){return e},t.promisify=function(e,t){return function(){const r=Array.prototype.slice.call(arguments);return new Promise((n,i)=>{r.push((e,t)=>e?i(e):n(t)),e.apply(t,r)})}},t.instrumentPromise=async(e,t,r)=>{const n=t+" end";return e(t+" start"),r.then(()=>e(n))},t.composeRL=(...e)=>e.reduce((e,t)=>(...r)=>e(t(...r))),t.getProp=function e(t,r,n){const i=Array.isArray(r)?r:r.split(".").filter(e=>e.length);return i.length?e(t[i.shift()],i,n):void 0===t?n:t},t.getUniqueName=h,t.getRandomWindowName=function(e,t){return`${h(e)}-${t}`},t.timeoutPromise=p,t.wrapWithTimeout=function(e,t,r){return Promise.race([e,p(t,r)])},t.isStackedWindow=function(e){return e&&"StackedWindow"===(o.default(e,"windowIdentifier.windowType")||e.windowType)},t.toRecord=function(e,t){const r="string"==typeof e?t=>t[e]:e;return t.reduce((e,t)=>(e[r(t)]=t,e),{})},t.removeKeys=function(e,t){if(!e)return e;const r=Object.keys(e).filter(e=>!t.includes(e));return s.default(e,r)},t.checkIfBoundsAreEqual=function(e,t){if(!e||!t)return!1;const r=["left","right","top","bottom","width","height"],n=s.default(e,r),i=s.default(t,r);return!!a.default(n,i)},t.sleep=function(e,t=!1){return new Promise((r,n)=>{t?setTimeout(()=>{try{n("timeout expired")}catch(e){}},e):setTimeout(r,e)})},t.isEqualIgnoringArrayOrder=function(e,t){const r=f(e,Function.prototype),n=f(t,Function.prototype);return l.default(r,n,(e,t)=>{if(Array.isArray(e)&&Array.isArray(t))return l.default(e.sort(),t.sort())})},t.checkDeprecatedConfigs=function(e,t,r){const{baseString:n,oldPath:i,newPath:o,oldValue:s,newValue:a}=t;let l=u.ConfigUtilInstance.getDefault(e,m(n,o,a),null);return null===l&&(l=u.ConfigUtilInstance.getDefault(e,m(n,o,s),null),l?g(t,o,s):(l=u.ConfigUtilInstance.getDefault(e,m(n,i,a),null),l?g(t,i,a):(l=u.ConfigUtilInstance.getDefault(e,m(n,i,s),null),l?g(t,i,s):l=r))),l}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHECKPOINT_CHANNEL_BASE=t.STAGE_CHANNEL=t.STATUS_CHANNEL_BASE=t.SHOW_SYSLOG_CHANNEL=t.SYSLOG_CHANNEL=t.CRITICAL_BOOT_STAGES=t.ALL_BOOT_STAGES=void 0,t.ALL_BOOT_STAGES=["microkernel","kernel","authentication","preuser","earlyuser","user"],t.CRITICAL_BOOT_STAGES=["microkernel","kernel","authentication"],t.SYSLOG_CHANNEL="systemManager.systemlog",t.SHOW_SYSLOG_CHANNEL="systemManager.showSystemlog",t.STATUS_CHANNEL_BASE="systemManager.boot.status",t.STAGE_CHANNEL="systemManager.boot.stage",t.CHECKPOINT_CHANNEL_BASE="systemManager.checkpoint"},function(e,t,r){"use strict";(function(e,n){var i,o=r(7);i=o.c?e.nextTick:o.d?n:o.b,t.a=Object(o.e)(i)}).call(this,r(27),r(39).setImmediate)},function(e,t,r){"use strict";(function(e){var n=r(30),i="object"==typeof exports&&exports&&!exports.nodeType&&exports,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,s=o&&o.exports===i&&n.a.process,a=function(){try{var e=o&&o.require&&o.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();t.a=a}).call(this,r(48)(e))},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */
const a=r(22),l=s(r(79)),u=o(r(17)),c=s(r(19)),d=r(6),f=s(r(4)),h=r(56),p=window,m={};class g extends a._BaseClient{constructor(e){super(e),c.default.args(e,"object=")&&e&&c.default.args2("params.onReady",e.onReady,"function="),this.windowClient=e.clients.windowClient}getComponentList(e=Function.prototype){c.default.args(e,"function=");return new Promise(t=>{this.routerClient.query("Launcher.componentList",{},(r,n)=>{e(r,n.data),t({err:r,data:n.data})})})}getComponentDefaultConfig(e,t=Function.prototype){c.default.args(t,"function=");return new Promise(r=>{this.routerClient.query("Launcher.componentList",{},(n,i)=>{const o=i.data[e];t(n,o),r({err:n,data:o})})})}getMonitorInfo(e={},t=Function.prototype){const r=this;if(c.default.args(t,"function="),f.default.system.debug("MONITOR: launcherClient.getMonitorInfo"),"all"===e.monitor)return r.getMonitorInfoAll(t);return new Promise(n=>{u.getMyWindowIdentifier(i=>{e.windowIdentifier||(e.windowIdentifier=i),r.routerClient.query("Launcher.getMonitorInfo",e,(e,r)=>{t&&t(e,r.data),f.default.system.log("MONITOR: launcherClient.getMonitorInfo query response data",r.data),n({err:e,data:r.data})})})})}getMonitorInfoAll(e=Function.prototype){c.default.args(e,"function="),f.default.system.debug("MONITOR: launcherClient.getMonitorInfoAll");return new Promise((t,r)=>{this.routerClient.query("Launcher.getMonitorInfoAll",{},(n,i)=>{n&&(r({err:n}),e(n)),t({err:n,data:i.data}),e(n,i.data)})})}registerComponent(e,t=Function.prototype){return new Promise(r=>{this.routerClient.query("LauncherService.registerComponent",e,(e,n)=>{t&&t(e,n.data),r({err:e,data:n.data})})})}unRegisterComponent(e,t=Function.prototype){if(!e.componentType)return t("No componentType provided");return new Promise(r=>{this.routerClient.query("LauncherService.unRegisterComponent",e,(e,n)=>{t&&t(e,n.data),r({err:e,data:n.data})})})}locatorToIdentifier(e){let t={};return t.windowName="windowName"in e?e.windowName:"","componentType"in e&&(t.componentType=e.componentType),"uuid"in e&&(t.uuid=e.uuid),t}toggleWindowOnClick(e,t,r){const n=this;let i=this.locatorToIdentifier(t),o=`${i.windowName}:${i.uuid}`;if(i.windowName||(o=i.componentType),!1===m[o])return void(m[o]=!0);r.position||(r.position="absolute"),this.showWindow(t,r,(function(t,r){if(!r)return;const{finWindow:i}=r;var s=function(){m[o]=!0,n.windowClient.isMouseOverDOMElement(e,e=>{m[o]=!e}),i.removeEventListener("blurred",s)};i.addEventListener("blurred",s)}))}showWindow(e,t,r=Function.prototype){c.default.args(e,"object",t,"object=",r,"function=");const n=this;t||(t={}),(t=u.clone(t)).staggerPixels||0===t.staggerPixels||(t.staggerPixels=100),t.windowIdentifier=this.locatorToIdentifier(e);return new Promise(e=>{u.getMyWindowIdentifier(i=>{t.relativeWindow||(t.relativeWindow=i),n.routerClient.query("Launcher.showWindow",t,async(t,n)=>{if(t)return e({err:t}),r(t);const i=n.data.windowIdentifier;n.data.windowIdentifier.name=n.data.windowIdentifier.windowName;const{wrap:o}=await h.FinsembleWindow.getInstance({name:i.windowName});n.data.finWindow=o,e({err:t,data:n.data}),r(t,n.data)})})})}spawn(e,t,r=Function.prototype){const n=this;c.default.args(e,"string",t,"object=",r,"function="),t||(t={}),(t=u.clone(t)).component=e,t.options||(t.options={}),t.options.customData||(t.options.customData={}),t.staggerPixels||0===t.staggerPixels||(t.staggerPixels=50),f.default.system.debug("LauncherClient.spawn starting for componentType:"+e);return new Promise(i=>{u.getMyWindowIdentifier(o=>{t.launchingWindow=o,n.callSpawn(t,(t,n)=>{f.default.system.debug("LauncherClient.spawn completing for componentType:"+e,t),i({err:t,response:n}),r(t,n)})})})}callSpawn(e,t=Function.prototype){const r=this;c.default.args(t,"function="),f.default.perf.debug("CallSpawn","start","from spawn to callback",e);return new Promise(n=>{function i(e,r){t(e,r),n({err:e,data:r})}r.routerClient.query("Launcher.spawn",e,async(e,t)=>{if(f.default.system.debug("CallSpawn","Initial launcher callback params",e,t),f.default.perf.debug("CallSpawn","Initial launcher callback",t),e)return i(e,t.data),f.default.system.error("LauncherClient.callSpawn",e);t.data.windowIdentifier.name=t.data.windowIdentifier.windowName;var n=t.data;if(n.windowDescriptor.native)return i(e,n);const o=n.windowIdentifier,{wrap:s}=await h.FinsembleWindow.getInstance({name:o.windowName});n.finWindow=s;const a=`Finsemble.${n.windowIdentifier.windowName}.componentReady`,l=r.routerClient.subscribe(a,(t,o)=>{if(t)return f.default.system.error(t);o&&0===Object.keys(o.data).length||(f.default.perf.debug("CallSpawn","stop"),i(e,n),r.routerClient.unsubscribe(l))})})})}getMonitor(e,t=Function.prototype){f.default.system.warn("This method is deprecated and will be removed in a future release. Method getMonitorInfo should be used instead.");return c.default.args(t,"function="),this.getMonitorInfo({windowIdentifier:e},t)}getMyWindowIdentifier(e=Function.prototype){c.default.args(e,"function=");return new Promise(t=>{u.getMyWindowIdentifier(r=>{e(r),t(r)})})}getActiveDescriptors(e=Function.prototype){c.default.args(e,"function=");return new Promise(t=>{this.routerClient.query("Launcher.getActiveDescriptors",{},(r,n)=>{r&&f.default.system.error(r),e(r,n.data),t({err:r,data:n.data})})})}getActiveAndPendingWindowNames(e=Function.prototype){return new Promise(t=>{this.routerClient.query("Launcher.getActiveAndPendingWindowNames",{},(r,n)=>{r&&f.default.system.error(r),e(r,n.data),t({err:r,data:n.data})})})}async getPendingWindows(){const{err:e,response:t}=await this.routerClient.query("Launcher.getPendingWindows",{});return e&&f.default.system.error("Error retrieving pending windows:",e),{err:e,data:t.data}}addUserDefinedComponent(e,t=Function.prototype){c.default.args(t,"function=");return new Promise(r=>{this.routerClient.query("Launcher.userDefinedComponentUpdate",{type:"add",name:e.name,url:e.url},(e,n)=>{t(e,n.data),r({err:e,data:n.data})})})}removeUserDefinedComponent(e,t=Function.prototype){c.default.args(t,"function=");return new Promise(r=>{this.routerClient.query("Launcher.userDefinedComponentUpdate",{type:"remove",name:e.name,url:e.url},(e,n)=>{t(e,n.data),r({err:e,data:n.data})})})}getComponentsThatCanReceiveDataTypes(e,t=Function.prototype){c.default.args(t,"function=");return new Promise(r=>{if(!e||!e.dataTypes){const e="Invalid params. Expected: {dataTypes: string[]}";return t(e),r({err:e})}Array.isArray(e.dataTypes)||(e.dataTypes=[e.dataTypes]),this.routerClient.query("LauncherService.getComponentsThatCanReceiveDataTypes",e,(e,n)=>{t(e,n.data),r({err:e,data:n.data})})})}bringWindowsToFront(e={},t=Function.prototype){return c.default.args(t,"function="),e.windowList&&!Array.isArray(e.windowList)&&(e.windowList=[e.windowList]),e.groupName&&c.default.args(e.groupName,"string"),e.componentType&&c.default.args(e.componentType,"string"),this.routerClient.query("LauncherService.bringWindowsToFront",e,(e,r)=>{t(e,r)}),Promise.resolve()}hyperFocus(e,t=Function.prototype){return f.default.system.warn("hyperFocus is deprecated as of version 4.0.0. This functionality may be removed in a future release"),console.warn("hyperFocus is deprecated as of version 4.0.0. This functionality may be removed in a future release"),c.default.args(t,"function="),e.windowList&&!Array.isArray(e.windowList)&&(e.windowList=[e.windowList]),e.windowList||e.groupName||e.componentType||(e.windowList=[this.myWindowIdentifier]),e.groupName&&c.default.args(e.groupName,"string"),e.componentType&&c.default.args(e.componentType,"string"),this.routerClient.transmit("LauncherService.hyperFocus",e),t(),Promise.resolve()}minimizeWindows(e,t=Function.prototype){return c.default.args(t,"function="),e.windowList&&!Array.isArray(e.windowList)&&(e.windowList=[e.windowList]),e.groupName&&c.default.args(e.groupName,"string"),e.componentType&&c.default.args(e.componentType,"string"),this.routerClient.transmit("LauncherService.minimizeWindows",e),t(),Promise.resolve()}createWindowGroup(e,t=Function.prototype){c.default.args(t,"function="),e.windowList&&!Array.isArray(e.windowList)&&(e.windowList=[e.windowList],delete e.groupName),c.default.args(e.groupName,"string");return new Promise(r=>{if(!e.groupName){const e="Invalid Parameters";return r({err:e}),void t(e)}this.routerClient.query("LauncherService.createWindowGroup",e,(e,n)=>{t(e,n),r({err:e,data:n})})})}addWindowsToGroup(e,t=Function.prototype){c.default.args(t,"function=");return new Promise(r=>{if(!e.groupName||!e.windowList){const e="Invalid Parameters";return r({err:e}),void t(e)}e.windowList&&!Array.isArray(e.windowList)&&(e.windowList=[e.windowList]),c.default.args(e.groupName,"string"),this.routerClient.query("LauncherService.addWindowsToGroup",e,(e,n)=>{t(e,n),r({err:e,data:n})})})}removeWindowsFromGroup(e,t=Function.prototype){c.default.args(t,"function=");return new Promise(r=>{if(!e.groupName||!e.windowList){const e="Invalid Parameters";return r({err:e}),void t(e)}e.windowList&&!Array.isArray(e.windowList)&&(e.windowList=[e.windowList]),this.routerClient.query("LauncherService.removeWindowsFromGroup",e,(e,n)=>{t(e,n),r({err:e,data:n})})})}getGroupsForWindow(e,t=Function.prototype){c.default.args(t,"function="),"function"==typeof e&&(t=e,e=null);return new Promise(r=>{e&&e.windowIdentifier?this.routerClient.query("LauncherService.getGroupsForWindow",e,(e,n)=>{r({err:e,data:n.data}),t(e,n.data)}):this.windowClient.getComponentState({field:"finsemble:windowGroups"},(e,n)=>{r({err:e,data:n}),t(e,n)})})}addToGroups(e,t=Function.prototype){c.default.args(t,"function="),c.default.args(e.groupNames,"array"),e.windowIdentifier||(e.windowIdentifier=this.myWindowIdentifier);return new Promise(r=>{this.routerClient.query("LauncherService.addWindowToGroups",e,(e,n)=>{t(e,n),r({err:e,data:n})})})}_createWrap(e,t){this.routerClient.query("LauncherService.createWrap",e,t)}start(e){const t=this;if(void 0!==p.FSBL){function r(){t.routerClient.subscribe("Finsemble.LauncherService.updateGroups."+t.windowName,(e,r)=>{Array.isArray(r.data)&&t.windowClient.setComponentState({field:"finsemble:windowGroups",value:r.data})})}p.FSBL.addEventListener("onReady",()=>{t.windowClient.onReady(()=>{t.windowClient.getComponentState({field:"finsemble:windowGroups"},(e,n)=>{if(!e&&n)return t.addToGroups({groupNames:n},r);r()})})})}setInterval(()=>{t.routerClient.transmit("Finsemble.heartbeat",{type:"component",windowName:t.windowName,componentType:"finsemble",isBrowserView:d.System.isBrowserView()})},1e3),this.getMyWindowIdentifier(r=>{t.myWindowIdentifier=r,e&&e()})}}let y;function v(e){return(e=e||{}).windowClient||(e.windowClient=l.default),new g({clients:e,onReady(e){f.default.system.debug("launcherClient ready",window.name),f.default.perf.debug("LauncherClientReadyTime","stop"),y.start(e)},name:"launcherClient"})}y=v(),y.constructInstance=v,t.default=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkpointChannel=t.statusChannel=t.killOldApplications=void 0;const n=r(6),i=r(34);t.killOldApplications=function(e){return new Promise(async t=>{n.System.getAllApplications(async r=>{if(r)for(let t=0;t<r.length;t++){const i=r[t];if(i.uuid.endsWith("-"+e)){const e=n.System.Application.wrap(i.uuid);await n.System.closeApplication(e)}}console.log("killOldApplications: finished closing old apps"),t()})})},t.statusChannel=function(e){return`${i.STATUS_CHANNEL_BASE}.${e}`},t.checkpointChannel=function(e,t){return`${i.CHECKPOINT_CHANNEL_BASE}.${e}.${t}`}},function(e,t,r){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(75),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(8))},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.LocalLogger=void 0;const{debug:n,warn:i,log:o,error:s}=console,a=()=>{},l=a,u={warn:i,info:a,log:o,debug:n,error:s,verbose:l},c={Error:!0,Warn:!0,Info:!0,Log:!0,Debug:!0,Verbose:!0,LocalOnly:!1},d={console:{Error:!0,Warn:!0,Info:!0,Log:!0,Debug:!0},dev:c,system:c,perf:c};function f(e){return"logger.service.logMessages"===e}t.LocalLogger=class{constructor(){this.start=()=>{},this.isLogMessage=f,this.setting=()=>d,this.callStack=()=>function(){const{stack:e}=function(){try{throw Error("")}catch(e){return e}}(),t=(r="\n",n=4,e.split(r,n).join(r).length);var r,n;return"Log Stack: \n"+e.substring(t).substr(1)}(),this.unregisterClient=()=>{},this.setRouterClient=()=>{},this.warn=i,this.info=a,this.log=o,this.debug=n,this.error=s,this.verbose=l,this.system=u,this.perf=u}}},function(e,t,r){var n=r(42),i=r(43),o=n(),s=[1|o[0],o[1],o[2],o[3],o[4],o[5]],a=16383&(o[6]<<8|o[7]),l=0,u=0;e.exports=function(e,t,r){var n=t&&r||0,o=t||[],c=void 0!==(e=e||{}).clockseq?e.clockseq:a,d=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:u+1,h=d-l+(f-u)/1e4;if(h<0&&void 0===e.clockseq&&(c=c+1&16383),(h<0||d>l)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=d,u=f,a=c;var p=(1e4*(268435455&(d+=122192928e5))+f)%4294967296;o[n++]=p>>>24&255,o[n++]=p>>>16&255,o[n++]=p>>>8&255,o[n++]=255&p;var m=d/4294967296*1e4&268435455;o[n++]=m>>>8&255,o[n++]=255&m,o[n++]=m>>>24&15|16,o[n++]=m>>>16&255,o[n++]=c>>>8|128,o[n++]=255&c;for(var g=e.node||s,y=0;y<6;++y)o[n+y]=g[y];return t||i(o)}},function(e,t,r){(function(t){var r,n=t.crypto||t.msCrypto;if(n&&n.getRandomValues){var i=new Uint8Array(16);r=function(){return n.getRandomValues(i),i}}if(!r){var o=new Array(16);r=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}e.exports=r}).call(this,r(8))},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,i=r;return i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]}},function(e,t,r){(function(e,r){var n="[object Arguments]",i="[object Map]",o="[object Object]",s="[object Set]",a=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,u={};u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u[n]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object Boolean]"]=u["[object DataView]"]=u["[object Date]"]=u["[object Error]"]=u["[object Function]"]=u[i]=u["[object Number]"]=u[o]=u["[object RegExp]"]=u[s]=u["[object String]"]=u["[object WeakMap]"]=!1;var c="object"==typeof e&&e&&e.Object===Object&&e,d="object"==typeof self&&self&&self.Object===Object&&self,f=c||d||Function("return this")(),h=t&&!t.nodeType&&t,p=h&&"object"==typeof r&&r&&!r.nodeType&&r,m=p&&p.exports===h,g=m&&c.process,y=function(){try{return g&&g.binding&&g.binding("util")}catch(e){}}(),v=y&&y.isTypedArray;function b(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function w(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function S(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var C,_,E,P=Array.prototype,T=Function.prototype,k=Object.prototype,A=f["__core-js_shared__"],O=T.toString,L=k.hasOwnProperty,I=(C=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+C:"",D=k.toString,R=RegExp("^"+O.call(L).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),F=m?f.Buffer:void 0,j=f.Symbol,W=f.Uint8Array,M=k.propertyIsEnumerable,N=P.splice,x=j?j.toStringTag:void 0,$=Object.getOwnPropertySymbols,B=F?F.isBuffer:void 0,U=(_=Object.keys,E=Object,function(e){return _(E(e))}),V=ye(f,"DataView"),H=ye(f,"Map"),q=ye(f,"Promise"),z=ye(f,"Set"),G=ye(f,"WeakMap"),Q=ye(Object,"create"),K=Se(V),Y=Se(H),J=Se(q),X=Se(z),Z=Se(G),ee=j?j.prototype:void 0,te=ee?ee.valueOf:void 0;function re(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ne(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function oe(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ie;++t<r;)this.add(e[t])}function se(e){var t=this.__data__=new ne(e);this.size=t.size}function ae(e,t){var r=Ee(e),n=!r&&_e(e),i=!r&&!n&&Pe(e),o=!r&&!n&&!i&&Le(e),s=r||n||i||o,a=s?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],l=a.length;for(var u in e)!t&&!L.call(e,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||we(u,l))||a.push(u);return a}function le(e,t){for(var r=e.length;r--;)if(Ce(e[r][0],t))return r;return-1}function ue(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":x&&x in Object(e)?function(e){var t=L.call(e,x),r=e[x];try{e[x]=void 0;var n=!0}catch(e){}var i=D.call(e);n&&(t?e[x]=r:delete e[x]);return i}(e):function(e){return D.call(e)}(e)}function ce(e){return Oe(e)&&ue(e)==n}function de(e,t,r,a,l){return e===t||(null==e||null==t||!Oe(e)&&!Oe(t)?e!=e&&t!=t:function(e,t,r,a,l,u){var c=Ee(e),d=Ee(t),f=c?"[object Array]":be(e),h=d?"[object Array]":be(t),p=(f=f==n?o:f)==o,m=(h=h==n?o:h)==o,g=f==h;if(g&&Pe(e)){if(!Pe(t))return!1;c=!0,p=!1}if(g&&!p)return u||(u=new se),c||Le(e)?pe(e,t,r,a,l,u):function(e,t,r,n,o,a,l){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new W(e),new W(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ce(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case i:var u=w;case s:var c=1&n;if(u||(u=S),e.size!=t.size&&!c)return!1;var d=l.get(e);if(d)return d==t;n|=2,l.set(e,t);var f=pe(u(e),u(t),n,o,a,l);return l.delete(e),f;case"[object Symbol]":if(te)return te.call(e)==te.call(t)}return!1}(e,t,f,r,a,l,u);if(!(1&r)){var y=p&&L.call(e,"__wrapped__"),v=m&&L.call(t,"__wrapped__");if(y||v){var b=y?e.value():e,C=v?t.value():t;return u||(u=new se),l(b,C,r,a,u)}}if(!g)return!1;return u||(u=new se),function(e,t,r,n,i,o){var s=1&r,a=me(e),l=a.length,u=me(t).length;if(l!=u&&!s)return!1;var c=l;for(;c--;){var d=a[c];if(!(s?d in t:L.call(t,d)))return!1}var f=o.get(e);if(f&&o.get(t))return f==t;var h=!0;o.set(e,t),o.set(t,e);var p=s;for(;++c<l;){d=a[c];var m=e[d],g=t[d];if(n)var y=s?n(g,m,d,t,e,o):n(m,g,d,e,t,o);if(!(void 0===y?m===g||i(m,g,r,n,o):y)){h=!1;break}p||(p="constructor"==d)}if(h&&!p){var v=e.constructor,b=t.constructor;v==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof b&&b instanceof b||(h=!1)}return o.delete(e),o.delete(t),h}(e,t,r,a,l,u)}(e,t,r,a,de,l))}function fe(e){return!(!Ae(e)||function(e){return!!I&&I in e}(e))&&(Te(e)?R:a).test(Se(e))}function he(e){if(r=(t=e)&&t.constructor,n="function"==typeof r&&r.prototype||k,t!==n)return U(e);var t,r,n,i=[];for(var o in Object(e))L.call(e,o)&&"constructor"!=o&&i.push(o);return i}function pe(e,t,r,n,i,o){var s=1&r,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var u=o.get(e);if(u&&o.get(t))return u==t;var c=-1,d=!0,f=2&r?new oe:void 0;for(o.set(e,t),o.set(t,e);++c<a;){var h=e[c],p=t[c];if(n)var m=s?n(p,h,c,t,e,o):n(h,p,c,e,t,o);if(void 0!==m){if(m)continue;d=!1;break}if(f){if(!b(t,(function(e,t){if(s=t,!f.has(s)&&(h===e||i(h,e,r,n,o)))return f.push(t);var s}))){d=!1;break}}else if(h!==p&&!i(h,p,r,n,o)){d=!1;break}}return o.delete(e),o.delete(t),d}function me(e){return function(e,t,r){var n=t(e);return Ee(e)?n:function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}(n,r(e))}(e,Ie,ve)}function ge(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function ye(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return fe(r)?r:void 0}re.prototype.clear=function(){this.__data__=Q?Q(null):{},this.size=0},re.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},re.prototype.get=function(e){var t=this.__data__;if(Q){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return L.call(t,e)?t[e]:void 0},re.prototype.has=function(e){var t=this.__data__;return Q?void 0!==t[e]:L.call(t,e)},re.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Q&&void 0===t?"__lodash_hash_undefined__":t,this},ne.prototype.clear=function(){this.__data__=[],this.size=0},ne.prototype.delete=function(e){var t=this.__data__,r=le(t,e);return!(r<0)&&(r==t.length-1?t.pop():N.call(t,r,1),--this.size,!0)},ne.prototype.get=function(e){var t=this.__data__,r=le(t,e);return r<0?void 0:t[r][1]},ne.prototype.has=function(e){return le(this.__data__,e)>-1},ne.prototype.set=function(e,t){var r=this.__data__,n=le(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},ie.prototype.clear=function(){this.size=0,this.__data__={hash:new re,map:new(H||ne),string:new re}},ie.prototype.delete=function(e){var t=ge(this,e).delete(e);return this.size-=t?1:0,t},ie.prototype.get=function(e){return ge(this,e).get(e)},ie.prototype.has=function(e){return ge(this,e).has(e)},ie.prototype.set=function(e,t){var r=ge(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},oe.prototype.add=oe.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},oe.prototype.has=function(e){return this.__data__.has(e)},se.prototype.clear=function(){this.__data__=new ne,this.size=0},se.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},se.prototype.get=function(e){return this.__data__.get(e)},se.prototype.has=function(e){return this.__data__.has(e)},se.prototype.set=function(e,t){var r=this.__data__;if(r instanceof ne){var n=r.__data__;if(!H||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new ie(n)}return r.set(e,t),this.size=r.size,this};var ve=$?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var s=e[r];t(s,r,e)&&(o[i++]=s)}return o}($(e),(function(t){return M.call(e,t)})))}:function(){return[]},be=ue;function we(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||l.test(e))&&e>-1&&e%1==0&&e<t}function Se(e){if(null!=e){try{return O.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ce(e,t){return e===t||e!=e&&t!=t}(V&&"[object DataView]"!=be(new V(new ArrayBuffer(1)))||H&&be(new H)!=i||q&&"[object Promise]"!=be(q.resolve())||z&&be(new z)!=s||G&&"[object WeakMap]"!=be(new G))&&(be=function(e){var t=ue(e),r=t==o?e.constructor:void 0,n=r?Se(r):"";if(n)switch(n){case K:return"[object DataView]";case Y:return i;case J:return"[object Promise]";case X:return s;case Z:return"[object WeakMap]"}return t});var _e=ce(function(){return arguments}())?ce:function(e){return Oe(e)&&L.call(e,"callee")&&!M.call(e,"callee")},Ee=Array.isArray;var Pe=B||function(){return!1};function Te(e){if(!Ae(e))return!1;var t=ue(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function ke(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Ae(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Oe(e){return null!=e&&"object"==typeof e}var Le=v?function(e){return function(t){return e(t)}}(v):function(e){return Oe(e)&&ke(e.length)&&!!u[ue(e)]};function Ie(e){return null!=(t=e)&&ke(t.length)&&!Te(t)?ae(e):he(e);var t}r.exports=function(e,t){return de(e,t)}}).call(this,r(8),r(32)(e))},function(e,t,r){var n=r(41),i=r(71),o=i;o.v1=n,o.v4=i,e.exports=o},function(e,t,r){(function(t){var r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/,i=/^\./,o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,s=/\\(\\)?/g,a=/^\[object .+?Constructor\]$/,l="object"==typeof t&&t&&t.Object===Object&&t,u="object"==typeof self&&self&&self.Object===Object&&self,c=l||u||Function("return this")();var d,f=Array.prototype,h=Function.prototype,p=Object.prototype,m=c["__core-js_shared__"],g=(d=/[^.]+$/.exec(m&&m.keys&&m.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"",y=h.toString,v=p.hasOwnProperty,b=p.toString,w=RegExp("^"+y.call(v).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),S=c.Symbol,C=f.splice,_=F(c,"Map"),E=F(Object,"create"),P=S?S.prototype:void 0,T=P?P.toString:void 0;function k(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function A(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function O(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function L(e,t){for(var r,n,i=e.length;i--;)if((r=e[i][0])===(n=t)||r!=r&&n!=n)return i;return-1}function I(e,t){for(var i,o=0,s=(t=function(e,t){if(N(e))return!1;var i=typeof e;if("number"==i||"symbol"==i||"boolean"==i||null==e||$(e))return!0;return n.test(e)||!r.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:N(i=t)?i:j(i)).length;null!=e&&o<s;)e=e[W(t[o++])];return o&&o==s?e:void 0}function D(e){return!(!x(e)||(t=e,g&&g in t))&&(function(e){var t=x(e)?b.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?w:a).test(function(e){if(null!=e){try{return y.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function R(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function F(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return D(r)?r:void 0}k.prototype.clear=function(){this.__data__=E?E(null):{}},k.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},k.prototype.get=function(e){var t=this.__data__;if(E){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return v.call(t,e)?t[e]:void 0},k.prototype.has=function(e){var t=this.__data__;return E?void 0!==t[e]:v.call(t,e)},k.prototype.set=function(e,t){return this.__data__[e]=E&&void 0===t?"__lodash_hash_undefined__":t,this},A.prototype.clear=function(){this.__data__=[]},A.prototype.delete=function(e){var t=this.__data__,r=L(t,e);return!(r<0)&&(r==t.length-1?t.pop():C.call(t,r,1),!0)},A.prototype.get=function(e){var t=this.__data__,r=L(t,e);return r<0?void 0:t[r][1]},A.prototype.has=function(e){return L(this.__data__,e)>-1},A.prototype.set=function(e,t){var r=this.__data__,n=L(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},O.prototype.clear=function(){this.__data__={hash:new k,map:new(_||A),string:new k}},O.prototype.delete=function(e){return R(this,e).delete(e)},O.prototype.get=function(e){return R(this,e).get(e)},O.prototype.has=function(e){return R(this,e).has(e)},O.prototype.set=function(e,t){return R(this,e).set(e,t),this};var j=M((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if($(e))return T?T.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var r=[];return i.test(e)&&r.push(""),e.replace(o,(function(e,t,n,i){r.push(n?i.replace(s,"$1"):t||e)})),r}));function W(e){if("string"==typeof e||$(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function M(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=e.apply(this,n);return r.cache=o.set(i,s),s};return r.cache=new(M.Cache||O),r}M.Cache=O;var N=Array.isArray;function x(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function $(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==b.call(e)}e.exports=function(e,t,r){var n=null==e?void 0:I(e,t);return void 0===n?r:n}}).call(this,r(8))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BootReadyItem=t.BootConfigElement=t.ALL_BOOT_STAGES=void 0,t.ALL_BOOT_STAGES=["microkernel","kernel","authentication","preuser","earlyuser","user"];t.BootConfigElement=class{};t.BootReadyItem=class{constructor(e,t,r){this.name=e,this.type=t,this.config=r}}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},,function(e,t,r){"use strict";(function(e){var n=r(29),i=r(51),o="object"==typeof exports&&exports&&!exports.nodeType&&exports,s=o&&"object"==typeof e&&e&&!e.nodeType&&e,a=s&&s.exports===o?n.a.Buffer:void 0,l=(a?a.isBuffer:void 0)||i.a;t.a=l}).call(this,r(48)(e))},function(e,t,r){"use strict";t.a=function(){return!1}},function(e,t,r){(function(e,r){var n="[object Arguments]",i="[object Function]",o="[object GeneratorFunction]",s="[object Map]",a="[object Set]",l=/\w*$/,u=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,d={};d[n]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object DataView]"]=d["[object Boolean]"]=d["[object Date]"]=d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d[s]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d[a]=d["[object String]"]=d["[object Symbol]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Error]"]=d[i]=d["[object WeakMap]"]=!1;var f="object"==typeof e&&e&&e.Object===Object&&e,h="object"==typeof self&&self&&self.Object===Object&&self,p=f||h||Function("return this")(),m=t&&!t.nodeType&&t,g=m&&"object"==typeof r&&r&&!r.nodeType&&r,y=g&&g.exports===m;function v(e,t){return e.set(t[0],t[1]),e}function b(e,t){return e.add(t),e}function w(e,t,r,n){var i=-1,o=e?e.length:0;for(n&&o&&(r=e[++i]);++i<o;)r=t(r,e[i],i,e);return r}function S(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function C(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function _(e,t){return function(r){return e(t(r))}}function E(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var P,T=Array.prototype,k=Function.prototype,A=Object.prototype,O=p["__core-js_shared__"],L=(P=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+P:"",I=k.toString,D=A.hasOwnProperty,R=A.toString,F=RegExp("^"+I.call(D).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j=y?p.Buffer:void 0,W=p.Symbol,M=p.Uint8Array,N=_(Object.getPrototypeOf,Object),x=Object.create,$=A.propertyIsEnumerable,B=T.splice,U=Object.getOwnPropertySymbols,V=j?j.isBuffer:void 0,H=_(Object.keys,Object),q=ge(p,"DataView"),z=ge(p,"Map"),G=ge(p,"Promise"),Q=ge(p,"Set"),K=ge(p,"WeakMap"),Y=ge(Object,"create"),J=Se(q),X=Se(z),Z=Se(G),ee=Se(Q),te=Se(K),re=W?W.prototype:void 0,ne=re?re.valueOf:void 0;function ie(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function oe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function se(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ae(e){this.__data__=new oe(e)}function le(e,t){var r=_e(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ee(e)}(e)&&D.call(e,"callee")&&(!$.call(e,"callee")||R.call(e)==n)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=r.length,o=!!i;for(var s in e)!t&&!D.call(e,s)||o&&("length"==s||be(s,i))||r.push(s);return r}function ue(e,t,r){var n=e[t];D.call(e,t)&&Ce(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function ce(e,t){for(var r=e.length;r--;)if(Ce(e[r][0],t))return r;return-1}function de(e,t,r,u,c,f,h){var p;if(u&&(p=f?u(e,c,f,h):u(e)),void 0!==p)return p;if(!ke(e))return e;var m=_e(e);if(m){if(p=function(e){var t=e.length,r=e.constructor(t);t&&"string"==typeof e[0]&&D.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(e),!t)return function(e,t){var r=-1,n=e.length;t||(t=Array(n));for(;++r<n;)t[r]=e[r];return t}(e,p)}else{var g=ve(e),y=g==i||g==o;if(Pe(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if("[object Object]"==g||g==n||y&&!f){if(S(e))return f?e:{};if(p=function(e){return"function"!=typeof e.constructor||we(e)?{}:(t=N(e),ke(t)?x(t):{});var t}(y?{}:e),!t)return function(e,t){return pe(e,ye(e),t)}(e,function(e,t){return e&&pe(t,Ae(t),e)}(p,e))}else{if(!d[g])return f?e:{};p=function(e,t,r,n){var i=e.constructor;switch(t){case"[object ArrayBuffer]":return he(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return function(e,t){var r=t?he(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var r=t?he(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,n);case s:return function(e,t,r){return w(t?r(C(e),!0):C(e),v,new e.constructor)}(e,n,r);case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,l.exec(e));return t.lastIndex=e.lastIndex,t}(e);case a:return function(e,t,r){return w(t?r(E(e),!0):E(e),b,new e.constructor)}(e,n,r);case"[object Symbol]":return o=e,ne?Object(ne.call(o)):{}}var o}(e,g,de,t)}}h||(h=new ae);var _=h.get(e);if(_)return _;if(h.set(e,p),!m)var P=r?function(e){return function(e,t,r){var n=t(e);return _e(e)?n:function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}(n,r(e))}(e,Ae,ye)}(e):Ae(e);return function(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r,e););}(P||e,(function(n,i){P&&(n=e[i=n]),ue(p,i,de(n,t,r,u,i,e,h))})),p}function fe(e){return!(!ke(e)||(t=e,L&&L in t))&&(Te(e)||S(e)?F:u).test(Se(e));var t}function he(e){var t=new e.constructor(e.byteLength);return new M(t).set(new M(e)),t}function pe(e,t,r,n){r||(r={});for(var i=-1,o=t.length;++i<o;){var s=t[i],a=n?n(r[s],e[s],s,r,e):void 0;ue(r,s,void 0===a?e[s]:a)}return r}function me(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function ge(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return fe(r)?r:void 0}ie.prototype.clear=function(){this.__data__=Y?Y(null):{}},ie.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ie.prototype.get=function(e){var t=this.__data__;if(Y){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return D.call(t,e)?t[e]:void 0},ie.prototype.has=function(e){var t=this.__data__;return Y?void 0!==t[e]:D.call(t,e)},ie.prototype.set=function(e,t){return this.__data__[e]=Y&&void 0===t?"__lodash_hash_undefined__":t,this},oe.prototype.clear=function(){this.__data__=[]},oe.prototype.delete=function(e){var t=this.__data__,r=ce(t,e);return!(r<0)&&(r==t.length-1?t.pop():B.call(t,r,1),!0)},oe.prototype.get=function(e){var t=this.__data__,r=ce(t,e);return r<0?void 0:t[r][1]},oe.prototype.has=function(e){return ce(this.__data__,e)>-1},oe.prototype.set=function(e,t){var r=this.__data__,n=ce(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},se.prototype.clear=function(){this.__data__={hash:new ie,map:new(z||oe),string:new ie}},se.prototype.delete=function(e){return me(this,e).delete(e)},se.prototype.get=function(e){return me(this,e).get(e)},se.prototype.has=function(e){return me(this,e).has(e)},se.prototype.set=function(e,t){return me(this,e).set(e,t),this},ae.prototype.clear=function(){this.__data__=new oe},ae.prototype.delete=function(e){return this.__data__.delete(e)},ae.prototype.get=function(e){return this.__data__.get(e)},ae.prototype.has=function(e){return this.__data__.has(e)},ae.prototype.set=function(e,t){var r=this.__data__;if(r instanceof oe){var n=r.__data__;if(!z||n.length<199)return n.push([e,t]),this;r=this.__data__=new se(n)}return r.set(e,t),this};var ye=U?_(U,Object):function(){return[]},ve=function(e){return R.call(e)};function be(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||c.test(e))&&e>-1&&e%1==0&&e<t}function we(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||A)}function Se(e){if(null!=e){try{return I.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ce(e,t){return e===t||e!=e&&t!=t}(q&&"[object DataView]"!=ve(new q(new ArrayBuffer(1)))||z&&ve(new z)!=s||G&&"[object Promise]"!=ve(G.resolve())||Q&&ve(new Q)!=a||K&&"[object WeakMap]"!=ve(new K))&&(ve=function(e){var t=R.call(e),r="[object Object]"==t?e.constructor:void 0,n=r?Se(r):void 0;if(n)switch(n){case J:return"[object DataView]";case X:return s;case Z:return"[object Promise]";case ee:return a;case te:return"[object WeakMap]"}return t});var _e=Array.isArray;function Ee(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!Te(e)}var Pe=V||function(){return!1};function Te(e){var t=ke(e)?R.call(e):"";return t==i||t==o}function ke(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ae(e){return Ee(e)?le(e):function(e){if(!we(e))return H(e);var t=[];for(var r in Object(e))D.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}r.exports=function(e){return de(e,!1,!0)}}).call(this,r(8),r(32)(e))},function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(4)),o=r(18),s=r(6),a=n(r(20));
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */
let l=null;var u=new function(){const e={},t={};let n=null;this.getDefaultTemplateURL=function(e){n?setTimeout(()=>{e(n)},0):(l||(l=r(21).default),l.get({field:"finsemble"},(t,r)=>{n=o.ConfigUtilInstance.getDefault(r,"finsemble.notificationURL",r.moduleRoot+"/components/system/notification/notification.html"),e(n)}))},this.alert=function(e,t,r,n,i){const o=this;i&&i.url?this.alertInternal(e,t,r,n,i,i.url):this.getDefaultTemplateURL(s=>{o.alertInternal(e,t,r,n,i,s)})},this.alertInternal=function(r,n,o,l,u,c){let d=!1;const f="UserNotification.alert."+o,h=(u=u||{}).duration||864e5;switch(n){case"ONCE-SINCE-STARTUP":f in e?d=!1:(d=!0,e[f]=!0);break;case"MAX-COUNT":{let e=0;const r=u.maxCount||1;f in t&&(e=t[f]),t[f]=++e,e<=r&&(d=!0);break}default:d=!0}if(i.default.log("UserNotification.alert",r,d,n,o,l,u),d){const e={url:c,message:l,timeout:h};a.default.systemLog({notification:!0},"Notification: "+l),new s.System.Notification(e)}}};t.default=u,e.exports=t.default},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(10)),o=n(r(4)),s=n(r(76));t.default=class{constructor(e){this.eventList=[],this.eventHandlerMap={},this.eventGuidMap={},this.name=e.name,this.sourceType=e.sourceType,window.addEventListener("beforeunload",()=>{this.cleanup()})}addListener(e,t){return this.addEventListener(e,t)}removeListener(e,t){return this.removeEventListener(e,t)}addEventListener(e,t){if(!t)return console.error("no handler",e);if(o.default.system.debug("addEventListener:",e),this.eventHandlerMap[e]||(this.eventHandlerMap[e]=[],this.eventGuidMap[e]=[]),!this.eventHandlerMap[e].includes(t)){const r=`${window.name}_public_${Date.now()}_${Math.random()}`;this.eventHandlerMap[e].push(t),this.eventGuidMap[e].push(r),i.default.transmit("Finsemble.RegisterInterruptibleEvent."+this.name,{event:e,listenerGuid:r}),i.default.addResponder("Finsemble.Interrupt."+r,(n,i)=>{new s.default({source:this.name,sourceType:this.sourceType,listenerGuid:r,handler:t,event:e},i)})}}removeEventListener(e,t){if(o.default.system.debug("removeEventListener:",e),!this.eventHandlerMap[e])return o.default.system.warn("not found");let r=this.eventHandlerMap[e].indexOf(t);if(-1!==r){const t=this.eventGuidMap[e][r];this.eventHandlerMap[e].splice(r,1),this.eventGuidMap[e].splice(r,1),i.default.transmit("Finsemble.UnregisterInterruptibleEvent."+window.name,{event:e,guid:t}),i.default.removeResponder("Finsemble.Interrupt."+t)}}cleanup(){for(var e of Object.keys(this.eventHandlerMap))for(var t of this.eventHandlerMap[e])this.removeEventListener(e,t)}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FSBLDependencyManagerSingleton=t.FSBLDependencyManager=void 0;const i=r(31),o=n(r(10)),s=r(25),a=n(r(20)),l=n(r(4));class u extends i.EventEmitter{constructor(e){super(),this.callback=e.callback,this.dependencies=e.dependencies,this.startupTimer=null,this.setStartupTimer=this.setStartupTimer.bind(this),this.clearStartupTimer=this.clearStartupTimer.bind(this),this.setStartupTimer()}clearStartupTimer(){clearTimeout(this.startupTimer),delete this.startupTimer}setStartupTimer(){const e=this;this.startupTimer=+setTimeout(()=>{e.emit("timeout")},1e4)}}function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}class d{constructor(){this.servicesAreAllOnline={},this.clientsAreAllOnline={},this.onlineClients=[],this.dependencies={},this.startupTimers={},this.startupTimerFired=!1,this.bindCorrectContext()}waitFor(e,t){const r=c();e.clients||(e.clients=[]),e.clients.length&&(e.clients=e.clients.map(e=>e.charAt(0).toLowerCase()+e.slice(1)));const n=new u({dependencies:e,callback:t});return n.on("timeout",()=>{this.onDependencyTimeout(n)}),this.dependencies[r]=n,this.checkDependencies(),n}onDependencyTimeout(e){const t=this.getOfflineClients();let r="APPLICATION LIFECYCLE:STARTUP:Dependency not online after 10 seconds.";t.length&&(r=`${r} Waiting for these clients: ${t.join(", ")}.`),e.emit("err",r)}checkDependencies(){for(const e in this.dependencies){const t=this.dependencies[e],{dependencies:r,callback:n}=t;(!r.clients.length||this.clientsAreAllOnline[e]||(this.clientsAreAllOnline[e]=this.checkClients(r.clients),this.clientsAreAllOnline[e]))&&(delete this.dependencies[e],t.clearStartupTimer(),n&&n())}}getOfflineClients(){let e=[];for(const t in this.dependencies){const{dependencies:r}=this.dependencies[t];e=e.concat(r.clients.filter(e=>!this.onlineClients.includes(e)))}return e.filter((t,r)=>e.indexOf(t)===r)}checkClients(e){return e.every(e=>this.onlineClients.includes(e))}setClientOnline(e){this.onlineClients.includes(e)||(this.onlineClients.push(e),this.checkDependencies())}getOnlineClients(){return this.onlineClients}bindCorrectContext(){this.checkDependencies=this.checkDependencies.bind(this),this.checkClients=this.checkClients.bind(this),this.getOfflineClients=this.getOfflineClients.bind(this),this.onDependencyTimeout=this.onDependencyTimeout.bind(this),this.waitFor=this.waitFor.bind(this)}}class f{constructor(){this.offlineServices=[],this.dependencies={},this.checkDependencies=this.checkDependencies.bind(this)}waitFor(e,t){l.default.system.debug("DependencyManager:waitFor",e),e.services||(e.services=[]);const r=c();this.dependencies[r]={dependencies:e,callback:t}}checkDependencies(){if(console.debug("checkDependencies",this.dependencies),Object.keys(this.dependencies))for(const e in this.dependencies){const{dependencies:t,callback:r}=this.dependencies[e];if(l.default.system.debug("DependencyManager:checkDependency",t.services,this.offlineServices),t.services.length){if(!this.checkServices(t.services))continue}console.debug("checkDependencies callback"),delete this.dependencies[e],r&&r()}}checkServices(e){return e.every(e=>this.offlineServices.includes(e))}setServiceOffline(e){l.default.system.debug("setServiceOffline",e),console.debug("setServiceOffline",e),this.offlineServices.push(e),this.checkDependencies()}}class h extends i.EventEmitter{constructor(){super(),this.startup=new d,this.shutdown=new f,this.RouterClient=o.default,this.AuthorizationCompleted=!1,this.bindCorrectContext(),this.onAuthorizationCompleted(this.startup.checkDependencies),o.default.onReady(this.listenForServices)}bindCorrectContext(){this.listenForServices=this.listenForServices.bind(this),this.onAuthorizationCompleted=this.onAuthorizationCompleted.bind(this)}setClientOnline(e){this.startup.setClientOnline(e)}onServiceStateChange(e){Object.keys(e).forEach(t=>{const{state:r}=e[t];"closed"===r&&this.shutdown.setServiceOffline(t)})}listenForServices(){l.default.system.debug("DependencyManager:listenForServices before wait"),a.default.waitForBootStage("kernel","stageEntered",()=>{l.default.system.debug("DependencyManager:listenForServices after wait"),this.RouterClient.subscribe(s.SERVICES_STATE_CHANNEL,(e,t)=>{l.default.system.debug("DependencyManager:listenForServices SERVICES_STATE_CHANNEL",t.data),this.onServiceStateChange(t.data)}),this.RouterClient.addListener(s.SERVICE_CLOSED_CHANNEL,(e,t)=>{l.default.system.debug("DependencyManager:listenForServices SERVICE_CLOSED_CHANNEL",t.data);const r={};r[t.data.name]={state:"closed"},this.onServiceStateChange(r)}),this.RouterClient.subscribe(s.APPLICATION_STATE_CHANNEL,(e,t)=>{switch(t.data.state){case"authenticated":case"ready":break;case"closing":this.shutdown.checkDependencies()}})})}onAuthorizationCompleted(e){this.AuthorizationCompleted?e():this.addListener("AuthorizationCompleted",e)}}t.FSBLDependencyManager=h,t.FSBLDependencyManagerSingleton=new h,t.default=t.FSBLDependencyManagerSingleton},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FinsembleWindow=void 0;const a=s(r(10)),l=s(r(4)),u=s(r(78)),c=s(r(60)),d=o(r(17)),f=s(r(54)),h=o(r(25)),p=r(33),m=r(6),g=r(90),y=r(91);u.default.initialize(),c.default.initialize(),window._FSBLCache||(window._FSBLCache={storeClientReady:!1,windows:{},gettingWindow:[],windowAttempts:{}});let v=(()=>{class e extends f.default{constructor(t){super({name:t.name,sourceType:"Window"}),this.types={},this.wrapState=t.wrapState||"initializing",this.componentState={},this.windowState=e.WINDOWSTATE.NORMAL,this.type=null,this.windowType=null,this.bounds={},this.guid=`${Date.now()}_${Math.random()}`,this.WINDOWSTATE=h.WINDOWSTATE,this.windowOptions={},this.doConstruction(t),this.TITLE_CHANGED_CHANNEL=`Finsemble.${this.name}.titleChanged`,this.componentKey=d.camelCase("activeWorkspace",this.name,this.name),this.windowKey=d.camelCase("activeWorkspace",this.name),e.bindFunctions(this)}standardizeEventName(e){switch(e){case"bounds-set":case"stoppedMoving":return"bounds-change-end";case"startedMoving":return"bounds-change-start";case"bringToFront":return"broughtToFront";case"setParent":return"parent-set";case"clearParent":return"parent-unset";default:return e}}addEventListener(e,t){return e=this.standardizeEventName(e),super.addEventListener(e,t)}removeEventListener(e,t){if("closed"!==e||!window.finsembleWindow||this.name!==finsembleWindow.name)return e=this.standardizeEventName(e),super.removeEventListener(e,t)}windowServiceChannelName(e){return"WindowService-Request-"+e}eventChannelName(e){return`WindowService-Event-${this.name||this.windowName}-${e}`}doConstruction(t){if(t.setWindowType||t.windowType||(t.windowType="WebWindow"),t.windowType){t.setWindowType=t.windowType,delete t.windowType;return new e(t)}if(t)for(const e in t)this[e]=t[e];this.name||(this.name=t.windowName),this.windowType=this.setWindowType}static registerType(t,r){const n=e;n.types||(n.types={}),n.types[t]=r}static bindFunctions(e){e.setParent=e.setParent.bind(e),e.getParent=e.getParent.bind(e),e.eventChannelName=e.eventChannelName.bind(e),e.windowServiceChannelName=e.windowServiceChannelName.bind(e),e.handleWrapRemoveRequest=e.handleWrapRemoveRequest.bind(e)}static getInstance(t,r=Function.prototype){const n=m.System.Window.getCurrent().name;if(t&&t.windowName&&(t.name=t.windowName),!(t=g(t))||!t.name)return r("name is required");return t.windowName=t.name,new Promise((async function(i,o){if(window._FSBLCache.windows[t.name]){l.default.system.debug("WRAP LIFECYCLE:",t.name,"Window found in the cache, returning without going to the Launcher");const e=window._FSBLCache.windows[t.name];return i({wrap:e}),r(null,e)}if(t.uuid&&t.name){if(t.windowIdentifier||(t.windowIdentifier={uuid:t.uuid,name:t.name,windowName:t.name,windowType:t.windowType}),!1!==t.waitForReady)try{await e._windowReady(t.windowName),t.wrapState="ready"}catch(e){return o(e),r(e,null)}if(l.default.system.debug("WRAP LIFECYCLE:",t.name,"All information for wrap passed in, creating wrap locally"),window._FSBLCache.windows[t.name]){l.default.system.debug("WRAP LIFECYCLE:",t.name,"Window found in the cache, returning without going to the Launcher");const e=window._FSBLCache.windows[t.name];return i({wrap:e}),r(null,e)}const{wrap:n}=await e._createWrap(t);return i({wrap:n}),r(null,n)}if(!1!==t.waitForReady)try{await e._windowReady(t.windowName),t.wrapState="ready"}catch(e){return o(e),r(e,null)}a.default.query("WindowService-Request-getWindowIdentifier",{windowName:t.name,requester:n},async(n,s)=>{if(n)return l.default.system.error(n),o(n),r(n,null);if(window._FSBLCache.windows[t.name]){const e=window._FSBLCache.windows[t.name];return l.default.system.debug("WRAP LIFECYCLE:",t.name,"Information received from launcher, but wrap exists in cache. Returning cached wrap."),i({wrap:e}),r(null,e)}const{identifier:a}=s.data;a.windowName&&(a.name=a.windowName),l.default.system.debug("WRAP LIFECYCLE:",t.name,"Information received from launcher. Creating wrap."),t.retrievedIdentifier=a;const{wrap:u}=await e._createWrap(t);s.data.descriptor&&(u.descriptor=s.data.descriptor),i({wrap:u}),r(null,u)})}))}static _createWrap(t){return new Promise((function(r){const n=t.retrievedIdentifier||t.windowIdentifier;let i=null;void 0===window._FSBLCache.windowAttempts[t.name]&&(window._FSBLCache.windowAttempts[t.name]=0),(t.setWindowType||n.windowType)&&"WebApplication"!==n.windowType||(n.windowType="WebWindow");let o=Object.assign({},n);o=Object.assign(o,t),o.setWindowType=o.windowType,delete o.windowType,l.default.system.debug("WRAP LIFECYCLE: Placing wrap into the local cache.",n.windowName);const s=e;window._FSBLCache.windows[n.windowName]=new s(o),i=window._FSBLCache.windows[n.windowName],i.windowType=n.windowType,i.identifier=n,i.addEventListener("closed",i.handleWrapRemoveRequest),i.addEventListener("maximized",()=>{i.windowState=e.WINDOWSTATE.MAXIMIZED}),i.addEventListener("minimized",()=>{i.windowState=e.WINDOWSTATE.MINIMIZED}),i.addEventListener("restored",()=>{i.windowState=e.WINDOWSTATE.NORMAL});const u=a.default.subscribe("Finsemble.Component.State."+n.windowName,(e,t)=>{if(e)l.default.system.error("Finsemble component state change error",e);else{const{state:e}=t.data;i.wrapState=e,a.default.unsubscribe(u)}});i.parentSubscribeID=a.default.subscribe("Finsemble.parentChange."+n.windowName,(e,t)=>{if(e)l.default.system.error("FinsembleWindow parent change notification error",e),r({wrap:i});else{const e=t.data||{};"Added"===e.type?(l.default.system.debug("FinsembleWindow Parent Notification: window.addedToStack listener",e),i.setParent(e.stackedWindowIdentifier,()=>{r({wrap:i})})):"Exists"===e.type?(l.default.system.debug("FinsembleWindow Parent Notification: Parent already exists, checking if added to wrap",e),i.setParentOnWrap(e.stackedWindowIdentifier,()=>{r({wrap:i})})):"Removed"===e.type?(l.default.system.debug("FinsembleWindow Parent Notification: window.removedFromStack listener",e),i.clearParent(),r({wrap:i})):e.type?(l.default.system.error("FinsembleWindow Parent Notification: unknown type",e),r({wrap:i})):r({wrap:i})}})}))}static _getRemoveWrapChannel(e){return`${m.System.Window.getCurrent().name}.removeWrap.${e}`}async handleWrapRemoveRequest(e){e&&e.wait(),l.default.system.debug("WRAP Destructor. Removing cached window",this.name,"in ",window.name),this.removeListeners&&this.removeListeners(),this.cleanupRouter(),this.cleanup(),this.name!==window.name&&(delete window._FSBLCache.windows[this.name],delete window._FSBLCache.windowAttempts[this.name]),e&&e.done()}cleanupRouter(){const t=e._getRemoveWrapChannel(this.name);a.default.removeResponder(t),this.TITLE_CHANGED_SUBSCRIPTION&&a.default.unsubscribe(this.TITLE_CHANGED_SUBSCRIPTION),a.default.unsubscribe(this.parentSubscribeID)}onReady(e){if("ready"===this.wrapState)return e();this.addEventListener("ready",e)}queryWindowService(e,t,r=Function.prototype){if("close"!==e&&"setParent"!==e&&"ready"!==this.wrapState)return void this.onReady(()=>{this.wrapState="ready",this.queryWindowService(e,t,r)});return new Promise(async(n,i)=>{"function"==typeof t&&(r=t,t={}),(t=t||{}).windowIdentifier=this.identifier,l.default.setting().system.Debug&&(t.callstack=l.default.callStack()),l.default.system.debug("FinsembleWindow.queryWindowService",this.windowServiceChannelName(e),t);let o=null;a.default.query(this.windowServiceChannelName(e),t,(t,s)=>{t?(l.default.system.debug(`WindowService.${e}: failed`,t),console.debug(`WindowService.${e}: failed`,t),"getComponentState"!==e&&"Not found"!==t&&i(t)):(o=s.data,l.default.system.debug(this.windowServiceChannelName(e)+" successful",o),console.debug(this.windowServiceChannelName(e)+" successful",o)),n(o),r(t,o)})})}minimize(e=null,t=Function.prototype){this.queryWindowService("minimize",e,t)}maximize(e=null,t=Function.prototype){this.queryWindowService("maximize",e,t)}restore(e=null,t=Function.prototype){this.queryWindowService("restore",e,t)}blur(e=null,t=Function.prototype){this.queryWindowService("blur",e,t)}focus(e=null,t=Function.prototype){this.queryWindowService("focus",e,t)}bringToFront(e=null,t=Function.prototype){this.queryWindowService("bringToFront",e,t)}setAlwaysOnTop(e={alwaysOnTop:!0},t=Function.prototype){this.queryWindowService("setAlwaysOnTop",e,t)}isAlwaysOnTop(e={},t){this.queryWindowService("isAlwaysOnTop",{},t)}isShowing(e={},t){this.queryWindowService("isShowing",e,t)}setIgnoreMouseEvents(e,t,r=Function.prototype){const n={ignore:new Boolean(e).valueOf(),options:new Boolean(t).valueOf()?t:{forward:!1}};this.queryWindowService("setIgnoreMouseEvents",n,r)}setShape(e,t=Function.prototype){this.queryWindowService("setShape",e,t)}async addBrowserView(e,t=Function.prototype){const r=await this.queryWindowService("addBrowserView",e,t);return new y.FinsembleView({id:r,win:this})}async removeBrowserView(e,t=Function.prototype){await this.queryWindowService("removeBrowserView",{viewId:e.id},t)}async bringViewToFront(e,t=Function.prototype){await this.queryWindowService("bringViewToFront",{viewId:e.id},t)}async setViewBounds(e,t=Function.prototype){await this.queryWindowService("setViewBounds",{viewId:e.view.id,bounds:e.bounds},t)}setBounds(e={bounds:{}},t=Function.prototype){if("function"!=typeof e&&!e.bounds){e={bounds:e}}this.queryWindowService("setBounds",e,t)}getBounds(e={},t=Function.prototype){return new Promise(r=>{this.queryWindowService("getBounds",e,(e,n)=>{r({err:e,data:n}),t(e,n)})})}updateOptions(e,t=Function.prototype){this.queryWindowService("updateOptions",e,t)}hide(e={},t=Function.prototype){this.queryWindowService("hide",e,t)}show(e={},t=Function.prototype){this.queryWindowService("show",e,t)}showAt(e={},t=Function.prototype){this.queryWindowService("showAt",e,t)}close(e={},t=Function.prototype){l.default.system.debug("WRAP CLOSE. Public close initiated for",this.name,e),this.queryWindowService("close",e,()=>{l.default.system.debug("WRAP CLOSE. Public close initiated for",this.name),t()})}animate(e={},t=Function.prototype){this.queryWindowService("animate",e,t)}registerWithDocking(e={},t){this.onReady(()=>{a.default.query("DockingService.registerWindow",{type:this.type,windowType:this.windowType,windowMsg:e,name:this.windowName},t)})}unRegisterWithDocking(){a.default.transmit("DockingService.deregisterWindow",{name:this.windowName})}initializeWindow({manageWindowMovement:e,identifier:t},r=Function.prototype){const n=()=>{a.default.publish(`Finsemble.${this.windowName}.componentReady`,{name:this.windowName}),r()};e?this.registerWithDocking(t,n):n()}wrapReady(){a.default.publish(`Finsemble.${this.windowName}.wrapReady`,{name:this.windowName,state:"open"})}setOpacity(e,t=Function.prototype){this.queryWindowService("setOpacity",e,t)}startTabTileMonitoring(e={}){l.default.system.debug("FinsembleWindow.startTabTileMonitoring",e),a.default.transmit("TabTile.startTabTile",{params:e})}stopTabTileMonitoring(e={},t=Function.prototype){l.default.system.debug("FinsembleWindow.stopTabTileMonitoring",e),a.default.query("TabTile.stopTabTile",{params:e},(function(e,r){e?l.default.system.warn("TabTile.stopTabTile: query failed",e):l.default.system.debug("TabTile.stopTabTile results",r.data);const n=r.data;t?t(e,n,this.defaultStopTrackingAction):this.defaultTabTileAction(n)}))}defaultTabTileAction(e){const t=this;switch(l.default.system.debug("FinsembleWindow.defaultTabTileAction",e),e.stoppedLocation){case"OutsideWindow":case"TabSection":break;case"InsideWindow":e.tileGroupId?t.Group.addWindow(this.identifier,e.tileGroupId,e.dropCoordinates):t.Group.createGroup((function(r){t.Group.addWindow(this.identifier,r,e.dropCoordinates,{startingWindowIdentifier:e.droppedOnWindowIdentifier})}));break;default:l.default.system.error("stopTracking returned an unknown stoppedLocation result",e)}}mergeBounds(e){e.right=e.left+e.width;const t={left:e.left,right:e.right,width:e.width,top:e.top,bottom:e.top+e.height,height:e.height},r={defaultLeft:e.left,defaultWidth:e.width,defaultTop:e.top,defaultHeight:e.height};Object.assign(this.windowOptions,t),Object.assign(this.windowOptions,r),this.windowOptions.bounds=t}startMove(e={}){l.default.system.debug("FinsembleWindow.startMove",e),e.windowIdentifier=this.identifier,a.default.transmit(this.eventChannelName("startedMoving"),{})}stopMove(e={}){l.default.system.debug("FinsembleWindow.stopMove",e),e.windowIdentifier=this.identifier,a.default.transmit(this.eventChannelName("stoppedMoving"),{})}getMonitor(e){a.default.query("DockingService.getMonitorForWindow",{windowIdentifier:this.identifier},(t,r)=>r?e(r.data):e())}getComponentState(e,t){this.queryWindowService("getComponentState",e,t)}getWindowState(e,t){this.queryWindowService("getWindowState",e,t)}setComponentState(e,t=(()=>{})){this.queryWindowService("setComponentState",e,t)}removeComponentState(e,t=(()=>{})){this.queryWindowService("removeComponentState",e,t)}setWindowState(e,t=(()=>{})){this.queryWindowService("setWindowState",e,t)}saveCompleteWindowState(e={},t=Function.prototype){this.queryWindowService("saveCompleteWindowState",e,t)}cancelTabTileMonitoring(e={}){l.default.system.debug("FinsembleWindow.cancelTabTileMonitoring",e),a.default.transmit("TabTile.cancelTabTile",{params:e})}getParent(t){this.settingParent?e.getInstance(this.settingParent,(e,r)=>{t(null,r)}):this.parentWindow?t(null,this.parentWindow):t(null,null)}setParent(t,r){if(this.settingParent)return this.getParent(r);this.settingParent=t,this.parentWindow&&this.parentWindow.name===t.windowName?(l.default.system.debug("FinsembleWindow.setParent already set",t),this.settingParent=!1,r(null,this.parentWindow)):this.queryWindowService("setParent",t,()=>{l.default.system.debug("FinsembleWindow.setParent",t),e.getInstance(t,(e,n)=>{e?l.default.system.error("FinsembleWindow.setParent error",e):(l.default.system.debug("FinsembleWindow.setParent wrap success",t),this.parentWindow=n,this.parentWindow.windowType.includes("StackedWindow")||l.default.system.error("FinsembleWindow.setParent error",this.parentWindow.name,t.windowName)),a.default.transmit(h.DOCKING.REQUEST_PUBLISH,null),this.settingParent=!1;const i=()=>{this.removeEventListener("parent-set",i),r(e,n)};this.addEventListener("parent-set",i)})})}setParentOnWrap(t,r=Function.prototype){this.parentWindow&&this.parentWindow.name===t.windowName?(l.default.system.debug("FinsembleWindow.setParentOnWrap already set",t),r(null,this.parentWindow)):this.queryWindowService("setParent",t,()=>{l.default.system.debug("FinsembleWindow.setParentOnWrap",t),e.getInstance(t,(e,n)=>{e?l.default.system.error("FinsembleWindow.setParentOnWrap error",e):(l.default.system.debug("FinsembleWindow.setParentOnWrap success getting wrap",t),console.debug("FinsembleWindow.setParentOnWrap success getting wrap",this,n),this.parentWindow=n,!1===this.parentWindow.windowType.includes("StackedWindow")&&l.default.system.error("FinsembleWindow.setParentOnWrap error",this.parentWindow.name,t.windowName)),r(e,n)})})}clearParent(){l.default.system.debug("FinsembleWindow.clearParent",this.parentWindow),this.parentWindow=null}setTitle(e){l.default.system.debug("Title change",e),a.default.publish(this.TITLE_CHANGED_CHANNEL,e)}getOptions(e=Function.prototype){this.queryWindowService("getOptions",{},e)}_privateManagementPreface(e,t){return"function"==typeof t&&l.default.system.error("StackedWindowWrapper.wrapPreface bad params",t),(t=t||{}).stackedWindowIdentifier={windowName:this.identifier.windowName,windowType:this.identifier.windowType},l.default.system.debug(`StackedWindow.${e}  _privateManagementPreface`,t),t}addWindow(e,t=Function.prototype){e=this._privateManagementPreface("addWindow",e);return new Promise(r=>{a.default.query("StackedWindow.addWindow",e,(e,n)=>{l.default.system.debug("StackedWindow.addWindow callback",e,n),t(e,n.data),r({err:e,data:n.data})})})}removeWindow(e,t=Function.prototype){e=this._privateManagementPreface("removeWindow",e);return new Promise(r=>{a.default.query("StackedWindow.removeWindow",e,(e,n)=>{l.default.system.debug("StackedWindow.removeWindow callback",e,n),t(e,n.data),r({err:e,data:n.data})})})}deleteWindow(e,t=Function.prototype){e=this._privateManagementPreface("deleteWindow",e);return new Promise(r=>{a.default.query("StackedWindow.deleteWindow",e,(e,n)=>{l.default.system.debug("StackedWindow.deleteWindow callback",e,n),t(e,n.data),r({err:e,data:n.data})})})}setVisibleWindow(e,t=Function.prototype){e=this._privateManagementPreface("setVisibleWindow",e);return new Promise(r=>{a.default.query("StackedWindow.setVisibleWindow",e,(e,n)=>{l.default.system.debug("StackedWindow.setVisibleWindow callback",e,n),t(e,n.data),r({err:e,data:n.data})})})}reorder(e,t=Function.prototype){e=this._privateManagementPreface("reorder",e);return new Promise(r=>{a.default.query("StackedWindow.reorder",e,(e,n)=>{l.default.system.debug("StackedWindow.reorder callback",e,n),t(e,n.data),r({err:e,data:n.data})})})}formGroup(){const e=this.parentWindow?this.parentWindow.name:this.name;a.default.transmit("DockingService.formGroup",{windowName:e})}ejectFromGroup(){const e=this.parentWindow?this.parentWindow.name:this.name;a.default.query("DockingService.leaveGroup",{name:e},()=>{})}}return e.WINDOWSTATE={NORMAL:0,MINIMIZED:1,MAXIMIZED:2,HIDDEN:3},e.wrap=e.getInstance,e.isStartupApplication=async function(e){let t;const r=await new Promise((e,t)=>{m.System.Application.getCurrent().getManifest(e,t)}).catch(()=>{t=!1});return r&&(t=r&&r.startup_app&&r.startup_app.name===e),t},e._windowReady=function(t){let r;l.default.system.debug(`windowServiceReady: ${t} starting`);const n="Finsemble.Component.State."+t;return new Promise(async(i,o)=>{const s=(e,n)=>{const{state:o}=n.data;switch(l.default.system.debug(`windowServiceReady: ${t} state change: ${o}`),console.log(`windowServiceReady: ${t} state change: ${o}`),o){case"ready":case"reloading":case"closing":l.default.system.debug(`windowServiceReady: ${t} ${o}`),a.default.unsubscribe(r),i()}};await e.isStartupApplication(t)||p.isServiceInWindow(t)?o("Cannot Wrap Service Manager or Services"):(l.default.system.debug(`windowServiceReady: ${t} waiting`),r=a.default.subscribe(n,s))})},e})();t.FinsembleWindow=v},,,function(e,t,r){(function(t){var r=/^\s+|\s+$/g,n=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,o=/^0o[0-7]+$/i,s=parseInt,a="object"==typeof t&&t&&t.Object===Object&&t,l="object"==typeof self&&self&&self.Object===Object&&self,u=a||l||Function("return this")(),c=Object.prototype.toString,d=Math.max,f=Math.min,h=function(){return u.Date.now()};function p(e,t,r){var n,i,o,s,a,l,u=0,c=!1,p=!1,y=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var r=n,o=i;return n=i=void 0,u=t,s=e.apply(o,r)}function b(e){return u=e,a=setTimeout(S,t),c?v(e):s}function w(e){var r=e-l;return void 0===l||r>=t||r<0||p&&e-u>=o}function S(){var e=h();if(w(e))return C(e);a=setTimeout(S,function(e){var r=t-(e-l);return p?f(r,o-(e-u)):r}(e))}function C(e){return a=void 0,y&&n?v(e):(n=i=void 0,s)}function _(){var e=h(),r=w(e);if(n=arguments,i=this,l=e,r){if(void 0===a)return b(l);if(p)return a=setTimeout(S,t),v(l)}return void 0===a&&(a=setTimeout(S,t)),s}return t=g(t)||0,m(r)&&(c=!!r.leading,o=(p="maxWait"in r)?d(g(r.maxWait)||0,t):o,y="trailing"in r?!!r.trailing:y),_.cancel=function(){void 0!==a&&clearTimeout(a),u=0,n=l=i=a=void 0},_.flush=function(){return void 0===a?s:C(h())},_}function m(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function g(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==c.call(e)}(e))return NaN;if(m(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=m(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var a=i.test(e);return a||o.test(e)?s(e.slice(2),a?2:8):n.test(e)?NaN:+e}e.exports=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return m(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),p(e,t,{leading:n,maxWait:t,trailing:i})}}).call(this,r(8))},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StorageClient=void 0;const i=n(r(86)),o=n(r(19)),s=n(r(4)),a=r(22),l=r(33),u=i.default(1);class c extends a._BaseClient{constructor(){super(...arguments),this.clientReady=!1,this.delete=this.remove}setUser(e,t){this.clientReady||s.default.system.error("storageClient invoked before ready"),o.default.args(e.user,"string",t,"function="),this.routerClient.query("Storage.setUser",{user:e.user},(r,n)=>{(r?s.default.system.error:s.default.system.info)("APPLICATION LIFECYCLE:StorageClient.setUser",e,r,n),t&&t(r,n.data)})}setStore(e,t){this.clientReady||s.default.system.error("storageClient invoked before ready"),o.default.args(e.topic,"string",e.dataStore,"string=",t,"function="),s.default.system.log("APPLICATION LIFECYCLE:StorageClient.setStore",e,t),this.routerClient.query("Storage.setStore",e,(e,r)=>{(e?s.default.system.error:s.default.system.info)("Storage.setStore",e,r),t&&t(e,r.data)})}save(e,t){if(this.clientReady||s.default.system.error("storageClient invoked before ready"),"string"!=typeof e.key||"string"!=typeof e.topic)throw new Error("Values for key and topic must be strings.");return new Promise((r,n)=>{o.default.args(e.topic,"string",e.key,"string",e.value,"any",t,"function="),this.routerClient.query("Storage.save",e,(e,i)=>{(e?s.default.system.error:s.default.system.info)("Storage.save",e,i),t&&t(e,i.data),e?n({err:e,data:null}):r({err:e,data:i.data})})})}save1(e){return u(()=>this.save(e))}get(e,t){if(this.clientReady||s.default.system.error("storageClient invoked before ready"),"string"!=typeof e.key||"string"!=typeof e.topic)throw new Error("Values for key and topic must be strings.");return new Promise((r,n)=>{o.default.args(e.topic,"string",e.key,"string",t,"function="),this.routerClient.query("Storage.get",e,(e,i)=>{if(e)return s.default.system.error("Storage.get",e,i),t&&t(e,i?i.data:null),n(e,i?i.data:null);s.default.system.info("Storage.get",e,i),t&&t(e,i.data),r(i.data)})})}get1(e,t){return u(()=>this.get(e,t))}async updateStorage(e){const{topic:t,key:r,updateFn:n}=e,i=await this.get({topic:t,key:r});return await this.save({topic:t,key:r,value:n(i)})}updateStorage1(e){return u(()=>this.updateStorage(e))}keys(e,t){this.clientReady||s.default.system.error("storageClient invoked before ready"),o.default.args(e.topic,"string",t,"function="),s.default.system.debug("StorageClient.keys",e,t),this.routerClient.query("Storage.keys",e,(e,r)=>{(e?s.default.system.error:s.default.system.info)("Storage.keys",e,r),t&&t(e,r.data)})}keys1(e){return u(()=>l.promisify(this.keys.bind(this))(e))}getMultiple(e,t){this.clientReady||s.default.system.error("storageClient invoked before ready"),s.default.system.info("StorageClient.getMultiple",e,t),this.routerClient.query("Storage.getMultiple",e,(r,n)=>{(r?s.default.system.error:s.default.system.info)("StorageClient.getMultiple:",e,n),t&&t(r,n)})}remove(e,t){this.clientReady||s.default.system.error("storageClient invoked before ready");return new Promise((r,n)=>{o.default.args(e.topic,"string",e.key,"string",t,"function="),this.routerClient.query("Storage.delete",e,(e,i)=>{(e?s.default.system.error:s.default.system.info)("StorageClient.delete",e,i),t&&t(e,i.data),e?n({err:e,data:null}):r({err:e,data:i.data})})})}remove1(e){return u(()=>this.remove(e))}clearCache(e){s.default.system.log("StorageClient.clearCache",e),this.routerClient.query("Storage.clearCache",null,(t,r)=>{(t?s.default.system.error:s.default.system.info)("StorageClient.clearCache",t,r),e&&e(t,r.data)})}}t.StorageClient=c;var d=new c({onReady(e){e&&e(),d.clientReady=!0},name:"storageClient"});t.default=d},function(e,t,r){"use strict";function n(e,t,r){var n=r?" !== ":" === ",i=r?" || ":" && ",o=r?"!":"",s=r?"":"!";switch(e){case"null":return t+n+"null";case"array":return o+"Array.isArray("+t+")";case"object":return"("+o+t+i+"typeof "+t+n+'"object"'+i+s+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+n+'"number"'+i+s+"("+t+" % 1)"+i+t+n+t+")";default:return"typeof "+t+n+'"'+e+'"'}}e.exports={copy:function(e,t){for(var r in t=t||{},e)t[r]=e[r];return t},checkDataType:n,checkDataTypes:function(e,t){switch(e.length){case 1:return n(e[0],t,!0);default:var r="",i=o(e);for(var s in i.array&&i.object&&(r=i.null?"(":"(!"+t+" || ",r+="typeof "+t+' !== "object")',delete i.null,delete i.array,delete i.object),i.number&&delete i.integer,i)r+=(r?" && ":"")+n(s,t,!0);return r}},coerceToTypes:function(e,t){if(Array.isArray(t)){for(var r=[],n=0;n<t.length;n++){var o=t[n];(i[o]||"array"===e&&"array"===o)&&(r[r.length]=o)}if(r.length)return r}else{if(i[t])return[t];if("array"===e&&"array"===t)return["array"]}},toHash:o,getProperty:l,escapeQuotes:u,equal:r(97),ucs2length:r(199),varOccurences:function(e,t){t+="[^0-9]";var r=e.match(new RegExp(t,"g"));return r?r.length:0},varReplace:function(e,t,r){return t+="([^0-9])",r=r.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),r+"$1")},cleanUpCode:function(e){return e.replace(c,"").replace(d,"").replace(f,"if (!($1))")},finalCleanUpCode:function(e,t){var r=e.match(h);r&&2==r.length&&(e=t?e.replace(m,"").replace(g,"return data;"):e.replace(p,"").replace("return errors === 0;","validate.errors = null; return true;"));return(r=e.match(y))&&3===r.length?e.replace(v,""):e},schemaHasRules:function(e,t){if("boolean"==typeof e)return!e;for(var r in e)if(t[r])return!0},schemaHasRulesExcept:function(e,t,r){if("boolean"==typeof e)return!e&&"not"!=r;for(var n in e)if(n!=r&&t[n])return!0},schemaUnknownRules:function(e,t){if("boolean"==typeof e)return;for(var r in e)if(!t[r])return r},toQuotedString:b,getPathExpr:function(e,t,r,n){return C(e,r?"'/' + "+t+(n?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):n?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")},getPath:function(e,t,r){var n=b(r?"/"+_(t):l(t));return C(e,n)},getData:function(e,t,r){var n,i,o,s;if(""===e)return"rootData";if("/"==e[0]){if(!w.test(e))throw new Error("Invalid JSON-pointer: "+e);i=e,o="rootData"}else{if(!(s=e.match(S)))throw new Error("Invalid JSON-pointer: "+e);if(n=+s[1],"#"==(i=s[2])){if(n>=t)throw new Error("Cannot access property/index "+n+" levels up, current level is "+t);return r[t-n]}if(n>t)throw new Error("Cannot access data "+n+" levels up, current level is "+t);if(o="data"+(t-n||""),!i)return o}for(var a=o,u=i.split("/"),c=0;c<u.length;c++){var d=u[c];d&&(o+=l(E(d)),a+=" && "+o)}return a},unescapeFragment:function(e){return E(decodeURIComponent(e))},unescapeJsonPointer:E,escapeFragment:function(e){return encodeURIComponent(_(e))},escapeJsonPointer:_};var i=o(["string","number","integer","boolean","null"]);function o(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}var s=/^[a-z$_][a-z$_0-9]*$/i,a=/'|\\/g;function l(e){return"number"==typeof e?"["+e+"]":s.test(e)?"."+e:"['"+u(e)+"']"}function u(e){return e.replace(a,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}var c=/else\s*{\s*}/g,d=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,f=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g;var h=/[^v.]errors/g,p=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,m=/var errors = 0;|var vErrors = null;/g,g=/if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/,y=/[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g,v=/if \(rootData === undefined\) rootData = data;/;function b(e){return"'"+u(e)+"'"}var w=/^\/(?:[^~]|~0|~1)*$/,S=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function C(e,t){return'""'==e?t:(e+" + "+t).replace(/' \+ '/g,"")}function _(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function E(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}},function(e,t,r){"use strict";(function(e){
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */
var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RouterClientConstructor=void 0;const a=s(r(63)),l=o(r(17)),u=r(18),c=s(r(19)),d=s(r(53)),f=r(6),h=r(4),p=r(40),m=r(45),g=[],y=e;let v=h.Logger;y.FSBLData=y.FSBLData||{},y.FSBLData.RouterClients=y.FSBLData.RouterClients||{},t.RouterClientConstructor=function(e){c.default.args(e,"object")&&c.default.args2("params.clientName",e.clientName,"string","params.transportName",e.transportName,"string=");const t=e.clientName,{transportName:r}=e;let n,i;const o={},s={},h={},b={},w={},S={},C={},_={},E={},P={};let T,k=null,A=!1;const O=[],L=this;function I(){this.header={origin:T,type:"initialHandshake"}}function D(e,t){this.header={origin:T,type:"timeCalibration"},this.clientBaseTime=e,this.serviceBaseTime=t}function R(e){this.header={origin:T,type:"addListener",channel:e}}function F(e,t,r){this.header={origin:T,type:"transmit",channel:e},this.data=t,this.options=r}function j(e){this.header={origin:T,type:"removeListener",channel:e}}function W(e){this.header={origin:T,type:"addResponder",channel:e}}function M(e,t,r){this.header={origin:T,type:"query",queryID:e,channel:t},this.data=r}function N(e,t,r){this.header={origin:T,type:"queryResponse",queryID:e,error:t},this.data=r}function x(e){this.header={origin:T,type:"removeResponder",channel:e}}function $(e,t){this.header={origin:T,type:"subscribe",subscribeID:e,topic:t}}function B(e,t){this.header={origin:T,type:"unsubscribe",subscribeID:e,topic:t}}function U(e,t){this.header={origin:T,type:"publish",topic:e},this.data=t}function V(e,t,r,n){this.header={origin:T,type:"notify",subscribeID:e,topic:t,error:r},this.data=n}function H(e,t,r){this.header={origin:T,type:"addPubSubResponder",topic:e,handleOnServer:r},this.data=t}function q(e){this.header={origin:T,type:"removePubSubResponder",topic:e}}function z(){for(L.startupTime=performance.now()-L.startupTime,v.system.debug("WINDOW LIFECYCLE:STARTUP:RouterClient Ready"),A=!0;O.length>0;){v.system.debug("WINDOW LIFECYCLE:STARTUP:RouterClient parentReady invoked");O.shift()()}}function G(e){!k||k instanceof Promise?(v.system.warn("RouterClient: Queuing message since router initialization not complete",e),g.push(e)):k.send(e)}function Q(){return this.header.origin===this.header.lastClient}function K(e,t){v.system.info("RouterClient: outgoing query response","CHANNEL",this.header.channel,"RESPONSE DATA",t,"QUERY ID",this.header.queryID),G(new N(this.header.queryID,e,t))}function Y(e,t){const r=e[t.header.channel];void 0===r?v.system.warn(`RouterClient: no query responder define on channel ${t.header.channel} incoming from ${t.header.origin}`,t):t.header.error?(v.system.warn("RouterClient: queryResponder error",t),r(t.header.error,null),delete e[t.header.channel]):(t.originatedHere=Q,t.sendQueryResponse=K.bind(t),v.system.info("RouterClient: incoming query","CHANNEL",t.header.channel,"FROM",t.header.origin,"QUERY MESSAGE",t),r(null,t))}function J(e,t){const r=e[t.header.queryID];void 0===r?v.system.warn("RouterClient: no handler for incoming query response","QUERY ID",t.header.queryID):(!function(e,t){const r=e[t];void 0!==r&&clearTimeout(r)}(P,t.header.queryID),t.header.error?(v.system.debug("RouterClient: incoming queryResponse error",t.header,"QUERY ID",t.header.queryID),r(t.header.error,t)):(v.system.info("RouterClient: incoming query response","RESPONSE MESSAGE",t,"QUERY ID",t.header.queryID),r(null,t)),delete e[t.header.queryID])}function X(e,t){if(e)v.system.warn("RouterClient: income publish rejected by pubsub responder",e,t);else{b[this.header.topic]=t;const r=S[this.header.topic];if(void 0!==r)for(let n=0;n<r.length;n++)v.system.info("RouterClient: sending pubsub notify","TOPIC",this.header.topic,"NOTIFY DATA",t),G(new V(r[n],this.header.topic,e,t))}}function Z(e,t){var r,n,i;(function(e){let t=!1;return void 0===e&&(t=!0),t})(t)||G(new V(this.header.subscribeID,this.header.topic,e,t)),e?v.system.warn("RouterClient: incoming subscription rejected by pubsub responder","TOPIC",this.header.topic,"MESSAGE",this):(r=S,n=this.header.topic,i=this.header.subscribeID,n in r?r[n].push(i):r[n]=[i],v.system.info("RouterClient: incoming subscription added","TOPIC",this.header.topic,"MESSAGE",this))}function ee(){!function(e,t,r){let n=!1;if(t in e){const i=S[t];for(let o=0;o<i.length;o++)if(r===i[o]){i.splice(o,1),0===i.length&&delete e[t],n=!0,v.system.info("RouterClient: PubSub removeListener","TOPIC",t,"FROM",r);break}}n||v.system.warn(`RouterClient: tried to remove non-existent listener on ${t} from ${JSON.stringify(r)}`)}(S,this.header.topic,this.header.subscribeID)}function te(e){switch(v.system.verbose("Incoming Message Type",e.header.type,e),e.header.type){case"transmit":!function(e,t){const r=e[t.header.channel]||[],n=[];if(Array.isArray(r)&&0!==r.length){t.originatedHere=Q,r.forEach(e=>{n.push(e)});for(let e=0;e<n.length;e++)v.isLogMessage(t.header.channel)||v.system.info("RouterClient: incoming transmit","CHANNEL",t.header.channel,"FROM",t.header.origin,"MESSAGE",t),n[e](null,t)}else v.system.warn(`RouterClient: no listener for incoming transmit on channel ${t.header.channel} from ${t.header.origin}`,t)}(o,e);break;case"query":Y(s,e);break;case"queryResponse":J(E,e);break;case"notify":!function(e,t){const r=e[t.header.subscribeID];void 0===r?v.system.warn("RouterClient: no subscription handler defined for incoming notify for subscriberID",t.header.subscribeID,t):t.header.error?(v.system.info("RouterClient: incoming PubSub notify error for subscriberID","SUBSCRIBER ID",t.header.subscribeID,"NOTIFY MESSAGE",t),r(t.header.error,t)):(t.originatedHere=Q,v.system.info("RouterClient: incoming PubSub notify","SUBSCRIBER ID",t.header.subscribeID,"NOTIFY MESSAGE",t),r(null,t))}(C,e);break;case"publish":!function(e){let t=h[e.header.topic];if(void 0===t)for(const r in w)if(w[r].test(e.header.topic)){t=h[r];break}void 0===t?v.system.warn("RouterClient: no pubsub responder defined for incoming publish","TOPIC",e.header.topic,"PUBLISH MESSAGE",e):(e.sendNotifyToAllSubscribers=X,t.publishCallback?(v.system.info("RouterClient: incoming PubSub publish callback invoked","TOPIC",e.header.topic,"PUBLISH MESSAGE",e),t.publishCallback(null,e)):(v.system.info("RouterClient: incoming PubSub publish","TOPIC",e.header.topic,"PUBLISH MESSAGE",e),e.sendNotifyToAllSubscribers(null,e.data)))}(e);break;case"subscribe":!function(e){v.system.info("RouterClient: PubSub subscribe","TOPIC",e.header.topic);let t=h[e.header.topic];if(void 0===t)for(const r in w)if(w[r].test(e.header.topic)){t=h[r];let n=b[e.header.topic];void 0===n&&(n=b[r]),b[e.header.topic]=n;break}void 0===t?v.system.warn("RouterClient: no pubsub responder defined for incoming subscribe",e):e.header.error?v.system.warn("RouterClient: pubsub error received from router service: "+JSON.stringify(e.header.error)):(e.sendNotifyToSubscriber=Z,t.subscribeCallback?(e.data=b[e.header.topic],t.subscribeCallback(null,e)):e.sendNotifyToSubscriber(null,b[e.header.topic]))}(e);break;case"unsubscribe":!function(e){let t=h[e.header.topic];if(void 0===t)for(const r in w)if(w[r].test(e.header.topic)){t=h[r];break}void 0===t?v.system.warn("RouterClient: no pubsub responder defined for incoming unsubscribe","TOPIC",e.header.topic,"UNSUBSCRIBE MESSAGE",e):(e.removeSubscriber=ee,t.unsubscribeCallback?(v.system.info("RouterClient: incoming unsubscribe callback","TOPIC",e.header.topic,"UNSUBSCRIBE MESSAGE",e),t.unsubscribeCallback(null,e)):(v.system.info("RouterClient: incoming unsubscribe","TOPIC",e.header.topic,"UNSUBSCRIBE MESSAGE",e),e.removeSubscriber()))}(e);break;case"timeCalibration":const t=()=>{i?i(e):setTimeout(()=>{t()},10)};t();break;case"initialHandshakeResponse":n()}}function re(e,t){t.header.lastClient=T,t.header.incomingTransportInfo=e,te(t)}function ne(){return`${T}.${m.v4()}`}function ie(e,t,r){e[t]=r}function oe(e,t,r,n){n>0&&(e[t]=setTimeout(()=>{v.system.warn(`RouterClient: timeout waiting on query response on channel ${r} for queryID ${t} on timer ${e[t]} timeout=${n}`)},n))}function se(e,t){let r=!1;return void 0!==e[t]&&(delete e[t],r=!0),r}return this.startupTime=0,this.calibrateTimeWithRouterService=function(e){let t,r=0,n=1/0;i=function(i){r++,r>5?function(r){let i=0;for(let e=1;e<5;e++){const o=r.clientBaseTime[e-1],s=r.clientBaseTime[e]-o,a=r.serviceBaseTime[e-1]-(o+s/2);s<n&&(n=s,t=a),i+=a,v.system.debug("calibrationCalculation Intermediate Values","lastRRT",s,"lastOffset",a,"fastestOffset",t,"fastestRRT",n)}i/=4,v.system.debug("RouterClient calibrationCalculation","Average Offset",i,"Chosen FastestOffset",t,r),e(t)}(i):(i.clientBaseTime.push(y.performance.timing.navigationStart+y.performance.now()),G(new D(i.clientBaseTime,i.serviceBaseTime)))},i(new D([],[]))},this.ready=e=>this.onReady(e),this.getClientName=function(){return v.system.debug("RouterClient.getClientName",T),T},this.onReady=function(e){c.default.args(e,"function"),A?e():O.push(e)},this.addListener=function(e,t){v.system.info("RouterClient.addListener","CHANNEL",e),c.default.args(e,"string",t,"function");(function(e,t,r){let n=!1;const i=e[t];return void 0===i||0===i.length?(e[t]=[r],n=!0):i.push(r),n})(o,e,t)&&G(new R(e))},this.transmit=function(e,t,r={suppressWarnings:!1}){v.isLogMessage(e)||v.system.info("RouterClient.transmit","TO CHANNEL",e,"EVENT",t),c.default.args(e,"string",t,"any"),G(new F(e,t,r))},this.removeListener=function(e,t){v.system.info("RouterClient.removeListener","CHANNEL",e,"EVENT HANDLER",t),c.default.args(e,"string",t,"function");(function(e,t,r){let n=!1;const i=e[t];if(void 0!==i){const e=i.indexOf(r);e>-1?(i.splice(e,1),0===i.length&&(n=!0)):v.system.warn("no listener defined for channel: "+t)}return n})(o,e,t)&&G(new j(e))},this.addResponder=function(e,t){v.system.info("RouterClient.addResponder","CHANNEL",e),c.default.args(e,"string",t,"function");(function(e,t,r){let n=!1;return void 0===e[t]&&(e[t]=r,n=!0),n})(s,e,t)?G(new W(e)):(v.system.warn("RouterClient.addResponder: Responder already locally defined for channel "+e),t({"RouteClient QueryError":"Responder already locally defined for channel"+e},null))},this.query=function(e,t,r,n=Function.prototype){const i=`${ne()}.${e}`,o=window.performance.timing.navigationStart+window.performance.now(),s=window.performance.timing.navigationStart,a=window.performance.now();function l(l){ie(E,i,(u,c)=>{l({err:u,response:c}),"function"==typeof n?n(u,c):v.system.warn("No response event handler passed to RouterClient.query","RESPONDER CHANNEL",e,"QUERY EVENT",t,"PARAMS",r,"QUERY ID",i,{timestamp:o,navstart:s,timenow:a})}),oe(P,i,e,r.timeout),G(new M(i,e,t))}return v.system.info("RouterClient.query","RESPONDER CHANNEL",e,"QUERY EVENT",t,"PARAMS",r,"QUERY ID",i,{timestamp:o,navstart:s,timenow:a}),3===arguments.length&&(n=r,r={timeout:2e4}),c.default.args(e,"string",t,"any=",r,"object=",n,"function"),r=r||{},c.default.args2("params.timeout",r.timeout,"number"),new Promise(l)},this.removeResponder=function(e){v.system.info("RouterClient.removeResponder","RESPONDER CHANNEL",e),c.default.args(e,"string");se(s,e)&&G(new x(e))},this.addPubSubResponder=function(t,r,n,i){let o,s;if(v.system.info("RouterClient.addPubSubResponder","TOPIC",t,"INITIAL STATE",r,"PARAMS",n),c.default.args(t,"any",r,"object=",e,"object="),n=n||{},c.default.args2("params.subscribeCallback",n.subscribeCallback,"function=","params.publishCallback",n.publishCallback,"function=")&&c.default.args2("params.unsubscribeCallback",n.unsubscribeCallback,"function="),void 0===n.subscribeCallback&&void 0===n.publishCallback&&void 0===n.unsubscribeCallback)r=r||{},G(new H(t.toString(),r,!0)),s="success";else{(function(e,t,r,n){let i=!1;return void 0===h[e.toString()]&&(e instanceof RegExp&&(w[e.toString()]=e,v.system.info("RouterClient: PubSub RegEx added for topic "+e.toString())),h[e.toString()]={subscribeCallback:t,publishCallback:r,unsubscribeCallback:n},i=!0),i})(t,n.subscribeCallback,n.publishCallback,n.unsubscribeCallback)?(r=r||{},b[t.toString()]=l.clone(r),G(new H(t.toString(),r,!1)),s="success"):(o="RouterClient.addPubSubResponder: Responder already locally defined for topic "+t,v.system.error(o))}i&&i(o,s)},this.removePubSubResponder=function(e){v.system.info("RouterClient.removePubSubResponder","TOPIC",e),c.default.args(e,"any");se(h,e)?(delete b[e.toString()],delete w[e.toString()],G(new q(e))):v.system.warn("RouterClient.removePubSubResponder failed: Could not find responder for topic "+e)},this.subscribe=function(e,t){v.system.info("RouterClient.subscribe","TOPIC",e),c.default.args(e,"string",t,"function");const r=ne();return function(e,t,r,n){e[t]=r,_[t]=n}(C,r,t,e),G(new $(r,e)),{subscribeID:r,topic:e}},this.publish=function(e,t){v.system.info("RouterClient.publish","TOPIC",e,"EVENT",t),c.default.args(e,"string",t,"any"),G(new U(e,t))},this.unsubscribe=function(e){v.system.info("RouterClient.unsubscribe","SUBSCRIBE ID",e),c.default.args(e,"object")&&c.default.args2("subscribeIDStruct.subscribeID",e.subscribeID,"string");(function(e,t){let r=!1;return void 0!==e[t]&&(delete e[t],r=!0),r})(C,e.subscribeID)?G(new B(e.subscribeID,e.topic)):v.system.warn("RouterClient.unsubscribe: Could not find subscribeID for topic "+e.topic)},this.trustedMessage=function(e){let t=!0;return v.system.debug("RouterClient.trustedMessage header",e.header),"SharedWorker"===e.header.originIncomingTransportInfo.transportID&&(t=!0),t},this.disconnectAll=function(){v.system.info("RouterClient.disconnectAll");for(const e in o)v.system.debug("RouterClient.disconnectAll is removing listener on "+e),G(new j(e)),delete o[e];for(const e in s)v.system.debug("RouterClient.disconnectAll is removing responder on "+e),G(new x(e)),delete s[e];for(const e in h)v.system.debug("RouterClient.disconnectAll is removing pubsub responder on "+e),G(new q(e)),delete h[e.toString()],delete b[e.toString()],delete w[e.toString()];for(const e in C){const t=_[e];v.system.debug("RouterClient.disconnectAll is removing subscriber on "+t),G(new B(e,t)),delete C[e],delete _[e]}},"loggerService"===f.System.Window.getCurrent().name&&(v=new p.LocalLogger),T=`${t}.${f.System.Window.getCurrent().name}`,T in y.FSBLData.RouterClients?(v.system.debug('"RouterClient Check: reusing existing client for '+T),console.debug('"RouterClient Check: reusing existing client for '+T,y)):(v.system.debug('"RouterClient Check: constructing new client for '+T),console.debug('"RouterClient Check: constructing new client for '+T,y),y.FSBLData.RouterClients[T]=this,function(e,t){v.system.debug("WINDOW LIFECYCLE:STARTUP:RouterClient Constructor:Name:",e);let i=0;function o(i){v.system.info("WINDOW LIFECYCLE:STARTUP:RouterClient:processManifest"),i&&"string"!=typeof i?function(e,t,i,o){v.system.verbose(`Client ${t} connecting to event router`),v.system.verbose("Name of transport to establish: "+i);const s=void 0===i;let l,c,f=!1,h=0;const p=e.finsemble,m={FinsembleUUID:p.FinsembleUUID,applicationRoot:p.applicationRoot,routerDomainRoot:p.moduleRoot,forceWindowTransport:u.ConfigUtilInstance.getDefault(p,"finConfig.router.forceWindowTransport",{}),sameDomainTransport:u.ConfigUtilInstance.getDefault(p,"finConfig.router.sameDomainTransport","SharedWorker"),crossDomainTransport:u.ConfigUtilInstance.getDefault(p,"finConfig.router.crossDomainTransport","IPCBus"),transportSettings:u.ConfigUtilInstance.getDefault(p,"finConfig.router.transportSettings",{}),IAC:u.ConfigUtilInstance.getDefault(p,"finConfig.IAC",{})};let y,b,w,S,C,_;y=e=>{c=0,v.system.debug("WINDOW LIFECYCLE:STARTUP:RouterClient:transport ready","TRANSPORT OBJECT",e),k=e,n=_,C(),l=setInterval(C,200)},b=e=>{v.system.error("RouterClientError",e)},w=()=>{v.system.debug("WINDOW LIFECYCLE:STARTUP:RouterClient:getClientTransport","ROUTER PARAMS:",m),k=s?a.default.getRecommendedTransport(m,re,T,"RouterService").then(y).catch(b):a.default.getTransport(m,r,re,T,"RouterService").then(y).catch(b)},S=()=>{if(clearInterval(l),h++,h<=3)v.system.error("WINDOW LIFECYCLE:STARTUP:RouterClient: failure to connect to router service. Retrying...",h,m),w();else{const e="A cross domain transport has failed to connect. Cross domain components may not work. Please contact your administrator.";v.system.error(e,m);const t=u.ConfigUtilInstance.getDefault(p,"finConfig.notificationURL",p.moduleRoot+"/components/system/notification/notification.html");d.default.alert("dev","ONCE-SINCE-STARTUP","FSBL-Internal-Transport-Failure",e,{url:t})}},C=()=>{v.system.debug("WINDOW LIFECYCLE:STARTUP:RouterClient: sendHandshake",c),G(new I),c++>50&&S()},_=()=>{if(!f){if(v.system.debug(`WINDOW LIFECYCLE:STARTUP:RouterClient connected: Starting ${T} with transport ${k.identifier()}`),f=!0,clearInterval(l),g)for(let e=0;e<g.length;e++){v.system.debug("RouterClient: firing queued msg");const t=g[e];k.send(t)}o&&o()}},w()}(i,e,t,z):v.system.error("WINDOW LIFECYCLE:STARTUP:RouterClient:processManifest failed -- fatal error",i)}f.System.ready(()=>{const e=f.System.Window.getCurrent();v.system.debug("WINDOW LIFECYCLE:STARTUP: System.ready invoked in "+e.name),console.debug("WINDOW LIFECYCLE:STARTUP: System.ready invoked in "+e.name),L.startupTime=performance.now(),0==i++&&e.getOptions(e=>{e.customData&&e.customData.manifest?(v.system.debug("Router Init using custom data"),o(e.customData.manifest)):u.ConfigUtilInstance.getExpandedRawManifest(e=>{v.system.debug("Router Init using getExpandedRawManifest"),y.FinsembleUUID&&(e.finsemble.FinsembleUUID=y.FinsembleUUID),o(e)},e=>{v.system.error("WINDOW LIFECYCLE:STARTUP:RouterClient:manifest error",e)})},e=>{v.system.error("WINDOW LIFECYCLE:STARTUP:finWindow.getOptions error",e)})})}(T,r)),y.FSBLData.RouterClients[T]}}).call(this,r(8))},function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(18),o=n(r(4)),s=r(6),a={activeTransports:{},addTransport(e,t){this.activeTransports[e]=t,o.default.system.log(`RouterTransport ${e} added to activeTransports`)},getActiveTransports(e){const t=[];function r(e){-1===t.indexOf(e)&&t.push(e)}return s.System.InterApplicationBus&&r("IPCBus"),"Electron"===s.System.container&&r("FinsembleTransport"),SharedWorker&&r("SharedWorker"),r(e.sameDomainTransport),r(e.crossDomainTransport),o.default.system.log("getActiveTransports",t),t},getDefaultTransport:(e,t,r,n)=>a.getTransport(e,"IPCBus",t,r,n),getRecommendedTransport(e,t,r,n){const i=function(){const{sameDomainTransport:t}=e,{crossDomainTransport:r}=e;let n=t;return function(){const t=document.createElement("a");t.href=e.routerDomainRoot;const r=window.location.hostname===t.hostname,n=window.location.protocol===t.protocol,i=(void 0!==window.location.port?window.location.port:80)===(void 0!==t.port?t.port:80),s=!(r&&i&&n);return o.default.system.debug(`Transport crossDomain=${s} (${r}:${n}:${i})`),s}()&&(n=r),o.default.system.log(`Transport Info: Selected=${n} SameDomainDefault=${t} CrossDomainDefault=${r}`),console.log(`Transport Info: Selected=${n} SameDomainDefault=${t} CrossDomainDefault=${r}`),n}();return a.getTransport(e,i,t,r,n)},getTransport(e,t,r,n,i){const o=this;return new Promise((s,a)=>{const l=o.activeTransports[t];l?new l(e,r,n,i,e=>{s(e)}):a("unknown router transport name: "+t)})}};const l={SharedWorkerTransport:function(e,t,r,n,i){let s;const a=this;this.send=function(e,t){1===arguments.length?(t=arguments[0],e=null):(e=arguments[0],t=arguments[1]),o.default.system.verbose("SharedWorkerTransport Outgoing Transport",t);try{s.port.postMessage([e,t])}catch(e){o.default.system.error("SharedWorkerTransport: post message failed: "+JSON.stringify(e),"Probable cause is sending illegal data type (e.g. function).")}},this.identifier=function(){return"SharedWorker"};const l=e.transportSettings.SharedWorker&&e.transportSettings.SharedWorker.workerPath?e.transportSettings.SharedWorker.workerPath:e.routerDomainRoot+"/common/routerSharedWorker.js";o.default.system.log(`SharedWorker Transport Initializing for ${r} using ${l}`),console.log(`SharedWorker Transport Initializing for ${r} using ${l}`),s=new SharedWorker(l,{name:"Finsemble",credentials:"include"}),s.port.onmessage=function(e){const r=e.data[0],n=e.data[1],i={transportID:a.identifier(),port:r};o.default.system.verbose("SharedWorkerTransport Incoming Transport",i,"Message",n),t(i,n)},s.onerror=function(e){o.default.system.error("SharedWorkerTransport Transport Error"+JSON.stringify(e))},s.port.start(),"RouterService"===r&&s.port.postMessage({data:"connect",source:"RouterService"}),i(this)},IPCTransport:function(e,t,r,n,i){const{uuid:a}=s.System.Application.getCurrent(),l=this;this.send=function(e,t){let r;1===arguments.length?(r=n,t=arguments[0]):(r=e.name,t=arguments[1]),o.default.system.verbose("IPCTransport Outgoing Transport",a,r,"Message",t),s.System.InterApplicationBus.publish(r,t,()=>{},()=>{})},this.identifier=function(){return"IPCBus"},o.default.system.log("IPCBus Transport Initializing for "+r),console.log("IPCBus Transport Initializing for "+r),s.System.InterApplicationBus.subscribe("*",r,(function(e,r){const n={transportID:l.identifier(),senderUuid:r,name:e.header.origin};o.default.system.verbose("IPCTransport Incoming Transport",n,"Message",e),t(n,e)}),null,(function(e){o.default.system.error("IPCBus Subscribe Failure: "+e)})),i(this)},FinsembleTransport:function(e,t,r,n,s){const a=i.ConfigUtilInstance.getDefault(e,"params.IAC.serverAddress","ws://127.0.0.1:3376"),l=i.ConfigUtilInstance.getDefault(e,"params.transportSettings.FinsembleTransport.serverAddress",a)+"/router",u=this;let c;function d(e){const r={transportID:u.identifier(),client:e.clientMessage.header.origin};o.default.system.verbose("FinsembleTransport Incoming Transport",r,"Message",e),t(r,e.clientMessage)}function f(){o.default.system.error("FinsembleTransport Connection Timeout for "+r),s(u)}function h(){o.default.system.log(`FinsembleTransport Transport Initializing for ${r} using ${l}`),console.log(`FinsembleTransport Transport Initializing for ${r} using ${l}`),l.startsWith("ws:")||l.startsWith("wss:")||console.error("wss not found as SOCKET_SERVER_ADDRESS.  Use wss!",l),c=new WebSocket(l);const e=setTimeout(f,3e3);c.addEventListener("open",()=>{clearTimeout(e),o.default.system.log("FinsembleTransport Connected to Server"),console.log("FinsembleTransport Connected to Server"),c.addEventListener("message",e=>{const t=JSON.parse(e.data);("RouterService"===r&&"ROUTER_SERVICE"==t.dest||r===t.message.client)&&d(t.message)}),s(u)})}this.send=function(e,t){let r,n;1===arguments.length?(r="ROUTER_SERVICE",n={clientMessage:t=arguments[0]}):(r="ROUTER_CLIENT",t=arguments[1],n={client:e.client,clientMessage:t}),o.default.system.verbose("FinsembleTransport Outgoing Transport",r,"NewMessage",n),c.readyState===WebSocket.OPEN&&c.send(JSON.stringify({dest:r,message:n})),c.readyState===WebSocket.CONNECTING&&c.addEventListener("open",()=>{c.send(JSON.stringify({dest:r,message:n}))}),c.readyState===WebSocket.CLOSED&&(h(),c.addEventListener("open",()=>{c.send(JSON.stringify({dest:r,message:n}))})),c.readyState===WebSocket.CLOSING&&(c.onclose=()=>{h(),c.addEventListener("open",()=>{c.send(JSON.stringify({dest:r,message:n}))})})},this.identifier=function(){return"FinsembleTransport"},h(),o.default.system.log(`FinsembleTransport Transport Initializing for ${r} using ${l}`),console.log(`FinsembleTransport Transport Initializing for ${r} using ${l}`),(l.startsWith("ws:")||l.startsWith("wss:"))&&console.error("wss not found as SOCKET_SERVER_ADDRESS.  Use wss!",l)},FinsembleCloudTransport:function(e,t,r,n,s){let a;const l=i.ConfigUtilInstance.getDefault(e,"params.transportSettings.FinsembleCloudTransport.serverAddress",e.applicationRoot),{FinsembleUUID:u}=e;a="/"===l.substr(l.length-1)?l.substring(0,l.length-1):l;const c=a+"/router",d=this;let f;function h(e){const r={transportID:d.identifier(),client:e.clientMessage.header.origin};o.default.system.verbose("FinsembleCloudTransport Incoming Transport",r,"Message",e),t(r,e.clientMessage)}this.send=function(e,t){let r,n;1===arguments.length?(r="ROUTER_SERVICE",n={FinsembleUUID:u,clientMessage:t=arguments[0]}):(r="ROUTER_CLIENT",t=arguments[1],n={FinsembleUUID:u,client:e.client,clientMessage:t}),o.default.system.verbose("FinsembleCloudTransport Outgoing Transport",r,"NewMessage",n),f.emit(r,n)},this.identifier=function(){return"FinsembleCloudTransport"},o.default.system.log(`FinsembleCloudTransport Transport Initializing for ${r} using ${c}`),console.log(`FinsembleCloudTransport Transport Initializing for ${r} using ${c}`),-1!==c.indexOf("ws:")||console.error("SOCKET_SERVER_ADDRESS not wss!",c),f=new WebSocket(c);const p=setTimeout((function(){o.default.system.error("FinsembleCloudTransport Connection Timeout for "+r),s(d)}),3e3);f.on("connect",()=>{clearTimeout(p),o.default.system.log("FinsembleCloudTransport Connected to Server",u),console.log("FinsembleCloudTransport Connected to Server"),"RouterService"===r?(o.default.system.debug("Setting Up Socket Connection","ROUTER_SERVICE_IN"+u),console.log("Setting Up Socket Connection","ROUTER_SERVICE_IN"+u),f.on("ROUTER_SERVICE_IN"+u,e=>{h(e)})):(o.default.system.debug("Setting Up Socket Connection",r+u),console.log("SETTING UP Socket CONNECTION",r+u),f.on(r+u,e=>{h(e)})),s(d)})}};a.addTransport("SharedWorker",l.SharedWorkerTransport),a.addTransport("IPCBus",l.IPCTransport),a.addTransport("FinsembleTransport",l.FinsembleTransport);var u=a;t.default=u,e.exports=t.default},function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(31),o=n(r(4)),s=(n(r(44)),n(r(65))),a=n(r(52)),l=r(33);let u;class c extends i.EventEmitter{constructor(e,t,r){if(super(),!r||!r.System)throw new Error("Monitors class requires dependency injection. Ensure that System is being passed in.");({System:u}=r),this.cachedMonitorInfo=null,this.limitedMonitorRefreshQueue=new s.default({concurrency:1}),this.bindAllFunctions(),this.limitedMonitorRefreshQueue.add(()=>this.refreshMonitors(e)),u.addEventListener("monitor-info-changed",()=>{this.limitedMonitorRefreshQueue.add(()=>this.refreshMonitors(t))}),u.addEventListener("session-changed",e=>{e&&("object"!=typeof e||!e.hasOwnProperty("reason")||"unlock"!==e.reason&&"remote-connect"!==e.reason&&"unknown"!==e.reason)||this.limitedMonitorRefreshQueue.add(()=>this.refreshMonitors(t))})}bindAllFunctions(){let e=this;for(let t of Object.getOwnPropertyNames(Object.getPrototypeOf(e))){let r=e[t];r instanceof Function&&r!==c&&(e[t]=e[t].bind(e))}}asyncIt(e,t){return t(e),e}rationalizeMonitor(e){e.monitorRect.width=e.monitorRect.right-e.monitorRect.left,e.monitorRect.height=e.monitorRect.bottom-e.monitorRect.top,e.availableRect.width=e.availableRect.right-e.availableRect.left,e.availableRect.height=e.availableRect.bottom-e.availableRect.top}calculateMonitorScale(e,t){return(t.right-t.left)/(e.right-e.left)}monitorInfoIsChanged(e,t){if(!e||!t)return!0;if(e.nonPrimaryMonitors.length!==t.nonPrimaryMonitors.length)return!0;if(!(0,l.checkIfBoundsAreEqual)(e.primaryMonitor.availableRect,t.primaryMonitor.availableRect))return!0;if(!(0,l.checkIfBoundsAreEqual)(e.primaryMonitor.monitorRect,t.primaryMonitor.monitorRect))return!0;e.nonPrimaryMonitors.sort((e,t)=>e.deviceName>t.deviceName?1:e.deviceName<t.deviceName?-1:0),t.nonPrimaryMonitors.sort((e,t)=>e.deviceName>t.deviceName?1:e.deviceName<t.deviceName?-1:0);let r=!1;return e.nonPrimaryMonitors.forEach((e,n)=>{const i=t.nonPrimaryMonitors[n];(0,l.checkIfBoundsAreEqual)(e.availableRect,i.availableRect)&&(0,l.checkIfBoundsAreEqual)(e.monitorRect,i.monitorRect)||(r=!0)}),r}async refreshMonitors(e=Function.prototype){this.limitedMonitorRefreshQueue.clear();const t=await u.getMonitorInfo();if(!this.monitorInfoIsChanged(this.cachedMonitorInfo,t))return o.default.system.info("Skipped refreshMonitors because monitors do not change."),e(this.allMonitors);this.allMonitors=[];let{primaryMonitor:r}=t;if(Object.entries(r).length){r.whichMonitor="primary",r.position=0,this.allMonitors.push(Object.assign({},r));for(let e=0;e<t.nonPrimaryMonitors.length;e++){let r=t.nonPrimaryMonitors[e];r.whichMonitor=e,r.position=e+1,this.allMonitors.push(r)}for(let e=0;e<this.allMonitors.length;e++){let t=this.allMonitors[e];this.rationalizeMonitor(t)}this.cachedMonitorInfo=(0,a.default)(t),e(this.allMonitors),this.ready=!0,1===this.limitedMonitorRefreshQueue.pending&&this.emit("monitors-changed",{monitors:this.allMonitors})}else o.default.system.info("There is no primary monitor in 'monitorInfo' - the system is still in the process of updating the monitor information. Returning from monitorsAndScaling -> refreshMonitors")}getAllMonitors(e=Function.prototype){return this.ready?this.asyncIt(JSON.parse(JSON.stringify(this.allMonitors)),e):e?void this.refreshMonitors(e):"not ready"}getMonitorFromScaledXY(e,t,r=Function.prototype){return new Promise(n=>{if(!this.ready)return this.refreshMonitors(()=>{this.getMonitorFromScaledXY(e,t,r)}),"not ready";let i=null;for(var o=this.allMonitors,s=0;s<o.length;s++){var a=o[s],{monitorRect:l}=a;if(e>=l.left&&e<l.right&&t>=l.top&&t<l.bottom){i=a;break}}n(i),r(i)})}getMonitorFromUnscaledXY(e,t,r=Function.prototype){if(!this.ready)return this.refreshMonitors(()=>{this.getMonitorFromUnscaledXY(e,t,r)}),"not ready";for(var n=this.allMonitors,i=0;i<n.length;i++){var o=n[i],s=o.monitor.scaledRect;if(e>=s.left&&e<s.right&&t>=s.top&&t<s.bottom)return this.asyncIt(o,r)}return this.asyncIt(null,r)}async translatePointFromScaled(e,t=Function.prototype){if(!this.ready)return this.refreshMonitors(()=>{this.translatePointFromScaled(e,t)}),"not ready";var r;e.point?({point:r}=e):r=e;var{monitor:n}=e;if(!n){n=(await this.getMonitorFromScaledXY(r.x,r.y)).data}let i=null;if(n){var o=r.x-n.monitorRect.left,s=r.y-n.monitorRect.top,a=o*n.deviceScaleFactor,l=s*n.deviceScaleFactor;i={x:a+n.monitor.scaledRect.left,y:l+n.monitor.scaledRect.top}}return t(i),Promise.resolve(i)}translatePointToScaled(e,t=Function.prototype){if(!this.ready)return this.refreshMonitors(()=>{this.translatePointToScaled(e,t)}),"not ready";var r;e.point?({point:r}=e):r=e;var n=e.monitor||this.getMonitorFromUnscaledXY(r.x,r.y);if(!n)return this.asyncIt(null,t);var i=r.x-n.monitor.scaledRect.left,o=r.y-n.monitor.scaledRect.top,s=i/n.deviceScaleFactor,a=o/n.deviceScaleFactor,l={x:s+n.monitorRect.left,y:a+n.monitorRect.top};return this.asyncIt(l,t)}async translateRectToScaled(e,t=Function.prototype){let r;if(!this.ready)return this.refreshMonitors(()=>{this.translateRectToScaled(e,t)}),"not ready";var n=this.translatePointToScaled({x:e.left,y:e.top}),i=this.translatePointToScaled({x:e.right,y:e.bottom});return!n&&i&&(r=await this.getMonitorFromScaledXY(i),n=this.translatePointToScaled({monitor:r,point:{x:e.left,y:e.top}})),!i&&n&&(r=await this.getMonitorFromScaledXY(i),i=this.translatePointToScaled({monitor:r,point:{x:e.right,y:e.bottom}})),this.asyncIt({top:n?n.y:null,left:n?n.x:null,bottom:i?i.y:null,right:i?i.x:null,height:n&&i?i.y-n.y:null,width:n&&i?i.x-n.x:null},t)}translateRectFromScaled(e,t=Function.prototype){if(!this.ready)return this.refreshMonitors(()=>{this.translateRectFromScaled(e,t)}),"not ready";var r=this.translatePointFromScaled({x:e.left,y:e.top}),n=this.translatePointFromScaled({x:e.right,y:e.bottom});return!r&&n&&(r=this.translatePointFromScaled({monitor:this.getMonitorFromUnscaledXY(n),point:{x:e.left,y:e.top}})),!n&&r&&(n=this.translatePointFromScaled({monitor:this.getMonitorFromUnscaledXY(r),point:{x:e.right,y:e.bottom}})),this.asyncIt({top:r?r.y:null,left:r?r.x:null,bottom:n?n.y:null,right:n?n.x:null,height:r&&n?n.y-r.y:null,width:r&&n?n.x-r.x:null},t)}}var d=c;t.default=d,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(66),i=r(67),o=r(69),s=()=>{},a=new i.TimeoutError;t.default=class extends n{constructor(e){if(super(),Object.defineProperty(this,"_carryoverConcurrencyCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isIntervalIgnored",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_intervalCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_intervalCap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_interval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_intervalEnd",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_intervalId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_timeoutId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_queueClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pendingCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_concurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isPaused",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_resolveEmpty",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_resolveIdle",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_throwOnTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:o.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother()}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s)}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother)return this.emit("active"),this._queue.dequeue()(),e&&this._initializeIntervalIfNeeded(),!0}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,n)=>{this._queue.enqueue(async()=>{this._pendingCount++,this._intervalCount++;try{const o=void 0===this._timeout&&void 0===t.timeout?e():i.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&n(a)});r(await o)}catch(e){n(e)}this._next()},t),this._tryToStartAnother()})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}set timeout(e){this._timeout=e}get timeout(){return this._timeout}}},function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,i="~";function o(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,r,n,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new s(r,n||e,o),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,s=new Array(o);n<o;n++)s[n]=r[n].fn;return s},u.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,n,o,s){var a=i?i+e:e;if(!this._events[a])return!1;var l,u,c=this._events[a],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,n),!0;case 5:return c.fn.call(c.context,t,r,n,o),!0;case 6:return c.fn.call(c.context,t,r,n,o,s),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var f,h=c.length;for(u=0;u<h;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,n);break;default:if(!l)for(f=1,l=new Array(d-1);f<d;f++)l[f-1]=arguments[f];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,n){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return l(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||n&&!s.once||r&&s.context!==r||l(this,o);else{for(var a=0,u=[],c=s.length;a<c;a++)(s[a].fn!==t||n&&!s[a].once||r&&s[a].context!==r)&&u.push(s[a]);u.length?this._events[o]=1===u.length?u[0]:u:l(this,o)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&l(this,t)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,e.exports=u},function(e,t,r){"use strict";const n=r(68);class i extends Error{constructor(e){super(e),this.name="TimeoutError"}}const o=(e,t,r)=>new Promise((o,s)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void o(e);const a=setTimeout(()=>{if("function"==typeof r){try{o(r())}catch(e){s(e)}return}const n=r instanceof Error?r:new i("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),s(n)},t);n(e.then(o,s),()=>{clearTimeout(a)})});e.exports=o,e.exports.default=o,e.exports.TimeoutError=i},function(e,t,r){"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(70);t.default=class{constructor(){Object.defineProperty(this,"_queue",{enumerable:!0,configurable:!0,writable:!0,value:[]})}enqueue(e,t){const r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);const i=n.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(i,0,r)}dequeue(){const e=this._queue.shift();return e&&e.run}get size(){return this._queue.length}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let n=0,i=e.length;for(;i>0;){const o=i/2|0;let s=n+o;r(e[s],t)<=0?(n=++s,i-=o+1):i=o}return n}},function(e,t,r){var n=r(42),i=r(43);e.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},function(e,t,r){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t,n="object"==typeof self&&self&&self.Object===Object&&self,i=r||n||Function("return this")();function o(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function s(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var a=Object.prototype,l=a.hasOwnProperty,u=a.toString,c=i.Symbol,d=a.propertyIsEnumerable,f=c?c.isConcatSpreadable:void 0,h=Math.max;function p(e){return g(e)||function(e){return function(e){return y(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?u.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)}(e)}(e)&&l.call(e,"callee")&&(!d.call(e,"callee")||"[object Arguments]"==u.call(e))}(e)||!!(f&&e&&e[f])}function m(e){if("string"==typeof e||function(e){return"symbol"==typeof e||y(e)&&"[object Symbol]"==u.call(e)}(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}var g=Array.isArray;function y(e){return!!e&&"object"==typeof e}var v,b,w=(v=function(e,t){return null==e?{}:function(e,t){return function(e,t,r){for(var n=-1,i=t.length,o={};++n<i;){var s=t[n],a=e[s];r(a,s)&&(o[s]=a)}return o}(e=Object(e),t,(function(t,r){return r in e}))}(e,function(e,t){for(var r=-1,n=e?e.length:0,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}(function e(t,r,n,i,o){var a=-1,l=t.length;for(n||(n=p),o||(o=[]);++a<l;){var u=t[a];r>0&&n(u)?r>1?e(u,r-1,n,i,o):s(o,u):i||(o[o.length]=u)}return o}(t,1),m))},b=h(void 0===b?v.length-1:b,0),function(){for(var e=arguments,t=-1,r=h(e.length-b,0),n=Array(r);++t<r;)n[t]=e[b+t];t=-1;for(var i=Array(b+1);++t<b;)i[t]=e[t];return i[b]=n,o(v,this,i)});e.exports=w}).call(this,r(8))},function(e,t,r){(function(e,r){var n="[object Arguments]",i="[object Map]",o="[object Object]",s="[object Set]",a=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,u={};u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u[n]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object Boolean]"]=u["[object DataView]"]=u["[object Date]"]=u["[object Error]"]=u["[object Function]"]=u[i]=u["[object Number]"]=u[o]=u["[object RegExp]"]=u[s]=u["[object String]"]=u["[object WeakMap]"]=!1;var c="object"==typeof e&&e&&e.Object===Object&&e,d="object"==typeof self&&self&&self.Object===Object&&self,f=c||d||Function("return this")(),h=t&&!t.nodeType&&t,p=h&&"object"==typeof r&&r&&!r.nodeType&&r,m=p&&p.exports===h&&c.process,g=function(){try{return m&&m.binding("util")}catch(e){}}(),y=g&&g.isTypedArray;function v(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function b(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function w(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function S(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var C,_,E,P=Array.prototype,T=Function.prototype,k=Object.prototype,A=f["__core-js_shared__"],O=(C=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+C:"",L=T.toString,I=k.hasOwnProperty,D=k.toString,R=RegExp("^"+L.call(I).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),F=f.Symbol,j=f.Uint8Array,W=k.propertyIsEnumerable,M=P.splice,N=(_=Object.keys,E=Object,function(e){return _(E(e))}),x=ce(f,"DataView"),$=ce(f,"Map"),B=ce(f,"Promise"),U=ce(f,"Set"),V=ce(f,"WeakMap"),H=ce(Object,"create"),q=he(x),z=he($),G=he(B),Q=he(U),K=he(V),Y=F?F.prototype:void 0,J=Y?Y.valueOf:void 0;function X(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Z(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ee(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function te(e){var t=-1,r=e?e.length:0;for(this.__data__=new ee;++t<r;)this.add(e[t])}function re(e){this.__data__=new Z(e)}function ne(e,t){var r=me(e)||function(e){return function(e){return we(e)&&ge(e)}(e)&&I.call(e,"callee")&&(!W.call(e,"callee")||D.call(e)==n)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=r.length,o=!!i;for(var s in e)!t&&!I.call(e,s)||o&&("length"==s||fe(s,i))||r.push(s);return r}function ie(e,t){for(var r=e.length;r--;)if(pe(e[r][0],t))return r;return-1}function oe(e,t,r,a,l){return e===t||(null==e||null==t||!be(e)&&!we(t)?e!=e&&t!=t:function(e,t,r,a,l,u){var c=me(e),d=me(t),f="[object Array]",h="[object Array]";c||(f=(f=de(e))==n?o:f);d||(h=(h=de(t))==n?o:h);var p=f==o&&!b(e),m=h==o&&!b(t),g=f==h;if(g&&!p)return u||(u=new re),c||Se(e)?le(e,t,r,a,l,u):function(e,t,r,n,o,a,l){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!n(new j(e),new j(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return pe(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case i:var u=w;case s:var c=2&a;if(u||(u=S),e.size!=t.size&&!c)return!1;var d=l.get(e);if(d)return d==t;a|=1,l.set(e,t);var f=le(u(e),u(t),n,o,a,l);return l.delete(e),f;case"[object Symbol]":if(J)return J.call(e)==J.call(t)}return!1}(e,t,f,r,a,l,u);if(!(2&l)){var y=p&&I.call(e,"__wrapped__"),v=m&&I.call(t,"__wrapped__");if(y||v){var C=y?e.value():e,_=v?t.value():t;return u||(u=new re),r(C,_,a,l,u)}}if(!g)return!1;return u||(u=new re),function(e,t,r,n,i,o){var s=2&i,a=Ce(e),l=a.length,u=Ce(t).length;if(l!=u&&!s)return!1;var c=l;for(;c--;){var d=a[c];if(!(s?d in t:I.call(t,d)))return!1}var f=o.get(e);if(f&&o.get(t))return f==t;var h=!0;o.set(e,t),o.set(t,e);var p=s;for(;++c<l;){d=a[c];var m=e[d],g=t[d];if(n)var y=s?n(g,m,d,t,e,o):n(m,g,d,e,t,o);if(!(void 0===y?m===g||r(m,g,n,i,o):y)){h=!1;break}p||(p="constructor"==d)}if(h&&!p){var v=e.constructor,b=t.constructor;v==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof b&&b instanceof b||(h=!1)}return o.delete(e),o.delete(t),h}(e,t,r,a,l,u)}(e,t,oe,r,a,l))}function se(e){return!(!be(e)||function(e){return!!O&&O in e}(e))&&(ye(e)||b(e)?R:a).test(he(e))}function ae(e){if(r=(t=e)&&t.constructor,n="function"==typeof r&&r.prototype||k,t!==n)return N(e);var t,r,n,i=[];for(var o in Object(e))I.call(e,o)&&"constructor"!=o&&i.push(o);return i}function le(e,t,r,n,i,o){var s=2&i,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var u=o.get(e);if(u&&o.get(t))return u==t;var c=-1,d=!0,f=1&i?new te:void 0;for(o.set(e,t),o.set(t,e);++c<a;){var h=e[c],p=t[c];if(n)var m=s?n(p,h,c,t,e,o):n(h,p,c,e,t,o);if(void 0!==m){if(m)continue;d=!1;break}if(f){if(!v(t,(function(e,t){if(!f.has(t)&&(h===e||r(h,e,n,i,o)))return f.add(t)}))){d=!1;break}}else if(h!==p&&!r(h,p,n,i,o)){d=!1;break}}return o.delete(e),o.delete(t),d}function ue(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function ce(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return se(r)?r:void 0}X.prototype.clear=function(){this.__data__=H?H(null):{}},X.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},X.prototype.get=function(e){var t=this.__data__;if(H){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return I.call(t,e)?t[e]:void 0},X.prototype.has=function(e){var t=this.__data__;return H?void 0!==t[e]:I.call(t,e)},X.prototype.set=function(e,t){return this.__data__[e]=H&&void 0===t?"__lodash_hash_undefined__":t,this},Z.prototype.clear=function(){this.__data__=[]},Z.prototype.delete=function(e){var t=this.__data__,r=ie(t,e);return!(r<0)&&(r==t.length-1?t.pop():M.call(t,r,1),!0)},Z.prototype.get=function(e){var t=this.__data__,r=ie(t,e);return r<0?void 0:t[r][1]},Z.prototype.has=function(e){return ie(this.__data__,e)>-1},Z.prototype.set=function(e,t){var r=this.__data__,n=ie(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},ee.prototype.clear=function(){this.__data__={hash:new X,map:new($||Z),string:new X}},ee.prototype.delete=function(e){return ue(this,e).delete(e)},ee.prototype.get=function(e){return ue(this,e).get(e)},ee.prototype.has=function(e){return ue(this,e).has(e)},ee.prototype.set=function(e,t){return ue(this,e).set(e,t),this},te.prototype.add=te.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},te.prototype.has=function(e){return this.__data__.has(e)},re.prototype.clear=function(){this.__data__=new Z},re.prototype.delete=function(e){return this.__data__.delete(e)},re.prototype.get=function(e){return this.__data__.get(e)},re.prototype.has=function(e){return this.__data__.has(e)},re.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Z){var n=r.__data__;if(!$||n.length<199)return n.push([e,t]),this;r=this.__data__=new ee(n)}return r.set(e,t),this};var de=function(e){return D.call(e)};function fe(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||l.test(e))&&e>-1&&e%1==0&&e<t}function he(e){if(null!=e){try{return L.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function pe(e,t){return e===t||e!=e&&t!=t}(x&&"[object DataView]"!=de(new x(new ArrayBuffer(1)))||$&&de(new $)!=i||B&&"[object Promise]"!=de(B.resolve())||U&&de(new U)!=s||V&&"[object WeakMap]"!=de(new V))&&(de=function(e){var t=D.call(e),r=t==o?e.constructor:void 0,n=r?he(r):void 0;if(n)switch(n){case q:return"[object DataView]";case z:return i;case G:return"[object Promise]";case Q:return s;case K:return"[object WeakMap]"}return t});var me=Array.isArray;function ge(e){return null!=e&&ve(e.length)&&!ye(e)}function ye(e){var t=be(e)?D.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}function ve(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function be(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function we(e){return!!e&&"object"==typeof e}var Se=y?function(e){return function(t){return e(t)}}(y):function(e){return we(e)&&ve(e.length)&&!!u[D.call(e)]};function Ce(e){return ge(e)?ne(e):ae(e)}r.exports=function(e,t,r){var n=(r="function"==typeof r?r:void 0)?r(e,t):void 0;return void 0===n?oe(e,t,r):!!n}}).call(this,r(8),r(32)(e))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=new function(){let e=3;this.diagLevel=function(){return e},this.setDiagLevel=function(t){e=t},this.validationEnabled=function(){return e>=4}};t.default=n,e.exports=t.default},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,i,o,s,a,l=1,u={},c=!1,d=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick((function(){p(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){p(e.data)},n=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,n=function(e){var t=d.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):n=function(e){setTimeout(p,0,e)}:(s="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&p(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),n=function(t){e.postMessage(s+t,"*")}),f.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return u[l]=i,n(l),l++},f.clearImmediate=h}function h(e){delete u[e]}function p(e){if(c)setTimeout(p,0,e);else{var t=u[e];if(t){c=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(void 0,r)}}(t)}finally{h(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(8),r(27))},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(r(10)),l=o(r(25));t.default=class{constructor(e,t){this.allowDelay=!1,this.delayed=!1,this.allowCancel=!1,this.canceled=!1,this.completed=!1,this.event=e.event,this.source=e.source,this.sourceType=e.sourceType,this.listenerGuid=e.listenerGuid,l[this.sourceType.toUpperCase()]&&l[this.sourceType.toUpperCase()].DELAYABLE_EVENTS.includes(this.event)&&(this.allowDelay=!0),l[this.sourceType.toUpperCase()]&&l[this.sourceType.toUpperCase()].CANCELABLE_EVENTS.includes(this.event)&&(this.allowCancel=!0),this.handler=e.handler,this.queryMessage=t,this.guid=t.data.guid,this.internalHandler()}async internalHandler(){this.data=this.queryMessage.data.data,this.handler&&await this.handler(this),this.delayed||this.canceled||this.completed||this.done()}cancel(){this.allowCancel&&(this.canceled=!0,this.done())}wait(){this.allowDelay?(this.delayed=!0,this.queryMessage.sendQueryResponse(null,{delayed:!0})):this.done()}done(e){this.completed=!0,this.delayed?a.default.transmit(`Finsemble.Listener.Done.${this.guid}.${this.listenerGuid}`,{canceled:this.canceled,data:e}):this.queryMessage.sendQueryResponse(null,{canceled:this.canceled,data:e})}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(31),o=r(22),s=n(r(10)),a=n(r(4)),l=r(85).dictionary,u=window,c=new i.EventEmitter;function d(e,t=l){const r=[];return e.keys.forEach(e=>{if("string"!=typeof e)return a.default.system.error("FSBL.Clients.HotkeyClient - one of the keys passed into a function was not a string: ",e);e=e.toLowerCase();const n=t[e];if(!n)return a.default.system.error("FSBL.Clients.HotkeyClient - At least one of the key codes does not map to a supported key - registering hotkey unsuccessful. Unsupported keys: "+e);r.push(n)}),r}const f=function(e){this.cb=e,this.shift=!1,this.ctrl=!1,this.cmd=!1,this.capsLock=!1,this.initialize()};f.prototype.keyup=function(e){switch(e.key){case"Shift":return this.shift=!1,void this.cb({key:e.key,e:e,keystroke:this});case"Control":case"Alt":return this.ctrl=!1,void this.cb({key:e.key,e:e,keystroke:this});case"Meta":case"Win":return this.cmd=!1,void this.cb({key:e.key,e:e,keystroke:this})}this.key&&this.cb({key:this.key,e:e,keystroke:this})},f.prototype.keydown=function(e){if(!this.noKeyCapture)switch(this.key=e.key,e.key){case"Meta":case"Win":this.cmd=!0;break;case"Shift":this.shift=!0;break;case"Control":case"Alt":this.ctrl=!0;break;case"CapsLock":this.capsLock=!this.capsLock;break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"Up":case"Down":case"Left":case"Right":this.key=null,this.cb({key:e.key,e:e,keystroke:this})}},f.prototype.keypress=function(e){if(this.noKeyCapture)return;const t=e.which;t<32||t>222||(this.key=e.key)},f.prototype.initialize=function(){const e=this;document.addEventListener("keyup",t=>{e.keyup(t)}),document.addEventListener("keydown",t=>{e.downValue=t.key,e.keydown(t)}),document.addEventListener("keypress",t=>{e.keypress(t)}),window.addEventListener("blur",t=>{e.ctrl=!1,e.cb({key:"Control",e:t,keystroke:e})})};const h=[];class p extends o._BaseClient{constructor(e){super(e),this.onClose=e=>{this.removeAllHotkeys(e)},this.keyMap=l,this.listenForHotkeys=this.listenForHotkeys.bind(this),this.routerClient=s.default,this.routerClient.onReady(this.listenForHotkeys),this.localListeners={}}addLocalHotkey(e,t,r=(()=>{})){a.default.system.info("HotkeyClient.addLocalHotkey"),a.default.system.debug("HotkeyClient.addLocalHotkey, keyArr: ",e);const n=d({keys:e}).sort().toString(),i=()=>{document.hasFocus()&&t()};this.localListeners[n]||(this.localListeners[n]={}),this.localListeners[n][t]=i,c.addListener(n,i),this.routerClient.query("hotkeysService.registerGlobalHotkey",{keys:n,windowName:this.windowName},r)}addBrowserHotkey(e,t){this.KeyStroke||(this.KeyStroke=new f(e=>{const{key:t,keystroke:r}=e,n=[t];r.ctrl&&n.push("control"),r.shift&&n.push("shift"),r.alt&&n.push("alt");const i=n.sort().toString();h.forEach(e=>{e.keyString.toUpperCase()===i.toUpperCase()&&e.handler()})}));const r=d({keys:e}).sort().toString();h.push({keyString:r,handler:t})}removeLocalHotkey(e,t,r=(()=>{})){a.default.system.info("HotkeyClient.removeLocalHotkey"),a.default.system.debug("HotkeyClient.removeLocalHotkey, keyArr: ",e);const n=d({keys:e}).sort().toString(),i=this.localListeners[n][t];c.removeListener(n,i),this.routerClient.query("hotkeysService.unregisterGlobalHotkey",{keys:n,windowName:this.windowName},r)}addGlobalHotkey(e,t,r=(()=>{})){a.default.system.info("HotkeyClient.addGlobalHotkey"),a.default.system.debug("HotkeyClient.addGlobalHotkey, keyArr: ",e);const n=d({keys:e}).sort().join("+");c.addListener(n,t),this.routerClient.query("hotkeysService.registerGlobalHotkey",{keys:n,windowName:this.windowName},r)}removeGlobalHotkey(e,t,r=(()=>{})){a.default.system.info("HotkeyClient.removeGlobalHotkey"),a.default.system.debug("HotkeyClient.removeGlobalHotkey, keyArr: ",e);const n=d({keys:e}).sort().join("+");c.removeListener(n,t),this.routerClient.query("hotkeysService.unregisterGlobalHotkey",{keys:n,windowName:this.windowName},r)}listenForHotkeys(){const e=this;this.routerClient.addListener("HotkeyTriggered",(t,r)=>{t?console.error("Hotkey Channel Error: "+JSON.stringify(t)):r.data.windows.includes(e.windowName)&&c.emit(r.data.keys)})}removeAllHotkeys(e){c.removeAllListeners(),this.routerClient.query("hotkeysService.removeAllHotkeysForWindow",{windowName:this.windowName},e)}}const m=new p({onReady(e){e&&e()},name:"hotkeyClient"});u.Keystroke=f,t.default=m},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */
const i=r(22),o=n(r(88));let s;const a=window;let l;const u={};function c(e,t){return l.routerClient.query("storeService.getStore",e,(function(e,r){return e?t(e):t(e,new s(r.data,l.routerClient))}))}function d(e,t){l.routerClient.query("storeService.removeStore",e,(e,r)=>t(e,!e&&r.data))}class f extends i._BaseClient{constructor(e){super(e),this.load=function(e){e()},l=this,this.ls=u}getStore(e,t){return e.global?c(e,t):u[e.store]?t(null,u[e.store]):c(e,t)}createStore(e,t=Function.prototype){return new Promise((r,n)=>{if(e.global)return this.routerClient.query("storeService.createStore",e,(e,i)=>{if(e)return n(e),t(e);const o=new s(i.data,l.routerClient);return r({err:e,data:o}),t(e,o)});if(u[e.store])return r({err:null,data:u[e.store]}),t(null,u[e.store]);const i=new s(e,l.routerClient);return u[i.name]=i,r({err:null,data:i}),t(null,i)})}removeStore(e,t){return e.global?d(e,t):u[e.store]?(delete u[e.store],t(null,!0)):void d(e,t)}}var h=new f({startupDependencies:{},onReady(e){s=o.default,h.load(e)},name:"distributedStoreClient"});a.distributedStoreClient=h,t.default=h},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */
const a=r(26),l=s(r(60)),u=s(r(77)),c=o(r(17)),d=r(6),f=r(22),h=s(r(4)),p=s(r(19)),m=r(56),g=r(18),y=s(r(10)),v=r(25),b=s(r(21)),w=r(33),S=r(46);let C;function _(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp(`(\\s|^)${t}(\\s|$)`))}class E extends f._BaseClient{constructor(e){super(e),this.showAtMousePosition=function(){this.routerClient.transmit("DockingService.showAtMousePosition",this.getWindowIdentifier())},p.default.args(e,"object=")&&e&&p.default.args2("params.onReady",e.onReady,"function="),this.options={},this.windowHash="",this.title=null,this.toolbarBottom=40,this.containers=[],this.componentState={},this.windowState="normal",this.hasHeader=!1,this.enableWindowsAeroSnap=!1,this.bindFunctions(),this.minimizeWithDockedWindows=this.minimize}bindFunctions(){this.onWindowRestored=this.onWindowRestored.bind(this),this.onWindowMaximized=this.onWindowMaximized.bind(this),this.onWindowBlurred=this.onWindowBlurred.bind(this),this.onWindowFocused=this.onWindowFocused.bind(this),this.onMinimizedRestored=this.onMinimizedRestored.bind(this),this.onWindowMinimized=this.onWindowMinimized.bind(this),this.close=this.close.bind(this),this.getInitialOptions=this.getInitialOptions.bind(this),this.cacheInitialBounds=this.cacheInitialBounds.bind(this),this._setHeaderHeight=this._setHeaderHeight.bind(this)}onWindowRestored(){this.updateHeaderState("Maximize",{hide:!1})}onWindowMaximized(){this.updateHeaderState("Maximize",{hide:!0})}onWindowBlurred(){this.setActive(!1)}onWindowFocused(){this.setActive(!0)}onMinimizedRestored(){this.routerClient.transmit("DockingService.windowRestored",C.name),C.removeEventListener("restored",this.onMinimizedRestored)}onWindowMinimized(){this.routerClient.query("DockingService.windowMinimized",{windowName:C.name}),C.addEventListener("restored",this.onMinimizedRestored)}getWindowGroups(){return this.windowGroups}groupUpdateHandler(e,t){e?FSBL.Clients.Logger.error(e):t.data&&t.data.groupData&&(this.windowGroups=Object.values(t.data.groupData).filter(e=>e.windowNames.includes(this.getWindowNameForDocking())))}close(e,t=(()=>{})){e||(e={removeFromWorkspace:!0,closeWindow:!0});const{parentWindow:r}=C;if(e.userInitiated&&r)return r.close(e,t);C.close(e,t)}getWindowHash(){return this.windowHash}getWindowTitle(){return this.title}retrieveMonitorDimensions(e=Function.prototype){c.getMonitor(null,t=>{C.updateOptions({options:{monitorDimensions:t.monitorRect}}),e&&e(t.monitorRect)})}listenForHashChanges(){d.System.hasBrowserView()||(C.updateOptions({url:window.top.location.href},()=>{}),function(e){const{pushState:t}=e;e.pushState=function(r){"function"==typeof e.onpushstate&&e.onpushstate({state:r}),t.apply(e,arguments),C.updateOptions({url:window.top.location.href},()=>{})};const{replaceState:r}=e;e.replaceState=function(t){"function"==typeof e.onreplacestate&&e.onreplacestate({state:t}),r.apply(e,arguments),C.updateOptions({url:window.top.location.toString()})}}(window.history),window.addEventListener("hashchange",()=>{C.updateOptions({url:window.top.location.toString()},()=>{})}))}getInitialOptions(e){this.isInAService?(this.options={},h.default.system.debug("WindowClient:getting options empty",this.options),e()):C.getOptions((t,r)=>{t&&(r={}),C.windowOptions=r,this.options=r,h.default.system.debug("WindowClient:getting options",this.options),e()})}cacheInitialBounds(e){if(d.System.hasBrowserView())return e();this.cacheBounds(()=>{try{if(!C.windowOptions.customData.foreign.components["Window Manager"].persistWindowState)return e();C.updateOptions({options:{url:window.top.location.toString()}})}catch(e){h.default.system.warn('customData.foreign.components["Window Manager" is undefined')}e()})}setInitialWindowBounds(e){h.default.system.warn("`FSBL.Clients.WindowClient.setInitialWindowBounds is deprecated and will be removed in a future version of finsemble. Use 'getInitialOptions' and 'cacheInitialBounds' instead."),a.parallel([this.getInitialOptions,this.cacheInitialBounds],e)}getWindowBounds(){return{top:C.windowOptions.defaultTop,left:C.windowOptions.defaultLeft,width:C.windowOptions.defaultWidth,height:C.windowOptions.defaultHeight}}saveWindowBounds(e,t){if(h.default.system.debug("WINDOW LIFECYCLE:SavingBounds:",e,"setActiveWorkspaceDirty",t),void 0===t&&(t=!1),p.default.args(e,"object")&&p.default.args2("bounds.top",e.top,"number"),e){C.updateOptions({options:{top:Math.round(e.top),defaultTop:Math.round(e.top),left:Math.round(e.left),defaultLeft:Math.round(e.left),width:Math.round(e.width),defaultWidth:Math.round(e.width),height:Math.round(e.height),defaultHeight:Math.round(e.height)}});try{C.windowOptions.customData.foreign.components["Window Manager"].persistWindowState}catch(e){}}}minimize(e){this.cacheBounds(()=>{C.minimize(null,t=>{t&&h.default.system.error("WindowClient:minimize",t),e&&e(t)})})}setAlwaysOnTop(e,t){C.setAlwaysOnTop({alwaysOnTop:e},t)}restore(e=(()=>{})){C.restore(null,t=>{t&&h.default.system.error("WindowClient:restore",t),e(t)})}cacheBounds(e){this.getBounds((t,r)=>{if(t)return e(),console.warn("Get bounds error.",t,"Window may not be registered with the window service");C.updateOptions({options:{cachedLeft:r.left,defaultLeft:r.left,cachedTop:r.top,defaultTop:r.top,cachedWidth:r.width,defaultWidth:r.width,cachedHeight:r.height,defaultHeight:r.height}}),e&&e(r)})}maximize(e){this.cacheBounds(()=>(C.maximize(),e()))}removeFinWindowEventListeners(){C.removeEventListener("maximized",this.onWindowMaximized),C.removeEventListener("restored",this.onWindowRestored),C.removeEventListener("blurred",this.onWindowBlurred),C.removeEventListener("focused",this.onWindowFocused),C.removeEventListener("close-requested",this.close),C.removeEventListener("minimized",this.onWindowMinimized)}injectDOM(e){if(h.default.system.debug("injectDOM",e),document.getElementById("FSBLHeader"))return;window.scrollTo(0,0);const t=document.createElement("div");t.innerHTML=`<div id="FSBLHeader"${e?" style=height:"+e:""}></div>`,document.body.insertBefore(t.firstChild,document.body.firstChild)}getComponentState(e,t){if(e||(e={}),e.fields&&!Array.isArray(e.fields)&&(e.fields=[e.fields]),p.default.args(e,"object",t,"function"),C)return C.getComponentState(e,t);h.default.system.warn("Attempt to use getComponentState before component is ready or in a service"),e.windowName||(e.windowName=window.name);const r=this.getContainerHash(e.windowName);l.default.get({topic:v.WORKSPACE.CACHE_STORAGE_TOPIC,key:r},(r,n)=>{if(r)return h.default.system.error("Error retrieving window client's component state."),void t(r);const i=n;if(n&&e.field)this.componentState=i||{},t(r,i[e.field]);else{if(e.fields){const r={};for(let t=0;t<e.fields.length;t++)i[e.fields[t]]&&(r[e.fields[t]]=i[e.fields[t]]);return t(null,r)}if(n)return t(null,i);h.default.system.info("WindowClient:getComponentState:error, response, params",r,n,e),t("Not found",n)}})}async setComponentState(e,t=(()=>{})){return p.default.args(e,"object",t,"function=")&&p.default.args2("params.field",e.field,"string"),C?C.setComponentState(e,t):this.isInAService?(t("Cannot call setComponentState in a service."),Promise.resolve()):(t("Cannot call setComponentState. The window may not be ready"),Promise.reject("The window is not yet ready to save state."))}async removeComponentState(e,t=(()=>{})){p.default.args(e,"object",t,"function=")&&p.default.args2("params.field",e.field,"string");return(C||await m.FinsembleWindow.getInstance({name:e.windowName||window.name})).removeComponentState(e,t)}getWindowNameForDocking(){const e=C.parentWindow;return e?e.name:C.name}getContainerHash(e){return c.camelCase(this.windowHash,e)}formGroup(){C.formGroup()}registerWithDockingManager(e,t){C.parentWindow&&(h.default.system.debug("registerWithDockingManager ignore registration request if has a parent"),t&&t());const r=C.name,{uuid:n}=C;this.startedRegistrationWithDocking=!0,this.routerClient.query("DockingService.registerWindow",{name:r,uuid:n,options:e||{},windowType:"WebWindow"},()=>{this.startedRegistrationWithDocking=!1,this.deregisterPlease&&(this.deregisterWithDockingManager(),this.deregisterPlease=!1),h.default.system.debug("WINDOW LIFECYCLE: Docking Registration complete."),t&&t()})}deregisterWithDockingManager(e){this.startedRegistrationWithDocking&&(this.deregisterPlease=!0);const t=C.name;this.routerClient.transmit("DockingService.deregisterWindow",{name:t,userInitiated:e})}bumpFixedElements(e){if("complete"!==document.readyState)return setTimeout(()=>{this.bumpFixedElements(e)},100);if(!e)return;let{absolute:t,fixed:r,bumpBy:n}=e;if(!t&&!r)return;const i=document.getElementById("FSBLHeader");if(!i||0===i.children.length||!i.children[0].clientHeight)return setTimeout(()=>{this.bumpFixedElements(e)},100);"auto"===n?n="0px":-1===new String(n).indexOf("px")&&(n+="px");const o=document.body.getElementsByTagName("*"),s=o.length;for(let e=0;e<s;e++){if("FSBLHeader"===o[e].id||o[e].classList.contains("fsbl-header"))continue;const i=window.getComputedStyle(o[e],null),s=["0","0px",0],a=i.getPropertyValue("top");t&&o[e].parentNode===document.body&&"absolute"==i.getPropertyValue("position")&&("all"==t?o[e].style.top=`calc(${a} + ${n})`:"0Positioned"==t&&s.includes(a)&&(o[e].style.top=n)),r&&"fixed"==i.getPropertyValue("position")&&("all"==r?o[e].style.top=`calc(${a} + ${n})`:"0Positioned"==r&&s.includes(a)&&(o[e].style.top=n))}}bringWindowToFront(){C.bringToFront({forceFocus:!0},e=>{e?h.default.system.error("WindowClient.bringWindowToFront: failure:"+e):h.default.system.info("WindowClient.bringWindowToFront: success")})}injectStylesheetOverride(){const e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(C.windowOptions.customData.cssOverride)),document.body.appendChild(e)}checkIfChildApp(){if(C.windowOptions&&C.windowOptions.customData&&C.windowOptions.customData.parentUUID&&C.windowOptions.customData.parentUUID!==d.System.Application.getCurrent().uuid){const e=d.System.Application.wrap(C.windowOptions.customData.parentUUID);e.addEventListener("crashed",this.close.bind(null,!1)),e.addEventListener("initialized",this.close.bind(null,!1)),e.addEventListener("out-of-memory",this.close.bind(null,!1))}}preventUnintendedDropEvents(){function e(e){e.preventDefault()}window.addEventListener("dragover",e,!1),window.addEventListener("drop",e,!1)}rejectWindowsKeyResizes(){let e=!1;const t=async t=>{this.enableWindowsAeroSnap?"Meta"===t.key&&y.default.transmit("Finsemble.WindowService.WindowsKey","up"):"Meta"===t.key&&e&&(e=!1,d.System.Window.getCurrent().updateOptions({resizable:!0}))},r=t=>{this.enableWindowsAeroSnap?"Meta"===t.key&&y.default.transmit("Finsemble.WindowService.WindowsKey","down"):"Meta"===t.key&&(e=!0,d.System.Window.getCurrent().updateOptions({resizable:!1}))};FSBL&&u.default.onReady(()=>{window.addEventListener("keyup",t),window.addEventListener("keydown",r)})}addListeners(e=Function.prototype){this.listenForHashChanges(),this.preventUnintendedDropEvents(),this.rejectWindowsKeyResizes(),C.addListener("setParent",()=>{h.default.system.info("WindowClient.setParent deregisterWithDockingManager"),this.deregisterWithDockingManager()}),C.addEventListener("maximized",this.onWindowMaximized),C.addEventListener("minimized",this.onWindowMinimized),C.addEventListener("restored",this.onWindowRestored),C.addEventListener("blurred",this.onWindowBlurred),C.addEventListener("focused",this.onWindowFocused),"undefined"!=typeof FSBL&&FSBL.onShutdown(()=>(h.default.system.info("WINDOW LIFECYCLE:SHUTDOWN: FSBL.onShutdown start"),new Promise(e=>{h.default.system.debug("FSBL.onShutdown"),FSBL.shutdownComplete(),this.close({removeFromWorkspace:!1,ignoreParent:!0,closeWindow:!1},e)}))),e()}updateHeaderState(e,t){this.commandChannel&&this.commandChannel(e,t)}headerCommandChannel(e){this.commandChannel=e}ejectFromGroup(){C.ejectFromGroup()}setWindowTitle(e){p.default.args(e,"string"),this.title=e,this.updateHeaderState("Main",{windowTitle:e}),C.setTitle(e)}getSpawnData(){if(!this.options.customData)return{};const{spawnData:e}=this.options.customData;return void 0===e?{}:e}getCurrentWindow(){return d.System.Window.getCurrent()}async getDesktopBoundingBox(e){let t=e;"string"==typeof e&&(t=document.querySelector(e));const r=t.getBoundingClientRect(),n=await C.getBounds(),i=n.data;let o,s;n.err?(o=this.options.defaultTop,s=this.options.defaultLeft):(o=i.top,s=i.left);const a={top:o+r.top,left:s+r.left,width:r.width,height:r.height,right:0,bottom:0};return a.right=a.left+a.width,a.bottom=a.top+a.height,a}isPointInBox(e,t){return t.bottom||(t.bottom=t.top+t.height),t.right||(t.right=t.left+t.width),e.x>t.left&&e.x<t.right&&e.y<t.bottom&&e.y>t.top}isMouseOverDOMElement(e,t){this.getDesktopBoundingBox(e).then(e=>{d.System.getMousePosition((r,n)=>{t(this.isPointInBox(n,e))})})}getWindowIdentifier(){var e=null;return this.options&&this.options.customData&&this.options.customData.component&&(e=this.options.customData.component.type),{windowName:C?C.name:window.name,uuid:C?C.uuid:null,componentType:e}}setActive(e){var t,r;e?(t=document.documentElement,r="desktop-active",t.classList?t.classList.add(r):_(t,r)||(t.className=`${t.className} ${r}`)):function(e,t){if(e.classList)e.classList.remove(t);else if(_(e,t)){const r=new RegExp(`(\\s|^)${t}(\\s|$)`);e.className=e.className.replace(r," ")}}(document.documentElement,"desktop-active")}getBounds(e){C.getBounds((t,r)=>{e(t,r)})}setShape(e,t=Function.prototype){C.setShape(e,t)}startTilingOrTabbing(e,t=Function.prototype){FSBL.Clients.RouterClient.transmit("DockingService.startTilingOrTabbing",e),t()}startMovingWindow(e){d.System.Window.getCurrent().startMovingWindow(e)}stopMovingWindow(){d.System.Window.getCurrent().stopMovingWindow()}cancelTilingOrTabbing(e,t=Function.prototype){console.debug("CancelTilingOrTabbing"),y.default.transmit("DockingService.cancelTilingOrTabbing",e),t()}sendIdentifierForTilingOrTabbing(e,t=Function.prototype){FSBL.Clients.RouterClient.transmit("DockingService.identifierForTilingOrTabbing",e),t()}stopTilingOrTabbing(e,t=Function.prototype){const r=()=>{y.default.query("DockingService.stopTilingOrTabbing",e,()=>{t()}),y.default.transmit("DockingService.stopTilingOrTabbing",e)};return e.mousePosition?(r(),e.allowDropOnSelf?void 0:t()):d.System.getMousePosition((n,i)=>{if(e.mousePosition=i,r(),!e.allowDropOnSelf)return t()})}getStackedWindow(e,t){if(h.default.system.debug("WindowClient.getStackedWindow",e),t=t||e,(e=e||{}).windowIdentifiers=e.windowIdentifiers||[],!C.parentWindow&&e.create){const r=e=>{const{parentName:n}=e.data;C.setParent({windowName:n},(e,r)=>{t(e,r)}),C.removeListener("parent-set",r)};C.addListener("parent-set",r),FSBL.Clients.LauncherClient.spawn("StackedWindow",{windowType:"StackedWindow",data:{windowIdentifiers:e.windowIdentifiers},options:{newStack:!0}},(e,r)=>{h.default.system.debug("WindowClient.getStackedWindow-success",e,r),e&&t(e,null)})}else C.getParent(t)}getMonitorInfo(e,t){c.getMyWindowIdentifier(r=>{e.windowIdentifier||(e.windowIdentifier=r),this.routerClient.query("Launcher.getMonitorInfo",e,(e,r)=>{t&&t(e,r.data)})})}fitToDOM(e,t){let r=document.documentElement.offsetHeight,n=this.options.width;"function"==typeof e&&(t=e,e=null),e&&e.padding&&(e.padding.height&&(r+=e.padding.height),e.padding.width&&(n+=e.padding.width)),e&&e.maxHeight&&r>e.maxHeight&&(r=e.maxHeight),h.default.system.debug("WindowClient.FitToDOM:newHeight",r,e),this.getMonitorInfo({},(e,i)=>{i&&(r>=i.availableRect.height&&(r=i.availableRect.height),n>=i.availableRect.width&&(n=i.availableRect.width)),h.default.system.debug("WindowClient.FitToDOM:fixBounds",r,n),C.getBounds((e,i)=>{i.width!=n||i.height!=r?(i.width=n,i.height=r,C.setBounds({bounds:i},t)):"function"==typeof t&&t()})})}_setHeaderHeight(e){let t=document.getElementsByClassName("fsbl-header")[0];if(!t)return setTimeout(()=>{this._setHeaderHeight(e)},100);let r=window.getComputedStyle(t,null).getPropertyValue("height");document.body.style.marginTop=r,e.bumpElements&&"auto"===e.bumpElements.bumpBy&&(e.bumpElements.bumpBy=r),this.bumpFixedElements(e.bumpElements)}async start(e=Function.prototype){if(p.default.args(e,"function"),w.iAmAServiceWindow())return this.isInAService=!0,e();const t=this;await b.default.getValue("finsemble");let r=null,n=!1,i=!1,o=!1;this.componentState={};(e=>{m.FinsembleWindow.getInstance({name:this.finWindow.name,uuid:this.finWindow.uuid},(t,r)=>{if(h.default.system.debug("FinsembleWindow.getInstance "+this.finWindow.name),"Cannot Wrap Service Manager or Services"==t)return this.isInAService=!0,this.windowHash=c.camelCase("activeWorkspace",window.name),e();!t&&r||h.default.system.error("wrap failure",t),this.finsembleWindow=r,({finsembleWindow:C}=this),this.windowHash=c.camelCase("activeWorkspace",C.name),this.addListeners(),this.routerClient.subscribe("Finsemble.WorkspaceService.groupUpdate",(e,t)=>this.groupUpdateHandler(e,t)),e()})})(()=>{this.retrieveMonitorDimensions(),this.getInitialOptions(()=>{if(!C||!C.windowOptions)return this.isInAService||h.default.system.error("Something went wrong attempting to get the current window."),e();({customData:r}=C.windowOptions),h.default.system.debug("getInitialOptions",r),r&&(n=S(r,"window.compound",!1),r.cssOverride&&(h.default.system.debug("Window has cssOverride. See local window to inspect object"),i=!0),o=!n&&S(r,["foreign","components","Window Manager","FSBLHeader"],!1)),a.parallel([function(e){i&&t.injectStylesheetOverride(),e()},function(e){b.default.getValue("finsemble",(r,n)=>{r&&h.default.system.error("Error reading windowService config from finsemble");const i=n.services.windowService.config.enableWindowsAeroSnap;t.enableWindowsAeroSnap=g.ConfigUtilInstance.getDefault(n,"config.servicesConfig.docking.enableWindowsAeroSnap",i),e()})},function(e){if(d.System.isBrowserView())e();else{if(!r||!r.component||w.iAmAServiceWindow())return e();{let n=g.ConfigUtilInstance.getDefault(r,"customData.foreign.services.windowService.manageWindowMovement",!1);n||(n=g.ConfigUtilInstance.getDefault(r,"customData.foreign.services.dockingService.manageWindowMovement",!1));const i=g.ConfigUtilInstance.getDefault(r,"customData.foreign.components.Window Manager.FSBLHeader",!1),o=g.ConfigUtilInstance.getDefault(r,"customData.window.dockable",!1);n=n||i||o;let s=w.checkDeprecatedConfigs(r,{baseString:"customData.foreign.services",newPath:"windowService",oldPath:"dockingService",newValue:"allowAutoArrange",oldValue:"isArrangable"},null);null===s&&(s=w.checkDeprecatedConfigs(r,{baseString:"customData.foreign.services",newPath:"windowService",oldPath:"dockingService",newValue:"allowAutoArrange",oldValue:"isArrangeable"},n));if(!(n||s))return e();if(r.window.allowAutoArrange=s,r.window.snapping=w.checkDeprecatedConfigs(r,{baseString:"customData.foreign.services",newPath:"windowService",oldPath:"dockingService",newValue:"allowSnapping",oldValue:"ignoreSnappingRequests"},n),r&&r.foreign&&r.foreign.services){const e=void 0!==r.foreign.services.windowService?"windowService":"dockingService";void 0!==r.foreign.services[e].ignoreSnappingRequests&&(r.window.snapping=!r.foreign.services[e].ignoreSnappingRequests)}if(g.ConfigUtilInstance.getDefault(r,"customData.window.ephemeral",!1)&&!r.window.snapping&&(r.window.snapping=!1),r.window.tiling=w.checkDeprecatedConfigs(r,{baseString:"customData.foreign.services",newPath:"windowService",oldPath:"dockingService",newValue:"allowTiling",oldValue:"ignoreTilingAndTabbingRequests"},n),r.window.tabbing=w.checkDeprecatedConfigs(r,{baseString:"customData.foreign.services",newPath:"windowService",oldPath:"dockingService",newValue:"allowTabbing",oldValue:"ignoreTilingAndTabbingRequests"},n),r&&r.foreign&&r.foreign.services){const e=void 0!==r.foreign.services.windowService?"windowService":"dockingService";void 0!==r.foreign.services[e].ignoreTilingAndTabbingRequests&&(r.window.tiling=!r.window.tiling,r.window.tabbing=!r.window.tabbing)}r.window.canGroup=w.checkDeprecatedConfigs(r,{baseString:"customData.foreign.services",newPath:"windowService",oldPath:"dockingService",newValue:"allowGrouping",oldValue:"canGroup"},n),r.window.canMinimize=w.checkDeprecatedConfigs(r,{baseString:"customData.foreign.services",newPath:"windowService",oldPath:"dockingService",newValue:"allowMinimize",oldValue:"canMinimize"},void 0),void 0===r.window.canMinimize&&(r.window.canMinimize=r.component.canMinimize,void 0===r.window.canMinimize&&(r.window.canMinimize=n)),void 0===r.window.canMaximize&&(r.window.canMaximize=r.component.canMaximize,void 0===r.window.canMaximize&&(r.window.canMaximize=n)),r.window.overwriteStartDocked=g.ConfigUtilInstance.getDefault(r,"customData.foreign.services.workspaceService.global",!1),t.registerWithDockingManager(r.window,()=>{t.cacheInitialBounds(e)})}}}],(t,r)=>e(t,r))})})}}var P=new E({startupDependencies:{clients:["storageClient"]},onReady(e){P.start(e)},name:"windowClient"});t.default=P},,,,,,function(e){e.exports=JSON.parse('{"dictionary":{"0":"0","1":"1","2":"2","3":"3","4":"4","5":"5","6":"6","7":"7","8":"8","9":"9","backspace":"Backspace","bs":"Backspace","bksp":"Backspace","tab":"Tab","escape":"Escape","esc":"Escape","clear":"Clear","enter":"Enter","return":"Enter","shift":"Shift","shft":"Shift","lshift":"Shift","lshft":"Shift","left shift":"Shift","leftshift":"Shift","rshift":"Shift","rshft":"Shift","right shift":"Shift","rightshift":"Shift","control":"Control","ctrl":"Control","alt":"Alt","alternate":"Alt","pause":"Pause","caps lock":"Capslock","capslock":"Capslock","spacebar":"Space","space":"Space","space bar":"Space","page up":"PageUp","pgup":"PageUp","pg up":"PageUp","page down":"PageDown","pgdn":"PageDown","pg dn":"PageDown","pgdown":"PageDown","end":"End","home":"Home","left arrow":"Left","left":"Left","up arrow":"Up","up":"Up","right arrow":"Right","right":"Right","down arrow":"Down","down":"Down","select":"Select","slct":"Select","print":"PrintScreen","prnt":"PrintScreen","execute":"Execute","print screen":"PrintScreen","printscreen":"PrintScreen","print scrn":"PrintScreen","printscrn":"PrintScreen","prnt scrn":"PrintScreen","prntscrn":"PrintScreen","prt scrn":"PrintScreen","prtscrn":"PrintScreen","prt scn":"PrintScreen","prtscn":"PrintScreen","prt scr":"PrintScreen","prtscr":"PrintScreen","prt sc":"PrintScreen","prtsc":"PrintScreen","pr sc":"PrintScreen","prsc":"PrintScreen","insert":"Insert","ins":"Insert","delete":"Delete","del":"Delete","a":"A","b":"B","c":"C","d":"D","e":"E","f":"F","g":"G","h":"H","i":"I","j":"J","k":"K","l":"L","m":"M","n":"N","o":"O","p":"P","q":"Q","r":"R","s":"S","t":"T","u":"U","v":"V","w":"W","x":"X","y":"Y","z":"Z","windows":"Super","left windows":"Super","right windows":"Super","numpad 0":"num0","numpad 1":"num1","numpad 2":"num2","numpad 3":"num3","numpad 4":"num4","numpad 5":"num5","numpad 6":"num6","numpad 7":"num7","numpad 8":"num8","numpad 9":"num9","f1":"F1","fn1":"F1","function 1":"F1","f2":"F2","fn2":"F2","function 2":"F2","f3":"F3","fn3":"F3","function 3":"F3","f4":"F4","fn4":"F4","function 4":"F4","f5":"F5","fn5":"F5","function 5":"F5","f6":"F6","fn6":"F6","function 6":"F6","f7":"F7","fn7":"F7","function 7":"F7","f8":"F8","fn8":"F8","function 8":"F8","f9":"F9","fn9":"F9","function 9":"F9","f10":"F10","fn10":"F10","function 10":"F10","f11":"F11","fn11":"F11","function 11":"F11","f12":"F12","fn12":"F12","function 12":"F12","f13":"F13","fn":"F13","function 13":"F13","f14":"F14","fn14":"F14","function 14":"F14","f15":"F15","fn15":"F15","function 15":"F15","f16":"F16","fn16":"F16","function 16":"F16","num lock":"Numlock","numlock":"Numlock","number lock":"Numlock","numeric lock":"Numlock","scroll lock":"Scrolllock","sclk":"Scrolllock","scrlk":"Scrolllock","slk":"Scrolllock","*":"*","+":"+","-":"-","/":"/",";":";","=":"=",",":",","_":"-",".":".","`":"`","[":"[","]":"]","\'":"\'"}}')},function(e,t,r){"use strict";const n=r(87);e.exports=e=>{if(!Number.isInteger(e)&&e!==1/0||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=[];let r=0;const i=async(e,i,...o)=>{r++;const s=n(e,...o);i(s);try{await s}catch{}r--,t.length>0&&t.shift()()},o=(n,...o)=>new Promise(s=>((n,o,...s)=>{t.push(i.bind(null,n,o,...s)),(async()=>{await Promise.resolve(),r<e&&t.length>0&&t.shift()()})()})(n,s,...o));return Object.defineProperties(o,{activeCount:{get:()=>r},pendingCount:{get:()=>t.length},clearQueue:{value:()=>{t.length=0}}}),o}},function(e,t,r){"use strict";const n=(e,...t)=>new Promise(r=>{r(e(...t))});e.exports=n,e.exports.default=n},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(26),l=o(r(89)),u=s(r(4)),c=window;t.default=class{constructor(e,t){this.values={},this.listeners=[],this.registeredDispatchListeners=[],this.mapping={},this.Dispatcher={register:e=>{this.registeredDispatchListeners.push(e)},dispatch:e=>{this.isGlobal?this.routerClient.transmit("storeService.dispatch."+this.name,e):this.handleDispatchedMessages(null,{data:e})}},this.handleChanges=(e,t)=>{if(e&&u.default.system.error("DistributedStoreClient",e),!t.data.store)return;t.data.field||(t.data.field=null);const r=this.name+(t.data.field?"."+t.data.field:""),n=t.data.storeData?t.data.storeData:t.data.value;this.triggerListeners(r,n)},this.routerClient=t,this.isGlobal=e.global,this.name=e.store?e.store:"finsemble",e.values&&(this.values=e.values),this.lst=this.listeners,l.initObject(this.values,null,this.mapping),this.isGlobal&&this.routerClient.addListener("storeService.dispatch."+this.name,this.handleDispatchedMessages.bind(this))}handleDispatchedMessages(e,t){for(let e=0;e<this.registeredDispatchListeners.length;e++)this.registeredDispatchListeners[e](t.data)}setValue(e,t){if(e.field||u.default.system.error("DistributedStore.setValue:no field provided",e),e.hasOwnProperty("value")||u.default.system.error("DistributedStore.setValue:no value provided",e),this.isGlobal){const r={store:this.name,field:e.field,value:e.value};return c.distributedStoreClient.routerClient.query("storeService.setValue",r,e=>{if(t)return t(e)})}const r=l.checkForObjectChange(this.values,e.field,this.mapping);return l.setPath(this.values,e.field,e.value),l.mapField(this.values,e.field,this.mapping),r&&this.sendRemovals(r),this.triggerListeners(this.name,this),this.publishObjectUpdates(e.field,this.mapping),t?t(null):null}publishObjectUpdates(e,t){const r=t;for(;e;)this.triggerListeners(`${this.name}.${e}`,l.byString(this.values,e)),e=r[e]}sendRemovals(e){for(let t=0;t<e.length;t++)this.triggerListeners(`${this.name}.${e[t]}`,l.byString(this.values,e[t]))}setValues(e,t){return e?Array.isArray(e)?void a.each(e,(e,t)=>{this.setValue(e,t)},e=>t?t(e):null):u.default.system.error("DistributedStore.setValues:params must be an array"):u.default.system.error("DistributedStore.setValues:no params given")}getValue(e,t){if("string"==typeof e&&(e={field:e}),!e.field)return t?t("no field provided"):"no field provided";if(this.isGlobal)return this.getGlobalValue(e,t);const r=l.byString(this.values,e.field);return void 0!==r?t?t(null,r):r:t?t("couldn't find a value"):null}getValues(e,t){if(null===e&&(e=t),"function"==typeof e)return t=e,this.isGlobal?this.getGlobalValues(null,t):t?t(null,this.values):this.values;if(!Array.isArray(e))return this.getValue(e,t);if(this.isGlobal)return this.getGlobalValues(e,t);const r={};for(let t=0;t<e.length;t++){const n=e[t],i="string"==typeof n?n:n.field,o=l.byString(this.values,i);r[i]=o}return t?t(null,r):r}getGlobalValue(e,t){c.distributedStoreClient.routerClient.query("storeService.getValue",{store:this.name,field:e.field},(e,r)=>e?t(e):t(e,r.data))}getGlobalValues(e,t){c.distributedStoreClient.routerClient.query("storeService.getValues",{store:this.name,fields:e},(e,r)=>e?t(e):t(e,r.data))}removeValue(e,t){if(!e.field){if(void 0===e)return t("no field provided");e={field:e}}return e.value=null,this.setValue(e,t)}removeValues(e,t){if(!Array.isArray(e))return t("The passed in parameter needs to be an array");a.map(e,this.removeValue,(e,r)=>t(e,r))}destroy(e){const t={store:this.name,global:this.isGlobal};c.distributedStoreClient.removeStore(t,t=>t?e(t):e(null,!0))}changeSub(e){this.subs||(this.subs=[]),this.subs[e]||(this.isGlobal&&c.distributedStoreClient.routerClient.subscribe("storeService"+e,this.handleChanges),this.subs[e]=!0)}addListener(e,t,r){"function"==typeof e&&(t=e,e={});let{field:n}=e;const i=this.name+(n?"."+n:"");return this.listeners[i]?this.listeners[i].push(t):this.listeners[i]=[t],this.changeSub(i),r?r():null}addListeners(e,t,r){if(!Array.isArray(e))return this.addListener(e,t,r);for(let r=0;r<e.length;r++){let i=null;const o=e[r];var n;"string"==typeof o?i=o:o.field&&(({field:i}=o),n=e[r].listener);const s=this.name+(i?"."+i:"");n||t&&"function"==typeof t&&(n=t),this.listeners[s]?this.listeners[s].push(n):this.listeners[s]=[n],this.changeSub(s)}return r?r():null}removeListener(e,t,r){"function"==typeof e&&(r=t,t=e,e={});let{field:n}=e;const i=this.name+(n?"."+n:"");if(this.listeners[i])for(let e=0;e<this.listeners[i].length;e++)if(this.listeners[i][e]===t)return this.listeners[i].splice(e,1),r?r(null,!0):null;return r?r(null,!1):null}removeListeners(e,t,r){if(!Array.isArray(e))return"function"==typeof e?this.removeListener({},e,r):e.field&&this.removeListener(e,t,r),r("missing fields");let n=0;for(let r=0;r<e.length;r++){let o=null;const s=e[r];var i;"string"==typeof s?o=s:s.field&&(({field:o}=s),i=e[r].listener);const a=this.name+(o?"."+o:"");if(!i){if(!t||"function"!=typeof t)continue;i=t}for(let e=0;e<this.listeners[a].length;e++)this.listeners[a][e]===i&&(this.listeners[a].splice(e,1),n++)}return n<e.length?r("All listeners could not be found",!1):r?r(null,!0):null}triggerListeners(e,t){if(this.listeners[e])for(let r=0;r<this.listeners[e].length;r++)"function"==typeof this.listeners[e][r]?(u.default.system.debug("DistributedStore.triggerListeners",e,t),this.listeners[e][r](null,{field:e,value:t})):u.default.system.warn("DistributedStoreClient:triggerListeners: listener is not a function",e,r,this.listeners[e][r])}}},function(e,t,r){"use strict";function i(e,t){const r=(t=t.replace(/^\./,"")).split(/\.(?![^[]*])/g);for(let t=0;t<r.length;++t){const n=r[t].replace(/[["\]]/g,"");if(!e)return null;if("string"==typeof e)return null;if(!(n in e))return null;e=e[n]}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.byString=i,t.initObject=function e(t,r,i){let o;r||(r=null);if("object"!=typeof t)return o=r?`${r}.${n}`:n,void(i[o]=r);for(const n in t)"object"==typeof t[n]&&"undefined"!==t[n]?(o=r?`${r}.${n}`:n,i[o]=r,e(t[n],o,i)):(o=r?`${r}.${n}`:n,i[o]=r)},t.mapField=function e(t,r,n){if(n[r])return;const o=(r=(r=r.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),s=r;if(!n.hasOwnProperty(s)){let e=null;o.length>1&&(o.pop(),e=o.join(".")),n[s]=e}const a=i(t,s);if("undefined"===a)return;if("object"==typeof a)for(const r in a)e(t,`${s}.${r}`,n)},t.checkForObjectChange=function(e,t,r){const n=i(e,t);if(null===n)return!1;if("object"==typeof n)return o(r,t);if("object"!=typeof n&&"object"==typeof t)return o(r,t);return null},t.setPath=void 0;function o(e,t){const r=[];for(const n in e){const i=t+".";n.includes(i)&&(r.push(n),delete e[n])}return r}t.setPath=(e,t,r)=>t.split(".").reduce((e,n)=>e[n]=t.split(".").pop()===n?r:e[n]||{},e)},function(e,t,r){(function(e,r){var n="[object Arguments]",i="[object Function]",o="[object GeneratorFunction]",s="[object Map]",a="[object Set]",l=/\w*$/,u=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,d={};d[n]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object DataView]"]=d["[object Boolean]"]=d["[object Date]"]=d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d[s]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d[a]=d["[object String]"]=d["[object Symbol]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Error]"]=d[i]=d["[object WeakMap]"]=!1;var f="object"==typeof e&&e&&e.Object===Object&&e,h="object"==typeof self&&self&&self.Object===Object&&self,p=f||h||Function("return this")(),m=t&&!t.nodeType&&t,g=m&&"object"==typeof r&&r&&!r.nodeType&&r,y=g&&g.exports===m;function v(e,t){return e.set(t[0],t[1]),e}function b(e,t){return e.add(t),e}function w(e,t,r,n){var i=-1,o=e?e.length:0;for(n&&o&&(r=e[++i]);++i<o;)r=t(r,e[i],i,e);return r}function S(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function C(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function _(e,t){return function(r){return e(t(r))}}function E(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var P,T=Array.prototype,k=Function.prototype,A=Object.prototype,O=p["__core-js_shared__"],L=(P=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+P:"",I=k.toString,D=A.hasOwnProperty,R=A.toString,F=RegExp("^"+I.call(D).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j=y?p.Buffer:void 0,W=p.Symbol,M=p.Uint8Array,N=_(Object.getPrototypeOf,Object),x=Object.create,$=A.propertyIsEnumerable,B=T.splice,U=Object.getOwnPropertySymbols,V=j?j.isBuffer:void 0,H=_(Object.keys,Object),q=ge(p,"DataView"),z=ge(p,"Map"),G=ge(p,"Promise"),Q=ge(p,"Set"),K=ge(p,"WeakMap"),Y=ge(Object,"create"),J=Se(q),X=Se(z),Z=Se(G),ee=Se(Q),te=Se(K),re=W?W.prototype:void 0,ne=re?re.valueOf:void 0;function ie(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function oe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function se(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ae(e){this.__data__=new oe(e)}function le(e,t){var r=_e(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ee(e)}(e)&&D.call(e,"callee")&&(!$.call(e,"callee")||R.call(e)==n)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=r.length,o=!!i;for(var s in e)!t&&!D.call(e,s)||o&&("length"==s||be(s,i))||r.push(s);return r}function ue(e,t,r){var n=e[t];D.call(e,t)&&Ce(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function ce(e,t){for(var r=e.length;r--;)if(Ce(e[r][0],t))return r;return-1}function de(e,t,r,u,c,f,h){var p;if(u&&(p=f?u(e,c,f,h):u(e)),void 0!==p)return p;if(!ke(e))return e;var m=_e(e);if(m){if(p=function(e){var t=e.length,r=e.constructor(t);t&&"string"==typeof e[0]&&D.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(e),!t)return function(e,t){var r=-1,n=e.length;t||(t=Array(n));for(;++r<n;)t[r]=e[r];return t}(e,p)}else{var g=ve(e),y=g==i||g==o;if(Pe(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if("[object Object]"==g||g==n||y&&!f){if(S(e))return f?e:{};if(p=function(e){return"function"!=typeof e.constructor||we(e)?{}:(t=N(e),ke(t)?x(t):{});var t}(y?{}:e),!t)return function(e,t){return pe(e,ye(e),t)}(e,function(e,t){return e&&pe(t,Ae(t),e)}(p,e))}else{if(!d[g])return f?e:{};p=function(e,t,r,n){var i=e.constructor;switch(t){case"[object ArrayBuffer]":return he(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return function(e,t){var r=t?he(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var r=t?he(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,n);case s:return function(e,t,r){return w(t?r(C(e),!0):C(e),v,new e.constructor)}(e,n,r);case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,l.exec(e));return t.lastIndex=e.lastIndex,t}(e);case a:return function(e,t,r){return w(t?r(E(e),!0):E(e),b,new e.constructor)}(e,n,r);case"[object Symbol]":return o=e,ne?Object(ne.call(o)):{}}var o}(e,g,de,t)}}h||(h=new ae);var _=h.get(e);if(_)return _;if(h.set(e,p),!m)var P=r?function(e){return function(e,t,r){var n=t(e);return _e(e)?n:function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}(n,r(e))}(e,Ae,ye)}(e):Ae(e);return function(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r,e););}(P||e,(function(n,i){P&&(n=e[i=n]),ue(p,i,de(n,t,r,u,i,e,h))})),p}function fe(e){return!(!ke(e)||(t=e,L&&L in t))&&(Te(e)||S(e)?F:u).test(Se(e));var t}function he(e){var t=new e.constructor(e.byteLength);return new M(t).set(new M(e)),t}function pe(e,t,r,n){r||(r={});for(var i=-1,o=t.length;++i<o;){var s=t[i],a=n?n(r[s],e[s],s,r,e):void 0;ue(r,s,void 0===a?e[s]:a)}return r}function me(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function ge(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return fe(r)?r:void 0}ie.prototype.clear=function(){this.__data__=Y?Y(null):{}},ie.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ie.prototype.get=function(e){var t=this.__data__;if(Y){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return D.call(t,e)?t[e]:void 0},ie.prototype.has=function(e){var t=this.__data__;return Y?void 0!==t[e]:D.call(t,e)},ie.prototype.set=function(e,t){return this.__data__[e]=Y&&void 0===t?"__lodash_hash_undefined__":t,this},oe.prototype.clear=function(){this.__data__=[]},oe.prototype.delete=function(e){var t=this.__data__,r=ce(t,e);return!(r<0)&&(r==t.length-1?t.pop():B.call(t,r,1),!0)},oe.prototype.get=function(e){var t=this.__data__,r=ce(t,e);return r<0?void 0:t[r][1]},oe.prototype.has=function(e){return ce(this.__data__,e)>-1},oe.prototype.set=function(e,t){var r=this.__data__,n=ce(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},se.prototype.clear=function(){this.__data__={hash:new ie,map:new(z||oe),string:new ie}},se.prototype.delete=function(e){return me(this,e).delete(e)},se.prototype.get=function(e){return me(this,e).get(e)},se.prototype.has=function(e){return me(this,e).has(e)},se.prototype.set=function(e,t){return me(this,e).set(e,t),this},ae.prototype.clear=function(){this.__data__=new oe},ae.prototype.delete=function(e){return this.__data__.delete(e)},ae.prototype.get=function(e){return this.__data__.get(e)},ae.prototype.has=function(e){return this.__data__.has(e)},ae.prototype.set=function(e,t){var r=this.__data__;if(r instanceof oe){var n=r.__data__;if(!z||n.length<199)return n.push([e,t]),this;r=this.__data__=new se(n)}return r.set(e,t),this};var ye=U?_(U,Object):function(){return[]},ve=function(e){return R.call(e)};function be(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||c.test(e))&&e>-1&&e%1==0&&e<t}function we(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||A)}function Se(e){if(null!=e){try{return I.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ce(e,t){return e===t||e!=e&&t!=t}(q&&"[object DataView]"!=ve(new q(new ArrayBuffer(1)))||z&&ve(new z)!=s||G&&"[object Promise]"!=ve(G.resolve())||Q&&ve(new Q)!=a||K&&"[object WeakMap]"!=ve(new K))&&(ve=function(e){var t=R.call(e),r="[object Object]"==t?e.constructor:void 0,n=r?Se(r):void 0;if(n)switch(n){case J:return"[object DataView]";case X:return s;case Z:return"[object Promise]";case ee:return a;case te:return"[object WeakMap]"}return t});var _e=Array.isArray;function Ee(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!Te(e)}var Pe=V||function(){return!1};function Te(e){var t=ke(e)?R.call(e):"";return t==i||t==o}function ke(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ae(e){return Ee(e)?le(e):function(e){if(!we(e))return H(e);var t=[];for(var r in Object(e))D.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}r.exports=function(e){return de(e,!0,!0)}}).call(this,r(8),r(32)(e))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FinsembleView=void 0;t.FinsembleView=class{constructor(e){this.win=e.win,this.id=e.id}async remove(e=Function.prototype){await this.win.removeBrowserView(this,e)}async setBounds(e,t=Function.prototype){await this.win.setViewBounds({view:this,bounds:e},t)}async bringToFront(e=Function.prototype){await this.win.bringViewToFront(this,e)}}},,,function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SystemLog=void 0;const i=r(6),o=n(r(4)),s=r(34);class a{constructor(){this.onErrorMakeSystemManagerVisible=!0,this.catastrophicFailure=!1}initialize(e){this.onErrorMakeSystemManagerVisible=e;const t=i.System.Window.getCurrent();setTimeout(()=>{r(10).default.addListener(s.SHOW_SYSLOG_CHANNEL,()=>{this.showSystemLog()})},2e3),setTimeout(()=>{t.bringToFront()},15e3),t.addEventListener("close-requested",()=>{this.catastrophicFailure?i.System.exit():this.hideSystemLog()})}log(e,t,r=""){o.default.system.debug("SystemLog.log",e,t,r);let n="";console.log("SYSTEM LOG",t,r);const i=document.getElementById("log");e.leadingBlankLine&&(i.innerHTML=i.innerHTML+"<br />"),e.indent?n=" &nbsp &nbsp &nbsp &nbsp":e.doubleIndent&&(n="&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp"),i.innerHTML=`${i.innerHTML}<span>${n}${t}<br /></span>`,""!=r&&(i.innerHTML=`${i.innerHTML}${JSON&&JSON.stringify?JSON.stringify(r):r}<br />`)}warn(e,t,r){o.default.system.debug("SystemLog.warn",e,t,r);let n="";this.onErrorMakeSystemManagerVisible&&this.showSystemLog(),r=r||"",console.error("SYSTEM LOG ERROR",t,r);const i=document.getElementById("log");e.leadingBlankLine&&(i.innerHTML=i.innerHTML+"<br />"),e.indent?n=" &nbsp &nbsp &nbsp &nbsp":e.doubleIndent&&(n="&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp"),i.innerHTML=`${i.innerHTML}<span style='color: #DC951F;'>${n}${t}<br /></span>`,""!=r&&(i.innerHTML=`${i.innerHTML}<span style='color: #DC951F;'>${n}${JSON&&JSON.stringify?JSON.stringify(r):r}<br /></span>`)}error(e,t,r){o.default.system.debug("SystemLog.error",e,t,r),t.includes("Terminating Boot")&&(this.catastrophicFailure=!0);let n="";this.onErrorMakeSystemManagerVisible?this.showSystemLog():this.catastrophicFailure&&i.System.exit(),r=r||"",console.error("SYSTEM LOG ERROR",t,r);const s=document.getElementById("log");e.leadingBlankLine&&(s.innerHTML=s.innerHTML+"<br />"),e.indent?n=" &nbsp &nbsp &nbsp &nbsp":e.doubleIndent&&(n="&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp"),s.innerHTML=`${s.innerHTML}<span style='color: #F26666;'>${n}${t}<br /></span>`,""!=r&&(s.innerHTML=`${s.innerHTML}<span style='color: #F26666;'>${n}${JSON&&JSON.stringify?JSON.stringify(r):r}<br /></span>`)}notification(e,t,r){o.default.system.debug("SystemLog.notification",e,t,r);let n="";r=r||"",console.error("SYSTEM LOG NOTIFICATION",t,r);const i=document.getElementById("notification");e.leadingBlankLine&&(i.innerHTML=i.innerHTML+"<br />"),e.indent?n=" &nbsp &nbsp &nbsp &nbsp":e.doubleIndent&&(n="&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp"),i.innerHTML=`${i.innerHTML}<span style='color: #0A8CF4;'>${n}${t}<br /></span>`,""!=r&&(i.innerHTML=`${i.innerHTML}<span style='color: #0A8CF4;'>${n}${JSON&&JSON.stringify?JSON.stringify(r):r}<br /></span>`)}showSystemLog(){const e=i.System.Window.getCurrent();e.show(),e.bringToFront()}hideSystemLog(){i.System.Window.getCurrent().hide()}}t.SystemLog=a;const l=new a;t.default=l},function(e,t,r){var n,i;void 0===(i="function"==typeof(n=function(){function e(e){return e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function t(t,r){var i;return r&&!0===r.clone&&e(t)?n((i=t,Array.isArray(i)?[]:{}),t,r):t}function r(r,i,o){var s=r.slice();return i.forEach((function(i,a){void 0===s[a]?s[a]=t(i,o):e(i)?s[a]=n(r[a],i,o):-1===r.indexOf(i)&&s.push(t(i,o))})),s}function n(i,o,s){var a=Array.isArray(o),l=(s||{arrayMerge:r}).arrayMerge||r;return a?Array.isArray(i)?l(i,o,s):t(o,s):function(r,i,o){var s={};return e(r)&&Object.keys(r).forEach((function(e){s[e]=t(r[e],o)})),Object.keys(i).forEach((function(a){e(i[a])&&r[a]?s[a]=n(r[a],i[a],o):s[a]=t(i[a],o)})),s}(i,o,s)}return n.all=function(e,t){if(!Array.isArray(e)||e.length<2)throw new Error("first argument should be an array with at least two elements");return e.reduce((function(e,r){return n(e,r,t)}))},n})?n.call(t,r,t,e):n)||(e.exports=i)},function(e,t,r){"use strict";var n=r(198),i=r(97),o=r(61),s=r(109),a=r(200);function l(e,t,r){var n=this._refs[r];if("string"==typeof n){if(!this._refs[n])return l.call(this,e,t,n);n=this._refs[n]}if((n=n||this._schemas[r])instanceof s)return p(n.schema,this._opts.inlineRefs)?n.schema:n.validate||this._compile(n);var i,o,a,c=u.call(this,t,r);return c&&(i=c.schema,t=c.root,a=c.baseId),i instanceof s?o=i.validate||e.call(this,i.schema,t,void 0,a):void 0!==i&&(o=p(i,this._opts.inlineRefs)?i:e.call(this,i,t,void 0,a)),o}function u(e,t){var r=n.parse(t),i=g(r),o=m(this._getId(e.schema));if(0===Object.keys(e.schema).length||i!==o){var a=v(i),l=this._refs[a];if("string"==typeof l)return c.call(this,e,l,r);if(l instanceof s)l.validate||this._compile(l),e=l;else{if(!((l=this._schemas[a])instanceof s))return;if(l.validate||this._compile(l),a==v(t))return{schema:l,root:e,baseId:o};e=l}if(!e.schema)return;o=m(this._getId(e.schema))}return f.call(this,r,o,e.schema,e)}function c(e,t,r){var n=u.call(this,e,t);if(n){var i=n.schema,o=n.baseId;e=n.root;var s=this._getId(i);return s&&(o=b(o,s)),f.call(this,r,o,i,e)}}e.exports=l,l.normalizeId=v,l.fullPath=m,l.url=b,l.ids=function(e){var t=v(this._getId(e)),r={"":t},s={"":m(t,!1)},l={},u=this;return a(e,{allKeys:!0},(function(e,t,a,c,d,f,h){if(""!==t){var p=u._getId(e),m=r[c],g=s[c]+"/"+d;if(void 0!==h&&(g+="/"+("number"==typeof h?h:o.escapeFragment(h))),"string"==typeof p){p=m=v(m?n.resolve(m,p):p);var y=u._refs[p];if("string"==typeof y&&(y=u._refs[y]),y&&y.schema){if(!i(e,y.schema))throw new Error('id "'+p+'" resolves to more than one schema')}else if(p!=v(g))if("#"==p[0]){if(l[p]&&!i(e,l[p]))throw new Error('id "'+p+'" resolves to more than one schema');l[p]=e}else u._refs[p]=g}r[t]=m,s[t]=g}})),l},l.inlineRef=p,l.schema=u;var d=o.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function f(e,t,r,n){if(e.fragment=e.fragment||"","/"==e.fragment.slice(0,1)){for(var i=e.fragment.split("/"),s=1;s<i.length;s++){var a=i[s];if(a){if(void 0===(r=r[a=o.unescapeFragment(a)]))break;var l;if(!d[a]&&((l=this._getId(r))&&(t=b(t,l)),r.$ref)){var c=b(t,r.$ref),f=u.call(this,n,c);f&&(r=f.schema,n=f.root,t=f.baseId)}}}return void 0!==r&&r!==n.schema?{schema:r,root:n,baseId:t}:void 0}}var h=o.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function p(e,t){return!1!==t&&(void 0===t||!0===t?function e(t){var r;if(Array.isArray(t)){for(var n=0;n<t.length;n++)if("object"==typeof(r=t[n])&&!e(r))return!1}else for(var i in t){if("$ref"==i)return!1;if("object"==typeof(r=t[i])&&!e(r))return!1}return!0}(e):t?function e(t){var r,n=0;if(Array.isArray(t)){for(var i=0;i<t.length;i++)if("object"==typeof(r=t[i])&&(n+=e(r)),n==1/0)return 1/0}else for(var o in t){if("$ref"==o)return 1/0;if(h[o])n++;else if("object"==typeof(r=t[o])&&(n+=e(r)+1),n==1/0)return 1/0}return n}(e)<=t:void 0)}function m(e,t){return!1!==t&&(e=v(e)),g(n.parse(e))}function g(e){return n.serialize(e).split("#")[0]+"#"}var y=/#\/?$/;function v(e){return e?e.replace(y,""):""}function b(e,t){return t=v(t),n.resolve(e,t)}},function(e,t,r){"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,i,o;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(i=n;0!=i--;)if(!e(t[i],r[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(o=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=n;0!=i--;){var s=o[i];if(!e(t[s],r[s]))return!1}return!0}return t!=t&&r!=r}},function(e,t,r){"use strict";var n=r(96);function i(e,t,r){this.message=r||i.message(e,t),this.missingRef=n.url(e,t),this.missingSchema=n.normalizeId(n.fullPath(this.missingRef))}function o(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}e.exports={Validation:o((function(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0})),MissingRef:o(i)},i.message=function(e,t){return"can't resolve reference "+t+" from id "+e}},,,,,,,,,function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BootDependencyGraph=t.DGDiagnostics=t.DGGraphStatus=void 0;const i=r(47),o=n(r(4));class s{constructor(e,t,r,n){this.graphState=e,this.bootConfig=t,this.readyToStartList=r,this.graphState=e,this.errorDiag=n}}t.DGGraphStatus=s;class a{constructor(e="",t=[]){this.errorData=[],this.description=e,this.errorData=t}}t.DGDiagnostics=a;class l{constructor(e,t,r,n,i){this.dependencies=[],this.name=e,this.dependencies=t,this.stopOnFailure=n,this.customFailureMessage=i,this.currentState=r?"uninitialized":"disabled"}}class u{constructor(){this.nodes={}}}const c=["uninitialized","waitingOnDependencies","readyToStart"],d=["blockedByDisabled","failed","blockedByFailure"];t.BootDependencyGraph=class{constructor(e,t,r=[]){this.errorDiag=new a,o.default.system.debug("BootDependencyGraph.constructor -- start",e,t);try{this.context=e,this.bootConfig=t,this.allPreviousBootConfig=r,this.graph=this.buildGraph(this.bootConfig),this.checkNodesForValidDependencies(this.bootConfig,this.allPreviousBootConfig),this.checkNodesForCircularDependencies(),this.iterativelySetAllGraphStates(this.graph)}catch(e){"error"!=this.graphState&&(this.graphState="error",this.errorDiag.description=e),o.default.system.error("BootDependencyGraph constructor caught error",this.errorDiag)}}setBootDependencyState(e,t){o.default.system.debug("BootDependencyGraph.setBootDependencyState",e,t);const r=this.graph.nodes[e];r?r.currentState=t:o.default.system.error(`BootDependencyGraph.setBootDependencyState called with unknown dependency name ${e} for this stage (may be a late message).  Operation ignored.`,this.graph)}getCurrentStatus(){this.iterativelySetAllGraphStates(this.graph);return new s(this.graphState,this.bootConfig,this.readyToStartList,this.errorDiag)}buildGraph(e){const t=new u;for(let r=0;r<e.length;r++){const n=e[r],i=new l(n.name,n.dependencies,n.autoStart,n.stopOnFailure,n.customFailureMessage);t.nodes[n.name]=i}return o.default.system.debug("BootDependencyGraph.buildGraph -- graph built",this.graph),t}testOneNodeForCircularPath(e,t){o.default.system.debug("BootDependencyGraph.testOneNodeForCircularPath -- nodeName="+t,e);let r=!1;if(e.includes(t))e.push(t),r=!0;else{e.push(t);const n=this.graph.nodes[t];for(const t in n.dependencies)if(r=this.testOneNodeForCircularPath(e,n.dependencies[t]),r)break}return r||e.pop(),o.default.system.debug(`BootDependencyGraph.testOneNodeForCircularPath done for nodeName=${t} with circular=${r}`),r}checkNodesForCircularDependencies(){for(const e in this.graph.nodes){const t=[];o.default.system.debug("BootDependencyGraph.checkNodesForCircularDependencies -- nodeName="+e);if(this.testOneNodeForCircularPath(t,e))throw this.errorDiag=new a(this.context+" circular dependency",t),this.graphState="error",this.errorDiag.description}}checkForKnownDependency(e,t){return t.findIndex(t=>t.name==e)>=0}checkNodesForValidDependencies(e,t){let r,n,i;const s=[];for(const a in this.graph.nodes){const l=this.graph.nodes[a];let u=l.dependencies.length;for(;u--;){const c=l.dependencies[u];n=this.checkForKnownDependency(c,e),n||(i=this.checkForKnownDependency(c,t)),!n&&i?(o.default.system.debug(`dependencyGraphy.checkNodesForValidDependencies removing dependency ${l.dependencies[u]} in node ${a}`),l.dependencies.splice(u,1)):n||i||(r=!0,s.push(`${a} dependency "${c}" is unknown in this stage or previous stages`))}}if(r)throw this.errorDiag=new a(this.context+" illegal boot configuration",s),this.graphState="error",this.errorDiag.description}setNewNodeState(e){o.default.system.debug("BootDependencyGraph.setNewNodeState for node="+e.name,e);let t=e.currentState;if(c.includes(t)){t="readyToStart";for(const r of e.dependencies)if("completed"===this.graph.nodes[r].currentState);else{if("disabled"===this.graph.nodes[r].currentState||"blockedByDisabled"===this.graph.nodes[r].currentState){t="blockedByDisabled";break}if("failed"===this.graph.nodes[r].currentState||"blockedByFailure"===this.graph.nodes[r].currentState){t="blockedByFailure";break}(c.includes(this.graph.nodes[r].currentState)||"starting"===this.graph.nodes[r].currentState)&&(t="waitingOnDependencies")}}const r=t!==e.currentState;return e.currentState=t,o.default.system.debug("BootDependencyGraph.setNewNodeState done for node="+e.name,r,t),r}getNewReadyList(){const e=[];for(const t in this.graph.nodes){if("readyToStart"===this.graph.nodes[t].currentState){const r=this.bootConfig.findIndex(e=>e.name==t),n=this.bootConfig[r];e.push(new i.BootReadyItem(t,n.type,n))}}return e}getNewGraphState(e){let t,r=0,n=0,i=0;for(const t in e.nodes){const o=e.nodes[t];d.includes(o.currentState)&&o.stopOnFailure?n++:c.includes(o.currentState)?r++:"starting"===o.currentState&&i++}return t=n>0?"error":r>0||i>0?"notFinished":"finished",o.default.system.debug("BootDependencyGraph.getNewGraphState",t,n,r),t}iterativelySetAllGraphStates(e){let t,r=0;for(;"error"!=this.graphState&&(t||0===r);){o.default.system.debug("BootDependencyGraph.iterativelySetAllGraphStates pass "+r,e),t=!1;for(const e in this.graph.nodes){o.default.system.debug("BootDependencyGraph.iterativelySetAllGraphStates for nodeName "+e);const r=this.graph.nodes[e];this.setNewNodeState(r)&&(o.default.system.debug(`BootDependencyGraph.iterativelySetAllGraphStates BootDependencyState updated for nodeName ${e} so continue iterating`),t=!0)}if(++r>200){o.default.system.error("iterativelySetAllGraphStates was stuck in loop -- breaking out");break}}"error"!=this.graphState&&(this.graphState=this.getNewGraphState(this.graph),this.readyToStartList=this.getNewReadyList()),o.default.system.debug("BootDependencyGraph.iterativelySetAllGraphStates done",this.graphState,this.readyToStartList)}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(26),o=n(r(37)),s=n(r(79)),a=n(r(78)),l=n(r(19)),u=r(22),c=r(56),d=n(r(4)),f=r(6),h=r(33);s.default.initialize(),o.default.initialize(),a.default.initialize();class p extends u._BaseClient{constructor(e){super(e),this.getParametersFromInDialog=()=>{const{inputParams:e}=s.default.getSpawnData();return d.default.system.debug("DialogManagerClient:getParametersFromInDialog: "+JSON.stringify(e)),e},this.respondAndExitFromInDialog=e=>{l.default.args(e,"any"),d.default.system.debug("DialogManagerClient:respondAndExitFromInDialog: "+JSON.stringify(e));const{responseChannel:t}=s.default.getSpawnData();this.routerClient.transmit(t,e)},this.getAvailableDialog=(e,t)=>{this.DialogStore.getValue("dialogs.available",(r,n)=>{for(const r in n){const i=n[r];if(i.componentType===e)return t(i)}t(null)})},this.generateDialogReadyChannel=e=>`Dialog.${e.windowName+e.uuid}.ready`,this.showDialog=()=>{const e=this.generateDialogReadyChannel(o.default.myWindowIdentifier);this.routerClient.transmit(e,{userInputTimeout:void 0===this.userInputTimeout?1e4:this.userInputTimeout})},this.sendQueryToDialog=(e,t,r)=>{function n(t){console.warn(`No response from dialog ${e.windowName} after ${t/1e3} seconds. Check to make sure your dialog is sending back data.`)}this.moveDialogFromAvailableToOpened(e);const i=`Dialog.${e.windowName+e.uuid}.Show`,s=this.generateDialogReadyChannel(e);let a;const l=(r,i)=>{a=setTimeout(n.bind(null,i.data.userInputTimeout),i.data.userInputTimeout),d.default.perf.info("DialogManagerClient:sendQueryToDialog:Dialog: ShowWindow Start"),o.default.showWindow(e,{monitor:t.monitor||"mine",left:"center",top:"center"},(e,t)=>{c.FinsembleWindow.getInstance({name:t.finWindow.name},(e,t)=>{t.bringToFront(),t.focus()}),d.default.perf.info("DialogManagerClient:sendQueryToDialog:ShowWindow finish")}),this.routerClient.removeListener(s,l)};this.routerClient.addListener(s,l),d.default.perf.info("DialogManagerClient:sendQueryToDialog ShowWindow Query begin."),this.routerClient.query(i,t,(t,n)=>{clearTimeout(a),this.moveDialogFromOpenedToAvailable(e),r(t,n.data)})},this.moveDialogFromOpenedToAvailable=e=>{this.DialogStore.getValue("dialogs",(t,r)=>{const n=r.opened,i=r.available;delete n[e.windowName],i[e.windowName]=e,this.DialogStore.setValue({field:"dialogs.opened",value:n}),this.DialogStore.setValue({field:"dialogs.available",value:i})})},this.moveDialogFromAvailableToOpened=e=>{this.DialogStore.getValue("dialogs",(t,r)=>{const n=r.available,i=r.opened;delete n[e.windowName],i[e.windowName]=e,this.DialogStore.setValue({field:"dialogs.available",value:n}),this.DialogStore.setValue({field:"dialogs.opened",value:i})})},this.registerModal=()=>{this.isModal&&(f.System.getMonitorInfo(e=>{const t=e.virtualScreen;t.width=t.right-t.left,t.height=t.bottom-t.top,this.finsembleWindow.setBounds({bounds:t})}),this.DialogStore.setValue({field:"modalIdentifier",value:o.default.myWindowIdentifier}))},this.showModal=e=>{this.DialogStore.getValue("modalIdentifier",async(t,r)=>{if(null==r)return;const{wrap:n}=await c.FinsembleWindow.getInstance({uuid:r.uuid,name:r.windowName});n.updateOptions({options:{opacity:.4}},()=>{n.show(()=>{n.bringToFront(()=>{this.finsembleWindow.focus(()=>{this.finsembleWindow.bringToFront(),e&&"function"==typeof e&&e()})})})})})},this.open=(e,t,r)=>{this.getAvailableDialog(e,n=>{n?this.sendQueryToDialog(n,t,r):o.default.spawn(e,{options:{customData:{foreign:{clients:{dialogManager:{isDialog:!0}}}}}},()=>{this.open(e,t,r)})})},this.DialogStore=null,this.isDialog=!1,this.isModal=!1,this.RESPONDER_CHANNEL=null,this.openerMessage=null,this.registerDialogCallback=e=>{this.routerClient.addResponder(this.RESPONDER_CHANNEL,(t,r)=>{this.openerMessage=r,e(t,r)})},this.hideModal=()=>{this.DialogStore.getValue("modalIdentifier",async(e,t)=>{if(null==t)return;const{wrap:r}=await c.FinsembleWindow.getInstance({uuid:t.uuid,name:t.windowName});r.hide()})},this.respondToOpener=e=>{d.default.system.info("DialogManagerClient:RespondToOpener:",e),this.openerMessage.sendQueryResponse(null,e),!1!==e.hideModalOnClose&&this.hideModal(),this.finsembleWindow.hide(),this.openerMessage=null},this.registerWithStore=e=>{if(this.isDialog){const t=o.default.myWindowIdentifier;this.RESPONDER_CHANNEL=`Dialog.${t.windowName+t.uuid}.Show`,this.DialogStore.setValue({field:"dialogs.available."+t.windowName,value:t},e)}else e()},this.checkIfWindowIsDialog=e=>{let t=null;try{this.isDialog=s.default.options.customData.foreign.clients.dialogManager.isDialog}catch(e){t=e}e&&e(t)},this.createStore=e=>{a.default.createStore({store:"DialogStore",values:{dialogs:{opened:{},available:{}}},global:!0},(t,r)=>{this.DialogStore=r,e()})},this.getFinsembleWindow=e=>{if(!this.isDialog)return e();c.FinsembleWindow.getInstance({name:this.finWindow.name,uuid:this.finWindow.uuid},(t,r)=>{this.finsembleWindow=r,e()})},this.spawnDialog=this.spawnDialog.bind(this)}spawnDialog(e,t,r,n){l.default.args(e,"object",t,"object",r,"function");const i=h.getUniqueName("DialogChannel");e.data={inputParams:t,responseChannel:i},e.left||0===e.left||e.right||0===e.right||(e.left="center"),e.top||0===e.top||e.bottom||0===e.bottom||(e.top="center"),this.routerClient.addListener(i,(e,t)=>{r(e,t.data),this.routerClient.removeListener(i,n)}),o.default.spawn("dialogTemplate",e,(e,t)=>{e&&(d.default.system.error("ERROR",e),r(e,t)),n&&n(e,t)})}}var m=new p({startupDependencies:{clients:["distributedStoreClient","windowClient"]},onReady(e){m.checkIfWindowIsDialog(),i.series([m.createStore.bind(m),m.registerWithStore.bind(m),m.getFinsembleWindow.bind(m),e=>{o.default.onReady(e)},e=>{s.default.onReady(e)}],e)},name:"dialogManager"});t.default=m},function(e,t,r){"use strict";var n=r(61);e.exports=function(e){n.copy(e,this)}},function(e,t,r){"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r,n="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(r=t.cmp,function(e){return function(t,n){var i={key:t,value:e[t]},o={key:n,value:e[n]};return r(i,o)}}),o=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var r,s;if(Array.isArray(t)){for(s="[",r=0;r<t.length;r++)r&&(s+=","),s+=e(t[r])||"null";return s+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=o.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(s="",r=0;r<l.length;r++){var u=l[r],c=e(t[u]);c&&(s&&(s+=","),s+=JSON.stringify(u)+":"+c)}return o.splice(a,1),"{"+s+"}"}}(e)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n="",i=!0===e.schema.$async,o=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),s=e.self._getId(e.schema);if(e.opts.strictKeywords){var a=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(a){var l="unknown keyword: "+a;if("log"!==e.opts.strictKeywords)throw new Error(l);e.logger.warn(l)}}if(e.isTop&&(n+=" var validate = ",i&&(e.async=!0,n+="async "),n+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",s&&(e.opts.sourceCode||e.opts.processCode)&&(n+=" /*# sourceURL="+s+" */ ")),"boolean"==typeof e.schema||!o&&!e.schema.$ref){var u=e.level,c=e.dataLevel,d=e.schema["false schema"],f=e.schemaPath+e.util.getProperty("false schema"),h=e.errSchemaPath+"/false schema",p=!e.opts.allErrors,m="data"+(c||""),g="valid"+u;if(!1===e.schema){e.isTop?p=!0:n+=" var "+g+" = false; ",(J=J||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'false schema' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'boolean schema is false' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),n+=" } "):n+=" {} ";var y=n;n=J.pop(),!e.compositeRule&&p?e.async?n+=" throw new ValidationError(["+y+"]); ":n+=" validate.errors = ["+y+"]; return false; ":n+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?n+=i?" return data; ":" validate.errors = null; return true; ":n+=" var "+g+" = true; ";return e.isTop&&(n+=" }; return validate; "),n}if(e.isTop){var v=e.isTop;u=e.level=0,c=e.dataLevel=0,m="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],void 0!==e.schema.default&&e.opts.useDefaults&&e.opts.strictDefaults){var b="default is ignored in the schema root";if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}n+=" var vErrors = null; ",n+=" var errors = 0;     ",n+=" if (rootData === undefined) rootData = data; "}else{u=e.level,m="data"+((c=e.dataLevel)||"");if(s&&(e.baseId=e.resolve.url(e.baseId,s)),i&&!e.async)throw new Error("async schema in sync schema");n+=" var errs_"+u+" = errors;"}g="valid"+u,p=!e.opts.allErrors;var w="",S="",C=e.schema.type,_=Array.isArray(C);if(C&&e.opts.nullable&&!0===e.schema.nullable&&(_?-1==C.indexOf("null")&&(C=C.concat("null")):"null"!=C&&(C=[C,"null"],_=!0)),_&&1==C.length&&(C=C[0],_=!1),e.schema.$ref&&o){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(o=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(n+=" "+e.RULES.all.$comment.code(e,"$comment")),C){if(e.opts.coerceTypes)var E=e.util.coerceToTypes(e.opts.coerceTypes,C);var P=e.RULES.types[C];if(E||_||!0===P||P&&!X(P)){f=e.schemaPath+".type",h=e.errSchemaPath+"/type",f=e.schemaPath+".type",h=e.errSchemaPath+"/type";var T=_?"checkDataTypes":"checkDataType";if(n+=" if ("+e.util[T](C,m,!0)+") { ",E){var k="dataType"+u,A="coerced"+u;n+=" var "+k+" = typeof "+m+"; ","array"==e.opts.coerceTypes&&(n+=" if ("+k+" == 'object' && Array.isArray("+m+")) "+k+" = 'array'; "),n+=" var "+A+" = undefined; ";var O="",L=E;if(L)for(var I,D=-1,R=L.length-1;D<R;)I=L[D+=1],D&&(n+=" if ("+A+" === undefined) { ",O+="}"),"array"==e.opts.coerceTypes&&"array"!=I&&(n+=" if ("+k+" == 'array' && "+m+".length == 1) { "+A+" = "+m+" = "+m+"[0]; "+k+" = typeof "+m+";  } "),"string"==I?n+=" if ("+k+" == 'number' || "+k+" == 'boolean') "+A+" = '' + "+m+"; else if ("+m+" === null) "+A+" = ''; ":"number"==I||"integer"==I?(n+=" if ("+k+" == 'boolean' || "+m+" === null || ("+k+" == 'string' && "+m+" && "+m+" == +"+m+" ","integer"==I&&(n+=" && !("+m+" % 1)"),n+=")) "+A+" = +"+m+"; "):"boolean"==I?n+=" if ("+m+" === 'false' || "+m+" === 0 || "+m+" === null) "+A+" = false; else if ("+m+" === 'true' || "+m+" === 1) "+A+" = true; ":"null"==I?n+=" if ("+m+" === '' || "+m+" === 0 || "+m+" === false) "+A+" = null; ":"array"==e.opts.coerceTypes&&"array"==I&&(n+=" if ("+k+" == 'string' || "+k+" == 'number' || "+k+" == 'boolean' || "+m+" == null) "+A+" = ["+m+"]; ");n+=" "+O+" if ("+A+" === undefined) {   ",(J=J||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: { type: '",n+=_?""+C.join(","):""+C,n+="' } ",!1!==e.opts.messages&&(n+=" , message: 'should be ",n+=_?""+C.join(","):""+C,n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),n+=" } "):n+=" {} ";y=n;n=J.pop(),!e.compositeRule&&p?e.async?n+=" throw new ValidationError(["+y+"]); ":n+=" validate.errors = ["+y+"]; return false; ":n+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else {  ";var F=c?"data"+(c-1||""):"parentData";n+=" "+m+" = "+A+"; ",c||(n+="if ("+F+" !== undefined)"),n+=" "+F+"["+(c?e.dataPathArr[c]:"parentDataProperty")+"] = "+A+"; } "}else{(J=J||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: { type: '",n+=_?""+C.join(","):""+C,n+="' } ",!1!==e.opts.messages&&(n+=" , message: 'should be ",n+=_?""+C.join(","):""+C,n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),n+=" } "):n+=" {} ";y=n;n=J.pop(),!e.compositeRule&&p?e.async?n+=" throw new ValidationError(["+y+"]); ":n+=" validate.errors = ["+y+"]; return false; ":n+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}n+=" } "}}if(e.schema.$ref&&!o)n+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",p&&(n+=" } if (errors === ",n+=v?"0":"errs_"+u,n+=") { ",S+="}");else{var j=e.RULES;if(j)for(var W=-1,M=j.length-1;W<M;)if(X(P=j[W+=1])){if(P.type&&(n+=" if ("+e.util.checkDataType(P.type,m)+") { "),e.opts.useDefaults)if("object"==P.type&&e.schema.properties){d=e.schema.properties;var N=Object.keys(d);if(N)for(var x,$=-1,B=N.length-1;$<B;){if(void 0!==(H=d[x=N[$+=1]]).default){var U=m+e.util.getProperty(x);if(e.compositeRule){if(e.opts.strictDefaults){b="default is ignored for: "+U;if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}}else n+=" if ("+U+" === undefined ","empty"==e.opts.useDefaults&&(n+=" || "+U+" === null || "+U+" === '' "),n+=" ) "+U+" = ","shared"==e.opts.useDefaults?n+=" "+e.useDefault(H.default)+" ":n+=" "+JSON.stringify(H.default)+" ",n+="; "}}}else if("array"==P.type&&Array.isArray(e.schema.items)){var V=e.schema.items;if(V){D=-1;for(var H,q=V.length-1;D<q;)if(void 0!==(H=V[D+=1]).default){U=m+"["+D+"]";if(e.compositeRule){if(e.opts.strictDefaults){b="default is ignored for: "+U;if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}}else n+=" if ("+U+" === undefined ","empty"==e.opts.useDefaults&&(n+=" || "+U+" === null || "+U+" === '' "),n+=" ) "+U+" = ","shared"==e.opts.useDefaults?n+=" "+e.useDefault(H.default)+" ":n+=" "+JSON.stringify(H.default)+" ",n+="; "}}}var z=P.rules;if(z)for(var G,Q=-1,K=z.length-1;Q<K;)if(Z(G=z[Q+=1])){var Y=G.code(e,G.keyword,P.type);Y&&(n+=" "+Y+" ",p&&(w+="}"))}if(p&&(n+=" "+w+" ",w=""),P.type&&(n+=" } ",C&&C===P.type&&!E)){n+=" else { ";var J;f=e.schemaPath+".type",h=e.errSchemaPath+"/type";(J=J||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: { type: '",n+=_?""+C.join(","):""+C,n+="' } ",!1!==e.opts.messages&&(n+=" , message: 'should be ",n+=_?""+C.join(","):""+C,n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),n+=" } "):n+=" {} ";y=n;n=J.pop(),!e.compositeRule&&p?e.async?n+=" throw new ValidationError(["+y+"]); ":n+=" validate.errors = ["+y+"]; return false; ":n+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } "}p&&(n+=" if (errors === ",n+=v?"0":"errs_"+u,n+=") { ",S+="}")}}function X(e){for(var t=e.rules,r=0;r<t.length;r++)if(Z(t[r]))return!0}function Z(t){return void 0!==e.schema[t.keyword]||t.implements&&function(t){for(var r=t.implements,n=0;n<r.length;n++)if(void 0!==e.schema[r[n]])return!0}(t)}return p&&(n+=" "+S+" "),v?(i?(n+=" if (errors === 0) return data;           ",n+=" else throw new ValidationError(vErrors); "):(n+=" validate.errors = vErrors; ",n+=" return errors === 0;       "),n+=" }; return validate;"):n+=" var "+g+" = errors === errs_"+u+";",n=e.util.cleanUpCode(n),v&&(n=e.util.finalCleanUpCode(n,i)),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(s||""),f=e.opts.$data&&a&&a.$data;f?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",n="schema"+o):n=a;var h="maximum"==t,p=h?"exclusiveMaximum":"exclusiveMinimum",m=e.schema[p],g=e.opts.$data&&m&&m.$data,y=h?"<":">",v=h?">":"<",b=void 0;if(g){var w=e.util.getData(m.$data,s,e.dataPathArr),S="exclusive"+o,C="exclType"+o,_="exclIsNumber"+o,E="' + "+(k="op"+o)+" + '";i+=" var schemaExcl"+o+" = "+w+"; ",i+=" var "+S+"; var "+C+" = typeof "+(w="schemaExcl"+o)+"; if ("+C+" != 'boolean' && "+C+" != 'undefined' && "+C+" != 'number') { ";var P;b=p;(P=P||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(b||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: '"+p+" should be boolean' "),e.opts.verbose&&(i+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var T=i;i=P.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else if ( ",f&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+C+" == 'number' ? ( ("+S+" = "+n+" === undefined || "+w+" "+y+"= "+n+") ? "+d+" "+v+"= "+w+" : "+d+" "+v+" "+n+" ) : ( ("+S+" = "+w+" === true) ? "+d+" "+v+"= "+n+" : "+d+" "+v+" "+n+" ) || "+d+" !== "+d+") { var op"+o+" = "+S+" ? '"+y+"' : '"+y+"='; ",void 0===a&&(b=p,u=e.errSchemaPath+"/"+p,n=w,f=g)}else{E=y;if((_="number"==typeof m)&&f){var k="'"+E+"'";i+=" if ( ",f&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" ( "+n+" === undefined || "+m+" "+y+"= "+n+" ? "+d+" "+v+"= "+m+" : "+d+" "+v+" "+n+" ) || "+d+" !== "+d+") { "}else{_&&void 0===a?(S=!0,b=p,u=e.errSchemaPath+"/"+p,n=m,v+="="):(_&&(n=Math[h?"min":"max"](m,a)),m===(!_||n)?(S=!0,b=p,u=e.errSchemaPath+"/"+p,v+="="):(S=!1,E+="="));k="'"+E+"'";i+=" if ( ",f&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+d+" "+v+" "+n+" || "+d+" !== "+d+") { "}}b=b||t,(P=P||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(b||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { comparison: "+k+", limit: "+n+", exclusive: "+S+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be "+E+" ",i+=f?"' + "+n:n+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=f?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";T=i;return i=P.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",c&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(s||""),f=e.opts.$data&&a&&a.$data;f?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",n="schema"+o):n=a,i+="if ( ",f&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+d+".length "+("maxItems"==t?">":"<")+" "+n+") { ";var h=t,p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(h||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxItems"==t?"more":"fewer",i+=" than ",i+=f?"' + "+n+" + '":""+a,i+=" items' "),e.opts.verbose&&(i+=" , schema:  ",i+=f?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var m=i;return i=p.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(s||""),f=e.opts.$data&&a&&a.$data;f?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",n="schema"+o):n=a;var h="maxLength"==t?">":"<";i+="if ( ",f&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),!1===e.opts.unicode?i+=" "+d+".length ":i+=" ucs2length("+d+") ",i+=" "+h+" "+n+") { ";var p=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(p||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT be ",i+="maxLength"==t?"longer":"shorter",i+=" than ",i+=f?"' + "+n+" + '":""+a,i+=" characters' "),e.opts.verbose&&(i+=" , schema:  ",i+=f?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var g=i;return i=m.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+g+"]); ":i+=" validate.errors = ["+g+"]; return false; ":i+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(s||""),f=e.opts.$data&&a&&a.$data;f?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",n="schema"+o):n=a,i+="if ( ",f&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" Object.keys("+d+").length "+("maxProperties"==t?">":"<")+" "+n+") { ";var h=t,p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(h||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxProperties"==t?"more":"fewer",i+=" than ",i+=f?"' + "+n+" + '":""+a,i+=" properties' "),e.opts.verbose&&(i+=" , schema:  ",i+=f?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var m=i;return i=p.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"http://json-schema.org/draft-07/schema#","title":"Core schema meta-schema","definitions":{"schemaArray":{"type":"array","minItems":1,"items":{"$ref":"#"}},"nonNegativeInteger":{"type":"integer","minimum":0},"nonNegativeIntegerDefault0":{"allOf":[{"$ref":"#/definitions/nonNegativeInteger"},{"default":0}]},"simpleTypes":{"enum":["array","boolean","integer","null","number","object","string"]},"stringArray":{"type":"array","items":{"type":"string"},"uniqueItems":true,"default":[]}},"type":["object","boolean"],"properties":{"$id":{"type":"string","format":"uri-reference"},"$schema":{"type":"string","format":"uri"},"$ref":{"type":"string","format":"uri-reference"},"$comment":{"type":"string"},"title":{"type":"string"},"description":{"type":"string"},"default":true,"readOnly":{"type":"boolean","default":false},"examples":{"type":"array","items":true},"multipleOf":{"type":"number","exclusiveMinimum":0},"maximum":{"type":"number"},"exclusiveMaximum":{"type":"number"},"minimum":{"type":"number"},"exclusiveMinimum":{"type":"number"},"maxLength":{"$ref":"#/definitions/nonNegativeInteger"},"minLength":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"pattern":{"type":"string","format":"regex"},"additionalItems":{"$ref":"#"},"items":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/schemaArray"}],"default":true},"maxItems":{"$ref":"#/definitions/nonNegativeInteger"},"minItems":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"uniqueItems":{"type":"boolean","default":false},"contains":{"$ref":"#"},"maxProperties":{"$ref":"#/definitions/nonNegativeInteger"},"minProperties":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"required":{"$ref":"#/definitions/stringArray"},"additionalProperties":{"$ref":"#"},"definitions":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"properties":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"patternProperties":{"type":"object","additionalProperties":{"$ref":"#"},"propertyNames":{"format":"regex"},"default":{}},"dependencies":{"type":"object","additionalProperties":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/stringArray"}]}},"propertyNames":{"$ref":"#"},"const":true,"enum":{"type":"array","items":true,"minItems":1,"uniqueItems":true},"type":{"anyOf":[{"$ref":"#/definitions/simpleTypes"},{"type":"array","items":{"$ref":"#/definitions/simpleTypes"},"minItems":1,"uniqueItems":true}]},"format":{"type":"string"},"contentMediaType":{"type":"string"},"contentEncoding":{"type":"string"},"if":{"$ref":"#"},"then":{"$ref":"#"},"else":{"$ref":"#"},"allOf":{"$ref":"#/definitions/schemaArray"},"anyOf":{"$ref":"#/definitions/schemaArray"},"oneOf":{"$ref":"#/definitions/schemaArray"},"not":{"$ref":"#"}},"default":true}')},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SystemManager=void 0;const i=n(r(4)),o=n(r(94)),s=r(188),a=r(38),l=r(192),u=r(194),c=r(6),d=r(18),f=r(195),h=r(230),p=r(231),m=r(232),g=r(233),y=r(234),v=r(235),b=r(236),w=r(237),S=r(238),C=r(239),_=r(242),E=r(243),P=r(246),T=r(247),k=r(248),A=r(249),O=r(250),L=r(251),I=r(252),D=r(254),R=r(255);window.addEventListener("error",e=>{const t=e.error&&e.error.stack?e.error.stack.substring(e.error.stack.search("at ")):"",r=`System Manager: ${e.message}<br />File: ${e.filename}<br />Line: ${e.lineno}<br />Column: ${e.colno}<br />${t}`;return o.default.error({leadingBlankLine:!0},r),!1});class F{constructor(e){console.debug("Starting System Manager",e),c.System.startupApplicationHandshake(),this.manifest=e.manifest,this.initialize()}async initialize(){this.onErrorMakeSystemManagerVisible=d.ConfigUtilInstance.getDefault(this.manifest,"manifest.finsemble.bootConfig.onErrorMakeSystemManagerVisible",!1),o.default.initialize(this.onErrorMakeSystemManagerVisible),await h.DeprecatedConfigUtilInstance.modifyConfigBasedOnDeprecatedDefinitions("bootConfig",this.manifest),await f.SchemaUtilInstance.walkSchemaAndSetConfigDefaults(this.manifest),this.verifyConfig(this.manifest),this.finUUID=c.System.Application.getCurrent().uuid,console.log("finUUID",this.finUUID),!1!==this.manifest.finsemble.killOrphanApplications&&(console.log("killing applications"),await a.killOldApplications(this.finUUID)),i.default.system.log("APPLICATION LIFECYCLE:STARTUP: Finsemble Version",this.manifest.finsemble.system.FSBLVersion)}async verifyConfig(e){let t=!0;let r=await f.SchemaUtilInstance.validateConfig(e,"#/definitions/BootManifestSubschema");return r&&(o.default.error({},'Boot Config Errors: Ctrl+Shift-I on this window to see "JSON Schema Validation Errors" in System Manager\'s devTool console.'),console.error(r),t=!1),t}helpData(){return console.log("1) finsemble.bootConfig onErrorMakeSystemManagerVisible:",this.onErrorMakeSystemManagerVisible),console.log(""),this.bootEngine.helpData(),"helpData complete"}reallyBoot(){try{this.shutdownManager=new u.ShutdownManager({finUUID:this.finUUID,manifest:this.manifest}),this.serviceLauncher=new l.ServiceLauncher({finUUID:this.finUUID,manifest:this.manifest,shutdownManager:this.shutdownManager}),window.bootEngine=this.bootEngine=new s.BootEngine(this.manifest,this.serviceLauncher,this.shutdownManager),this.registerBootTasks(this.bootEngine,this.manifest,this.serviceLauncher,this.shutdownManager),this.bootEngine.run()}catch(e){o.default.error({leadingBlankLine:!0},e)}}async boot(){await this.verifyConfig(this.manifest)?(!1!==this.manifest.finsemble.killOrphanApplications&&(console.log("killing applications"),await a.killOldApplications(this.finUUID)),i.default.system.log("APPLICATION LIFECYCLE:STARTUP: Finsemble Version",this.manifest.finsemble.system.FSBLVersion),this.manifest.finsemble.debugSystemManager?c.System.showDeveloperTools(this.finUUID,this.manifest.startup_app.name,null,()=>{setTimeout(()=>{this.reallyBoot()},1e3)}):this.reallyBoot()):o.default.error({leadingBlankLine:!0},"FATAL ERROR: Prematurely terminating Finsemble.")}registerBootTasks(e,t,r,n){this.bootEngine.registerBootTask("initializeDeepLinkingTask",e=>{(new p.InitializeDeepLinkingTask).start(e)}),this.bootEngine.registerBootTask("initializeRouterTask",e=>{new g.InitializeRouterTask({manifest:t,serviceLauncher:r}).start(e)}),this.bootEngine.registerBootTask("updateServiceLauncherConfigTask",e=>{new L.UpdateServiceLauncherConfigTask({serviceLauncher:r}).start(e)}),this.bootEngine.registerBootTask("initializeFinsemblePubsubTask",e=>{(new y.InitializeFinsemblePubsubTask).start(e)}),this.bootEngine.registerBootTask("initializeSystemStateHandersTask",e=>{(new m.InitializeSystemStateHandersTask).start(e)}),this.bootEngine.registerBootTask("testTask_initializeSplinterAgentPool",e=>{this.bootEngine.initializeSplinterAgentPoolTask(e)}),this.bootEngine.registerBootTask("waitForUpdateDownloadTask",e=>{(new R.WaitForUpdateDownloadTask).start(e)}),this.bootEngine.registerBootTask("waitForAuthenticatedTask",e=>{(new v.WaitForAuthenticatedTask).start(e)}),this.bootEngine.registerBootTask("initializeSystemManagerAPITask",t=>{new b.InitializeSystemManagerAPITask({bootEngine:e,systemLog:o.default}).start(t)}),this.bootEngine.registerBootTask("startLoggerTask",e=>{(new w.StartLoggerTask).start(e)}),this.bootEngine.registerBootTask("loadUserDefinedComponentsTask",e=>{(new _.LoadUserDefinedComponentsTask).start(e)}),this.bootEngine.registerBootTask("loadFDC3InstalledComponentsTask",e=>{(new E.LoadFDC3InstalledComponentsTask).start(e)}),this.bootEngine.registerBootTask("registerHotkeysTask",e=>{(new S.RegisterHotkeysTask).start(e)}),this.bootEngine.registerBootTask("setupSearchLauncherTask",e=>{(new C.SetupSearchLauncherTask).start(e)}),this.bootEngine.registerBootTask("loadSystemTrayIconTask",e=>{(new P.LoadSystemTrayIconTask).start(e)}),this.bootEngine.registerBootTask("checkForScheduledRestartTask",e=>{(new I.CheckForScheduledRestartTask).start(e)}),this.bootEngine.registerBootTask("hideSplashScreenTask",e=>{(new D.HideSplashScreenTask).start(e)}),this.bootEngine.registerBootTask("forceErrorTestTask",(new T.ForceErrorTestTask).start),this.bootEngine.registerBootTask("checkpointErrorTestTask",(new k.CheckpointErrorTestTask).start),this.bootEngine.registerBootTask("checkpointCircularDependencyTestTask",(new A.CheckpointBadDependencyTestTask).start),this.bootEngine.registerBootTask("checkpointBadDependencyTestTask",(new O.CheckpointCircularDependencyTestTask).start)}}t.SystemManager=F,c.System.ready(()=>{window.finsembleServices=[{name:"System Manager"}],d.ConfigUtilInstance.getInitialManifest(async e=>{console.log("APPLICATION LIFECYCLE:STARTUP: *** Initial manifest ***",e),i.default.system.log("forceObjectsToLogger","APPLICATION LIFECYCLE:STARTUP: *** Initial manifest ***",e);const t=new F({manifest:e});t.boot(),window.systemManager=t,window.helpData=window.systemManager.helpData.bind(window.systemManager)})})},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BootEngine=void 0;const a=s(r(4)),l=s(r(10)),u=s(r(21)),c=s(r(37)),d=r(18),f=r(47),h=r(189),p=r(107),m=s(r(190)),g=s(r(94)),y=o(r(17)),v=r(34),b=r(38),w=s(r(20)),S=["bootTasks","services","components"],C={name:"",state:"uninitialized"};t.BootEngine=class{constructor(e,t,r){this.dependencyGraphs={},this.bootConfigs={},this.cumulativePreviousBootConfig=[],this.startTimers={},this.registeredTasks={},this.processStatusCounter=0,this.processingTerminated=!1,this.activeServices=[],this.checkpointEngines={},this.manifest=e,this.finsembleConfig=e.finsemble,this.serviceLauncher=t,this.shutdownManager=r,this.handleTaskResponse=this.handleTaskResponse.bind(this),this.genericHandlerForStateChange=this.genericHandlerForStateChange.bind(this),this.startServiceTimeout=d.ConfigUtilInstance.getDefault(this.finsembleConfig,"finsembleConfig.bootConfig.defaults.startServiceTimeout",15e3),this.startComponentTimeout=d.ConfigUtilInstance.getDefault(this.finsembleConfig,"finsembleConfig.bootConfig.defaults.startComponentTimeout",15e3),this.startTaskTimeout=d.ConfigUtilInstance.getDefault(this.finsembleConfig,"finsembleConfig.bootConfig.defaults.startTaskTimeout",15e3),this.setupDependencyBootStatusPubSubs()}helpData(){console.log("2) finsemble.bootConfig timeout values"),console.log("\tstartServiceTimeout value",this.startServiceTimeout),console.log("\tstartComponentTimeout value",this.startComponentTimeout),console.log("\tstartTaskTimeout value",this.startTaskTimeout),console.log(""),console.log("3) Current boot stage:",this.currentStage),console.log(""),console.log(`4) Lastest/current status of dependencyGraph for ${this.currentStage} stage`,this.dependencyGraphs[this.currentStage].getCurrentStatus()),console.log(""),console.log("5) Dependency graphs by stage",this.dependencyGraphs),console.log(""),console.log("6) Boot config data by stage",this.bootConfigs),console.log(""),console.log("7) Active Checkpoint Engines",this.checkpointEngines),console.log(""),console.log("8) Registered tasks",this.registeredTasks),console.log(""),console.log("9) List of outstanding start timers",this.startTimers),console.log(""),console.log("10) Dependency graphs display by stage"),this.outputDependencyGraphs(this.dependencyGraphs),console.log("")}registerBootTask(e,t){"string"==typeof e&&"function"==typeof t?this.registeredTasks[e]=t:g.default.error({},`BootEngine: registerBootTask failed because of illegal input.  Task Name = ${e}. Task Function Type = ${typeof t}`)}initializeSplinterAgentPoolTask(e){a.default.system.log("FINSEMBLE CONFIG",this.finsembleConfig);let t=[];if(this.finsembleConfig.splinteringConfig&&this.finsembleConfig.splinteringConfig.splinterAgents&&(t=this.finsembleConfig.splinteringConfig.splinterAgents.filter(e=>e.services&&e.services.length>0)),t.length){const e={manifest:this.manifest,finsembleConfig:this.finsembleConfig,agentList:t,defaultAgentLabel:"defaultServiceAgent"};this.splinterAgentPool=new m.default(e),this.shutdownManager.setSplinterAgentPool(this.splinterAgentPool)}e("testTask_initializeSplinterAgentPool","bootTasks","completed")}async run(){try{for(let e=0;e<v.ALL_BOOT_STAGES.length;e++){const t=e=>{if(this.logDiagnostics(e),v.CRITICAL_BOOT_STAGES.includes(this.currentStage))throw"*** Terminating Boot ***"};this.currentStage=v.ALL_BOOT_STAGES[e],a.default.system.log("BootEngine.run stage entered",this.currentStage),await this.runBootStage(this.currentStage).catch(t);const{data:r}=await u.default.getValue({field:"finsemble"});this.finsembleConfig=r,this.shutdownManager.addActiveServicesToDependencyManager(this.activeServices),a.default.system.log("BootEngine.run stage complete",this.currentStage),l.default.publish(v.STAGE_CHANNEL,{stage:this.currentStage})}}catch(e){this.shutdownManager.addActiveServicesToDependencyManager(this.activeServices),this.cleanupStagesOutStandingTimers(),this.processingTerminated=!0,g.default.error({},'"BootEngine: '+e)}}startService(e){const t=this.manifest.finsembleConfig.services[e];t?(g.default.log({indent:!0},"Starting service "+e),a.default.system.debug(`bootEngine.startService starting service ${e} in ${this.currentStage}`),this.serviceLauncher.createService(t,this.splinterAgentPool)):g.default.error({},`"BootEngine.startService failed for ${e} because config not found in "finsemble.services"`)}logDiagnostics(e){g.default.error({leadingBlankLine:!0,indent:!0},`Error in stage "${this.currentStage}": ${e.description}`);for(let t=0;t<e.errorData.length;t++)g.default.error({doubleIndent:!0},`"${t}: ${e.errorData[t]}`);g.default.error({leadingBlankLine:!0,indent:!0},`"${this.currentStage}" stage failed. See SystemManager console for additional information.`)}checkpointLogDiagnostics(e){if(e.description){g.default.warn({indent:!0},`checkpoint issue in stage "${this.currentStage}": ${e.description}`);for(let t=0;t<e.errorData.length;t++)g.default.warn({doubleIndent:!0},`${t}: ${e.errorData[t]}`)}else for(let t=0;t<e.errorData.length;t++)g.default.warn({indent:!0},""+e.errorData[t])}findConfigElement(e){const t=this.bootConfigs[this.currentStage].findIndex(t=>t.name===e),r=this.bootConfigs[this.currentStage][t];return r||a.default.system.error("bootEngine.findConfigElement could not find expected config element",e,this.bootConfigs[this.currentStage]),r}outputDependencyGraphs(e){for(let t=0;t<v.ALL_BOOT_STAGES.length;t++){const r=v.ALL_BOOT_STAGES[t],n=e[r];if(n){console.log("\tStage:",r);for(const e in n.graph.nodes){console.log("\t\tName:",e);for(let t=0;t<n.graph.nodes[e].dependencies.length;t++)console.log("\t\t\tDependency:",n.graph.nodes[e].dependencies[t])}}}}cleanupStagesOutStandingTimers(){Object.keys(this.startTimers).forEach(e=>{clearTimeout(this.startTimers[e]),delete this.startTimers[e]})}getBootConfigElement(e,t,r,n){const i=y.clone(n);let o=new f.BootConfigElement;return o.name=n.name||t,o.type=r,i.bootParams?v.ALL_BOOT_STAGES.includes(i.bootParams.stage)||((i.bootParams.stage||!1!==i.bootParams.autoStart)&&g.default.error({leadingBlankLine:!1},`BOOT CONFIG: unknown boot stage "${i.bootParams.stage}" for ${t} in ${r} -- assigning default value`),i.bootParams.stage=null):i.bootParams={},"services"===r?(o.stage=i.bootParams.stage||"earlyuser",o.timeout=i.bootParams.timeout||this.startServiceTimeout,i.debugServiceDelay&&o.stage===e&&(o.timeout=o.timeout+i.debugServiceDelay,g.default.warn({leadingBlankLine:!1},`==> timeout value for ${t} will be increased to ${o.timeout} (debugServiceDelay=${i.debugServiceDelay})`))):"bootTasks"===r?(o.stage=i.bootParams.stage||"earlyuser",o.timeout=i.bootParams.timeout||this.startTaskTimeout):"components"===r&&(i.component=i.component||{},o.stage=i.bootParams.stage||"user",!1===i.bootParams.autoStart&&i.component.spawnOnStartup&&o.stage===e&&g.default.error({leadingBlankLine:!1},`BOOT CONFIG: autostart conflicts with spawnOnStartup value for ${t} in ${r} -- using spawnOnStartup value`),n.bootParams,i.bootParams.autoStart=i.component.spawnOnStartup||!1,o.timeout=i.bootParams.timeout||this.startComponentTimeout),i.bootParams.checkpoints&&Object.keys(i.bootParams.checkpoints).length>0&&(o.checkpointsIncluded=!0,o.checkpointConfig=i.bootParams.checkpoints),o.dependencies=i.bootParams.dependencies||[],o.stopOnFailure=!("stopOnFailure"in i.bootParams)||i.bootParams.stopOnFailure,o.autoStart=!("autoStart"in i.bootParams)||i.bootParams.autoStart,o.customFailureMessage=i.bootParams.customFailureMessage||"",o.originalConfig=n,Array.isArray(o.dependencies)||o.stage!==e||(g.default.error({leadingBlankLine:!1},`BOOT CONFIG: bootparams.dependencies for ${t} in ${r} must be an array`),o.dependencies=[""]),o}getBootConfigByType(e,t,r,n){for(const i in r){const o=this.getBootConfigElement(e,i,t,r[i]);o.stage==e&&n.push(o)}}getBootConfig(e,t){const r=[];for(let n=0;n<S.length;n++){const i=S[n];this.getBootConfigByType(e,i,t[i],r),"services"==i&&this.getBootConfigByType(e,i,t.system.requiredServicesConfig,r)}return r}runBootStage(e){return new Promise(async(t,r)=>{try{g.default.log({leadingBlankLine:!1},"BOOT STAGE: "+e),this.stageResolver=t,this.stageRejecter=r,this.bootConfigs[e]=this.getBootConfig(e,this.finsembleConfig),this.dependencyGraphs[e]=new p.BootDependencyGraph(e,this.bootConfigs[e],this.cumulativePreviousBootConfig),a.default.system.log("forceObjectsToLogger","BootDependencyGraph.runBootStage",e,this.bootConfigs[e],this.cumulativePreviousBootConfig,this.dependencyGraphs[e]),console.log("BootDependencyGraph.runBootStage",e,this.bootConfigs[e],this.cumulativePreviousBootConfig,this.dependencyGraphs[e]),this.processWhatIsReady(this.dependencyGraphs[e]),this.cumulativePreviousBootConfig=[...this.cumulativePreviousBootConfig,...this.bootConfigs[e]]}catch(e){r(new p.DGDiagnostics("BootEngine:runBootStage.reject"+e))}})}setupDependencyBootStatusPubSubs(){l.default.onReady(()=>{l.default.addPubSubResponder(new RegExp(v.STATUS_CHANNEL_BASE+".*"),C),l.default.addPubSubResponder(new RegExp(v.CHECKPOINT_CHANNEL_BASE+".*"),C),l.default.addPubSubResponder(v.STAGE_CHANNEL,{stage:"uninitialized"})})}subscribeToDependencyBootStatus(e){l.default.subscribe(b.statusChannel(e),(e,t)=>{e?a.default.system.error("BootEngine subscribe error",e):this.genericHandlerForStateChange(t.data.name,t.data.type,t.data.state)})}handleOneDependencyStateChange(e,t,r){if("completed"===r&&"services"===t?this.activeServices.push(e):"completed"===r&&"bootTasks"===t&&w.default.publishBootStatus(e,"bootTasks","completed"),"completed"===r||"failed"===r){const t=this.dependencyGraphs[this.currentStage];this.checkpointEngines[e]&&setTimeout(()=>{const t=this.checkpointEngines[e].getResults(r);t.okay||this.checkpointLogDiagnostics(t.errorDiag),delete this.checkpointEngines[e],a.default.system.debug("bootEngine.genericHandlerForStateChange checkpointEngine results",e,t)},50),"failed"===r&&g.default.error({doubleIndent:!0},`BootState=${r} for ${e}.  ${this.findConfigElement(e).customFailureMessage}`),t.setBootDependencyState(e,r),this.processWhatIsReady(t)}}genericHandlerForStateChange(e,t,r){a.default.system.debug("bootEngine.genericHandlerForStateChange",e,t,r),console.debug("bootEngine.genericHandlerForStateChange",e,t,r),this.startTimers[e]&&(clearTimeout(this.startTimers[e]),delete this.startTimers[e]),this.processingTerminated||this.handleOneDependencyStateChange(e,t,r)}handleTaskResponse(e,t,r){setTimeout(()=>{this.genericHandlerForStateChange(e,t,r)},0)}handleStartTimeout(e,t){delete this.startTimers[e],g.default.error({indent:!1},e+" startup failed due to a time out"),this.genericHandlerForStateChange(e,t,"failed")}startBootTaskDependency(e){g.default.log({indent:!0},"starting boot task: "+e.name),a.default.system.debug(`bootEngine.startBootTaskDependency starting boot task ${e.name} in ${this.currentStage}`,e),this.registeredTasks[e.name]?this.registeredTasks[e.name](this.handleTaskResponse):(a.default.system.error("bootEngine.startBootTaskDependency: unknown task "+e.name,e),g.default.error({},"bootEngine.startBootTaskDependency: unknown task "+e.name))}startServiceDependency(e){g.default.log({indent:!0},"starting service: "+e.name),this.subscribeToDependencyBootStatus(e.name),a.default.system.debug(`bootEngine.startServiceDependency starting service ${e.name} in ${this.currentStage}`,e),this.serviceLauncher.createService(e.config.originalConfig,this.splinterAgentPool)}startComponentDependency(e){"microkernel"===this.currentStage||"kernel"===this.currentStage?g.default.error({indent:!0},`cannot config in bootParams for component ${e.name} to start until after "kernal" stage`):(g.default.log({indent:!0},"starting component: "+e.name),this.subscribeToDependencyBootStatus(e.name),a.default.system.debug(`bootEngine.startComponentDependency starting component ${e.name} in ${this.currentStage}`,e,e.config.originalConfig),c.default.spawn(e.name,{}))}startReadyItem(e){switch(this.startTimers[e.name]=setTimeout(()=>{this.handleStartTimeout(e.name,e.type)},e.config.timeout),e.type){case"bootTasks":this.startBootTaskDependency(e);break;case"services":this.startServiceDependency(e);break;case"components":this.startComponentDependency(e);break;default:a.default.system.error("bootEngine.startReadyItem: unknown boot type",e)}e.config.checkpointsIncluded&&(a.default.system.debug("bootEngine.startReadyItem new BootCheckpointEngine",e.config.name,e),this.checkpointEngines[e.config.name]=new h.BootCheckpointEngine(e.config.name,this.currentStage,e.config.timeout,e.config.checkpointConfig))}setStateForList(e,t){for(let r=0;r<e.length;r++){const n=e[r];this.dependencyGraphs[this.currentStage].setBootDependencyState(n.name,t)}}processReadyList(e){a.default.system.debug("bootEngine.processReadyList",e),this.setStateForList(e,"starting");for(let t=0;t<e.length;t++){const r=e[t];this.startReadyItem(r)}}processWhatIsReady(e){const t=e.getCurrentStatus();if(a.default.system.debug("bootEngine processWhatIsReady",t,e),console.log("processWhatIsReady",t),++this.processStatusCounter>500)a.default.system.error("bootEngine.processWhatIsReady is in infinite loop -- breaking out",this.processStatusCounter);else switch(t.graphState){case"error":this.stageRejecter(t.errorDiag);break;case"notFinished":this.processReadyList(t.readyToStartList);break;case"finished":this.stageResolver()}}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BootCheckpointEngine=t.BootCheckpointResults=void 0;const a=s(r(4)),l=s(r(10)),u=r(47),c=r(107),d=s(r(94)),f=o(r(17)),h=r(38);class p{constructor(e,t=new c.DGDiagnostics){this.okay=e,this.errorDiag=t}}t.BootCheckpointResults=p;t.BootCheckpointEngine=class{constructor(e,t,r,n){this.checkpointTimers={},this.processStatusCounter=0,this.activeServices=[],this.parentName=e,this.currentStage=t,this.defaultTimeoutInterval=r,this.originalConfig=n,this.genericHandlerForStateChange=this.genericHandlerForStateChange.bind(this),this.run()}getResults(e){a.default.system.debug("bootCheckpointEngine.getResults",this.currentStatus,this.checkpointTimers,this.checkpointConfig);let t=new p(!0);const r=[];"error"===this.currentStatus.graphState&&(t=new p(!1,this.currentStatus.errorDiag));for(const t in this.checkpointTimers)this.findConfigElement(t).postStartupCompletion?"failed"===e&&clearTimeout(this.checkpointTimers[t]):(r.push(`checkpoint ${t} for ${this.parentName} did not complete`),clearTimeout(this.checkpointTimers[t]));if(r.length>0)if(t.okay){const e=new c.DGDiagnostics(null,r);t=new p(!1,e)}else t.errorDiag.errorData.push(...r);return t}findConfigElement(e){const t=this.checkpointConfig.findIndex(t=>t.name===e);return this.checkpointConfig[t]}run(){try{this.checkpointConfig=this.getCheckpointConfig(this.originalConfig),this.dependencyGraph=new c.BootDependencyGraph(this.parentName,this.checkpointConfig),a.default.system.log("forceObjectsToLogger","checkpoint BootDependencyGraph.run",this.currentStage,this.checkpointConfig,this.dependencyGraph),console.log("checkpoint BootDependencyGraph.run",this.currentStage,this.checkpointConfig,this.dependencyGraph),this.processWhatIsReady(this.dependencyGraph)}catch(e){this.cleanupStagesOutStandingTimers(),d.default.error({},'"checkpointEngine: '+e)}}cleanupStagesOutStandingTimers(){Object.keys(this.checkpointTimers).forEach(e=>{clearTimeout(this.checkpointTimers[e]),delete this.checkpointTimers[e]})}getCheckpoingConfigElement(e,t){const r=f.clone(t),n=new u.BootConfigElement;return n.name=e,n.type="checkpoints",n.stage=this.currentStage,n.dependencies=r.dependencies||[],n.postStartupCompletion=r.postStartupCompletion||!1,n.stopOnFailure=!0,n.autoStart=!0,n.customFailureMessage=r.customFailureMessage||"",n.originalConfig=r,n.timeout=r.timeout||this.defaultTimeoutInterval,Array.isArray(n.dependencies)||(d.default.error({leadingBlankLine:!1},`Checkpoint CONFIG: dependencies for ${e} must be an array`),n.dependencies=[""]),n}getCheckpointConfig(e){const t=[];for(const r in e){const n=this.getCheckpoingConfigElement(r,e[r]);t.push(n)}return t}subscribeToCheckpointStatus(e,t){a.default.system.debug("checkpointEngine subscribe",e,t,h.checkpointChannel(e,t)),l.default.subscribe(h.checkpointChannel(e,t),(e,t)=>{e?a.default.system.error("checkpointEngine subscribe error",e):(a.default.system.debug("checkpointEngine.notification",this.parentName,t.data.checkpointName,t.data.state,t.data.params),this.genericHandlerForStateChange(t.data.checkpointName,t.data.state,t.data.params))})}genericHandlerForStateChange(e,t,r={}){a.default.system.debug("checkpointEngine.genericHandlerForStateChange",this.parentName,e,t,r),this.checkpointTimers[e]&&(clearTimeout(this.checkpointTimers[e]),delete this.checkpointTimers[e]),"completed"===t?(this.dependencyGraph.setBootDependencyState(e,t),this.processWhatIsReady(this.dependencyGraph)):"failed"===t&&(r.timedOut?d.default.warn({indent:!0},`checkpoint ${e} for ${this.parentName} timed out.  ${this.findConfigElement(e).customFailureMessage}`):d.default.warn({indent:!0},`checkpoint ${e} for ${this.parentName} failed.  ${this.findConfigElement(e).customFailureMessage}`),this.dependencyGraph.setBootDependencyState(e,t),this.processWhatIsReady(this.dependencyGraph))}handleStartTimeout(e){delete this.checkpointTimers[e],this.genericHandlerForStateChange(e,"failed",{timedOut:!0})}startReadyCheckpoint(e){this.checkpointTimers[e.name]=setTimeout(()=>{this.handleStartTimeout(e.name)},e.config.timeout),this.subscribeToCheckpointStatus(this.parentName,e.name),a.default.system.debug(`checkpointEngine.processReadyList starting checkpoint ${e.name} in ${this.currentStage}`,e)}setStateForList(e,t){for(let r=0;r<e.length;r++){const n=e[r];this.dependencyGraph.setBootDependencyState(n.name,t)}}processReadyList(e){a.default.system.debug("checkpointEngine.processReadyList",e),this.setStateForList(e,"starting");for(let t=0;t<e.length;t++){const r=e[t];this.startReadyCheckpoint(r)}}processWhatIsReady(e){if(this.currentStatus=e.getCurrentStatus(),a.default.system.debug("checkpointEngine processWhatIsReady",status,e),console.log("processWhatIsReady",status),++this.processStatusCounter>500)a.default.system.error("checkpointEngine.processWhatIsReady is in infinite loop -- breaking out",this.processStatusCounter);else switch(this.currentStatus.graphState){case"error":break;case"notFinished":this.processReadyList(this.currentStatus.readyToStartList)}}}},function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(31)),o=n(r(52)),s=n(r(26)),a=n(r(10)),l=n(r(4)),u=n(r(191)),c=r(33),d=r(6);class f extends i.default.EventEmitter{constructor(e,t=Function.prototype){super(),l.default.system.debug("SplinterAgentPool constructor",e),this.finsembleConfig=e.finsembleConfig,this.manifest=e.manifest,this.status="requestedNewAgent",this.spawnQueue=[],this.agents=[],this.defaultAgentLabel=e.defaultAgentLabel||"defaultAgent",this.shuttingDown=!1,this.shutdown=this.shutdown.bind(this),this.removeAgent=this.removeAgent.bind(this);const r={agentLabel:this.defaultAgentLabel,spawnsAnything:!0,maxWindowsPerAgent:e.maxWindowsForDefaultAgent||1/0};e.agentList=e.agentList.concat([r]),l.default.system.debug("Spawning initial agent list",e.agentList),this.spawnSplinterAgent=this.spawnSplinterAgent.bind(this),this.poolReady=!1,s.default.each(e.agentList,this.spawnSplinterAgent,()=>{this.poolReady=!0,this.flushSpawnQueue(),t()})}availableAgentCount(e){let t=0;for(let r=0;r<this.agents.length;r++){const n=this.agents[r];n.config.agentLabel===e&&(!n.maxWindowsPerAgent||n.windows.length<n.maxWindowsPerAgent)&&t++}return t}addAgent(e){const t=this;l.default.system.debug("Agent added to pool. Agent UUID: "+e.app.uuid);if(e.spawnsAnything){const r=()=>{const n=t.getFlexibleAgents();t.shuttingDown||0!==n.length||t.spawnSplinterAgent(e.config),e.removeListener("agent-closed",r),e.removeListener("agent-crashed",r)};e.addListener("agent-closed",r),e.addListener("agent-crashed",r)}e.addListener("windowRemoved",e=>{t.emit("windowRemoved",e)}),e.addListener("windowMaximumReached",()=>{0===this.availableAgentCount(e.config.agentLabel)&&t.spawnSplinterAgent(e.config)}),e.addListener("empty",()=>{t.onAgentEmpty(e)}),l.default.system.debug("addAgent pushed: "+e.app.uuid),this.agents.push(e),this.status="ready",this.flushSpawnQueue()}getFlexibleAgents(){return this.agents.filter(e=>e.spawnsAnything)}queueSpawn(e,t){l.default.system.debug("SplinterAgentPool Queueing Spawn.",e);const r={windowDescriptor:e,cb:t};this.spawnQueue.push(r)}flushSpawnQueue(){const e=(0,o.default)(this.spawnQueue);l.default.system.debug("SplinterAgentPool flushing spawn queue",e),this.spawnQueue=[];for(let t=0;t<e.length;t++){const r=e[t];this.routeSpawnRequest(r.windowDescriptor,r.cb)}}routeSpawnRequest(e,t=Function.prototype){l.default.system.debug("SplinterAgentPool routingSpawnRequest",e);return new Promise(r=>{const n=e=>{t(e),r(e)},i=this.retrieveAvailableAgent(e.componentType);i?i.requestSpawn(e,n):this.queueSpawn(e,n)})}spawnSplinterAgent(e,t){l.default.system.debug("SplinterAgentPool spawning new Agent",e);const r=this;this.status="requestedNewAgent";const n=(0,c.getRandomWindowName)(e.agentLabel,this.manifest.startup_app.uuid),i={url:this.finsembleConfig.moduleRoot+"/services/window/Splintering/SplinterAgentSlave.html",uuid:n,name:n,mainWindowOptions:{customData:{manifest:{finsemble:this.finsembleConfig}}},plugins:!0},o=new d.System.Application(i,()=>{a.default.addListener(i.name+".onSpawned",()=>{l.default.system.debug("Agent spawned and connected to the pool.",i.name),e.app=o;const n=new u.default(e);r.addAgent(n),r.emit("addAgent",i.name),t&&t()}),o.run()},e=>{l.default.system.error("Failed to create Agent",e)})}removeAgent(e){l.default.system.debug("SplinterAgentPool removeAgent",e,this.agents);for(let t=0;t<this.agents.length;t++){const r=this.agents[t];if(r.uuid===e)return this.agents.splice(t,1),void this.emit("processRemoved",r.name)}}retrieveAvailableAgent(e){l.default.system.debug("SplinterAgentPool.retrieveAvailableAgent for: "+e);for(let t=0;t<this.agents.length;t++){const r=this.agents[t];if(r.canSpawn(e)){if(r.isMaxed)continue;return l.default.system.debug(`SplinterAgentPool.retrieveAvailableAgent: agent found (${r.app.uuid})`),r}}const t=this.getFlexibleAgents();for(let e=0;e<t.length;e++){const r=t[e];if(!r.isMaxed)return l.default.system.debug(`SplinterAgentPool.retrieveAvailableAgent: agent found (${r.app.uuid})`),r}return l.default.system.debug("No agent available."),null}onAgentEmpty(e){const t=this;l.default.system.debug(`SplinterAgentPool.onAgentEmpty. ${e.app.uuid} is empty.`,this.shuttingDown),(this.shuttingDown||this.availableAgentCount(e.config.agentLabel)>1)&&(t.removeAgent(e.app.uuid),e.shutdown())}shutdown(e){l.default.system.debug("SplinterAgentPool.shutdown.",this.agents);const t=this;async function r(e,r){const n=d.System.Application.wrap(e.uuid);await d.System.closeApplication(n),t.removeAgent(e.uuid),l.default.system.verbose("shutdown sync close, "+e.uuid),r()}t.shuttingDown=!0;s.default.whilst(()=>t.agents.length,e=>{const n=JSON.parse(JSON.stringify(t.agents));s.default.each(n,r,e)},e)}}var h=f;t.default=h,e.exports=t.default},function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(31)),o=n(r(4)),s=n(r(10)),a=r(6),l=r(56);class u extends i.default.EventEmitter{constructor(e){super(),o.default.system.debug("SplinterAgent constructor",e),this.spawnsAnything=e.spawnsAnything,this.windows=[],this.uuid=e.app.uuid,this.componentsICanSpawn=e.components||[],this.servicesICanSpawn=e.services||[],this.maxWindowsPerAgent=e.maxWindowsPerAgent,this.app=e.app,this.config=e,this.isMaxed=!1,this.addListeners()}canSpawn(e){return o.default.system.debug(`SplinterAgent.canSpawn: My uuid: ${this.app.uuid}. Checking on: ${e}`),this.componentsICanSpawn.includes(e)||this.servicesICanSpawn.includes(e)}setSlaveTitle(){const e=`Splinter Agent | Open Windows: ${this.windows.length} | Components:${this.componentsICanSpawn.toString()||"N/A"}, Services: ${this.servicesICanSpawn.toString()||"N/A"}`;o.default.system.debug("SplinterAgent.setSlaveTitle: "+e),s.default.transmit(this.app.uuid+".setTitle",{title:e})}addListeners(){o.default.system.debug("SplinterAgent.addListeners"),this.app.addEventListener("window-closed",this.removeWindow.bind(this)),this.app.addEventListener("window-crashed",e=>{l.FinsembleWindow.getInstance(e,(t,r)=>{t?o.default.system.error("Window crash getInstance error",t):r.close(),this.removeWindow(e),o.default.system.error("Agent child crashed",e)})}),this.app.addEventListener("window-out-of-memory",e=>{this.removeWindow(e),o.default.system.error("Agent child out of memory",e)}),this.app.addEventListener("closed",e=>{this.shutdown(),this.emit("agent-closed"),o.default.system.log("Agent closed",e)}),this.app.addEventListener("crashed",e=>{this.shutdown(),this.emit("agent-crashed"),o.default.system.error("Agent crashed",e)}),this.app.addEventListener("out-of-memory",e=>{this.shutdown(),this.emit("agent-crashed"),o.default.system.error("Agent out of memory",e)}),this.app.addEventListener("not-responding",e=>{this.shutdown(),this.emit("agent-crashed"),o.default.system.error("Agent not responding",e)})}addWindow(e){o.default.system.info("SplinterAgent.addWindow",e),this.windows.push(e),this.setSlaveTitle(),this.checkMaximum()}checkMaximum(){o.default.system.debug("SplinterAgent.checkMaximum"),this.isMaxed=this.windows.length===this.maxWindowsPerAgent,o.default.system.debug(`SplinterAgent.checkMaximum. numWindows: ${this.windows.length}. maxWindows: ${this.maxWindowsPerAgent}. isMaxed:${this.isMaxed}`),this.isMaxed&&this.emit("windowMaximumReached")}requestSpawn(e,t){o.default.system.debug("SplinterAgent.requestSpawn"),o.default.system.debug("SplinterAgent.requestSpawn arguments:",e);const r=this;e.uuid=this.app.uuid,window.pendingWindowNames&&(window.pendingWindowNames[e.name]=e.uuid),this.addWindow(e);const n=e.name+".onSpawned";var i=function(){const l=a.System.Window.wrap(e.uuid,e.name);function u(e){s.default.removeListener(n,i),o.default.system.info("SplinterAgent.noticed window closed: "+e.name),r.removeWindow({name:e.name})}l.addEventListener("closed",u),l.addEventListener("crashed",u),o.default.system.info("Window spawned and connected to the agent. Adding window to global store. "+e.name);const c=e.customData.manifest.finsemble;e.customData.manifest={finsemble:{FinsembleUUID:c.FinsembleUUID,applicationRoot:c.applicationRoot,routerDomainRoot:c.moduleRoot,router:c.router}},t&&t(l)};s.default.addListener(n,i),s.default.transmit(this.app.uuid+".spawn",{windowDescriptor:e})}removeWindow(e){o.default.system.debug("SplinterAgent.removeWindow. window name: "+e.name);for(let t=0;t<this.windows.length;t++){if(this.windows[t].name===e.name){this.windows.splice(t,1),this.emit("windowRemoved",e);break}}0===this.windows.length&&(o.default.system.debug("Agent empty "+this.app.uuid),this.emit("empty")),this.setSlaveTitle(),this.checkMaximum()}async shutdown(){this.removeListener("empty",this.shutdown),await a.System.closeApplication(this.app)}}var c=u;t.default=c,e.exports=t.default},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceLauncher=void 0;const i=n(r(4)),o=r(6),s=n(r(193)),a=r(17),l=n(r(20)),u=r(46),c=r(95);t.ServiceLauncher=class{constructor(e){this.runningServices={},this.workerTop=100,this.workerLeft=100,this.webWorkers={},this.finUUID=e.finUUID,this.manifest=e.manifest,this.finsembleConfig=e.manifest.finsemble,this.shutdownManager=e.shutdownManager,this.FinsembleUUID=a.guuid()}updateConfig(e){this.finsembleConfig=e}updateManifest(e){this.manifest=e}getServiceConfig(e){let t=e;const r=t.indexOf("Service");-1!==r&&(t=t.substring(0,r));const n=t+"Service";return this.mergeConfig([{path:"system.requiredServicesConfig",entry:n},{path:"system.requiredServicesConfig",entry:t},{path:"services",entry:n},{path:"services",entry:t},{path:"servicesConfig",entry:n},{path:"servicesConfig",entry:t}])}createService(e,t){if(this.runningServices[e.name])return;this.runningServices[e.name]=!0;const r=this.getServiceConfig(e.name);r.parentUuid=this.finUUID;const n=this.composeWorkerConfig(Object.assign({},e,r));if(i.default.system.debug("createService",n),!n.name){let t="Tried to create a service without a name. Check your config.";return e&&r&&(t+=`\n\t\t\t\tconfig: ${JSON.stringify(e,null,4)}\n\t\t\t\tupdatedConfig: ${JSON.stringify(r,null,4)}`),void l.default.systemLog({error:!0},t)}let{spawnAs:o}=n;switch(!o&&n.isolate&&(o="process"),o||(o="window"),o){case"window":this.launchServiceAsWindow(r,n,t);break;case"process":this.launchServiceAsProcess(r,n);break;case"script":this.launchServiceAsScript(r);break;case"thread":this.launchServiceAsThread(r,n)}this.workerTop=this.workerTop+25,this.workerLeft=this.workerLeft+25}mergeConfig(e){let t={};return e.forEach(e=>{t=c(t,u(this.finsembleConfig,`${e.path}.${e.entry}`,{}))}),t}launchServiceAsScript(e){const t=e.file,r=document.createElement("script");r.setAttribute("src",t),document.head.appendChild(r)}launchServiceAsThread(e,t){const r=e.file;this.webWorkers[t.name]=new Worker(r)}launchServiceAsWindow(e,t,r){new o.System.Window(t,()=>{const e=o.System.Window.wrap(t.uuid,t.name);this.onServiceCreated(e)},this.onServiceCreationError)}launchServiceAsProcess(e,t){t.uuid=`${t.name}-${this.finUUID}`,t.parentUUID=this.finUUID,console.info(t.name,t);const r=new o.System.Application(t,()=>{r.run();const e=o.System.Window.wrap(t.uuid,t.name);this.onServiceCreated(e),this.shutdownManager.addAppToShutdownList(r)})}composeWorkerConfig(e){this.manifest.finsemble.FinsembleUUID=this.FinsembleUUID;const t=c(e,{manifest:this.manifest}),r={url:e.external?e.html:e.html||"base.html",name:e.name,defaultTop:this.workerTop,defaultLeft:this.workerLeft,autoShow:e.visible,frame:e.frame,customData:t,alwaysOnTop:!1,fixedPosition:!1,saveWindowState:!1,cornerRounding:!0,waitForPageLoad:!0,isolate:e.isolate,spawnAs:e.spawnAs,affinity:e.affinity,securityPolicy:e.securityPolicy||null,permissions:e.permissions||{},icon:this.manifest.startup_app?this.manifest.startup_app.applicationIcon:null},n=c(r,e.window||{});return this.finsembleConfig.securityPolicies&&(n.securityPolicy=s.default.getSecurityPolicy(n,this.finsembleConfig),n.permissions=s.default.getPermissions(n,this.finsembleConfig)),n}onServiceCreated(e){i.default.system.debug("OnworkerCreated",e.name),e.addEventListener("reloaded",()=>{i.default.system.debug("Service Reloaded",e.name)})}onServiceCreationError(e){i.default.system.error("error",e)}}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=o(r(17)),l=s(r(4)),u=r(95);t.default={getSecurityPolicy(e,t){let r=null;if(e.securityPolicy&&(r=t.securityPolicies[e.securityPolicy],r))return e.securityPolicy;const n=!e.url||a.crossDomain(e.url);let i=t.securityPolicyRules.sameDomain;return n&&(i=t.securityPolicyRules.crossDomain),!r&&e.securityPolicy&&l.default.system.error(`Security policy ${e.securityPolicy} not found. Defaulting to ${i}`),i},getPermissions(e,t){let r={System:{},Window:{},Application:{}},n={};if(e.permissions)try{n=JSON.parse(JSON.stringify(e.permissions))}catch(e){l.default.system.error("SpawnUtils:getPermissions: Unexpected JSON parsing error.")}r=u(r,n);const i=t.securityPolicies[e.securityPolicy];if(i){const e=Object.keys(i);for(let t=0;t<e.length;t++){const n=e[t],o=Object.keys(i[n]);r[n]||(r[n]={});for(let e=0;e<o.length;e++){const t=o[e],s=i[n][t];let a=r[n][t];a?!1===s&&(a=!1):void 0===a&&(a=s),r[n][t]=a}}}const o=!1===r.Window.close;return"windowService"===e.name&&o&&(l.default.system.error("Window Service cannot be restricted from closing windows, disabling restriction."),r.Window.close=!0),r}}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShutdownManager=void 0;const a=r(26),l=s(r(4)),u=r(6),c=s(r(10)),d=o(r(25)),f=r(38),h=r(55);class p{constructor(e){this.quitType="quit",this.servicesLoaded=[],this.servicesResponded=[],this.waitFor=[],this.createdApps=[],this.splinterAgentPool=null,this.finsembleConfig=e.manifest.finsemble,this.finUUID=e.finUUID,this.forceRestart=this.forceRestart.bind(this)}setSplinterAgentPool(e){this.splinterAgentPool=e}attemptQuit(){"quit"===this.quitType?this.shutdownFinsemble():"restart"===this.quitType&&this.forceRestart()}forceRestart(){u.System.Application.getCurrent().restart()}closeAllApplications(e){console.info("APPLICATION LIFECYCLE:SHUTDOWN:Closing all applications:start"),a.series([e=>{this.splinterAgentPool?this.splinterAgentPool.shutdown(e):e()},async e=>{for(const e of this.createdApps)await u.System.closeApplication(e);e()}],e)}shutdownFinsemble(){this.closeAllApplications(()=>{u.System.closeApplication(u.System.Application.getCurrent())})}transmitShutdownRequest(){u.System.hideSplashScreen();const e="APPLICATION LIFECYCLE:SHUTDOWN:transmitShutdownRequest:Sending out message to shut down.";console.info(e),l.default.system.log(e);c.default.publish(d.APPLICATION_STATE_CHANNEL,{state:"closing"});const t=this.finsembleConfig.shutdownTimeout||1e4;setTimeout(async()=>{"Electron"!==u.System.container&&await f.killOldApplications(this.finUUID),u.System.closeApplication(u.System.Application.getCurrent())},t)}transmitRestartRequest(){const e="APPLICATION LIFECYCLE:SHUTDOWN:transmitShutdownRequest:Sending out message to shut down.";console.info(e),l.default.system.log(e),l.default.system.debug("shutdownManager.transmitRestartRequest"),this.quitType="restart";c.default.publish(d.APPLICATION_STATE_CHANNEL,{state:"closing"});const t=this.finsembleConfig.shutdownTimeout||1e4;setTimeout(this.forceRestart,t)}}t.ShutdownManager=class{constructor(e){l.default.system.log("shutdownManager",e),this.manifest=e.manifest,this.finsembleConfig=e.manifest.finsemble,this.shutdown=new p({finUUID:e.finUUID,manifest:e.manifest}),this.shutdownList=[],this.restart=this.restart.bind(this),c.default.onReady(()=>{l.default.system.debug("Adding Listeners for shutdown and restart"),this.dialogManager=r(108).default,this.dialogManager.initialize(),c.default.addListener("Application.shutdown",this.shutdown.transmitShutdownRequest.bind(this.shutdown)),c.default.addListener("Application.restart",this.shutdown.transmitRestartRequest.bind(this.shutdown))}),u.System.addEventListener("apply-update-requested",()=>{l.default.system.log("Apply update requested: after onReady"),this.dialogManager.createStore(()=>{this.dialogManager.open("yesNo",{monitor:"primary",title:"Application Update",question:"A new version has been downloaded. Do you want to restart the application now to apply the updates?",showTimer:!1,showNegativeButton:!1,affirmativeResponseLabel:"Restart Now"},async(e,t)=>{"cancel"!==t.choice&&c.default.transmit("Application.restart",{})})})})}setSplinterAgentPool(e){this.shutdown.setSplinterAgentPool(e)}addAppToShutdownList(e){this.shutdownList.push(e)}addActiveServicesToDependencyManager(e){const t=e.filter(e=>"routerService"!==e);l.default.system.debug("shutdownManager.addActiveServicesToDependencyManager: Will wait for the following services at shutdown",t),console.log("Will wait for the following services at shutdown",t);(new h.FSBLDependencyManager).shutdown.waitFor({services:t},this.shutdown.attemptQuit.bind(this.shutdown))}restart(){this.shutdown.transmitRestartRequest()}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaUtilInstance=void 0;const i=n(r(4)),o=r(18),s=n(r(196));t.SchemaUtilInstance=new class{constructor(){this.generatedDocLines=[],this.knownPropertiesMap={},this.previousLevel=0}formatValidationErrors(e){let t={errorList:[],errorListWithMoreDetails:e};for(let r=0;r<e.length;r++){let n={configPathOfError:e[r].dataPath,errorMessage:e[r].message,errorData:JSON.stringify(e[r].params)};t.errorList.push(n)}return t}schemaValidate(e,t,r,n){let o=!1;try{var s=e.getSchema(r);s(n)?(console.log("JSON Schema Validation: No Errors"),i.default.system.log("JSON Schema Validation: Done With No Errors"),o=!0):i.default.system.error("forceObjectsToLogger","JSON Schema Validation Errors",this.formatValidationErrors(s.errors),"manifest",n,"schema",t)}catch(e){console.log("schemaValidate catch: ",e,t,n),i.default.system.error("forceObjectsToLogger","schemaValidate catch",e,t,n)}return o}async validateConfig(e,t){console.log("JSON Schema Validation: validateConfig",t,e),i.default.system.debug("forceObjectsToLogger","JSON Schema Validation: validateConfig",t,e);let r=null,n=!1,a={allErrors:!0,verbose:!0,useDefaults:"empty"};if(this.finsembleSchema&&this.ajv)n=!0;else try{this.finsembleSchema=await o.ConfigUtilInstance.getFile(e.finsemble.configSchemaURL,e=>{e&&console.error("getFile error: "+e)}),this.ajv=new s.default(a),this.ajv.addSchema(this.finsembleSchema,"Finsemble"),n=!0}catch(e){i.default.system.error("validateConfig: Error thrown reading or adding schema: "+e)}return n?(i.default.system.debug("ConfigService: schema read",this.finsembleSchema),this.schemaValidate(this.ajv,this.finsembleSchema,t,e)||(r="Failure validating config against schema")):(i.default.system.error("Failure reading config schema. Confirm the schema URL configured in finsemble.configSchemaURL is correct and the file contains a valid JSON schema."),r="Failure reading config schema"),r}setDefaultForForOneProperty(e,t,r){i.default.system.debug(`setDefaultForForOneProperty: ${t}=${r}`);let n=null,o=e,s=t.split("%%");for(let e=1;e<s.length-1;e++){let t=s[e];if(t.includes("%&%")){let e=t.split("%&%"),r=e[0],n=e[1];o=o[r][n]}else o[t]||(o[t]={}),o=o[t]}let a=s[s.length-1];n=o[a],void 0===n&&(o[a]=r,i.default.system.debug(`config-default-set property: path=${t}, originalPropertyValue=${n} defaultValue=${r},`))}getAdditionalProperties(e,t){i.default.system.debug("getAdditionalProperties for "+t);let r=e,n=t.split("%%");for(let e=1;e<n.length;e++){let t=n[e];r[t]||(r[t]={}),r=r[t]}let o=Object.keys(r),s=[];for(let e of o){let r=`${t}%%${e}`;this.knownPropertiesMap[r]||s.push(e)}return i.default.system.debug("getAdditionalProperties-additionalProperties for "+t,s,o),s}getLengthOfArrayInConfig(e,t){i.default.system.debug("getLengthOfArrayInConfig for "+t);let r=0,n=e,o=t.split("%%");for(let e=1;e<o.length;e++){let t=o[e];if(t.includes("%&%")){let e=t.split("%&%"),r=e[0],i=e[1];n=n[r][i]}else n=n[t];if(!n)break}return n&&Array.isArray(n)&&(r=n.length,i.default.system.debug(`getLengthOfArrayInConfig value is ${r} for path=${t}`,n)),r}recursiveWalkerForDefaults(e,t,r,n,o,s){if(i.default.system.verbose(`recursiveWalkerForDefaults: level ${s} path=${o} default=${r}`),r instanceof Object&&"forceDefaults"in r&&(t=r.forceDefaults),r.default&&t&&this.setDefaultForForOneProperty(e,o,r.default),++s>=50)i.default.system.warn(`recursiveWalkerForDefaults stopped due to excessive schema depth although could be a valid circular dependency: level ${s} path=${o} default=${r}`);else{if(r.$ref){let i=r.$ref.replace("#/definitions/","");this.recursiveWalkerForDefaults(e,t,this.finsembleSchema.definitions[i],n,""+o,--s)}if(r.items){"array"===r.type||Array.isArray(r.type)||i.default.system.error("recursiveWalkerForDefaults expected items of type array for "+o,r);let a=this.getLengthOfArrayInConfig(e,o);for(let l=0;l<a;l++){let a=`${o}%&%${l}`;i.default.system.debug("processing items for "+a,r.items),this.recursiveWalkerForDefaults(e,t,r.items,n,""+a,s)}}if(r.properties){let i=Object.keys(r.properties);for(let a of i){let i=`${o}%%${a}`;a!=n&&"object"==typeof r.properties[a]&&(this.knownPropertiesMap[i]=!0,this.recursiveWalkerForDefaults(e,t,r.properties[a],a,""+i,s))}}if(r.additionalProperties){let a=this.getAdditionalProperties(e,o);for(let l=0;l<a.length;l++){let u=`${o}%%${a[l]}`;i.default.system.debug("processing additionalProperties for "+u,r.additionalProperties),this.recursiveWalkerForDefaults(e,t,r.additionalProperties,n,""+u,s)}}}--s}async initializeSchema(e){let t=!0;return this.finsembleSchema||(this.finsembleSchema=await o.ConfigUtilInstance.getFile(e)),this.finsembleSchema||(i.default.system.error("Failure reading config schema. Confirm the schema URL configured in finsemble.configSchemaURL is correct and the file contains a valid JSON schema."),t=!1),t}async walkSchemaAndSetConfigDefaults(e){i.default.system.debug("walkSchemaAndSetConfigDefaults Starting"),console.log("walkSchemaAndSetConfigDefaults",e);await this.initializeSchema(e.finsemble.configSchemaURL)?this.recursiveWalkerForDefaults(e,!0,this.finsembleSchema.definitions.ManifestSubschema,"ManifestSubschema","",0):i.default.system.error("Failure to initialize schema so config defaults not initialized."),i.default.system.debug("walkSchemaAndSetConfigDefaults Done")}}},function(e,t,r){"use strict";var n=r(197),i=r(96),o=r(201),s=r(109),a=r(110),l=r(202),u=r(203),c=r(224),d=r(61);e.exports=y,y.prototype.validate=function(e,t){var r;if("string"==typeof e){if(!(r=this.getSchema(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var n=this._addSchema(e);r=n.validate||this._compile(n)}var i=r(t);!0!==r.$async&&(this.errors=r.errors);return i},y.prototype.compile=function(e,t){var r=this._addSchema(e,void 0,t);return r.validate||this._compile(r)},y.prototype.addSchema=function(e,t,r,n){if(Array.isArray(e)){for(var o=0;o<e.length;o++)this.addSchema(e[o],void 0,r,n);return this}var s=this._getId(e);if(void 0!==s&&"string"!=typeof s)throw new Error("schema id must be string");return _(this,t=i.normalizeId(t||s)),this._schemas[t]=this._addSchema(e,r,n,!0),this},y.prototype.addMetaSchema=function(e,t,r){return this.addSchema(e,t,r,!0),this},y.prototype.validateSchema=function(e,t){var r=e.$schema;if(void 0!==r&&"string"!=typeof r)throw new Error("$schema must be a string");if(!(r=r||this._opts.defaultMeta||function(e){var t=e._opts.meta;return e._opts.defaultMeta="object"==typeof t?e._getId(t)||t:e.getSchema(p)?p:void 0,e._opts.defaultMeta}(this)))return this.logger.warn("meta-schema not available"),this.errors=null,!0;var n=this.validate(r,e);if(!n&&t){var i="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(i);this.logger.error(i)}return n},y.prototype.getSchema=function(e){var t=v(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return function(e,t){var r=i.schema.call(e,{schema:{}},t);if(r){var o=r.schema,a=r.root,l=r.baseId,u=n.call(e,o,a,void 0,l);return e._fragments[t]=new s({ref:t,fragment:!0,schema:o,root:a,baseId:l,validate:u}),u}}(this,e)}},y.prototype.removeSchema=function(e){if(e instanceof RegExp)return b(this,this._schemas,e),b(this,this._refs,e),this;switch(typeof e){case"undefined":return b(this,this._schemas),b(this,this._refs),this._cache.clear(),this;case"string":var t=v(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],delete this._refs[e],this;case"object":var r=this._opts.serialize,n=r?r(e):e;this._cache.del(n);var o=this._getId(e);o&&(o=i.normalizeId(o),delete this._schemas[o],delete this._refs[o])}return this},y.prototype.addFormat=function(e,t){"string"==typeof t&&(t=new RegExp(t));return this._formats[e]=t,this},y.prototype.errorsText=function(e,t){if(!(e=e||this.errors))return"No errors";for(var r=void 0===(t=t||{}).separator?", ":t.separator,n=void 0===t.dataVar?"data":t.dataVar,i="",o=0;o<e.length;o++){var s=e[o];s&&(i+=n+s.dataPath+" "+s.message+r)}return i.slice(0,-r.length)},y.prototype._addSchema=function(e,t,r,n){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var o=this._opts.serialize,a=o?o(e):e,l=this._cache.get(a);if(l)return l;n=n||!1!==this._opts.addUsedSchema;var u=i.normalizeId(this._getId(e));u&&n&&_(this,u);var c,d=!1!==this._opts.validateSchema&&!t;d&&!(c=u&&u==i.normalizeId(e.$schema))&&this.validateSchema(e,!0);var f=i.ids.call(this,e),h=new s({id:u,schema:e,localRefs:f,cacheKey:a,meta:r});"#"!=u[0]&&n&&(this._refs[u]=h);this._cache.put(a,h),d&&c&&this.validateSchema(e,!0);return h},y.prototype._compile=function(e,t){if(e.compiling)return e.validate=o,o.schema=e.schema,o.errors=null,o.root=t||o,!0===e.schema.$async&&(o.$async=!0),o;var r,i;e.compiling=!0,e.meta&&(r=this._opts,this._opts=this._metaOpts);try{i=n.call(this,e.schema,t,e.localRefs)}catch(t){throw delete e.validate,t}finally{e.compiling=!1,e.meta&&(this._opts=r)}return e.validate=i,e.refs=i.refs,e.refVal=i.refVal,e.root=i.root,i;function o(){var t=e.validate,r=t.apply(this,arguments);return o.errors=t.errors,r}},y.prototype.compileAsync=r(225);var f=r(226);y.prototype.addKeyword=f.add,y.prototype.getKeyword=f.get,y.prototype.removeKeyword=f.remove,y.prototype.validateKeyword=f.validate;var h=r(98);y.ValidationError=h.Validation,y.MissingRefError=h.MissingRef,y.$dataMetaSchema=c;var p="http://json-schema.org/draft-07/schema",m=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],g=["/properties"];function y(e){if(!(this instanceof y))return new y(e);e=this._opts=d.copy(e)||{},function(e){var t=e._opts.logger;if(!1===t)e.logger={log:E,warn:E,error:E};else{if(void 0===t&&(t=console),!("object"==typeof t&&t.log&&t.warn&&t.error))throw new Error("logger must implement log, warn and error methods");e.logger=t}}(this),this._schemas={},this._refs={},this._fragments={},this._formats=l(e.format),this._cache=e.cache||new o,this._loadingSchemas={},this._compilations=[],this.RULES=u(),this._getId=function(e){switch(e.schemaId){case"auto":return C;case"id":return w;default:return S}}(e),e.loopRequired=e.loopRequired||1/0,"property"==e.errorDataPath&&(e._errorDataPathProperty=!0),void 0===e.serialize&&(e.serialize=a),this._metaOpts=function(e){for(var t=d.copy(e._opts),r=0;r<m.length;r++)delete t[m[r]];return t}(this),e.formats&&function(e){for(var t in e._opts.formats){var r=e._opts.formats[t];e.addFormat(t,r)}}(this),e.keywords&&function(e){for(var t in e._opts.keywords){var r=e._opts.keywords[t];e.addKeyword(t,r)}}(this),function(e){var t;e._opts.$data&&(t=r(229),e.addMetaSchema(t,t.$id,!0));if(!1===e._opts.meta)return;var n=r(116);e._opts.$data&&(n=c(n,g));e.addMetaSchema(n,p,!0),e._refs["http://json-schema.org/schema"]=p}(this),"object"==typeof e.meta&&this.addMetaSchema(e.meta),e.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),function(e){var t=e._opts.schemas;if(!t)return;if(Array.isArray(t))e.addSchema(t);else for(var r in t)e.addSchema(t[r],r)}(this)}function v(e,t){return t=i.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function b(e,t,r){for(var n in t){var i=t[n];i.meta||r&&!r.test(n)||(e._cache.del(i.cacheKey),delete t[n])}}function w(e){return e.$id&&this.logger.warn("schema $id ignored",e.$id),e.id}function S(e){return e.id&&this.logger.warn("schema id ignored",e.id),e.$id}function C(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function _(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function E(){}},function(e,t,r){"use strict";var n=r(96),i=r(61),o=r(98),s=r(110),a=r(111),l=i.ucs2length,u=r(97),c=o.Validation;function d(e,t,r){var n=h.call(this,e,t,r);return n>=0?{index:n,compiling:!0}:(n=this._compilations.length,this._compilations[n]={schema:e,root:t,baseId:r},{index:n,compiling:!1})}function f(e,t,r){var n=h.call(this,e,t,r);n>=0&&this._compilations.splice(n,1)}function h(e,t,r){for(var n=0;n<this._compilations.length;n++){var i=this._compilations[n];if(i.schema==e&&i.root==t&&i.baseId==r)return n}return-1}function p(e,t){return"var pattern"+e+" = new RegExp("+i.toQuotedString(t[e])+");"}function m(e){return"var default"+e+" = defaults["+e+"];"}function g(e,t){return void 0===t[e]?"":"var refVal"+e+" = refVal["+e+"];"}function y(e){return"var customRule"+e+" = customRules["+e+"];"}function v(e,t){if(!e.length)return"";for(var r="",n=0;n<e.length;n++)r+=t(n,e);return r}e.exports=function e(t,r,h,b){var w=this,S=this._opts,C=[void 0],_={},E=[],P={},T=[],k={},A=[];r=r||{schema:t,refVal:C,refs:_};var O=d.call(this,t,r,b),L=this._compilations[O.index];if(O.compiling)return L.callValidate=function e(){var t=L.validate,r=t.apply(this,arguments);return e.errors=t.errors,r};var I=this._formats,D=this.RULES;try{var R=j(t,r,h,b);L.validate=R;var F=L.callValidate;return F&&(F.schema=R.schema,F.errors=null,F.refs=R.refs,F.refVal=R.refVal,F.root=R.root,F.$async=R.$async,S.sourceCode&&(F.source=R.source)),R}finally{f.call(this,t,r,b)}function j(t,s,d,f){var h=!s||s&&s.schema==t;if(s.schema!=r.schema)return e.call(w,t,s,d,f);var b,P=!0===t.$async,k=a({isTop:!0,schema:t,isRoot:h,baseId:f,root:s,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:o.MissingRef,RULES:D,validate:a,util:i,resolve:n,resolveRef:W,usePattern:x,useDefault:$,useCustomRule:B,opts:S,formats:I,logger:w.logger,self:w});k=v(C,g)+v(E,p)+v(T,m)+v(A,y)+k,S.processCode&&(k=S.processCode(k));try{b=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",k)(w,D,I,r,C,T,A,u,l,c),C[0]=b}catch(e){throw w.logger.error("Error compiling schema, function code:",k),e}return b.schema=t,b.errors=null,b.refs=_,b.refVal=C,b.root=h?b:s,P&&(b.$async=!0),!0===S.sourceCode&&(b.source={code:k,patterns:E,defaults:T}),b}function W(t,i,o){i=n.url(t,i);var s,a,l=_[i];if(void 0!==l)return N(s=C[l],a="refVal["+l+"]");if(!o&&r.refs){var u=r.refs[i];if(void 0!==u)return N(s=r.refVal[u],a=M(i,s))}a=M(i);var c=n.call(w,j,r,i);if(void 0===c){var d=h&&h[i];d&&(c=n.inlineRef(d,S.inlineRefs)?d:e.call(w,d,r,h,t))}if(void 0!==c)return function(e,t){var r=_[e];C[r]=t}(i,c),N(c,a);!function(e){delete _[e]}(i)}function M(e,t){var r=C.length;return C[r]=t,_[e]=r,"refVal"+r}function N(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&!!e.$async}}function x(e){var t=P[e];return void 0===t&&(t=P[e]=E.length,E[t]=e),"pattern"+t}function $(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return i.toQuotedString(e);case"object":if(null===e)return"null";var t=s(e),r=k[t];return void 0===r&&(r=k[t]=T.length,T[r]=e),"default"+r}}function B(e,t,r,n){if(!1!==w._opts.validateSchema){var i=e.definition.dependencies;if(i&&!i.every((function(e){return Object.prototype.hasOwnProperty.call(r,e)})))throw new Error("parent schema must have all required keywords: "+i.join(","));var o=e.definition.validateSchema;if(o)if(!o(t)){var s="keyword schema is invalid: "+w.errorsText(o.errors);if("log"!=w._opts.validateSchema)throw new Error(s);w.logger.error(s)}}var a,l=e.definition.compile,u=e.definition.inline,c=e.definition.macro;if(l)a=l.call(w,t,r,n);else if(c)a=c.call(w,t,r,n),!1!==S.validateSchema&&w.validateSchema(a,!0);else if(u)a=u.call(w,n,e.keyword,t,r);else if(!(a=e.definition.validate))return;if(void 0===a)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var d=A.length;return A[d]=a,{code:"customRule"+d,validate:a}}}},function(e,t,r){
/** @license URI.js v4.2.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */
!function(e){"use strict";function t(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(t.length>1){t[0]=t[0].slice(0,-1);for(var n=t.length-1,i=1;i<n;++i)t[i]=t[i].slice(1,-1);return t[n]=t[n].slice(1),t.join("")}return t[0]}function r(e){return"(?:"+e+")"}function n(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function i(e){return e.toUpperCase()}function o(e){var n=t("[0-9]","[A-Fa-f]"),i=r(r("%[EFef]"+n+"%"+n+n+"%"+n+n)+"|"+r("%[89A-Fa-f]"+n+"%"+n+n)+"|"+r("%"+n+n)),o="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",s=t("[\\:\\/\\?\\#\\[\\]\\@]",o),a=e?"[\\uE000-\\uF8FF]":"[]",l=t("[A-Za-z]","[0-9]","[\\-\\.\\_\\~]",e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]"),u=r("[A-Za-z]"+t("[A-Za-z]","[0-9]","[\\+\\-\\.]")+"*"),c=r(r(i+"|"+t(l,o,"[\\:]"))+"*"),d=(r(r("25[0-5]")+"|"+r("2[0-4][0-9]")+"|"+r("1[0-9][0-9]")+"|"+r("[1-9][0-9]")+"|[0-9]"),r(r("25[0-5]")+"|"+r("2[0-4][0-9]")+"|"+r("1[0-9][0-9]")+"|"+r("0?[1-9][0-9]")+"|0?0?[0-9]")),f=r(d+"\\."+d+"\\."+d+"\\."+d),h=r(n+"{1,4}"),p=r(r(h+"\\:"+h)+"|"+f),m=r(r(h+"\\:")+"{6}"+p),g=r("\\:\\:"+r(h+"\\:")+"{5}"+p),y=r(r(h)+"?\\:\\:"+r(h+"\\:")+"{4}"+p),v=r(r(r(h+"\\:")+"{0,1}"+h)+"?\\:\\:"+r(h+"\\:")+"{3}"+p),b=r(r(r(h+"\\:")+"{0,2}"+h)+"?\\:\\:"+r(h+"\\:")+"{2}"+p),w=r(r(r(h+"\\:")+"{0,3}"+h)+"?\\:\\:"+h+"\\:"+p),S=r(r(r(h+"\\:")+"{0,4}"+h)+"?\\:\\:"+p),C=r(r(r(h+"\\:")+"{0,5}"+h)+"?\\:\\:"+h),_=r(r(r(h+"\\:")+"{0,6}"+h)+"?\\:\\:"),E=r([m,g,y,v,b,w,S,C,_].join("|")),P=r(r(l+"|"+i)+"+"),T=(r(E+"\\%25"+P),r(E+r("\\%25|\\%(?!"+n+"{2})")+P)),k=r("[vV]"+n+"+\\."+t(l,o,"[\\:]")+"+"),A=r("\\["+r(T+"|"+E+"|"+k)+"\\]"),O=r(r(i+"|"+t(l,o))+"*"),L=r(A+"|"+f+"(?!"+O+")|"+O),I=r("[0-9]*"),D=r(r(c+"@")+"?"+L+r("\\:"+I)+"?"),R=r(i+"|"+t(l,o,"[\\:\\@]")),F=r(R+"*"),j=r(R+"+"),W=r(r(i+"|"+t(l,o,"[\\@]"))+"+"),M=r(r("\\/"+F)+"*"),N=r("\\/"+r(j+M)+"?"),x=r(W+M),$=r(j+M),B="(?!"+R+")",U=(r(M+"|"+N+"|"+x+"|"+$+"|"+B),r(r(R+"|"+t("[\\/\\?]",a))+"*")),V=r(r(R+"|[\\/\\?]")+"*"),H=r(r("\\/\\/"+D+M)+"|"+N+"|"+$+"|"+B),q=r(u+"\\:"+H+r("\\?"+U)+"?"+r("\\#"+V)+"?"),z=r(r("\\/\\/"+D+M)+"|"+N+"|"+x+"|"+B),G=r(z+r("\\?"+U)+"?"+r("\\#"+V)+"?");return r(q+"|"+G),r(u+"\\:"+H+r("\\?"+U)+"?"),r(r("\\/\\/("+r("("+c+")@")+"?("+L+")"+r("\\:("+I+")")+"?)")+"?("+M+"|"+N+"|"+$+"|"+B+")"),r("\\?("+U+")"),r("\\#("+V+")"),r(r("\\/\\/("+r("("+c+")@")+"?("+L+")"+r("\\:("+I+")")+"?)")+"?("+M+"|"+N+"|"+x+"|"+B+")"),r("\\?("+U+")"),r("\\#("+V+")"),r(r("\\/\\/("+r("("+c+")@")+"?("+L+")"+r("\\:("+I+")")+"?)")+"?("+M+"|"+N+"|"+$+"|"+B+")"),r("\\?("+U+")"),r("\\#("+V+")"),r("("+c+")@"),r("\\:("+I+")"),{NOT_SCHEME:new RegExp(t("[^]","[A-Za-z]","[0-9]","[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",l,o),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",l,o),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",l,o),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",l,o),"g"),NOT_QUERY:new RegExp(t("[^\\%]",l,o,"[\\:\\@\\/\\?]",a),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",l,o,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",l,o),"g"),UNRESERVED:new RegExp(l,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",l,s),"g"),PCT_ENCODED:new RegExp(i,"g"),IPV4ADDRESS:new RegExp("^("+f+")$"),IPV6ADDRESS:new RegExp("^\\[?("+E+")"+r(r("\\%25|\\%(?!"+n+"{2})")+"("+P+")")+"?\\]?$")}}var s=o(!1),a=o(!0),l=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=2147483647,c=/^xn--/,d=/[^\0-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,m=String.fromCharCode;function g(e){throw new RangeError(h[e])}function y(e,t){var r=e.split("@"),n="";r.length>1&&(n=r[0]+"@",e=r[1]);var i=function(e,t){for(var r=[],n=e.length;n--;)r[n]=t(e[n]);return r}((e=e.replace(f,".")).split("."),t).join(".");return n+i}function v(e){for(var t=[],r=0,n=e.length;r<n;){var i=e.charCodeAt(r++);if(i>=55296&&i<=56319&&r<n){var o=e.charCodeAt(r++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),r--)}else t.push(i)}return t}var b=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},w=function(e,t,r){var n=0;for(e=r?p(e/700):e>>1,e+=p(e/t);e>455;n+=36)e=p(e/35);return p(n+36*e/(e+38))},S=function(e){var t,r=[],n=e.length,i=0,o=128,s=72,a=e.lastIndexOf("-");a<0&&(a=0);for(var l=0;l<a;++l)e.charCodeAt(l)>=128&&g("not-basic"),r.push(e.charCodeAt(l));for(var c=a>0?a+1:0;c<n;){for(var d=i,f=1,h=36;;h+=36){c>=n&&g("invalid-input");var m=(t=e.charCodeAt(c++))-48<10?t-22:t-65<26?t-65:t-97<26?t-97:36;(m>=36||m>p((u-i)/f))&&g("overflow"),i+=m*f;var y=h<=s?1:h>=s+26?26:h-s;if(m<y)break;var v=36-y;f>p(u/v)&&g("overflow"),f*=v}var b=r.length+1;s=w(i-d,b,0==d),p(i/b)>u-o&&g("overflow"),o+=p(i/b),i%=b,r.splice(i++,0,o)}return String.fromCodePoint.apply(String,r)},C=function(e){var t=[],r=(e=v(e)).length,n=128,i=0,o=72,s=!0,a=!1,l=void 0;try{for(var c,d=e[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var f=c.value;f<128&&t.push(m(f))}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}var h=t.length,y=h;for(h&&t.push("-");y<r;){var S=u,C=!0,_=!1,E=void 0;try{for(var P,T=e[Symbol.iterator]();!(C=(P=T.next()).done);C=!0){var k=P.value;k>=n&&k<S&&(S=k)}}catch(e){_=!0,E=e}finally{try{!C&&T.return&&T.return()}finally{if(_)throw E}}var A=y+1;S-n>p((u-i)/A)&&g("overflow"),i+=(S-n)*A,n=S;var O=!0,L=!1,I=void 0;try{for(var D,R=e[Symbol.iterator]();!(O=(D=R.next()).done);O=!0){var F=D.value;if(F<n&&++i>u&&g("overflow"),F==n){for(var j=i,W=36;;W+=36){var M=W<=o?1:W>=o+26?26:W-o;if(j<M)break;var N=j-M,x=36-M;t.push(m(b(M+N%x,0))),j=p(N/x)}t.push(m(b(j,0))),o=w(i,A,y==h),i=0,++y}}}catch(e){L=!0,I=e}finally{try{!O&&R.return&&R.return()}finally{if(L)throw I}}++i,++n}return t.join("")},_=function(e){return y(e,(function(e){return d.test(e)?"xn--"+C(e):e}))},E=function(e){return y(e,(function(e){return c.test(e)?S(e.slice(4).toLowerCase()):e}))},P={};function T(e){var t=e.charCodeAt(0);return t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase()}function k(e){for(var t="",r=0,n=e.length;r<n;){var i=parseInt(e.substr(r+1,2),16);if(i<128)t+=String.fromCharCode(i),r+=3;else if(i>=194&&i<224){if(n-r>=6){var o=parseInt(e.substr(r+4,2),16);t+=String.fromCharCode((31&i)<<6|63&o)}else t+=e.substr(r,6);r+=6}else if(i>=224){if(n-r>=9){var s=parseInt(e.substr(r+4,2),16),a=parseInt(e.substr(r+7,2),16);t+=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}else t+=e.substr(r,9);r+=9}else t+=e.substr(r,3),r+=3}return t}function A(e,t){function r(e){var r=k(e);return r.match(t.UNRESERVED)?r:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,r).replace(t.NOT_USERINFO,T).replace(t.PCT_ENCODED,i)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_HOST,T).replace(t.PCT_ENCODED,i)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,r).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,T).replace(t.PCT_ENCODED,i)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,r).replace(t.NOT_QUERY,T).replace(t.PCT_ENCODED,i)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,r).replace(t.NOT_FRAGMENT,T).replace(t.PCT_ENCODED,i)),e}function O(e){return e.replace(/^0*(.*)/,"$1")||"0"}function L(e,t){var r=e.match(t.IPV4ADDRESS)||[],n=l(r,2)[1];return n?n.split(".").map(O).join("."):e}function I(e,t){var r=e.match(t.IPV6ADDRESS)||[],n=l(r,3),i=n[1],o=n[2];if(i){for(var s=i.toLowerCase().split("::").reverse(),a=l(s,2),u=a[0],c=a[1],d=c?c.split(":").map(O):[],f=u.split(":").map(O),h=t.IPV4ADDRESS.test(f[f.length-1]),p=h?7:8,m=f.length-p,g=Array(p),y=0;y<p;++y)g[y]=d[y]||f[m+y]||"";h&&(g[p-1]=L(g[p-1],t));var v=g.reduce((function(e,t,r){if(!t||"0"===t){var n=e[e.length-1];n&&n.index+n.length===r?n.length++:e.push({index:r,length:1})}return e}),[]).sort((function(e,t){return t.length-e.length}))[0],b=void 0;if(v&&v.length>1){var w=g.slice(0,v.index),S=g.slice(v.index+v.length);b=w.join(":")+"::"+S.join(":")}else b=g.join(":");return o&&(b+="%"+o),b}return e}var D=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,R=void 0==="".match(/(){0}/)[1];function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={},n=!1!==t.iri?a:s;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);var i=e.match(D);if(i){R?(r.scheme=i[1],r.userinfo=i[3],r.host=i[4],r.port=parseInt(i[5],10),r.path=i[6]||"",r.query=i[7],r.fragment=i[8],isNaN(r.port)&&(r.port=i[5])):(r.scheme=i[1]||void 0,r.userinfo=-1!==e.indexOf("@")?i[3]:void 0,r.host=-1!==e.indexOf("//")?i[4]:void 0,r.port=parseInt(i[5],10),r.path=i[6]||"",r.query=-1!==e.indexOf("?")?i[7]:void 0,r.fragment=-1!==e.indexOf("#")?i[8]:void 0,isNaN(r.port)&&(r.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?i[4]:void 0)),r.host&&(r.host=I(L(r.host,n),n)),void 0!==r.scheme||void 0!==r.userinfo||void 0!==r.host||void 0!==r.port||r.path||void 0!==r.query?void 0===r.scheme?r.reference="relative":void 0===r.fragment?r.reference="absolute":r.reference="uri":r.reference="same-document",t.reference&&"suffix"!==t.reference&&t.reference!==r.reference&&(r.error=r.error||"URI is not a "+t.reference+" reference.");var o=P[(t.scheme||r.scheme||"").toLowerCase()];if(t.unicodeSupport||o&&o.unicodeSupport)A(r,n);else{if(r.host&&(t.domainHost||o&&o.domainHost))try{r.host=_(r.host.replace(n.PCT_ENCODED,k).toLowerCase())}catch(e){r.error=r.error||"Host's domain name can not be converted to ASCII via punycode: "+e}A(r,s)}o&&o.parse&&o.parse(r,t)}else r.error=r.error||"URI can not be parsed.";return r}function j(e,t){var r=!1!==t.iri?a:s,n=[];return void 0!==e.userinfo&&(n.push(e.userinfo),n.push("@")),void 0!==e.host&&n.push(I(L(String(e.host),r),r).replace(r.IPV6ADDRESS,(function(e,t,r){return"["+t+(r?"%25"+r:"")+"]"}))),"number"==typeof e.port&&(n.push(":"),n.push(e.port.toString(10))),n.length?n.join(""):void 0}var W=/^\.\.?\//,M=/^\/\.(\/|$)/,N=/^\/\.\.(\/|$)/,x=/^\/?(?:.|\n)*?(?=\/|$)/;function $(e){for(var t=[];e.length;)if(e.match(W))e=e.replace(W,"");else if(e.match(M))e=e.replace(M,"/");else if(e.match(N))e=e.replace(N,"/"),t.pop();else if("."===e||".."===e)e="";else{var r=e.match(x);if(!r)throw new Error("Unexpected dot segment condition");var n=r[0];e=e.slice(n.length),t.push(n)}return t.join("")}function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.iri?a:s,n=[],i=P[(t.scheme||e.scheme||"").toLowerCase()];if(i&&i.serialize&&i.serialize(e,t),e.host)if(r.IPV6ADDRESS.test(e.host));else if(t.domainHost||i&&i.domainHost)try{e.host=t.iri?E(e.host):_(e.host.replace(r.PCT_ENCODED,k).toLowerCase())}catch(r){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+r}A(e,r),"suffix"!==t.reference&&e.scheme&&(n.push(e.scheme),n.push(":"));var o=j(e,t);if(void 0!==o&&("suffix"!==t.reference&&n.push("//"),n.push(o),e.path&&"/"!==e.path.charAt(0)&&n.push("/")),void 0!==e.path){var l=e.path;t.absolutePath||i&&i.absolutePath||(l=$(l)),void 0===o&&(l=l.replace(/^\/\//,"/%2F")),n.push(l)}return void 0!==e.query&&(n.push("?"),n.push(e.query)),void 0!==e.fragment&&(n.push("#"),n.push(e.fragment)),n.join("")}function U(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3],i={};return n||(e=F(B(e,r),r),t=F(B(t,r),r)),!(r=r||{}).tolerant&&t.scheme?(i.scheme=t.scheme,i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=$(t.path||""),i.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=$(t.path||""),i.query=t.query):(t.path?("/"===t.path.charAt(0)?i.path=$(t.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?i.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:i.path=t.path:i.path="/"+t.path,i.path=$(i.path)),i.query=t.query):(i.path=e.path,void 0!==t.query?i.query=t.query:i.query=e.query),i.userinfo=e.userinfo,i.host=e.host,i.port=e.port),i.scheme=e.scheme),i.fragment=t.fragment,i}function V(e,t){return e&&e.toString().replace(t&&t.iri?a.PCT_ENCODED:s.PCT_ENCODED,k)}var H={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){return e.port!==("https"!==String(e.scheme).toLowerCase()?80:443)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}},q={scheme:"https",domainHost:H.domainHost,parse:H.parse,serialize:H.serialize},z={},G="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",Q="[0-9A-Fa-f]",K=r(r("%[EFef]"+Q+"%"+Q+Q+"%"+Q+Q)+"|"+r("%[89A-Fa-f]"+Q+"%"+Q+Q)+"|"+r("%"+Q+Q)),Y=t("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),J=new RegExp(G,"g"),X=new RegExp(K,"g"),Z=new RegExp(t("[^]","[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]","[\\.]",'[\\"]',Y),"g"),ee=new RegExp(t("[^]",G,"[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]"),"g"),te=ee;function re(e){var t=k(e);return t.match(J)?t:e}var ne={scheme:"mailto",parse:function(e,t){var r=e,n=r.to=r.path?r.path.split(","):[];if(r.path=void 0,r.query){for(var i=!1,o={},s=r.query.split("&"),a=0,l=s.length;a<l;++a){var u=s[a].split("=");switch(u[0]){case"to":for(var c=u[1].split(","),d=0,f=c.length;d<f;++d)n.push(c[d]);break;case"subject":r.subject=V(u[1],t);break;case"body":r.body=V(u[1],t);break;default:i=!0,o[V(u[0],t)]=V(u[1],t)}}i&&(r.headers=o)}r.query=void 0;for(var h=0,p=n.length;h<p;++h){var m=n[h].split("@");if(m[0]=V(m[0]),t.unicodeSupport)m[1]=V(m[1],t).toLowerCase();else try{m[1]=_(V(m[1],t).toLowerCase())}catch(e){r.error=r.error||"Email address's domain name can not be converted to ASCII via punycode: "+e}n[h]=m.join("@")}return r},serialize:function(e,t){var r,n=e,o=null!=(r=e.to)?r instanceof Array?r:"number"!=typeof r.length||r.split||r.setInterval||r.call?[r]:Array.prototype.slice.call(r):[];if(o){for(var s=0,a=o.length;s<a;++s){var l=String(o[s]),u=l.lastIndexOf("@"),c=l.slice(0,u).replace(X,re).replace(X,i).replace(Z,T),d=l.slice(u+1);try{d=t.iri?E(d):_(V(d,t).toLowerCase())}catch(e){n.error=n.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+e}o[s]=c+"@"+d}n.path=o.join(",")}var f=e.headers=e.headers||{};e.subject&&(f.subject=e.subject),e.body&&(f.body=e.body);var h=[];for(var p in f)f[p]!==z[p]&&h.push(p.replace(X,re).replace(X,i).replace(ee,T)+"="+f[p].replace(X,re).replace(X,i).replace(te,T));return h.length&&(n.query=h.join("&")),n}},ie=/^([^\:]+)\:(.*)/,oe={scheme:"urn",parse:function(e,t){var r=e.path&&e.path.match(ie),n=e;if(r){var i=t.scheme||n.scheme||"urn",o=r[1].toLowerCase(),s=r[2],a=i+":"+(t.nid||o),l=P[a];n.nid=o,n.nss=s,n.path=void 0,l&&(n=l.parse(n,t))}else n.error=n.error||"URN can not be parsed.";return n},serialize:function(e,t){var r=t.scheme||e.scheme||"urn",n=e.nid,i=r+":"+(t.nid||n),o=P[i];o&&(e=o.serialize(e,t));var s=e,a=e.nss;return s.path=(n||t.nid)+":"+a,s}},se=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,ae={scheme:"urn:uuid",parse:function(e,t){var r=e;return r.uuid=r.nss,r.nss=void 0,t.tolerant||r.uuid&&r.uuid.match(se)||(r.error=r.error||"UUID is not valid."),r},serialize:function(e,t){var r=e;return r.nss=(e.uuid||"").toLowerCase(),r}};P[H.scheme]=H,P[q.scheme]=q,P[ne.scheme]=ne,P[oe.scheme]=oe,P[ae.scheme]=ae,e.SCHEMES=P,e.pctEncChar=T,e.pctDecChars=k,e.parse=F,e.removeDotSegments=$,e.serialize=B,e.resolveComponents=U,e.resolve=function(e,t,r){var n=function(e,t){var r=e;if(t)for(var n in t)r[n]=t[n];return r}({scheme:"null"},r);return B(U(F(e,n),F(t,n),n,!0),n)},e.normalize=function(e,t){return"string"==typeof e?e=B(F(e,t),t):"object"===n(e)&&(e=F(B(e,t),t)),e},e.equal=function(e,t,r){return"string"==typeof e?e=B(F(e,r),r):"object"===n(e)&&(e=B(e,r)),"string"==typeof t?t=B(F(t,r),r):"object"===n(t)&&(t=B(t,r)),e===t},e.escapeComponent=function(e,t){return e&&e.toString().replace(t&&t.iri?a.ESCAPE:s.ESCAPE,T)},e.unescapeComponent=V,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,r){"use strict";e.exports=function(e){for(var t,r=0,n=e.length,i=0;i<n;)r++,(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<n&&56320==(64512&(t=e.charCodeAt(i)))&&i++;return r}},function(e,t,r){"use strict";var n=e.exports=function(e,t,r){"function"==typeof t&&(r=t,t={}),function e(t,r,i,o,s,a,l,u,c,d){if(o&&"object"==typeof o&&!Array.isArray(o)){for(var f in r(o,s,a,l,u,c,d),o){var h=o[f];if(Array.isArray(h)){if(f in n.arrayKeywords)for(var p=0;p<h.length;p++)e(t,r,i,h[p],s+"/"+f+"/"+p,a,s,f,o,p)}else if(f in n.propsKeywords){if(h&&"object"==typeof h)for(var m in h)e(t,r,i,h[m],s+"/"+f+"/"+m.replace(/~/g,"~0").replace(/\//g,"~1"),a,s,f,o,m)}else(f in n.keywords||t.allKeys&&!(f in n.skipKeywords))&&e(t,r,i,h,s+"/"+f,a,s,f,o)}i(o,s,a,l,u,c,d)}}(t,"function"==typeof(r=t.cb||r)?r:r.pre||function(){},r.post||function(){},e,"",e)};n.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},n.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},n.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},n.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}},function(e,t,r){"use strict";var n=e.exports=function(){this._cache={}};n.prototype.put=function(e,t){this._cache[e]=t},n.prototype.get=function(e){return this._cache[e]},n.prototype.del=function(e){delete this._cache[e]},n.prototype.clear=function(){this._cache={}}},function(e,t,r){"use strict";var n=r(61),i=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,o=[0,31,28,31,30,31,30,31,31,30,31,30,31],s=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,a=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,l=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,u=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,c=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,d=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,f=/^(?:\/(?:[^~/]|~0|~1)*)*$/,h=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,p=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;function m(e){return e="full"==e?"full":"fast",n.copy(m[e])}function g(e){var t=e.match(i);if(!t)return!1;var r=+t[1],n=+t[2],s=+t[3];return n>=1&&n<=12&&s>=1&&s<=(2==n&&function(e){return e%4==0&&(e%100!=0||e%400==0)}(r)?29:o[n])}function y(e,t){var r=e.match(s);if(!r)return!1;var n=r[1],i=r[2],o=r[3],a=r[5];return(n<=23&&i<=59&&o<=59||23==n&&59==i&&60==o)&&(!t||a)}e.exports=m,m.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":u,url:c,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:a,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:S,uuid:d,"json-pointer":f,"json-pointer-uri-fragment":h,"relative-json-pointer":p},m.full={date:g,time:y,"date-time":function(e){var t=e.split(v);return 2==t.length&&g(t[0])&&y(t[1],!0)},uri:function(e){return b.test(e)&&l.test(e)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":u,url:c,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:a,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:S,uuid:d,"json-pointer":f,"json-pointer-uri-fragment":h,"relative-json-pointer":p};var v=/t|\s/i;var b=/\/|:/;var w=/[^\\]\\Z/;function S(e){if(w.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}}},function(e,t,r){"use strict";var n=r(204),i=r(61).toHash;e.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"];return e.all=i(t),e.types=i(["number","integer","string","array","object","boolean","null"]),e.forEach((function(r){r.rules=r.rules.map((function(r){var i;if("object"==typeof r){var o=Object.keys(r)[0];i=r[o],r=o,i.forEach((function(r){t.push(r),e.all[r]=!0}))}return t.push(r),e.all[r]={keyword:r,code:n[r],implements:i}})),e.all.$comment={keyword:"$comment",code:n.$comment},r.type&&(e.types[r.type]=r)})),e.keywords=i(t.concat(["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"])),e.custom={},e}},function(e,t,r){"use strict";e.exports={$ref:r(205),allOf:r(206),anyOf:r(207),$comment:r(208),const:r(209),contains:r(210),dependencies:r(211),enum:r(212),format:r(213),if:r(214),items:r(215),maximum:r(112),minimum:r(112),maxItems:r(113),minItems:r(113),maxLength:r(114),minLength:r(114),maxProperties:r(115),minProperties:r(115),multipleOf:r(216),not:r(217),oneOf:r(218),pattern:r(219),properties:r(220),propertyNames:r(221),required:r(222),uniqueItems:r(223),validate:r(111)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i,o=" ",s=e.level,a=e.dataLevel,l=e.schema[t],u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(a||""),f="valid"+s;if("#"==l||"#/"==l)e.isRoot?(n=e.async,i="validate"):(n=!0===e.root.schema.$async,i="root.refVal[0]");else{var h=e.resolveRef(e.baseId,l,e.isRoot);if(void 0===h){var p=e.MissingRefError.message(e.baseId,l);if("fail"==e.opts.missingRefs){e.logger.error(p),(v=v||[]).push(o),o="",!1!==e.createErrors?(o+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { ref: '"+e.util.escapeQuotes(l)+"' } ",!1!==e.opts.messages&&(o+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(l)+"' "),e.opts.verbose&&(o+=" , schema: "+e.util.toQuotedString(l)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var m=o;o=v.pop(),!e.compositeRule&&c?e.async?o+=" throw new ValidationError(["+m+"]); ":o+=" validate.errors = ["+m+"]; return false; ":o+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(o+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,l,p);e.logger.warn(p),c&&(o+=" if (true) { ")}}else if(h.inline){var g=e.util.copy(e);g.level++;var y="valid"+g.level;g.schema=h.schema,g.schemaPath="",g.errSchemaPath=l,o+=" "+e.validate(g).replace(/validate\.schema/g,h.code)+" ",c&&(o+=" if ("+y+") { ")}else n=!0===h.$async||e.async&&!1!==h.$async,i=h.code}if(i){var v;(v=v||[]).push(o),o="",e.opts.passContext?o+=" "+i+".call(this, ":o+=" "+i+"( ",o+=" "+d+", (dataPath || '')",'""'!=e.errorPath&&(o+=" + "+e.errorPath);var b=o+=" , "+(a?"data"+(a-1||""):"parentData")+" , "+(a?e.dataPathArr[a]:"parentDataProperty")+", rootData)  ";if(o=v.pop(),n){if(!e.async)throw new Error("async schema referenced by sync schema");c&&(o+=" var "+f+"; "),o+=" try { await "+b+"; ",c&&(o+=" "+f+" = true; "),o+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",c&&(o+=" "+f+" = false; "),o+=" } ",c&&(o+=" if ("+f+") { ")}else o+=" if (!"+b+") { if (vErrors === null) vErrors = "+i+".errors; else vErrors = vErrors.concat("+i+".errors); errors = vErrors.length; } ",c&&(o+=" else { ")}return o}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,a=!e.opts.allErrors,l=e.util.copy(e),u="";l.level++;var c="valid"+l.level,d=l.baseId,f=!0,h=i;if(h)for(var p,m=-1,g=h.length-1;m<g;)p=h[m+=1],(e.opts.strictKeywords?"object"==typeof p&&Object.keys(p).length>0:e.util.schemaHasRules(p,e.RULES.all))&&(f=!1,l.schema=p,l.schemaPath=o+"["+m+"]",l.errSchemaPath=s+"/"+m,n+="  "+e.validate(l)+" ",l.baseId=d,a&&(n+=" if ("+c+") { ",u+="}"));return a&&(n+=f?" if (true) { ":" "+u.slice(0,-1)+" "),n=e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="valid"+i,f="errs__"+i,h=e.util.copy(e),p="";h.level++;var m="valid"+h.level;if(s.every((function(t){return e.opts.strictKeywords?"object"==typeof t&&Object.keys(t).length>0:e.util.schemaHasRules(t,e.RULES.all)}))){var g=h.baseId;n+=" var "+f+" = errors; var "+d+" = false;  ";var y=e.compositeRule;e.compositeRule=h.compositeRule=!0;var v=s;if(v)for(var b,w=-1,S=v.length-1;w<S;)b=v[w+=1],h.schema=b,h.schemaPath=a+"["+w+"]",h.errSchemaPath=l+"/"+w,n+="  "+e.validate(h)+" ",h.baseId=g,n+=" "+d+" = "+d+" || "+m+"; if (!"+d+") { ",p+="}";e.compositeRule=h.compositeRule=y,n+=" "+p+" if (!"+d+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; "),n+=" } else {  errors = "+f+"; if (vErrors !== null) { if ("+f+") vErrors.length = "+f+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } "),n=e.util.cleanUpCode(n)}else u&&(n+=" if (true) { ");return n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.schema[t],o=e.errSchemaPath+"/"+t,s=(e.opts.allErrors,e.util.toQuotedString(i));return!0===e.opts.$comment?n+=" console.log("+s+");":"function"==typeof e.opts.$comment&&(n+=" self._opts.$comment("+s+", "+e.util.toQuotedString(o)+", validate.root.schema);"),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="valid"+i,f=e.opts.$data&&s&&s.$data;f&&(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; "),f||(n+=" var schema"+i+" = validate.schema"+a+";"),n+="var "+d+" = equal("+c+", schema"+i+"); if (!"+d+") {   ";var h=h||[];h.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValue: schema"+i+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to constant' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var p=n;return n=h.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+p+"]); ":n+=" validate.errors = ["+p+"]; return false; ":n+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",u&&(n+=" else { "),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="valid"+i,f="errs__"+i,h=e.util.copy(e);h.level++;var p="valid"+h.level,m="i"+i,g=h.dataLevel=e.dataLevel+1,y="data"+g,v=e.baseId,b=e.opts.strictKeywords?"object"==typeof s&&Object.keys(s).length>0:e.util.schemaHasRules(s,e.RULES.all);if(n+="var "+f+" = errors;var "+d+";",b){var w=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.schema=s,h.schemaPath=a,h.errSchemaPath=l,n+=" var "+p+" = false; for (var "+m+" = 0; "+m+" < "+c+".length; "+m+"++) { ",h.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers,!0);var S=c+"["+m+"]";h.dataPathArr[g]=m;var C=e.validate(h);h.baseId=v,e.util.varOccurences(C,y)<2?n+=" "+e.util.varReplace(C,y,S)+" ":n+=" var "+y+" = "+S+"; "+C+" ",n+=" if ("+p+") break; }  ",e.compositeRule=h.compositeRule=w,n+="  if (!"+p+") {"}else n+=" if ("+c+".length == 0) {";var _=_||[];_.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should contain a valid item' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var E=n;return n=_.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+E+"]); ":n+=" validate.errors = ["+E+"]; return false; ":n+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { ",b&&(n+="  errors = "+f+"; if (vErrors !== null) { if ("+f+") vErrors.length = "+f+"; else vErrors = null; } "),e.opts.allErrors&&(n+=" } "),n=e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="errs__"+i,f=e.util.copy(e),h="";f.level++;var p="valid"+f.level,m={},g={},y=e.opts.ownProperties;for(S in s){var v=s[S],b=Array.isArray(v)?g:m;b[S]=v}n+="var "+d+" = errors;";var w=e.errorPath;for(var S in n+="var missing"+i+";",g)if((b=g[S]).length){if(n+=" if ( "+c+e.util.getProperty(S)+" !== undefined ",y&&(n+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(S)+"') "),u){n+=" && ( ";var C=b;if(C)for(var _=-1,E=C.length-1;_<E;){L=C[_+=1],_&&(n+=" || "),n+=" ( ( "+(F=c+(R=e.util.getProperty(L)))+" === undefined ",y&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(L)+"') "),n+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?L:R)+") ) "}n+=")) {  ";var P="missing"+i,T="' + "+P+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(w,P,!0):w+" + "+P);var k=k||[];k.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(S)+"', missingProperty: '"+T+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",1==b.length?n+="property "+e.util.escapeQuotes(b[0]):n+="properties "+e.util.escapeQuotes(b.join(", ")),n+=" when property "+e.util.escapeQuotes(S)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var A=n;n=k.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+A+"]); ":n+=" validate.errors = ["+A+"]; return false; ":n+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{n+=" ) { ";var O=b;if(O)for(var L,I=-1,D=O.length-1;I<D;){L=O[I+=1];var R=e.util.getProperty(L),F=(T=e.util.escapeQuotes(L),c+R);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(w,L,e.opts.jsonPointers)),n+=" if ( "+F+" === undefined ",y&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(L)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(S)+"', missingProperty: '"+T+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",1==b.length?n+="property "+e.util.escapeQuotes(b[0]):n+="properties "+e.util.escapeQuotes(b.join(", ")),n+=" when property "+e.util.escapeQuotes(S)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}n+=" }   ",u&&(h+="}",n+=" else { ")}e.errorPath=w;var j=f.baseId;for(var S in m){v=m[S];(e.opts.strictKeywords?"object"==typeof v&&Object.keys(v).length>0:e.util.schemaHasRules(v,e.RULES.all))&&(n+=" "+p+" = true; if ( "+c+e.util.getProperty(S)+" !== undefined ",y&&(n+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(S)+"') "),n+=") { ",f.schema=v,f.schemaPath=a+e.util.getProperty(S),f.errSchemaPath=l+"/"+e.util.escapeFragment(S),n+="  "+e.validate(f)+" ",f.baseId=j,n+=" }  ",u&&(n+=" if ("+p+") { ",h+="}"))}return u&&(n+="   "+h+" if ("+d+" == errors) {"),n=e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="valid"+i,f=e.opts.$data&&s&&s.$data;f&&(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ");var h="i"+i,p="schema"+i;f||(n+=" var "+p+" = validate.schema"+a+";"),n+="var "+d+";",f&&(n+=" if (schema"+i+" === undefined) "+d+" = true; else if (!Array.isArray(schema"+i+")) "+d+" = false; else {"),n+=d+" = false;for (var "+h+"=0; "+h+"<"+p+".length; "+h+"++) if (equal("+c+", "+p+"["+h+"])) { "+d+" = true; break; }",f&&(n+="  }  "),n+=" if (!"+d+") {   ";var m=m||[];m.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValues: schema"+i+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var g=n;return n=m.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+g+"]); ":n+=" validate.errors = ["+g+"]; return false; ":n+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",u&&(n+=" else { "),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||"");if(!1===e.opts.format)return u&&(n+=" if (true) { "),n;var d,f=e.opts.$data&&s&&s.$data;f?(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",d="schema"+i):d=s;var h=e.opts.unknownFormats,p=Array.isArray(h);if(f){n+=" var "+(m="format"+i)+" = formats["+d+"]; var "+(g="isObject"+i)+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+(y="formatType"+i)+" = "+g+" && "+m+".type || 'string'; if ("+g+") { ",e.async&&(n+=" var async"+i+" = "+m+".async; "),n+=" "+m+" = "+m+".validate; } if (  ",f&&(n+=" ("+d+" !== undefined && typeof "+d+" != 'string') || "),n+=" (","ignore"!=h&&(n+=" ("+d+" && !"+m+" ",p&&(n+=" && self._opts.unknownFormats.indexOf("+d+") == -1 "),n+=") || "),n+=" ("+m+" && "+y+" == '"+r+"' && !(typeof "+m+" == 'function' ? ",e.async?n+=" (async"+i+" ? await "+m+"("+c+") : "+m+"("+c+")) ":n+=" "+m+"("+c+") ",n+=" : "+m+".test("+c+"))))) {"}else{var m;if(!(m=e.formats[s])){if("ignore"==h)return e.logger.warn('unknown format "'+s+'" ignored in schema at path "'+e.errSchemaPath+'"'),u&&(n+=" if (true) { "),n;if(p&&h.indexOf(s)>=0)return u&&(n+=" if (true) { "),n;throw new Error('unknown format "'+s+'" is used in schema at path "'+e.errSchemaPath+'"')}var g,y=(g="object"==typeof m&&!(m instanceof RegExp)&&m.validate)&&m.type||"string";if(g){var v=!0===m.async;m=m.validate}if(y!=r)return u&&(n+=" if (true) { "),n;if(v){if(!e.async)throw new Error("async format in sync schema");n+=" if (!(await "+(b="formats"+e.util.getProperty(s)+".validate")+"("+c+"))) { "}else{n+=" if (! ";var b="formats"+e.util.getProperty(s);g&&(b+=".validate"),n+="function"==typeof m?" "+b+"("+c+") ":" "+b+".test("+c+") ",n+=") { "}}var w=w||[];w.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { format:  ",n+=f?""+d:""+e.util.toQuotedString(s),n+="  } ",!1!==e.opts.messages&&(n+=" , message: 'should match format \"",n+=f?"' + "+d+" + '":""+e.util.escapeQuotes(s),n+="\"' "),e.opts.verbose&&(n+=" , schema:  ",n+=f?"validate.schema"+a:""+e.util.toQuotedString(s),n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var S=n;return n=w.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+S+"]); ":n+=" validate.errors = ["+S+"]; return false; ":n+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",u&&(n+=" else { "),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="valid"+i,f="errs__"+i,h=e.util.copy(e);h.level++;var p="valid"+h.level,m=e.schema.then,g=e.schema.else,y=void 0!==m&&(e.opts.strictKeywords?"object"==typeof m&&Object.keys(m).length>0:e.util.schemaHasRules(m,e.RULES.all)),v=void 0!==g&&(e.opts.strictKeywords?"object"==typeof g&&Object.keys(g).length>0:e.util.schemaHasRules(g,e.RULES.all)),b=h.baseId;if(y||v){var w;h.createErrors=!1,h.schema=s,h.schemaPath=a,h.errSchemaPath=l,n+=" var "+f+" = errors; var "+d+" = true;  ";var S=e.compositeRule;e.compositeRule=h.compositeRule=!0,n+="  "+e.validate(h)+" ",h.baseId=b,h.createErrors=!0,n+="  errors = "+f+"; if (vErrors !== null) { if ("+f+") vErrors.length = "+f+"; else vErrors = null; }  ",e.compositeRule=h.compositeRule=S,y?(n+=" if ("+p+") {  ",h.schema=e.schema.then,h.schemaPath=e.schemaPath+".then",h.errSchemaPath=e.errSchemaPath+"/then",n+="  "+e.validate(h)+" ",h.baseId=b,n+=" "+d+" = "+p+"; ",y&&v?n+=" var "+(w="ifClause"+i)+" = 'then'; ":w="'then'",n+=" } ",v&&(n+=" else { ")):n+=" if (!"+p+") { ",v&&(h.schema=e.schema.else,h.schemaPath=e.schemaPath+".else",h.errSchemaPath=e.errSchemaPath+"/else",n+="  "+e.validate(h)+" ",h.baseId=b,n+=" "+d+" = "+p+"; ",y&&v?n+=" var "+(w="ifClause"+i)+" = 'else'; ":w="'else'",n+=" } "),n+=" if (!"+d+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { failingKeyword: "+w+" } ",!1!==e.opts.messages&&(n+=" , message: 'should match \"' + "+w+" + '\" schema' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; "),n+=" }   ",u&&(n+=" else { "),n=e.util.cleanUpCode(n)}else u&&(n+=" if (true) { ");return n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="valid"+i,f="errs__"+i,h=e.util.copy(e),p="";h.level++;var m="valid"+h.level,g="i"+i,y=h.dataLevel=e.dataLevel+1,v="data"+y,b=e.baseId;if(n+="var "+f+" = errors;var "+d+";",Array.isArray(s)){var w=e.schema.additionalItems;if(!1===w){n+=" "+d+" = "+c+".length <= "+s.length+"; ";var S=l;l=e.errSchemaPath+"/additionalItems",n+="  if (!"+d+") {   ";var C=C||[];C.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+s.length+" } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have more than "+s.length+" items' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var _=n;n=C.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+_+"]); ":n+=" validate.errors = ["+_+"]; return false; ":n+=" var err = "+_+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",l=S,u&&(p+="}",n+=" else { ")}var E=s;if(E)for(var P,T=-1,k=E.length-1;T<k;)if(P=E[T+=1],e.opts.strictKeywords?"object"==typeof P&&Object.keys(P).length>0:e.util.schemaHasRules(P,e.RULES.all)){n+=" "+m+" = true; if ("+c+".length > "+T+") { ";var A=c+"["+T+"]";h.schema=P,h.schemaPath=a+"["+T+"]",h.errSchemaPath=l+"/"+T,h.errorPath=e.util.getPathExpr(e.errorPath,T,e.opts.jsonPointers,!0),h.dataPathArr[y]=T;var O=e.validate(h);h.baseId=b,e.util.varOccurences(O,v)<2?n+=" "+e.util.varReplace(O,v,A)+" ":n+=" var "+v+" = "+A+"; "+O+" ",n+=" }  ",u&&(n+=" if ("+m+") { ",p+="}")}if("object"==typeof w&&(e.opts.strictKeywords?"object"==typeof w&&Object.keys(w).length>0:e.util.schemaHasRules(w,e.RULES.all))){h.schema=w,h.schemaPath=e.schemaPath+".additionalItems",h.errSchemaPath=e.errSchemaPath+"/additionalItems",n+=" "+m+" = true; if ("+c+".length > "+s.length+") {  for (var "+g+" = "+s.length+"; "+g+" < "+c+".length; "+g+"++) { ",h.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);A=c+"["+g+"]";h.dataPathArr[y]=g;O=e.validate(h);h.baseId=b,e.util.varOccurences(O,v)<2?n+=" "+e.util.varReplace(O,v,A)+" ":n+=" var "+v+" = "+A+"; "+O+" ",u&&(n+=" if (!"+m+") break; "),n+=" } }  ",u&&(n+=" if ("+m+") { ",p+="}")}}else if(e.opts.strictKeywords?"object"==typeof s&&Object.keys(s).length>0:e.util.schemaHasRules(s,e.RULES.all)){h.schema=s,h.schemaPath=a,h.errSchemaPath=l,n+="  for (var "+g+" = 0; "+g+" < "+c+".length; "+g+"++) { ",h.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);A=c+"["+g+"]";h.dataPathArr[y]=g;O=e.validate(h);h.baseId=b,e.util.varOccurences(O,v)<2?n+=" "+e.util.varReplace(O,v,A)+" ":n+=" var "+v+" = "+A+"; "+O+" ",u&&(n+=" if (!"+m+") break; "),n+=" }"}return u&&(n+=" "+p+" if ("+f+" == errors) {"),n=e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(s||""),f=e.opts.$data&&a&&a.$data;f?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",n="schema"+o):n=a,i+="var division"+o+";if (",f&&(i+=" "+n+" !== undefined && ( typeof "+n+" != 'number' || "),i+=" (division"+o+" = "+d+" / "+n+", ",e.opts.multipleOfPrecision?i+=" Math.abs(Math.round(division"+o+") - division"+o+") > 1e-"+e.opts.multipleOfPrecision+" ":i+=" division"+o+" !== parseInt(division"+o+") ",i+=" ) ",f&&(i+="  )  "),i+=" ) {   ";var h=h||[];h.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { multipleOf: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be multiple of ",i+=f?"' + "+n:n+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=f?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var p=i;return i=h.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+p+"]); ":i+=" validate.errors = ["+p+"]; return false; ":i+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="errs__"+i,f=e.util.copy(e);f.level++;var h="valid"+f.level;if(e.opts.strictKeywords?"object"==typeof s&&Object.keys(s).length>0:e.util.schemaHasRules(s,e.RULES.all)){f.schema=s,f.schemaPath=a,f.errSchemaPath=l,n+=" var "+d+" = errors;  ";var p,m=e.compositeRule;e.compositeRule=f.compositeRule=!0,f.createErrors=!1,f.opts.allErrors&&(p=f.opts.allErrors,f.opts.allErrors=!1),n+=" "+e.validate(f)+" ",f.createErrors=!0,p&&(f.opts.allErrors=p),e.compositeRule=f.compositeRule=m,n+=" if ("+h+") {   ";var g=g||[];g.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be valid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var y=n;n=g.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+y+"]); ":n+=" validate.errors = ["+y+"]; return false; ":n+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } ")}else n+="  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be valid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u&&(n+=" if (false) { ");return n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="valid"+i,f="errs__"+i,h=e.util.copy(e),p="";h.level++;var m="valid"+h.level,g=h.baseId,y="prevValid"+i,v="passingSchemas"+i;n+="var "+f+" = errors , "+y+" = false , "+d+" = false , "+v+" = null; ";var b=e.compositeRule;e.compositeRule=h.compositeRule=!0;var w=s;if(w)for(var S,C=-1,_=w.length-1;C<_;)S=w[C+=1],(e.opts.strictKeywords?"object"==typeof S&&Object.keys(S).length>0:e.util.schemaHasRules(S,e.RULES.all))?(h.schema=S,h.schemaPath=a+"["+C+"]",h.errSchemaPath=l+"/"+C,n+="  "+e.validate(h)+" ",h.baseId=g):n+=" var "+m+" = true; ",C&&(n+=" if ("+m+" && "+y+") { "+d+" = false; "+v+" = ["+v+", "+C+"]; } else { ",p+="}"),n+=" if ("+m+") { "+d+" = "+y+" = true; "+v+" = "+C+"; }";return e.compositeRule=h.compositeRule=b,n+=p+"if (!"+d+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { passingSchemas: "+v+" } ",!1!==e.opts.messages&&(n+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; "),n+="} else {  errors = "+f+"; if (vErrors !== null) { if ("+f+") vErrors.length = "+f+"; else vErrors = null; }",e.opts.allErrors&&(n+=" } "),n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(s||""),f=e.opts.$data&&a&&a.$data;f?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",n="schema"+o):n=a,i+="if ( ",f&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'string') || "),i+=" !"+(f?"(new RegExp("+n+"))":e.usePattern(a))+".test("+d+") ) {   ";var h=h||[];h.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { pattern:  ",i+=f?""+n:""+e.util.toQuotedString(a),i+="  } ",!1!==e.opts.messages&&(i+=" , message: 'should match pattern \"",i+=f?"' + "+n+" + '":""+e.util.escapeQuotes(a),i+="\"' "),e.opts.verbose&&(i+=" , schema:  ",i+=f?"validate.schema"+l:""+e.util.toQuotedString(a),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var p=i;return i=h.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+p+"]); ":i+=" validate.errors = ["+p+"]; return false; ":i+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="errs__"+i,f=e.util.copy(e),h="";f.level++;var p="valid"+f.level,m="key"+i,g="idx"+i,y=f.dataLevel=e.dataLevel+1,v="data"+y,b="dataProperties"+i,w=Object.keys(s||{}),S=e.schema.patternProperties||{},C=Object.keys(S),_=e.schema.additionalProperties,E=w.length||C.length,P=!1===_,T="object"==typeof _&&Object.keys(_).length,k=e.opts.removeAdditional,A=P||T||k,O=e.opts.ownProperties,L=e.baseId,I=e.schema.required;if(I&&(!e.opts.$data||!I.$data)&&I.length<e.opts.loopRequired)var D=e.util.toHash(I);if(n+="var "+d+" = errors;var "+p+" = true;",O&&(n+=" var "+b+" = undefined;"),A){if(n+=O?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+g+"=0; "+g+"<"+b+".length; "+g+"++) { var "+m+" = "+b+"["+g+"]; ":" for (var "+m+" in "+c+") { ",E){if(n+=" var isAdditional"+i+" = !(false ",w.length)if(w.length>8)n+=" || validate.schema"+a+".hasOwnProperty("+m+") ";else{var R=w;if(R)for(var F=-1,j=R.length-1;F<j;)Q=R[F+=1],n+=" || "+m+" == "+e.util.toQuotedString(Q)+" "}if(C.length){var W=C;if(W)for(var M=-1,N=W.length-1;M<N;)ie=W[M+=1],n+=" || "+e.usePattern(ie)+".test("+m+") "}n+=" ); if (isAdditional"+i+") { "}if("all"==k)n+=" delete "+c+"["+m+"]; ";else{var x=e.errorPath,$="' + "+m+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers)),P)if(k)n+=" delete "+c+"["+m+"]; ";else{n+=" "+p+" = false; ";var B=l;l=e.errSchemaPath+"/additionalProperties",(te=te||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { additionalProperty: '"+$+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is an invalid additional property":n+="should NOT have additional properties",n+="' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var U=n;n=te.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+U+"]); ":n+=" validate.errors = ["+U+"]; return false; ":n+=" var err = "+U+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=B,u&&(n+=" break; ")}else if(T)if("failing"==k){n+=" var "+d+" = errors;  ";var V=e.compositeRule;e.compositeRule=f.compositeRule=!0,f.schema=_,f.schemaPath=e.schemaPath+".additionalProperties",f.errSchemaPath=e.errSchemaPath+"/additionalProperties",f.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var H=c+"["+m+"]";f.dataPathArr[y]=m;var q=e.validate(f);f.baseId=L,e.util.varOccurences(q,v)<2?n+=" "+e.util.varReplace(q,v,H)+" ":n+=" var "+v+" = "+H+"; "+q+" ",n+=" if (!"+p+") { errors = "+d+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+c+"["+m+"]; }  ",e.compositeRule=f.compositeRule=V}else{f.schema=_,f.schemaPath=e.schemaPath+".additionalProperties",f.errSchemaPath=e.errSchemaPath+"/additionalProperties",f.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);H=c+"["+m+"]";f.dataPathArr[y]=m;q=e.validate(f);f.baseId=L,e.util.varOccurences(q,v)<2?n+=" "+e.util.varReplace(q,v,H)+" ":n+=" var "+v+" = "+H+"; "+q+" ",u&&(n+=" if (!"+p+") break; ")}e.errorPath=x}E&&(n+=" } "),n+=" }  ",u&&(n+=" if ("+p+") { ",h+="}")}var z=e.opts.useDefaults&&!e.compositeRule;if(w.length){var G=w;if(G)for(var Q,K=-1,Y=G.length-1;K<Y;){var J=s[Q=G[K+=1]];if(e.opts.strictKeywords?"object"==typeof J&&Object.keys(J).length>0:e.util.schemaHasRules(J,e.RULES.all)){var X=e.util.getProperty(Q),Z=(H=c+X,z&&void 0!==J.default);f.schema=J,f.schemaPath=a+X,f.errSchemaPath=l+"/"+e.util.escapeFragment(Q),f.errorPath=e.util.getPath(e.errorPath,Q,e.opts.jsonPointers),f.dataPathArr[y]=e.util.toQuotedString(Q);q=e.validate(f);if(f.baseId=L,e.util.varOccurences(q,v)<2){q=e.util.varReplace(q,v,H);var ee=H}else{ee=v;n+=" var "+v+" = "+H+"; "}if(Z)n+=" "+q+" ";else{if(D&&D[Q]){n+=" if ( "+ee+" === undefined ",O&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Q)+"') "),n+=") { "+p+" = false; ";x=e.errorPath,B=l;var te,re=e.util.escapeQuotes(Q);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,Q,e.opts.jsonPointers)),l=e.errSchemaPath+"/required",(te=te||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+re+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+re+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";U=n;n=te.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+U+"]); ":n+=" validate.errors = ["+U+"]; return false; ":n+=" var err = "+U+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=B,e.errorPath=x,n+=" } else { "}else u?(n+=" if ( "+ee+" === undefined ",O&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Q)+"') "),n+=") { "+p+" = true; } else { "):(n+=" if ("+ee+" !== undefined ",O&&(n+=" &&   Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Q)+"') "),n+=" ) { ");n+=" "+q+" } "}}u&&(n+=" if ("+p+") { ",h+="}")}}if(C.length){var ne=C;if(ne)for(var ie,oe=-1,se=ne.length-1;oe<se;){J=S[ie=ne[oe+=1]];if(e.opts.strictKeywords?"object"==typeof J&&Object.keys(J).length>0:e.util.schemaHasRules(J,e.RULES.all)){f.schema=J,f.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ie),f.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ie),n+=O?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+g+"=0; "+g+"<"+b+".length; "+g+"++) { var "+m+" = "+b+"["+g+"]; ":" for (var "+m+" in "+c+") { ",n+=" if ("+e.usePattern(ie)+".test("+m+")) { ",f.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);H=c+"["+m+"]";f.dataPathArr[y]=m;q=e.validate(f);f.baseId=L,e.util.varOccurences(q,v)<2?n+=" "+e.util.varReplace(q,v,H)+" ":n+=" var "+v+" = "+H+"; "+q+" ",u&&(n+=" if (!"+p+") break; "),n+=" } ",u&&(n+=" else "+p+" = true; "),n+=" }  ",u&&(n+=" if ("+p+") { ",h+="}")}}}return u&&(n+=" "+h+" if ("+d+" == errors) {"),n=e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="errs__"+i,f=e.util.copy(e);f.level++;var h="valid"+f.level;if(n+="var "+d+" = errors;",e.opts.strictKeywords?"object"==typeof s&&Object.keys(s).length>0:e.util.schemaHasRules(s,e.RULES.all)){f.schema=s,f.schemaPath=a,f.errSchemaPath=l;var p="key"+i,m="idx"+i,g="i"+i,y="' + "+p+" + '",v="data"+(f.dataLevel=e.dataLevel+1),b="dataProperties"+i,w=e.opts.ownProperties,S=e.baseId;w&&(n+=" var "+b+" = undefined; "),n+=w?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+m+"=0; "+m+"<"+b+".length; "+m+"++) { var "+p+" = "+b+"["+m+"]; ":" for (var "+p+" in "+c+") { ",n+=" var startErrs"+i+" = errors; ";var C=p,_=e.compositeRule;e.compositeRule=f.compositeRule=!0;var E=e.validate(f);f.baseId=S,e.util.varOccurences(E,v)<2?n+=" "+e.util.varReplace(E,v,C)+" ":n+=" var "+v+" = "+C+"; "+E+" ",e.compositeRule=f.compositeRule=_,n+=" if (!"+h+") { for (var "+g+"=startErrs"+i+"; "+g+"<errors; "+g+"++) { vErrors["+g+"].propertyName = "+p+"; }   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { propertyName: '"+y+"' } ",!1!==e.opts.messages&&(n+=" , message: 'property name \\'"+y+"\\' is invalid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; "),u&&(n+=" break; "),n+=" } }"}return u&&(n+="  if ("+d+" == errors) {"),n=e.util.cleanUpCode(n)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),d="valid"+i,f=e.opts.$data&&s&&s.$data;f&&(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ");var h="schema"+i;if(!f)if(s.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var p=[],m=s;if(m)for(var g,y=-1,v=m.length-1;y<v;){g=m[y+=1];var b=e.schema.properties[g];b&&(e.opts.strictKeywords?"object"==typeof b&&Object.keys(b).length>0:e.util.schemaHasRules(b,e.RULES.all))||(p[p.length]=g)}}else p=s;if(f||p.length){var w=e.errorPath,S=f||p.length>=e.opts.loopRequired,C=e.opts.ownProperties;if(u)if(n+=" var missing"+i+"; ",S){f||(n+=" var "+h+" = validate.schema"+a+"; ");var _="' + "+(O="schema"+i+"["+(T="i"+i)+"]")+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(w,O,e.opts.jsonPointers)),n+=" var "+d+" = true; ",f&&(n+=" if (schema"+i+" === undefined) "+d+" = true; else if (!Array.isArray(schema"+i+")) "+d+" = false; else {"),n+=" for (var "+T+" = 0; "+T+" < "+h+".length; "+T+"++) { "+d+" = "+c+"["+h+"["+T+"]] !== undefined ",C&&(n+=" &&   Object.prototype.hasOwnProperty.call("+c+", "+h+"["+T+"]) "),n+="; if (!"+d+") break; } ",f&&(n+="  }  "),n+="  if (!"+d+") {   ",(A=A||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+_+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+_+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var E=n;n=A.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+E+"]); ":n+=" validate.errors = ["+E+"]; return false; ":n+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { "}else{n+=" if ( ";var P=p;if(P)for(var T=-1,k=P.length-1;T<k;){I=P[T+=1],T&&(n+=" || "),n+=" ( ( "+(j=c+(F=e.util.getProperty(I)))+" === undefined ",C&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(I)+"') "),n+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?I:F)+") ) "}n+=") {  ";var A;_="' + "+(O="missing"+i)+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(w,O,!0):w+" + "+O),(A=A||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+_+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+_+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";E=n;n=A.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+E+"]); ":n+=" validate.errors = ["+E+"]; return false; ":n+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { "}else if(S){f||(n+=" var "+h+" = validate.schema"+a+"; ");var O;_="' + "+(O="schema"+i+"["+(T="i"+i)+"]")+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(w,O,e.opts.jsonPointers)),f&&(n+=" if ("+h+" && !Array.isArray("+h+")) {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+_+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+_+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+h+" !== undefined) { "),n+=" for (var "+T+" = 0; "+T+" < "+h+".length; "+T+"++) { if ("+c+"["+h+"["+T+"]] === undefined ",C&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", "+h+"["+T+"]) "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+_+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+_+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",f&&(n+="  }  ")}else{var L=p;if(L)for(var I,D=-1,R=L.length-1;D<R;){I=L[D+=1];var F=e.util.getProperty(I),j=(_=e.util.escapeQuotes(I),c+F);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(w,I,e.opts.jsonPointers)),n+=" if ( "+j+" === undefined ",C&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(I)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+_+"' } ",!1!==e.opts.messages&&(n+=" , message: '",e.opts._errorDataPathProperty?n+="is a required property":n+="should have required property \\'"+_+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=w}else u&&(n+=" if (true) {");return n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(s||""),f="valid"+o,h=e.opts.$data&&a&&a.$data;if(h?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",n="schema"+o):n=a,(a||h)&&!1!==e.opts.uniqueItems){h&&(i+=" var "+f+"; if ("+n+" === false || "+n+" === undefined) "+f+" = true; else if (typeof "+n+" != 'boolean') "+f+" = false; else { "),i+=" var i = "+d+".length , "+f+" = true , j; if (i > 1) { ";var p=e.schema.items&&e.schema.items.type,m=Array.isArray(p);if(!p||"object"==p||"array"==p||m&&(p.indexOf("object")>=0||p.indexOf("array")>=0))i+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+d+"[i], "+d+"[j])) { "+f+" = false; break outer; } } } ";else{i+=" var itemIndices = {}, item; for (;i--;) { var item = "+d+"[i]; ";var g="checkDataType"+(m?"s":"");i+=" if ("+e.util[g](p,"item",!0)+") continue; ",m&&(i+=" if (typeof item == 'string') item = '\"' + item; "),i+=" if (typeof itemIndices[item] == 'number') { "+f+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}i+=" } ",h&&(i+="  }  "),i+=" if (!"+f+") {   ";var y=y||[];y.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var v=i;i=y.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+v+"]); ":i+=" validate.errors = ["+v+"]; return false; ":i+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",c&&(i+=" else { ")}else c&&(i+=" if (true) { ");return i}},function(e,t,r){"use strict";var n=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];e.exports=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var i,o=t[r].split("/"),s=e;for(i=1;i<o.length;i++)s=s[o[i]];for(i=0;i<n.length;i++){var a=n[i],l=s[a];l&&(s[a]={anyOf:[l,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]})}}return e}},function(e,t,r){"use strict";var n=r(98).MissingRef;e.exports=function e(t,r,i){var o=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof r&&(i=r,r=void 0);var s=a(t).then((function(){var e=o._addSchema(t,void 0,r);return e.validate||function e(t){try{return o._compile(t)}catch(e){if(e instanceof n)return i(e);throw e}function i(n){var i=n.missingSchema;if(u(i))throw new Error("Schema "+i+" is loaded but "+n.missingRef+" cannot be resolved");var s=o._loadingSchemas[i];return s||(s=o._loadingSchemas[i]=o._opts.loadSchema(i)).then(l,l),s.then((function(e){if(!u(i))return a(e).then((function(){u(i)||o.addSchema(e,i,void 0,r)}))})).then((function(){return e(t)}));function l(){delete o._loadingSchemas[i]}function u(e){return o._refs[e]||o._schemas[e]}}}(e)}));i&&s.then((function(e){i(null,e)}),i);return s;function a(t){var r=t.$schema;return r&&!o.getSchema(r)?e.call(o,{$ref:r},!0):Promise.resolve()}}},function(e,t,r){"use strict";var n=/^[a-z_$][a-z0-9_$-]*$/i,i=r(227),o=r(228);e.exports={add:function(e,t){var r=this.RULES;if(r.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!n.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){this.validateKeyword(t,!0);var o=t.type;if(Array.isArray(o))for(var s=0;s<o.length;s++)l(e,o[s],t);else l(e,o,t);var a=t.metaSchema;a&&(t.$data&&this._opts.$data&&(a={anyOf:[a,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]}),t.validateSchema=this.compile(a,!0))}function l(e,t,n){for(var o,s=0;s<r.length;s++){var a=r[s];if(a.type==t){o=a;break}}o||(o={type:t,rules:[]},r.push(o));var l={keyword:e,definition:n,custom:!0,code:i,implements:n.implements};o.rules.push(l),r.custom[e]=l}return r.keywords[e]=r.all[e]=!0,this},get:function(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1},remove:function(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var r=0;r<t.length;r++)for(var n=t[r].rules,i=0;i<n.length;i++)if(n[i].keyword==e){n.splice(i,1);break}return this},validate:function e(t,r){e.errors=null;var n=this._validateKeyword=this._validateKeyword||this.compile(o,!0);if(n(t))return!0;if(e.errors=n.errors,r)throw new Error("custom keyword definition is invalid: "+this.errorsText(n.errors));return!1}}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i,o=" ",s=e.level,a=e.dataLevel,l=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,f="data"+(a||""),h="valid"+s,p="errs__"+s,m=e.opts.$data&&l&&l.$data;m?(o+=" var schema"+s+" = "+e.util.getData(l.$data,a,e.dataPathArr)+"; ",i="schema"+s):i=l;var g,y,v,b,w,S="definition"+s,C=this.definition,_="";if(m&&C.$data){w="keywordValidate"+s;var E=C.validateSchema;o+=" var "+S+" = RULES.custom['"+t+"'].definition; var "+w+" = "+S+".validate;"}else{if(!(b=e.useCustomRule(this,l,e.schema,e)))return;i="validate.schema"+u,w=b.code,g=C.compile,y=C.inline,v=C.macro}var P=w+".errors",T="i"+s,k="ruleErr"+s,A=C.async;if(A&&!e.async)throw new Error("async keyword in sync schema");if(y||v||(o+=P+" = null;"),o+="var "+p+" = errors;var "+h+";",m&&C.$data&&(_+="}",o+=" if ("+i+" === undefined) { "+h+" = true; } else { ",E&&(_+="}",o+=" "+h+" = "+S+".validateSchema("+i+"); if ("+h+") { ")),y)C.statements?o+=" "+b.validate+" ":o+=" "+h+" = "+b.validate+"; ";else if(v){var O=e.util.copy(e);_="";O.level++;var L="valid"+O.level;O.schema=b.validate,O.schemaPath="";var I=e.compositeRule;e.compositeRule=O.compositeRule=!0;var D=e.validate(O).replace(/validate\.schema/g,w);e.compositeRule=O.compositeRule=I,o+=" "+D}else{(W=W||[]).push(o),o="",o+="  "+w+".call( ",e.opts.passContext?o+="this":o+="self",g||!1===C.schema?o+=" , "+f+" ":o+=" , "+i+" , "+f+" , validate.schema"+e.schemaPath+" ",o+=" , (dataPath || '')",'""'!=e.errorPath&&(o+=" + "+e.errorPath);var R=a?"data"+(a-1||""):"parentData",F=a?e.dataPathArr[a]:"parentDataProperty",j=o+=" , "+R+" , "+F+" , rootData )  ";o=W.pop(),!1===C.errors?(o+=" "+h+" = ",A&&(o+="await "),o+=j+"; "):o+=A?" var "+(P="customErrors"+s)+" = null; try { "+h+" = await "+j+"; } catch (e) { "+h+" = false; if (e instanceof ValidationError) "+P+" = e.errors; else throw e; } ":" "+P+" = null; "+h+" = "+j+"; "}if(C.modifying&&(o+=" if ("+R+") "+f+" = "+R+"["+F+"];"),o+=""+_,C.valid)d&&(o+=" if (true) { ");else{var W;o+=" if ( ",void 0===C.valid?(o+=" !",o+=v?""+L:""+h):o+=" "+!C.valid+" ",o+=") { ",n=this.keyword,(W=W||[]).push(o),o="",(W=W||[]).push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(o+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(o+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),o+=" } "):o+=" {} ";var M=o;o=W.pop(),!e.compositeRule&&d?e.async?o+=" throw new ValidationError(["+M+"]); ":o+=" validate.errors = ["+M+"]; return false; ":o+=" var err = "+M+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var N=o;o=W.pop(),y?C.errors?"full"!=C.errors&&(o+="  for (var "+T+"="+p+"; "+T+"<errors; "+T+"++) { var "+k+" = vErrors["+T+"]; if ("+k+".dataPath === undefined) "+k+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+k+".schemaPath === undefined) { "+k+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(o+=" "+k+".schema = "+i+"; "+k+".data = "+f+"; "),o+=" } "):!1===C.errors?o+=" "+N+" ":(o+=" if ("+p+" == errors) { "+N+" } else {  for (var "+T+"="+p+"; "+T+"<errors; "+T+"++) { var "+k+" = vErrors["+T+"]; if ("+k+".dataPath === undefined) "+k+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+k+".schemaPath === undefined) { "+k+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(o+=" "+k+".schema = "+i+"; "+k+".data = "+f+"; "),o+=" } } "):v?(o+="   var err =   ",!1!==e.createErrors?(o+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(o+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(o+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),o+=" } "):o+=" {} ",o+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?o+=" throw new ValidationError(vErrors); ":o+=" validate.errors = vErrors; return false; ")):!1===C.errors?o+=" "+N+" ":(o+=" if (Array.isArray("+P+")) { if (vErrors === null) vErrors = "+P+"; else vErrors = vErrors.concat("+P+"); errors = vErrors.length;  for (var "+T+"="+p+"; "+T+"<errors; "+T+"++) { var "+k+" = vErrors["+T+"]; if ("+k+".dataPath === undefined) "+k+".dataPath = (dataPath || '') + "+e.errorPath+";  "+k+'.schemaPath = "'+c+'";  ',e.opts.verbose&&(o+=" "+k+".schema = "+i+"; "+k+".data = "+f+"; "),o+=" } } else { "+N+" } "),o+=" } ",d&&(o+=" else { ")}return o}},function(e,t,r){"use strict";var n=r(116);e.exports={$id:"https://github.com/epoberezkin/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:n.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:n.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}},function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#","description":"Meta-schema for $data reference (JSON Schema extension proposal)","type":"object","required":["$data"],"properties":{"$data":{"type":"string","anyOf":[{"format":"relative-json-pointer"},{"format":"json-pointer"}]}},"additionalProperties":false}')},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DeprecatedConfigUtilInstance=t.SINGLE_PATH_OPERATIONS=void 0;const a=s(r(4)),l=o(r(17));t.SINGLE_PATH_OPERATIONS=["setValue","removeProperty","logMessage"];t.DeprecatedConfigUtilInstance=new class{getChildPropertyValue(e,t,r){let n;if(t.includes("[")){let i=(t=t.replace("]","[")).split("[");if(3!==i.length)throw new Error(`"illegal array syntax ${t} within ${r} so skipping`);{let t=i[0],o=i[1];if(n=e[t][o],void 0===n)throw new Error(`"undefined array element ${t}[${o}] within ${r} so skipping`)}}else n=e[t];return n}setChildPropertyValue(e,t,r,n,i){let o;if(o="object"==typeof r&&n?l.clone(r):r,t.includes("[")){let r=(t=t.replace("]","[")).split("[");if(3!==r.length)throw new Error(`"illegal array syntax ${t} within ${i} so skipping`);{let t=r[0],n=r[1];if(void 0===e[t][n])throw new Error(`"undefined array element ${t}[${n}] within ${i} so skipping`);e[t][n]=o}}else e[t]=o}findConfigPropertyValue(e,t){let r,n,i;if(t)for(r=e,i=t.split("."),n=0;n<i.length&&(r=this.getChildPropertyValue(r,i[n],t),"object"==typeof r);n++);return n<i.length-1&&(r=void 0),a.default.system.debug("DeprecatedConfigUtil.findConfigParent",t,r),r}findConfigParent(e,t){let r=t.split("."),n=e;for(let e=0;e<r.length-1;e++)r[e].includes("[")||n[r[e]]||(n[r[e]]={}),n=this.getChildPropertyValue(n,r[e],t);return a.default.system.debug("DeprecatedConfigUtil.findConfigParent",t,n),n}getLastPathProperty(e){let t=e.split(".").pop();return a.default.system.debug("DeprecatedConfigUtil.getLastPathProperty",e,t),t}copyObjectProperties(e,t,r){let n;n="object"==typeof t&&r?l.clone(t):t,Object.assign(e,n)}systemLog(e){let t=a.default.system.warn;return"error"===e&&(t=a.default.system.error),t}moveConfigProperty(e,t){let r=this.findConfigPropertyValue(e,t.oldProperty);if(void 0!==r){let n=this.findConfigParent(e,t.newProperty),i=this.getLastPathProperty(t.newProperty);if(t.addToExistingObject&&"object"==typeof n[i]&&!Array.isArray(n[i])?this.copyObjectProperties(n[i],r,t.clone):this.setChildPropertyValue(n,i,r,t.clone,t.newProperty),this.systemLog(t.userMessageType)(`${t.versionDeprecated} deprecated config ${t.oldProperty} was found and updated to ${t.newProperty}`),t.removeOld){delete this.findConfigParent(e,t.oldProperty)[this.getLastPathProperty(t.oldProperty)],a.default.system.log(`"DeprecatedConfig: ${t.oldProperty} removed`)}}else a.default.system.warn(`"DeprecatedConfig: ${t.oldProperty} not found so skipped`,t)}setPropertyValue(e,t){let r=this.findConfigPropertyValue(e,t.property);if(!t.ifOldValue||t.ifOldValue===r){this.findConfigParent(e,t.property)[this.getLastPathProperty(t.property)]=t.newValue,this.systemLog(t.userMessageType)(`${t.versionDeprecated} deprecated config value for ${t.property} set to ${t.newValue}`)}}removeProperty(e,t){let r=this.findConfigParent(e,t.property),n=this.getLastPathProperty(t.property);void 0!==r[n]&&(delete r[n],this.systemLog(t.userMessageType)(`${t.versionDeprecated} deprecated config property ${t.property} removed`))}getWildCardListItems(e,t){let r=[],n=e;if(t.includes("*")){let e=t.split(".");for(let t=0;t<e.length;t++){if("*"===e[t]){"object"==typeof n&&(r=Object.keys(n));break}if(n=n[e[t]],"object"!=typeof n)break}}return r}wildCardMismatch(e,t){let r,n=e.indexOf("*"),i=e.indexOf("*");if(-1===n)r=!1;else{r=e.substring(0,n)!==t.substring(0,i)}return r}displayDeprecationMessage(e,t){null!=this.findConfigPropertyValue(e,t.property)&&this.systemLog(t.userMessageType)(`${t.versionDeprecated} deprecated config found for ${t.property}. ${t.userMessage}`)}processDeprecatedProperty(e,r,n){try{let i;if(void 0===n.when||n.when[e])if(n.set)if(Array.isArray(n.set)){let t=n.set;delete n.set;for(let i=0;i<t.length;i++){let o=Object.keys(t[i]);for(let e=0;e<o.length;e++)n[o[e]]=t[i][o[e]];this.processDeprecatedProperty(e,r,n)}}else a.default.system.log("DeprecatedConfigUtil.processDeprecatedProperty skipping illegal set operation",n);else if(t.SINGLE_PATH_OPERATIONS.includes(n.operation))if(i=this.getWildCardListItems(r,n.property),0===i.length)switch(n.operation){case"setValue":a.default.system.debug("DeprecatedConfigUtil.setValue for property "+n.property,n),this.setPropertyValue(r,n);break;case"removeProperty":a.default.system.debug("DeprecatedConfigUtil.removeProperty for "+n.property,n),this.removeProperty(r,n);break;case"logMessage":a.default.system.debug("DeprecatedConfigUtil.logMessageOnly for "+n.property,n),this.displayDeprecationMessage(r,n)}else{let t,o=n.property.slice();for(;t=i.pop();)n.property=o.replace(".*.",`.${t}.`),this.processDeprecatedProperty(e,r,n)}else if("moveProperty"===n.operation)if(this.wildCardMismatch(n.oldProperty,n.newProperty))a.default.system.warn(`DeprecatedConfig: wildCards are mismatched for ${n.oldProperty} and ${n.newProperty} so ignoring`,n);else if(i=this.getWildCardListItems(r,n.newProperty),0===i.length)a.default.system.debug(`DeprecatedConfigUtil.moveProperty from ${n.oldProperty} to ${n.newProperty}`,n),this.moveConfigProperty(r,n);else{let t,o=n.oldProperty.slice(),s=n.newProperty.slice();for(;t=i.pop();)n.oldProperty=o.replace(".*.",`.${t}.`),n.newProperty=s.replace(".*.",`.${t}.`),this.processDeprecatedProperty(e,r,n)}else a.default.system.warn("DeprecatedConfigUtil.processDeprecatedProperty skipping unknown operation",n);else a.default.system.log("DeprecatedConfigUtil.processDeprecatedProperty skipping item because wrong context",n)}catch(e){a.default.system.error("DeprecatedConfig: error caught: "+e,n)}}modifyConfigBasedOnDeprecatedDefinitions(e,t){if(Array.isArray(t.finsemble.deprecatedConfig)){let r=t.finsemble.deprecatedConfig;for(let n=0;n<r.length;n++)a.default.system.debug("DeprecatedConfigUtil.modifyConfigBasedOnDeprecatedDefinitions processing",e,r[n]),this.processDeprecatedProperty(e,t,r[n])}return!0}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InitializeDeepLinkingTask=void 0;const i=n(r(4)),o=r(6);t.InitializeDeepLinkingTask=class{start(e){o.System.getProtocolString().then(e=>{i.default.system.log("initializeDeepLinkingTask startup "+e)}),e("initializeDeepLinkingTask","bootTasks","completed")}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InitializeSystemStateHandersTask=void 0;const a=s(r(10)),l=s(r(4)),u=o(r(25)),c=s(r(20));t.InitializeSystemStateHandersTask=class{constructor(){this.ServiceStates={}}start(e){l.default.system.debug("initializeSystemStateHandersTask start"),a.default.addPubSubResponder("AuthorizationState",{state:"undefined"}),a.default.addPubSubResponder(/WorkspaceService.*/,{state:"start"}),a.default.addPubSubResponder(u.APPLICATION_STATE_CHANNEL,{state:"initializing"},{publishCallback:(e,t)=>{l.default.system.log("APPLICATION LIFECYCLE: STATE CHANGE",t.data.state),t.sendNotifyToAllSubscribers(null,t.data)}}),a.default.addListener(u.SERVICE_INITIALIZING_CHANNEL,(e,t)=>{this.handleServiceStateChange({name:t.data.name,state:"initializing"})}),a.default.addListener(u.SERVICE_READY_CHANNEL,(e,t)=>{this.handleServiceStateChange({name:t.data.serviceName,state:"ready"})}),a.default.addListener(u.SERVICE_CLOSING_CHANNEL,(e,t)=>{this.handleServiceStateChange({name:t.data.name,state:"closing"})}),a.default.addListener(u.SERVICE_CLOSED_CHANNEL,(e,t)=>{this.handleServiceStateChange({name:t.data.name,state:"closed"})}),c.default.waitForStartup("dataStoreService",()=>{a.default.publish(u.APPLICATION_STATE_CHANNEL,{state:"configuring"})}),c.default.waitForBootStage("kernel","stageEntered",()=>{a.default.publish(u.APPLICATION_STATE_CHANNEL,{state:"initializing"})}),c.default.waitForBootStage("authentication","stageEntered",()=>{a.default.publish(u.APPLICATION_STATE_CHANNEL,{state:"authenticating"})}),c.default.waitForBootStage("authentication","stageCompleted",()=>{a.default.publish(u.APPLICATION_STATE_CHANNEL,{state:"authenticated"})}),c.default.waitForBootStage("user","stageEntered",()=>{a.default.publish(u.APPLICATION_STATE_CHANNEL,{state:"ready"})}),e("initializeSystemStateHandersTask","bootTasks","completed")}handleServiceStateChange(e){const t=e.name,r=e.state;this.ServiceStates[t]={state:r};const n="SERVICE LIFECYCLE: STATE CHANGE: Service "+r;l.default.system.log(n,t),a.default.publish("Finsemble.Service.State."+t,{state:r}),a.default.publish(u.SERVICES_STATE_CHANNEL,this.ServiceStates)}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InitializeRouterTask=void 0;const i=n(r(10)),o=n(r(4)),s=r(18),a=r(6);t.InitializeRouterTask=class{constructor(e){this.finsembleConfig=e.manifest.finsemble,this.serviceLauncher=e.serviceLauncher}start(e){const t=this.finsembleConfig,r=this.serviceLauncher.getServiceConfig("router"),n="Electron"==a.System.container,l=s.ConfigUtilInstance.getDefault(t,"finConfig.router.sameDomainTransport","SharedWorker"),u=s.ConfigUtilInstance.getDefault(t,"finConfig.router.crossDomainTransport","IPCBus");let c="FinsembleTransport"===l||"FinsembleTransport"===u;if(c=!n&&c,o.default.system.log("initializeRouterService",r,l,u,c),c){const e="ws://127.0.0.1:3376",n=s.ConfigUtilInstance.getDefault(t,"finConfig.IAC.serverAddress",e),i=s.ConfigUtilInstance.getDefault(t,"finConfig.router.transportSettings.FinsembleTransport.serverAddress",n),l=i.substring(i.lastIndexOf(":")+1);l>0&&l<65535?a.System.launchExternalProcess({alias:"FinsembleRouter",arguments:"PORT "+l,lifetype:"window",listener(e){"exited"===e.topic&&o.default.system.warn("APPLICATION LIFECYCLE: FinsembleTransport Server Exited",l,e)}},e=>{o.default.system.log("FinsembleTransport Server Launched",e,i),this.serviceLauncher.createService(r)},e=>{o.default.system.error("FinsembleTransport launchExternalProcess error.",e),this.serviceLauncher.createService(r)}):(o.default.system.error("FinsembleTransport illegal port",l),this.serviceLauncher.createService(r))}else this.serviceLauncher.createService(r);i.default.onReady(()=>{e("initializeRouterTask","bootTasks","completed")})}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InitializeFinsemblePubsubTask=void 0;const i=n(r(4)),o=n(r(10));t.InitializeFinsemblePubsubTask=class{start(e){i.default.system.debug("initializeFinsemblePubsubTask start"),o.default.addPubSubResponder(/.*Finsemble.*/,{}),e("initializeFinsemblePubsubTask","bootTasks","completed")}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WaitForAuthenticatedTask=void 0;const i=n(r(10)),o=n(r(4));t.WaitForAuthenticatedTask=class{start(e){o.default.system.debug("waitForAuthenticatedTask start"),i.default.addPubSubResponder("Authorization",{});const t=i.default.subscribe("Authorization",r=>{r||(i.default.unsubscribe(t),e("waitForAuthenticatedTask","bootTasks","completed"))})}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InitializeSystemManagerAPITask=void 0;const a=o(r(25)),l=s(r(10)),u=s(r(4)),c=r(34);t.InitializeSystemManagerAPITask=class{constructor(e){this.systemLog=e.systemLog,this.bootEngine=e.bootEngine}start(e){u.default.system.debug("initializeSystemManagerAPITask start"),l.default.addListener(c.SYSLOG_CHANNEL,(e,t)=>{t.data.params.error?this.systemLog.error(t.data.params,t.data.logMessage):t.data.params.notification?this.systemLog.notification(t.data.params,t.data.logMessage):this.systemLog.log(t.data.params,t.data.logMessage)}),l.default.addListener(a.SERVICE_START_CHANNEL,(e,t)=>{this.bootEngine.startService(t.data.name)}),e("initializeSystemManagerAPITask","bootTasks","completed")}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StartLoggerTask=void 0;const i=n(r(4));t.StartLoggerTask=class{start(e){i.default.system.debug("startLoggerTask start"),i.default.start(),e("startLoggerTask","bootTasks","completed")}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RegisterHotkeysTask=void 0;const i=n(r(4)),o=n(r(37)),s=n(r(77)),a=n(r(21));t.RegisterHotkeysTask=class{async start(e){i.default.system.debug("registerHotkeysTask start");const{data:t}=await a.default.getValue({field:"finsemble.components"});Object.keys(t).forEach(e=>{const r=t[e];if(r.component&&r.component.spawnOnHotkey){const t=()=>{o.default.spawn(e,{addToWorkspace:!0,monitor:"primary"},Function.prototype)};s.default.addGlobalHotkey(r.component.spawnOnHotkey,t)}}),e("registerHotkeysTask","bootTasks","completed")}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SetupSearchLauncherTask=void 0;const i=n(r(240)),o=n(r(95)),s=n(r(4)),a=n(r(241)),l=n(r(37)),u=n(r(10)),c=n(r(21));t.SetupSearchLauncherTask=class{constructor(){this.componentArray=[],a.default.initialize(),u.default.subscribe("Launcher.update",(e,t)=>{s.default.debug("SetupSearchLauncherTask component list updated",e,t),e||(this.componentArray=this.getRefinedComponentData(t.data.componentList))})}getRefinedComponentData(e){const t=[];for(const r in e){const n=e[r];n.foreign||(n.foreign={}),n.component||(n.component={}),n.component.type=r,t.push(n),s.default.system.debug("setupSearchLauncherTask oneConfig",r,n)}return s.default.system.debug("setupSearchLauncherTask refinedComponents",t),t}async start(e){s.default.system.debug("setupSearchLauncherTask start");const{data:t}=await c.default.getValue({field:"finsemble.servicesConfig"}),{data:r}=await c.default.getValue({field:"finsemble.components"});this.componentArray=this.getRefinedComponentData(r),s.default.system.debug("setupSearchLauncherTask config",t,this.componentArray);const n={title:null,providerActionComponent:null};t&&t.launcher&&t.launcher.searchProviderAction&&(n.title=t.launcher.searchProviderAction.title,n.providerActionComponent=t.launcher.searchProviderAction.component),a.default.onReady(()=>{a.default.register({name:"Installed Components",searchCallback:this.searchComponents.bind(this),itemActionCallback:this.searchActions.bind(this),providerActionTitle:n.title,providerActionCallback(e){s.default.system.debug("setupSearchLauncherTask providerActionCallback",e),e=e.replace("RouterClient.",""),l.default.spawn(n.providerActionComponent,{addToWorkspace:!0,monitor:"mine",relativeWindow:{windowName:e}},Function.prototype)}},()=>{e("setupSearchLauncherTask","bootTasks","completed")})})}searchComponents(e,t){const r=[];let n,s={shouldSort:!0,includeScore:!0,includeMatches:!0,threshold:.4,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:["component.displayName","component.type"]};c.default.getValue({field:"finsemble.servicesConfig.launcher.search"},(a,l)=>{if(null!=l){if(l.hasOwnProperty("enabled")&&!l.enabled)return void t(null,[]);l.hasOwnProperty("options")&&(s=o.default(s,l.options))}const u=new i.default(this.componentArray,s);n=e.text.length?u.search(e.text):JSON.parse(JSON.stringify(this.componentArray));for(let t=0;t<n.length;t++){const i=n[t];if(i.item||e.text.length||(i.item=i),i.item.foreign&&i.item.foreign.components&&i.item.foreign.components["App Launcher"]&&i.item.foreign.components["App Launcher"].launchableByUser){let e=null;i.item.window.icon&&(e={type:"url",path:i.item.window.icon}),!e&&i.item.foreign&&i.item.foreign.components&&i.item.foreign.components.Toolbar&&(i.item.foreign.components.Toolbar.iconClass?e={type:"fonticon",path:i.item.foreign.components.Toolbar.iconClass}:i.item.foreign.components.Toolbar.iconURL&&(e={type:"url",path:i.item.foreign.components.Toolbar.iconURL})),r.push({name:i.item.component.type,displayName:i.item.component.displayName||i.item.component.type,score:i.score,matches:i.matches,icon:e,type:"Application",description:"",actions:[{name:"Spawn"}],tags:[]})}}t(null,r)})}searchActions(e,t){t=t.replace("RouterClient.",""),e.action&&e.item&&"Spawn"===e.action.name&&l.default.spawn(e.item.name,{addToWorkspace:!0,monitor:"mine",relativeWindow:{windowName:t}},Function.prototype)}}},function(e,t,r){
/*!
 * Fuse.js v3.4.4 - Lightweight fuzzy-search (http://fusejs.io)
 * 
 * Copyright (c) 2012-2017 Kirollos Risk (http://kiro.me)
 * All Rights Reserved. Apache Software License 2.0
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 */
e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){e.exports=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=r(2),s=r(8),a=r(0),l=function(){function e(t,r){var n=r.location,i=void 0===n?0:n,o=r.distance,a=void 0===o?100:o,l=r.threshold,u=void 0===l?.6:l,c=r.maxPatternLength,d=void 0===c?32:c,f=r.caseSensitive,h=void 0!==f&&f,p=r.tokenSeparator,m=void 0===p?/ +/g:p,g=r.findAllMatches,y=void 0!==g&&g,v=r.minMatchCharLength,b=void 0===v?1:v,w=r.id,S=void 0===w?null:w,C=r.keys,_=void 0===C?[]:C,E=r.shouldSort,P=void 0===E||E,T=r.getFn,k=void 0===T?s:T,A=r.sortFn,O=void 0===A?function(e,t){return e.score-t.score}:A,L=r.tokenize,I=void 0!==L&&L,D=r.matchAllTokens,R=void 0!==D&&D,F=r.includeMatches,j=void 0!==F&&F,W=r.includeScore,M=void 0!==W&&W,N=r.verbose,x=void 0!==N&&N;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:a,threshold:u,maxPatternLength:d,isCaseSensitive:h,tokenSeparator:m,findAllMatches:y,minMatchCharLength:b,id:S,keys:_,includeMatches:j,includeScore:M,shouldSort:P,getFn:k,sortFn:O,verbose:x,tokenize:I,matchAllTokens:R},this.setCollection(t)}var t,r;return t=e,(r=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var r=this._prepareSearchers(e),n=r.tokenSearchers,i=r.fullSearcher,o=this._search(n,i),s=o.weights,a=o.results;return this._computeScore(s,a),this.options.shouldSort&&this._sort(a),t.limit&&"number"==typeof t.limit&&(a=a.slice(0,t.limit)),this._format(a)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var r=e.split(this.options.tokenSeparator),n=0,i=r.length;n<i;n+=1)t.push(new o(r[n],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=this.list,n={},i=[];if("string"==typeof r[0]){for(var o=0,s=r.length;o<s;o+=1)this._analyze({key:"",value:r[o],record:o,index:o},{resultMap:n,results:i,tokenSearchers:e,fullSearcher:t});return{weights:null,results:i}}for(var a={},l=0,u=r.length;l<u;l+=1)for(var c=r[l],d=0,f=this.options.keys.length;d<f;d+=1){var h=this.options.keys[d];if("string"!=typeof h){if(a[h.name]={weight:1-h.weight||1},h.weight<=0||h.weight>1)throw new Error("Key weight has to be > 0 and <= 1");h=h.name}else a[h]={weight:1};this._analyze({key:h,value:this.options.getFn(c,h),record:c,index:l},{resultMap:n,results:i,tokenSearchers:e,fullSearcher:t})}return{weights:a,results:i}}},{key:"_analyze",value:function(e,t){var r=e.key,n=e.arrayIndex,i=void 0===n?-1:n,o=e.value,s=e.record,l=e.index,u=t.tokenSearchers,c=void 0===u?[]:u,d=t.fullSearcher,f=void 0===d?[]:d,h=t.resultMap,p=void 0===h?{}:h,m=t.results,g=void 0===m?[]:m;if(null!=o){var y=!1,v=-1,b=0;if("string"==typeof o){this._log("\nKey: ".concat(""===r?"-":r));var w=f.search(o);if(this._log('Full text: "'.concat(o,'", score: ').concat(w.score)),this.options.tokenize){for(var S=o.split(this.options.tokenSeparator),C=[],_=0;_<c.length;_+=1){var E=c[_];this._log('\nPattern: "'.concat(E.pattern,'"'));for(var P=!1,T=0;T<S.length;T+=1){var k=S[T],A=E.search(k),O={};A.isMatch?(O[k]=A.score,y=!0,P=!0,C.push(A.score)):(O[k]=1,this.options.matchAllTokens||C.push(1)),this._log('Token: "'.concat(k,'", score: ').concat(O[k]))}P&&(b+=1)}v=C[0];for(var L=C.length,I=1;I<L;I+=1)v+=C[I];v/=L,this._log("Token score average:",v)}var D=w.score;v>-1&&(D=(D+v)/2),this._log("Score average:",D);var R=!this.options.tokenize||!this.options.matchAllTokens||b>=c.length;if(this._log("\nCheck Matches: ".concat(R)),(y||w.isMatch)&&R){var F=p[l];F?F.output.push({key:r,arrayIndex:i,value:o,score:D,matchedIndices:w.matchedIndices}):(p[l]={item:s,output:[{key:r,arrayIndex:i,value:o,score:D,matchedIndices:w.matchedIndices}]},g.push(p[l]))}}else if(a(o))for(var j=0,W=o.length;j<W;j+=1)this._analyze({key:r,arrayIndex:j,value:o[j],record:s,index:l},{resultMap:p,results:g,tokenSearchers:c,fullSearcher:f})}}},{key:"_computeScore",value:function(e,t){this._log("\n\nComputing score:\n");for(var r=0,n=t.length;r<n;r+=1){for(var i=t[r].output,o=i.length,s=1,a=1,l=0;l<o;l+=1){var u=e?e[i[l].key].weight:1,c=(1===u?i[l].score:i[l].score||.001)*u;1!==u?a=Math.min(a,c):(i[l].nScore=c,s*=c)}t[r].score=1===a?s:a,this._log(t[r])}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var r=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===n(t)&&null!==t){if(-1!==r.indexOf(t))return;r.push(t)}return t}))),r=null}var i=[];this.options.includeMatches&&i.push((function(e,t){var r=e.output;t.matches=[];for(var n=0,i=r.length;n<i;n+=1){var o=r[n];if(0!==o.matchedIndices.length){var s={indices:o.matchedIndices,value:o.value};o.key&&(s.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(s.arrayIndex=o.arrayIndex),t.matches.push(s)}}})),this.options.includeScore&&i.push((function(e,t){t.score=e.score}));for(var o=0,s=e.length;o<s;o+=1){var a=e[o];if(this.options.id&&(a.item=this.options.getFn(a.item,this.options.id)[0]),i.length){for(var l={item:a.item},u=0,c=i.length;u<c;u+=1)i[u](a,l);t.push(l)}else t.push(a.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&i(t.prototype,r),e}();e.exports=l},function(e,t,r){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=r(3),o=r(4),s=r(7),a=function(){function e(t,r){var n=r.location,i=void 0===n?0:n,o=r.distance,a=void 0===o?100:o,l=r.threshold,u=void 0===l?.6:l,c=r.maxPatternLength,d=void 0===c?32:c,f=r.isCaseSensitive,h=void 0!==f&&f,p=r.tokenSeparator,m=void 0===p?/ +/g:p,g=r.findAllMatches,y=void 0!==g&&g,v=r.minMatchCharLength,b=void 0===v?1:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:a,threshold:u,maxPatternLength:d,isCaseSensitive:h,tokenSeparator:m,findAllMatches:y,minMatchCharLength:b},this.pattern=this.options.isCaseSensitive?t:t.toLowerCase(),this.pattern.length<=d&&(this.patternAlphabet=s(this.pattern))}var t,r;return t=e,(r=[{key:"search",value:function(e){if(this.options.isCaseSensitive||(e=e.toLowerCase()),this.pattern===e)return{isMatch:!0,score:0,matchedIndices:[[0,e.length-1]]};var t=this.options,r=t.maxPatternLength,n=t.tokenSeparator;if(this.pattern.length>r)return i(e,this.pattern,n);var s=this.options,a=s.location,l=s.distance,u=s.threshold,c=s.findAllMatches,d=s.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:a,distance:l,threshold:u,findAllMatches:c,minMatchCharLength:d})}}])&&n(t.prototype,r),e}();e.exports=a},function(e,t){var r=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,i=new RegExp(t.replace(r,"\\$&").replace(n,"|")),o=e.match(i),s=!!o,a=[];if(s)for(var l=0,u=o.length;l<u;l+=1){var c=o[l];a.push([e.indexOf(c),c.length-1])}return{score:s?.5:1,isMatch:s,matchedIndices:a}}},function(e,t,r){var n=r(5),i=r(6);e.exports=function(e,t,r,o){for(var s=o.location,a=void 0===s?0:s,l=o.distance,u=void 0===l?100:l,c=o.threshold,d=void 0===c?.6:c,f=o.findAllMatches,h=void 0!==f&&f,p=o.minMatchCharLength,m=void 0===p?1:p,g=a,y=e.length,v=d,b=e.indexOf(t,g),w=t.length,S=[],C=0;C<y;C+=1)S[C]=0;if(-1!==b){var _=n(t,{errors:0,currentLocation:b,expectedLocation:g,distance:u});if(v=Math.min(_,v),-1!==(b=e.lastIndexOf(t,g+w))){var E=n(t,{errors:0,currentLocation:b,expectedLocation:g,distance:u});v=Math.min(E,v)}}b=-1;for(var P=[],T=1,k=w+y,A=1<<w-1,O=0;O<w;O+=1){for(var L=0,I=k;L<I;)n(t,{errors:O,currentLocation:g+I,expectedLocation:g,distance:u})<=v?L=I:k=I,I=Math.floor((k-L)/2+L);k=I;var D=Math.max(1,g-I+1),R=h?y:Math.min(g+I,y)+w,F=Array(R+2);F[R+1]=(1<<O)-1;for(var j=R;j>=D;j-=1){var W=j-1,M=r[e.charAt(W)];if(M&&(S[W]=1),F[j]=(F[j+1]<<1|1)&M,0!==O&&(F[j]|=(P[j+1]|P[j])<<1|1|P[j+1]),F[j]&A&&(T=n(t,{errors:O,currentLocation:W,expectedLocation:g,distance:u}))<=v){if(v=T,(b=W)<=g)break;D=Math.max(1,2*g-b)}}if(n(t,{errors:O+1,currentLocation:g,expectedLocation:g,distance:u})>v)break;P=F}return{isMatch:b>=0,score:0===T?.001:T,matchedIndices:i(S,m)}}},function(e,t){e.exports=function(e,t){var r=t.errors,n=void 0===r?0:r,i=t.currentLocation,o=void 0===i?0:i,s=t.expectedLocation,a=void 0===s?0:s,l=t.distance,u=void 0===l?100:l,c=n/e.length,d=Math.abs(a-o);return u?c+d/u:d?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[],n=-1,i=-1,o=0,s=e.length;o<s;o+=1){var a=e[o];a&&-1===n?n=o:a||-1===n||((i=o-1)-n+1>=t&&r.push([n,i]),n=-1)}return e[o-1]&&o-n>=t&&r.push([n,o-1]),r}},function(e,t){e.exports=function(e){for(var t={},r=e.length,n=0;n<r;n+=1)t[e.charAt(n)]=0;for(var i=0;i<r;i+=1)t[e.charAt(i)]|=1<<r-i-1;return t}},function(e,t,r){var n=r(0);e.exports=function(e,t){return function e(t,r,i){if(r){var o=r.indexOf("."),s=r,a=null;-1!==o&&(s=r.slice(0,o),a=r.slice(o+1));var l=t[s];if(null!=l)if(a||"string"!=typeof l&&"number"!=typeof l)if(n(l))for(var u=0,c=l.length;u<c;u+=1)e(l[u],a,i);else a&&e(l,a,i);else i.push(l.toString())}else i.push(t);return i}(e,t,[])}}])},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(4)),o=r(22);i.default.system.debug("Starting searchClient");class s extends o._BaseClient{constructor(){super(...arguments),this.providers={},this.resultProviders={},this.searchResultsList=[],this.isSearching=!1,this.unRegister=this.unregister,this.handleResults=(e,t)=>{t.data.searchId&&t.data.searchId==this.searchId&&(this.resultProviders[t.data.provider.channel]=t.data,this.searchResultsList.push(t.data),this.resultsCallback(null,this.searchResultsList))}}register(e,t){return e.name?e.searchCallback?void this.routerClient.query("Search.register",{name:e.name,channel:`${this.finWindow.name}.${e.name}`,providerActionTitle:e.providerActionTitle,providerActionCallback:!!e.providerActionCallback},(r,n)=>{if(r)return t?t(r):console.error(r);const i=`${this.finWindow.name}.${e.name}`;return this.providers[e.name]=e.name,this.routerClient.addResponder("Search.Provider."+i,(t,r)=>{if(t)return console.error(t);r&&e.searchCallback(r.data,(e,t)=>{r.sendQueryResponse(e,t)})}),this.routerClient.addResponder("Search.Provider.ItemAction."+i,(t,r)=>{if(t)return console.error(t);r&&e.itemActionCallback&&e.itemActionCallback(r.data,r.header.origin,(e,t)=>{r.sendQueryResponse(e,t)})}),e.providerActionCallback&&this.routerClient.addResponder("Search.Provider.Action."+i,(t,r)=>{if(t)return console.error(t);r&&e.providerActionCallback&&e.providerActionCallback(r.header.origin,(e,t)=>{r.sendQueryResponse(e,t)})}),t?t(null,n.data):null}):t("no provider callback provided"):t("no provider name provided")}unregister(e,t){if(!e.name)return t("Provider name was not provided");const r=`${this.finWindow.name}.${e.name}`;this.routerClient.query("Search.unregister",{channel:r},()=>(this.routerClient.removeResponder("Search.Provider."+r),this.routerClient.removeResponder("Search.Provider.ItemAction."+r),this.routerClient.removeResponder("Search.Provider.Action."+r),delete this.providers[e.name],t?t():null))}search(e,t){this.isSearching||(this.routerClient.addPubSubResponder("Search."+this.finWindow.name),this.routerClient.subscribe("Search."+this.finWindow.name,this.handleResults),this.isSearching=!0),this.searchResultsList=[],e.windowName=this.finWindow.name,this.routerClient.query("Search.search",e,(e,r)=>{if(e)return t(e);this.resultsCallback=t,this.searchId=r.data.searchId})}invokeItemAction(e,t){this.routerClient.query("Search.Provider.ItemAction."+e.provider,{item:e,action:t})}invokeProviderAction(e){this.routerClient.query("Search.Provider.Action."+e.channel,{})}}const a=new s({onReady(e){e&&e()},name:"searchClient"});t.default=a},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LoadUserDefinedComponentsTask=void 0;const i=r(26),o=n(r(4)),s=n(r(37)),a=n(r(60));t.LoadUserDefinedComponentsTask=class{start(e){o.default.system.debug("loadUserDefinedComponentsTask start"),a.default.onReady(()=>{a.default.get({topic:"finsemble",key:"userDefinedComponents"},(t,r)=>{const n=r||{};if(t)o.default.system.debug("loadUserDefinedComponentsTask error",t),e("loadUserDefinedComponentsTask","bootTasks","failed");else{const t=Object.keys(n);i.forEach(t,(e,t)=>{const r=n[e];s.default.addUserDefinedComponent({name:r.component.type,url:r.window.url},t)},()=>{e("loadUserDefinedComponentsTask","bootTasks","completed")})}})})}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LoadFDC3InstalledComponentsTask=void 0;const i=r(26),o=n(r(4)),s=n(r(37)),a=n(r(21)),l=n(r(78)),u=n(r(10)),c=n(r(244)),d=n(r(245));let f,h;t.LoadFDC3InstalledComponentsTask=class{start(e){o.default.system.debug("loadFDC3InstalledComponentsTask start"),a.default.getValue({field:"finsemble.appDirectoryEndpoint"},(t,r)=>{null===r?(o.default.system.debug("loadFDC3InstalledComponentsTask appDirectoryEndpoint is not set. No components to load."),e("loadFDC3InstalledComponentsTask","bootTasks","completed")):u.default.subscribe("distributedStoresLoading",(t,n)=>{t||"done"!==n.data.State||l.default.getStore({store:"Finsemble-AppLauncher-Store",global:!0},(t,n)=>{const a=n||{};let l={};if(t)o.default.system.debug("loadFDC3InstalledComponentsTask error",t),e("loadFDC3InstalledComponentsTask","bootTasks","completed");else{if(void 0===a.values||void 0===a.values.appDefinitions)return void e("loadFDC3InstalledComponentsTask","bootTasks","completed");l=a.values.appDefinitions,i.forEach(l,(e,t)=>{this.lazyLoadAppD(r),this.getApp(e.appID,(r,n)=>{r&&(console.error("There was an error loading from FDC3",e,r),t()),s.default.registerComponent({componentType:e.name,manifest:JSON.parse(n.manifest)},e=>{o.default.system.debug("loadFDC3InstalledComponentsTask err",e),t()})})},()=>{o.default.system.debug("loadFDC3InstalledComponentsTask done"),e("loadFDC3InstalledComponentsTask","bootTasks","completed")})}})})})}getApp(e,t=Function.prototype){h.get(e).then(e=>t(null,e)).catch(e=>t(e))}lazyLoadAppD(e){f||(f=new d.default({url:e})),h||(h=new c.default(f))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e){return e}},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e={},t={}){if(!e.url)throw new Error("Please specify the url of the app directory.");this.creds=t,this.config={url:e.url.replace(/\/+$/,"")}}_get(e,t){fetch(this.config.url+e,{method:"GET"}).then(e=>{e.json().then(r=>{200!==e.status?t(r):t(null,r)})}).catch(e=>{t({message:"Request failed "+e.message})})}_post(e,t,r){fetch(this.config.url+e,{method:"POST",credentials:"include",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(e=>{e.json().then(t=>{200!==e.status?r(t):r(null,t)})}).catch(e=>{r({message:"Request failed "+e.message})})}getAll(e){return new Promise((t,r)=>{this._get("/apps/",(n,i)=>{n?r(n):t(i.applications),e&&e(n,!n&&i.applications)})})}get(e,t){return new Promise((r,n)=>{this._get("/apps/"+e,(e,i)=>{let o;e?n(e):(o=i,i.applications&&i.applications.length&&(o=i.applications[0]),r(o)),t&&t(e,!e&&o)})})}getTags(e){return new Promise((t,r)=>{this._get("/tags/",(n,i)=>{n?r(n):t(i.tags),e&&e(n,!n&&i.tags)})})}search(e,t){return new Promise((r,n)=>{this._post("/apps/search",e,(e,i)=>{e?n(e):r(i.applications),t&&t(e,!e&&i.applications)})})}},e.exports=t.default},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LoadSystemTrayIconTask=void 0;const a=s(r(4)),l=s(r(37)),u=r(6),c=o(r(17)),d=s(r(21)),f=s(r(55));t.LoadSystemTrayIconTask=class{async start(e){a.default.system.debug("loadSystemTrayIconTask start"),f.default.shutdown.waitFor({},this.handleShutdown.bind(this));const{data:t}=await d.default.getValue({field:"finsemble.systemTrayIcon"});let{data:r}=await d.default.getValue({field:"finsemble.systemTrayComponent"});if(t){const e=u.System.Application.getCurrent(),n={clickListener(t){a.default.system.debug("System Tray Icon Clicked"),u.System.getMousePosition((n,i)=>{switch(t.button){case 0:l.default.getActiveDescriptors((e,t)=>{if(!e){const e=Object.keys(t);l.default.bringWindowsToFront({windowList:e})}});break;case 2:e.getTrayIconInfo(e=>{c.Monitors.getMonitorFromScaledXY(i.left,i.top,t=>{const n={spawnIfNotFound:!0,monitor:t.position,left:null,right:null,top:null,bottom:null},o=t.monitorRect,s=e.monitorInfo?e.monitorInfo.taskbar:t.taskbar;i.left-o.left<=o.right-i.left?(n.left=i.left,"left"==s.edge&&n.left<s.right&&(n.left=s.right+1)):("right"==s.edge&&i.left<s.right&&(i.left=s.right-1),n.right=o.right-i.left),i.top-o.top<=o.bottom-i.top?(n.top=i.top,"top"==s.edge&&n.top<s.top&&(n.top=s.top+1)):("bottom"==s.edge&&i.top>s.top&&(i.top=s.top-1),n.bottom=o.bottom-i.top),r&&l.default.showWindow({componentType:r},n,()=>{})})})}})}};a.default.system.log("Setting system tray icon"),e.setTrayIcon(t,n)}e("loadSystemTrayIconTask","bootTasks","completed")}removeSystemTrayIcon(){u.System.Application.getCurrent().removeTrayIcon(()=>{a.default.system.debug("System Tray Icon removed")},()=>{a.default.system.error("Unable to remove System Tray Icon")})}handleShutdown(){this.removeSystemTrayIcon()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ForceErrorTestTask=void 0;t.ForceErrorTestTask=class{start(e){e("forceErrorTestTask","bootTasks","failed")}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckpointErrorTestTask=void 0;const i=n(r(20)),o="checkpointErrorTestTask";t.CheckpointErrorTestTask=class{start(e){i.default.publishCheckpointState(o,"checkpoint1","completed"),i.default.publishCheckpointState(o,"checkpoint2","completed"),i.default.publishCheckpointState(o,"checkpoint3","completed"),i.default.publishCheckpointState(o,"checkpoint4","completed"),i.default.publishCheckpointState(o,"checkpoint5","completed"),i.default.publishCheckpointState(o,"checkpoint6","failed"),setTimeout(()=>{e(o,"bootTasks","completed")},2e3)}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckpointBadDependencyTestTask=void 0;const i=n(r(20)),o="checkpointBadDependencyTestTask";t.CheckpointBadDependencyTestTask=class{start(e){i.default.publishCheckpointState(o,"checkpoint1","completed"),i.default.publishCheckpointState(o,"checkpoint2","completed"),i.default.publishCheckpointState(o,"checkpoint3","completed"),i.default.publishCheckpointState(o,"checkpoint4","completed"),i.default.publishCheckpointState(o,"checkpoint5","completed"),i.default.publishCheckpointState(o,"checkpoint6","completed"),i.default.publishCheckpointState(o,"checkpoint7","completed"),i.default.publishCheckpointState(o,"checkpoint8","completed"),setTimeout(()=>{e(o,"bootTasks","completed")},2e3)}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckpointCircularDependencyTestTask=void 0;const i=n(r(20)),o="checkpointCircularDependencyTestTask";t.CheckpointCircularDependencyTestTask=class{start(e){i.default.publishCheckpointState(o,"checkpoint1","completed"),i.default.publishCheckpointState(o,"checkpoint2","completed"),i.default.publishCheckpointState(o,"checkpoint3","completed"),i.default.publishCheckpointState(o,"checkpoint4","completed"),i.default.publishCheckpointState(o,"checkpoint5","completed"),i.default.publishCheckpointState(o,"checkpoint6","completed"),i.default.publishCheckpointState(o,"checkpoint7","completed"),i.default.publishCheckpointState(o,"checkpoint8","completed"),setTimeout(()=>{e(o,"bootTasks","completed")},2e3)}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateServiceLauncherConfigTask=void 0;const i=n(r(21));t.UpdateServiceLauncherConfigTask=class{constructor(e){this.serviceLauncher=e.serviceLauncher}async start(e){const t=await i.default.getValue({field:"finsemble"});this.serviceLauncher.updateConfig(t.data),e("updateServiceLauncherConfigTask","bootTasks","completed")}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckForScheduledRestartTask=void 0;const i=n(r(4)),o=n(r(10)),s=n(r(21)),a=n(r(253));let l=6e4;t.CheckForScheduledRestartTask=class{start(e){i.default.system.debug("checkForScheduledRestartTask start"),this.checkForScheduledRestart(),this.dialogManager=r(108).default,this.dialogManager.initialize(),e("checkForScheduledRestartTask","bootTasks","completed")}checkForScheduledRestart(){let e=null,t=(t,r)=>{if(i.default.system.log("checkForScheduledRestart scheduleRestart.",t,r),console.log("Scheduling restart.",r),e&&clearTimeout(e),!r.value)return;let n=r.value,u=new Date;u.setHours(n.hour),u.setMinutes(n.minute);let c=+u-Date.now(),d=!1;c<=0&&(d=!0,u.setDate(u.getDate()+1),c=+u-Date.now()),i.default.system.log("checkForScheduledRestart scheduleRestart.",t,r),i.default.system.log(`APPLICATION LIFECYCLE:SCHEDULED RESTART FOR ${d?"TOMORROW":"TODAY"}:`,r.value,"diff",c),e=setTimeout(()=>{i.default.system.log("Scheduling restart"),this.dialogManager.createStore(()=>{i.default.system.log("Scheduling restart: after createStore"),this.dialogManager.open("yesNo",{monitor:"primary",title:"Automatic Restart",question:"The application will restart in one minute. Your workspace will be saved.",showTimer:!0,timerDuration:l,showNegativeButton:!1,affirmativeResponseLabel:"Restart Now"},async(e,t)=>{"cancel"===t.choice?s.default.getValue({field:"finsemble.scheduledRestart"},(e,t)=>{s.default.setPreference({field:"finsemble.scheduledRestart",value:t})}):(await a.default.save(),o.default.transmit("Application.restart",{}))})})},c)};s.default.getValue({field:"finsemble.scheduledRestart"},(e,r)=>{r&&!isNaN(r.dialogTimeout)&&(l=r.dialogTimeout),i.default.system.log("scheduledRestart initial config",r),t(e,{value:r})}),s.default.addListener({field:"finsemble.scheduledRestart"},(e,r)=>{i.default.system.log("scheduledRestart new config",r),r.value?i.default.system.log("APPLICATION LIFECYCLE:SCHEDULED RESTART TIME CHANGED. NEW TIME:",r.value):i.default.system.log("APPLICATION LIFECYCLE:SCHEDULED RESTART DISABLED."),t(e,r)})}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(22),l=o(r(17)),u=s(r(19)),c=s(r(4)),d=r(25),f=r(18);class h extends a._BaseClient{constructor(e){super(e),this.workspaces=[],this.setWorkspaces=this.setWorkspaceOrder,this.createNewWorkspace=this.createWorkspace,this.getWorkspaceDefinition=this.export,this.addWorkspaceDefinition=this.import,this.saveWorkspaceTemplateToConfigFile=this.exportToFile,u.default.args(e,"object=")&&e&&u.default.args2("params.onReady",e.onReady,"function=")}_serviceResponseHandler(e,t,r,n,i=Function.prototype){if(e)return n(new Error(e)),i(e);t||(t={data:null}),r(t.data),i(null,t.data)}saveGlobalData(e,t){c.default.system.debug("WorkspaceClient.saveGlobalData",e);return new Promise((r,n)=>{this.routerClient.query(d.WORKSPACE.API_CHANNELS.SAVE_GLOBAL_DATA,e,(e,i)=>{this._serviceResponseHandler(e,i,r,n,t)})})}saveViewData(e,t){c.default.system.debug("WorkspaceClient.saveViewData",e);return new Promise((r,n)=>{this.routerClient.query(d.WORKSPACE.API_CHANNELS.SAVE_VIEW_DATA,e,(e,i)=>{this._serviceResponseHandler(e,i,r,n,t)})})}addEventListener(e,t){super.addEventListener(e,t)}async addWindow(e,t=null){u.default.args(e,"object",t,"function=")&&e&&u.default.args2("params.name",e.name,"string");const{err:r,response:n}=await this.routerClient.query("WorkspaceService.addWindow",e,()=>{});if(c.default.system.log(`WORKSPACE LIFECYCLE: Window added:WorkspaceClient.addWindow: Name (${e.name})`),t&&t(r,n),!t&&r)throw r;return n}removeWindow(e,t=Function.prototype){u.default.args(e,"object",t,"function=")&&u.default.args2("params.name",e.name,"string"),this.routerClient.query("WorkspaceService.removeWindow",e,(r,n)=>{if(r)return c.default.system.error(r);c.default.system.log(`WORKSPACE LIFECYCLE:WorkspaceClient.removeWindow:Window removed: Name (${e.name})`),t(r,n?n.data:null)})}autoArrange(e,t=Function.prototype){u.default.args(e,"object",t,"function="),e=e||{},l.getMyWindowIdentifier(e=>{this.routerClient.query("DockingService.autoArrange",{windowIdentifier:e},t)})}minimizeAll(e,t=Function.prototype){u.default.args(e,"object",t,"function="),e=e||{monitor:"all"},l.getMyWindowIdentifier(r=>{e.windowIdentifier||(e.windowIdentifier=r),this.routerClient.query("WorkspaceService.minimizeAll",e,t)})}bringWindowsToFront(e,t=Function.prototype){u.default.args(e,"object",t,"function="),e=e||{monitor:"all"},l.getMyWindowIdentifier(r=>{e.windowIdentifier||(e.windowIdentifier=r),this.routerClient.query("WorkspaceService.bringWindowsToFront",e,t)})}async getActiveWorkspace(e){c.default.system.debug("WorkspaceClient.getActiveWorkspace");const t=(await this.routerClient.query(d.WORKSPACE.API_CHANNELS.GET_ACTIVE_WORKSPACE,{})).response;if(this.activeWorkspace=t.data,t.data.err)throw e&&e(t.data.err),new Error(t.data.err);return e&&e(null,t),t}getWorkspaces(e){u.default.args(e,"function="),c.default.system.debug("WorkspaceClient.getWorkspaces");return new Promise(async(t,r)=>{this.routerClient.query(d.WORKSPACE.API_CHANNELS.GET_WORKSPACES,{},(n,i)=>{this._serviceResponseHandler(n,i,t,r,e)})})}getWorkspaceActions(e){return e(null,d.WORKSPACE.API_CHANNELS)}getWorkspaceNames(e){u.default.args(e,"function="),c.default.system.debug("WorkspaceClient.getWorkspaceNames");return new Promise(async(t,r)=>{this.routerClient.query(d.WORKSPACE.API_CHANNELS.GET_WORKSPACE_NAMES,{},(n,i)=>{this._serviceResponseHandler(n,i,t,r,e)})})}setWorkspaceOrder(e,t){const{workspaces:r}=e;u.default.args(t,"function"),c.default.system.debug("WorkspaceClient.setWorkspaceOrder",e);return new Promise((n,i)=>{this.routerClient.query(d.WORKSPACE.API_CHANNELS.SET_WORKSPACE_ORDER,r||e,(e,r)=>{this._serviceResponseHandler(e,r,n,i,t)})})}remove(e,t=Function.prototype){u.default.args(e,"object",t,"function=")&&!e.name&&!e.workspace&&u.default.args2("params.name",e.name,"string"),c.default.system.debug("WorkspaceClient.remove",e);return new Promise(async(r,n)=>{e.name||(e.name=e.workspace.name,delete e.workspace);const i=(await this.getActiveWorkspace()).data;if(e.name===i.name){c.default.system.error("APPLICATION LIFECYCLE:  Cannot remove active workspace: WorkspaceClient.remove:attempt to remove active workspace name:"+i.name);const e="Cannot remove active workspace";return this._serviceResponseHandler(e,null,r,n,t)}this.routerClient.query(d.WORKSPACE.API_CHANNELS.REMOVE,e,(e,i)=>{this._serviceResponseHandler(e,i,r,n,t)})})}rename(e,t=Function.prototype){u.default.args(e,"object",t,"function=")&&u.default.args2("params.oldName",e.oldName,"string","params.newName",e.newName,"string"),c.default.system.debug("WorkspaceClient.rename",e);return new Promise((r,n)=>{if(!e.overwriteExisting&&this.workspaceExists(e.newName)){const e="Workspace Already Exists";return this._serviceResponseHandler(e,null,r,n,t)}this.routerClient.query(d.WORKSPACE.API_CHANNELS.RENAME,e,(e,i)=>{this._serviceResponseHandler(e,i,r,n,t)})})}clone(e,t=Function.prototype){return u.default.args(e,"object",t,"function=")&&u.default.args2("params.name",e.name,"string"),delete e.name,e.newName||(e.newName=e.name+"_clone"),e.removeOldWorkspace=!1,this.rename({removeOldWorkspace:!1,newName:e.newName,oldName:e.name},t)}save(e=Function.prototype){c.default.system.debug("WorkspaceClient.save");return new Promise((t,r)=>{this.routerClient.query(d.WORKSPACE.API_CHANNELS.SAVE,{},(n,i)=>{this._serviceResponseHandler(n,i,t,r,e)})})}workspaceExists(e){u.default.args(e,"string");for(let t=0;t<this.workspaces.length;t++)if(e===this.workspaces[t])return!0;return!1}saveAs(e,t=Function.prototype){u.default.args(e,"object",t,"function=")&&u.default.args2("params.name",e.name,"string"),c.default.system.debug("WorkspaceClient.saveAs",e);return new Promise((r,n)=>{if(!e.force&&this.workspaceExists(e.name))return this._serviceResponseHandler("Workspace Already Exists",null,r,n,t);this.routerClient.query(d.WORKSPACE.API_CHANNELS.SAVE_AS,e,(e,i)=>{this._serviceResponseHandler(e,i,r,n,t)})})}async switchTo(e,t=Function.prototype){u.default.args(e,"object",t,"function")&&u.default.args2("params.name",e.name,"string"),c.default.system.debug("WorkspaceClient.switchTo",e);const r=await this.routerClient.query(d.WORKSPACE.API_CHANNELS.SWITCH_TO,e);if(r.err)throw t(r.err,null),new Error(r.err);return t(r),r}async _setWindowState(e){if(!this.activeWorkspace)throw"Workspace is not yet ready";if(!this.activeWorkspace.windows.includes(e.windowName))throw"Cannot set state for Window not in workspace";return c.default.system.debug("WorkspaceClient.setWindowData",e),this.routerClient.query(d.WORKSPACE.API_CHANNELS.SET_WINDOW_STATE,e)}async _getWindowState(e){return c.default.system.debug("WorkspaceClient.getWindowData",e),this.routerClient.query(d.WORKSPACE.API_CHANNELS.GET_WINDOW_STATE,e)}async isWorkspaceDirty(e=Function.prototype){u.default.args(e,"function"),c.default.system.debug("WorkspaceClient.isWorkspaceDirty");const{err:t,response:r}=await this.routerClient.query(d.WORKSPACE.API_CHANNELS.GET_ACTIVE_WORKSPACE_DIRTY,{},()=>{});return e(t,r),r.data}async createWorkspace(e,t,r=((e,t)=>{e&&(c.default.system.error("Error creating workspace: "+e),c.default.system.info("Result from create workspace: "+t))})){c.default.system.log(`WorkspaceClient: Creating Workspace Request for name "${e}"`);const n=(await this.routerClient.query(d.WORKSPACE.API_CHANNELS.NEW_WORKSPACE,{workspaceName:e})).response.data;!1!==t.switchAfterCreation&&await this.switchTo({name:n});const i={workspaceName:n};return r(null,i),i}export(e,t){u.default.args(e,"object",t,"function")&&u.default.args2("params.workspaceName",e.workspaceName,"string"),c.default.system.debug("WorkspaceClient.export",e);return new Promise((r,n)=>{this.routerClient.query(d.WORKSPACE.API_CHANNELS.EXPORT,e,(i,o)=>{const s={};s[e.workspaceName]=o.data,this._serviceResponseHandler(i,{data:s},r,n,t)})})}async import(e,t){u.default.args(e,"object",t,"function=")&&u.default.args2("params.workspaceJSONDefinition",e.workspaceJSONDefinition,"object"),c.default.system.debug("WorkspaceClient.import",e);const r=(await this.routerClient.query(d.WORKSPACE.API_CHANNELS.IMPORT,e)).response.data;if(r&&r.err)throw t(r.err),new Error(r.err);return t&&t(null,r),r}exportToFile(e){c.default.system.info("workspaceClient.saveWorkspaceTemplateToConfigFile",e),u.default.args(e,"object")&&u.default.args2("params.workspaceTemplateDefinition",e.workspaceTemplateDefinition,"object");const{workspaceTemplateDefinition:t}=e;if("object"==typeof t){const e=Object.keys(t)[0];if(e&&t[e].templateDefinitionFlag){const r={workspaceTemplates:t};f.ConfigUtilInstance.promptAndSaveJSONToLocalFile("workspaceConfig-"+e,r)}else c.default.system.error("workspaceClient.saveWorkspaceTemplateToConfigFile. Input is not a legal template")}else c.default.system.error("workspaceClient.saveWorkspaceTemplateToConfigFile: Input is not a legal object")}async start(e){this.routerClient.subscribe("Finsemble.WorkspaceService.update",(t,r)=>{c.default.system.debug("workspaceClient init subscribe response",t,r),t?c.default.system.error(t):(this.activeWorkspace=r.data.activeWorkspace,this.workspaces=r.data.workspaces,e&&e())})}}var p=new h({onReady:e=>{p.start(e)},name:"workspaceClient"});t.default=p},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HideSplashScreenTask=void 0;const i=n(r(4)),o=n(r(21)),s=r(6);t.HideSplashScreenTask=class{start(e){i.default.system.log("Hide Splash Screen Task Started. If splashScreenTimeout is 0, this hides the splash screen."),o.default.getValue("splashScreenTimeout",(t,r)=>{r||s.System.hideSplashScreen(),e("hideSplashScreenTask","bootTasks","completed")})}}},function(e,t,r){"use strict";
/*!
 * Copyright 2017 - 2020 by ChartIQ, Inc.
 * All rights reserved.
 */var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WaitForUpdateDownloadTask=void 0;const i=n(r(4)),o=n(r(10)),s=r(6),a=n(r(21)),l=n(r(53));t.WaitForUpdateDownloadTask=class{async start(e){i.default.system.debug("waitForUpdateDownloadTask start");const{data:t}=await a.default.getValue({field:"finsemble.waitForUpdate"});t?s.System.getUpdateAvailable(t=>{t?(i.default.system.debug("Waiting for update to download"),l.default.alert("alert","ONCE-SINCE-STARTUP","Waiting for download","Update available. Waiting for it to download before starting."),s.System.addEventListener("apply-update-requested",()=>{i.default.system.debug("Update downloaded... restarting"),o.default.transmit("Application.restart",{})})):(i.default.system.debug("Update not available... continue startup"),e("waitForUpdateDownloadTask","bootTasks","completed"))}):(i.default.system.debug("Starting without waiting for update to download"),e("waitForUpdateDownloadTask","bootTasks","completed"))}}}]).default}));